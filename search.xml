<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[è®°â€œé¦™è•‰æ’­æ”¾å™¨â€ä¸Šæ¶çš„è¾›é…¸å†ç¨‹]]></title>
    <url>%2F2018%2F10%2F07%2F%E8%AE%B0%E2%80%9C%E9%A6%99%E8%95%89%E6%92%AD%E6%94%BE%E5%99%A8%E2%80%9D%E4%B8%8A%E6%9E%B6%E7%9A%84%E8%BE%9B%E9%85%B8%E5%8E%86%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢å…ˆè¯´ç‚¹åºŸè¯ï¼Œä»äº‹iOSå¼€å‘ä»¥æ¥ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„APPä¸Šæ¶App Storeï¼Œå¹¶ä¸”ç™»ä¸Šè‹¹æœæ¨èæ¦œå•ï¼Œè¿™å¯èƒ½æ˜¯å¤§å¤šæ•°iOSerçš„æ¢¦æƒ³ã€‚åœ¨è„‘å­é‡Œäº§ç”Ÿäº†å„ç§æƒ³æ³•ï¼Œä½†æ˜¯å‘ç°è‡ªå·±èƒ½æƒ³åˆ°çš„åˆ«äººéƒ½åšäº†ï¼Œå¹¶ä¸”åšçš„å¾ˆå¥½ï¼ŒåŠ ä¸Šå·¥ä½œç”Ÿæ´»ä¸Šçš„å¾ˆå¤šäº‹æƒ…ï¼ˆä¸»è¦æ˜¯æ‡’ğŸ˜ï¼‰ï¼Œä¸€æ‹–å°±æ˜¯3å¹´ã€‚åæ¥å› ä¸ºè‡ªå·±çš„çœŸå®éœ€æ±‚ï¼ŒApp Storeæ‰¾ä¸åˆ°èƒ½æ»¡è¶³éœ€æ±‚çš„äº§å“ï¼Œå°±åšäº†ä¸€ä¸ªæ’­æ”¾å™¨è‡ªå·±ç”¨ï¼Œåœ¨ä¸­ç§‹å‡æœŸç‹ ä¸‹å¿ƒæ¥ï¼Œä¹°äº†å¼€å‘è€…è´¦å·ï¼ˆ688ï¼Œå¿ƒç—›ï¼ï¼å°±å½“ä¸ºäº†æ¢¦æƒ³å……å€¼å§ã€‚ï¼‰ï¼ŒæŠŠè¿™ä¸ªæ’­æ”¾å™¨ä¸Šæ¶äº†ã€‚ è´­ä¹°å¼€å‘è€…è´¦å·å…³äºæ€ä¹ˆä¹°ä¸ªäººå¼€å‘è€…è´¦å·ï¼Œç½‘ä¸Šçš„æ•™ç¨‹ä¸€æŠ“ä¸€å¤§æŠŠï¼Œæ•´ä¸ªè´­ä¹°æµç¨‹ä¹Ÿæ²¡å•¥å¥½æ³¨æ„çš„ï¼Œæ ¹æ®æç¤ºä¸€æ­¥ä¸€æ­¥èµ°å°±OKäº†ã€‚ä½†æ˜¯åˆ°äº†æœ€åä»˜æ¬¾ç¯èŠ‚æŠŠæˆ‘å¡äº†ä¸€å‘¨ï¼ˆåŠäº†ä¸¤å¼ ä¿¡ç”¨å¡ã€‚ã€‚ã€‚ï¼‰ï¼Œå¿…é¡»è¦visa+é“¶è”åŒæ ‡çš„ä¿¡ç”¨å¡ï¼Œæ³¨æ„ä¸€å®šè¦åŒæ ‡ï¼Œåªæœ‰visaæˆ–è€…åªæœ‰é“¶è”éƒ½ä¸è¡Œã€‚ä»˜äº†æ¬¾ä¸€å¤©å·¦å³è‹¹æœå°±ä¼šå‘æ¥é‚®ä»¶ï¼Œæä¾›èº«ä»½è¯æ­£åé¢ç…§ç‰‡å°±å¯ä»¥äº†ã€‚ ä¸Šæ¶App Storeä¸Šæ¶æµç¨‹å°±è½»è½¦ç†Ÿè·¯äº†ï¼Œæ‰“åŒ…ä¸Šä¼ ã€å¡«å†™å„ç§APPè¯´æ˜ã€ä¸Šä¼ å›¾æ ‡ã€å®£ä¼ å›¾ã€æäº¤å®¡æ ¸ã€‚æ¿€åŠ¨çš„æˆ‘ä¸€æ™šä¸Šæ²¡ç¡å¥½è§‰ï¼Œç¬¬äºŒå¤©æ—©ä¸Šæ‰“å¼€é‚®ç®±ï¼Œç­‰å¾…æˆ‘çš„å±…ç„¶æ˜¯2.1å¤§ç¤¼åŒ…ï¼ˆGuideline 2.1 - Information Neededï¼‰ã€‚ ä¸€çœ‹æˆ‘å°±æ‡µé€¼äº†ï¼Œä¸Šæ¶è¿™ä¹ˆå¤šæ¬¡ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¹ˆä¸¥å‰çš„å›å¤ï¼Œæ„Ÿè§‰åˆ†åˆ†é’Ÿè¦è¢«å°å·ã€‚ç»è¿‡å¤šæ–¹å’¨è¯¢ï¼Œå‘ç°è¿™æ˜¯è‹¹æœä»Šå¹´æ–°æ¨å‡ºçš„å¤§ç¤¼åŒ…ï¼Œå¾ˆå¤šäººéƒ½é‡åˆ°è¿‡ï¼Œä¸€èˆ¬æ˜¯æœºå™¨å®¡æ ¸å›å¤çš„ï¼Œé‡åˆ°è¿™ç§æƒ…å†µåˆ«æ…Œï¼ˆé™¤éä½ æ˜¯é©¬ç”²åŒ…ã€æˆ–è€…æŠ„è¢­çš„ä¹‹ç±»çš„APPï¼‰ï¼Œä»”ç»†æ£€æŸ¥æ¡ä¾‹ï¼Œç„¶åé€æ¡ç­”å¤ï¼ˆæœ€å¥½ç”¨è‹±æ–‡ï¼‰ã€‚æœ€åæˆ‘è¿˜å½•åˆ¶äº†ä¸€ä¸ªè§†é¢‘ï¼Œæ¥æ¼”ç¤ºæˆ‘çš„APPçš„ä¸»è¦åŠŸèƒ½ï¼Œä¸Šä¼ åˆ°youtubeï¼Œé™„åœ¨äº†å¤‡æ³¨ã€‚åˆ†äº«ä¸‹æˆ‘çš„ç­”å¤æ¨¡æ¿ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243å°Šæ•¬çš„è‹¹æœå®¡æ ¸å›¢é˜Ÿï¼š æ„Ÿè°¢æ‚¨çš„è€å¿ƒå®¡æ ¸ï¼Œé’ˆå¯¹ä¸‹é¢é—®é¢˜ï¼Œæˆ‘ä»¬åšäº†è¯¦ç»†çš„æ£€æŸ¥ å…³äº Guideline 2.11.1.6 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åŒ…å«ä»»ä½•çš„è™šå‡ä¸è¯¯å¯¼ä¿¡æ¯ï¼Œå…¨éƒ¨éƒ½æ˜¯çœŸå®æœ‰æ•ˆçš„2.3.0 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åœ¨é€šè¿‡å®¡æ ¸åä¿®æ”¹ä»»ä½•æ¦‚å¿µå’ŒåŠŸèƒ½2.3.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åŒ…å«ä»»ä½•éšè—åŠŸèƒ½ï¼Œæ²¡æœ‰åŒ…å«èµŒåšã€å½©ç¥¨ç½‘ç«™3.1.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€å†…æ²¡æœ‰ä»»ä½•å†…è´­ã€æ”¯ä»˜åŠŸèƒ½ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯å…è´¹æä¾›ç»™ç”¨æˆ·3.2.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€å†…éƒ¨åŒ…å«ä»»ä½•è´·æ¬¾ç­‰é‡‘èæœåŠ¡4.3.0 - â€œé¦™è•‰æ’­æ”¾å™¨â€åŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹å¼€å‘ï¼Œä¸å­˜åœ¨æŠ„è¢­æˆ–è€…å¤§é‡ç›¸ä¼¼5.2.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰æ³•äººå®ä½“å’Œç‰ˆæƒé£é™©5.2.3 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰æä¾›æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œæˆ–è€…å…¶å®ƒå­˜åœ¨ç‰ˆæƒé—®é¢˜çš„éŸ³è§†é¢‘5.3.4 - â€œé¦™è•‰æ’­æ”¾å™¨â€ä»…åœ¨ä¸­å›½åŒºä¸Šæ¶ï¼Œæ²¡æœ‰è¿è§„å†…å®¹å…³äº Guideline 2.3.7æˆ‘å·²ç»æŒ‰ç…§è¯´æ˜ï¼Œä¿®æ”¹äº†å…ƒæ•°æ®ï¼Œè¯·å®¡æ ¸å›¢é˜Ÿå†æ¬¡å®¡æ ¸ã€‚æœ€åå†æ¬¡æ„Ÿè°¢æ‚¨è¾›è‹¦çš„å®¡æ ¸ã€‚Dear Apple Review Team: Thank you for your patience review, we have done a detailed check on the following questions. About Guideline 2.11.1.6 - &quot;Banana Player&quot; does not contain any false and misleading information, all of which are true and effective2.3.0 - &quot;Banana Player&quot; does not modify any concepts and features after passing the review2.3.1 - &quot;Banana Player&quot; does not contain any hidden features, does not contain gambling, lottery sites3.1.1 - There is no in-app purchase and payment function in the â€œBanana Playerâ€, all functions are provided to the user free of charge.3.2.1 - &quot;Banana Player&quot; contains any financial services such as loans4.3.0 - The &quot;Banana Player&quot; feature is developed independently, without plagiarism or a lot of similarity5.2.1 - &quot;Banana Player&quot; has no legal entity and copyright risk5.2.3 - &quot;Banana Player&quot; does not provide file sharing services, or other audio and video with copyright issues5.3.4 - &quot;Banana Player&quot; is only available in China, no illegal contentAbout Guideline 2.3.7I have modified the metadata according to the instructions, please review the team again.Finally, thank you again for your hard review. ç¬¬äºŒå¤©å®¡æ ¸é€šè¿‡ï¼ŒæˆåŠŸä¸Šæ¶ï¼ æ‰“ä¸ªå¹¿å‘Š ä¸‹è½½ğŸ”—ï¼šhttps://dwz.cn/HvVix2hH â€œé¦™è•‰æ’­æ”¾å™¨â€æ˜¯æˆ‘ç‹¬ç«‹å¼€å‘çš„ç¬¬ä¸€æ¬¾APPï¼Œå…è´¹æ— å¹¿å‘Šã€‚ä¸»è¦åŠŸèƒ½åœ¨æ‰‹æœºä¸Šæ’­æ”¾ä»ç½‘ç›˜ã€å…‰ç›˜ã€ç½‘ç«™ä¸‹è½½çš„éŸ³é¢‘èµ„æ–™ã€è¯¾ç¨‹ã€éŸ³ä¹ã€‚æ— éœ€æ•°æ®çº¿ï¼Œç”¨Wi-Fiå°±å¯ä»¥æ‹·è´æ–‡ä»¶åˆ°æ‰‹æœºï¼Œè‡ªåŠ¨è®°å½•æ’­æ”¾è¿›åº¦ã€‚å¦‚æœæœ‰éœ€æ±‚å¯ä»¥æ”¯æŒä¸€æ³¢ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿è”ç³»æˆ‘ã€‚]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°ä¸€ä¸ªè¡Œç»“æŸç¬¦å¼•å‘çš„JSæŠ¥é”™]]></title>
    <url>%2F2018%2F09%2F05%2F%E8%AE%B0%E4%B8%80%E4%B8%AA%E8%A1%8C%E7%BB%93%E6%9D%9F%E7%AC%A6%E5%BC%95%E5%8F%91%E7%9A%84JS%E6%8A%A5%E9%94%99%2F</url>
    <content type="text"><![CDATA[é—®é¢˜æè¿°æœ€è¿‘é‡åˆ°ä¸€ä¸ªç¥å¥‡çš„Bugï¼Œé€šè¿‡UIWebViewçš„stringByEvaluatingJavaScriptFromString:æ–¹æ³•æ‰§è¡Œä¸€æ®µJavaScriptä»£ç æ—¶ï¼ŒJavaScriptæŠ¥é”™: SyntaxError: Unexpected EOF ç»è¿‡ä»”ç»†çš„æ’æŸ¥ï¼Œå‘ç°å¾…æ‰§è¡Œçš„JavaScriptä»£ç é‡Œé¢åŒ…å«U+2028å­—ç¬¦ã€‚è¿˜æ‰¾åˆ°äº†Stack Overflowç›¸å…³è®¨è®ºã€‚JavaScriptè§£æå™¨ä¼šæŠŠè¡Œåˆ†éš”ç¬¦U+2028å’Œæ®µè½åˆ†éš”ç¬¦U+2029è§£ææˆä¸€è¡Œçš„ç»“æŸï¼Œä»£ç é‡Œè¦æ˜¯åŒ…å«è¿™ä¸¤ä¸ªå­—ç¬¦ç›¸å½“äºæ¢è¡Œï¼Œä¾‹å¦‚ï¼š alert(â€œ\u2028â€) å°±ä¼šè¢«è§£æä¸º alert(â€œâ€œ) äºæ˜¯å°±äº§ç”Ÿäº†è¯­æ³•é”™è¯¯ã€‚ è§£å†³æ–¹æ¡ˆæˆ‘ç”¨çš„æ–¹æ³•æ¯”è¾ƒç®€å•ã€ç²—æš´ï¼Œåœ¨æ‰§è¡ŒJavaScriptä»£ç å‰ï¼Œç›´æ¥è¿‡æ»¤æ‰è¿™ä¸¤ä¸ªå­—ç¬¦ã€‚ä»£ç å¦‚ä¸‹ï¼š 1234// javaScriptString = [javaScriptString stringByReplacingOccurrencesOfString:@"\u2028" withString:@""]; javaScriptString = [javaScriptString stringByReplacingOccurrencesOfString:@"\u2029" withString:@""]; NSString* ret = [(UIWebView*)_engineWebView stringByEvaluatingJavaScriptFromString:javaScriptString];]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»ä¸€ä¸ªAFNetworkingå¾ªç¯å¼•ç”¨è¯´èµ·]]></title>
    <url>%2F2018%2F08%2F28%2F%E4%BB%8E%E4%B8%80%E4%B8%AAAFNetworking%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E8%AF%B4%E8%B5%B7%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡åˆ†æä½¿ç”¨ä»£ç æ˜¯AFNetworking 3.2.1 æœ€è¿‘ä½¿ç”¨Instrumentsä¸­çš„Leaksåˆ†æé¡¹ç›®å†…å­˜æ³„éœ²ï¼Œå‘ç°äº†ä¸€ä¸ªAFNetworkingçš„å¾ªç¯å¼•ç”¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é€šè¿‡è°ƒç”¨æ ˆå‘ç°äº§ç”Ÿæ³„éœ²çš„ä»£ç åœ¨è¿™é‡Œï¼š 12345678910// AFURLSessionManager.m- (instancetype)initWithSessionConfiguration:(NSURLSessionConfiguration *)configuration &#123; // ... åˆå§‹åŒ–ä»£ç ï¼Œçœç•¥ // å¯¼è‡´å¾ªç¯å¼•ç”¨çš„æ–¹æ³• self.session = [NSURLSession sessionWithConfiguration:self.sessionConfiguration delegate:self delegateQueue:self.operationQueue]; // ... å…¶å®ƒåˆå§‹åŒ–ä»£ç ï¼Œçœç•¥ return self;&#125; å¤§è‡´åŸå› å°±æ˜¯AFURLSessionManagerå¼•ç”¨NSURLSessionï¼ŒåŒæ—¶è®¾ç½®NSURLSessionçš„delegateä¸ºè‡ªå·±ï¼ŒNSURLSessionä¼šå¼ºå¼•ç”¨delegateï¼Œäºæ˜¯äº§ç”Ÿäº†å¾ªç¯å¼•ç”¨ã€‚ å…³äºNSURLSessionçš„delegateå®˜æ–¹è¯´æ˜ï¼šThis delegate object is responsible for handling authentication challenges, for making caching decisions, and for handling other session-related events. The session object keeps a strong reference to this delegate until your app exits or explicitly invalidates the session. If you do not invalidate the session, your app leaks memory until it exits. è§£å†³æ–¹æ¡ˆåœ¨AFNetworkingå®˜æ–¹issuesæ‰¾åˆ°äº†ç›¸å…³çš„é—®é¢˜Possible memory leak in AFURLSessionManagerã€‚ä½œè€…çš„å›ç­”å¦‚ä¸‹ï¼š è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š è¿™æ˜¯æœ€å¸¸è§ä¹Ÿæ˜¯ä½œè€…æ¨èçš„æ–¹æ³•ï¼Œåªåˆ›å»ºä¸€ä¸ªAFURLSessionManagerï¼Œæ•´ä¸ªAPPå…±äº«ï¼Œè™½ç„¶è¿˜æ˜¯æœ‰å¾ªç¯å¼•ç”¨ï¼Œä½†æ˜¯å°±æ²¡æœ‰å†…å­˜æ³„éœ²çš„é—®é¢˜äº†ã€‚ å¦‚æœè¦ä½¿ç”¨å¤šä¸ªAFURLSessionManagerï¼Œåœ¨ä½¿ç”¨å®Œæˆåæ‰‹åŠ¨è°ƒç”¨invalidateSessionCancelingTasks:æ¥æ–­å¼€å¾ªç¯å¼•ç”¨ã€‚ï¼ˆè¿™ç§æ–¹æ¡ˆä¸æ¨èï¼Œå…·ä½“åŸå› çœ‹ä¸‹ä¸€å°èŠ‚ï¼‰ AFURLSessionManagerå¤ç”¨å…³äºAFURLSessionManageræ˜¯å¦ä½¿ç”¨å•ä¾‹è¿™ä¸ªé—®é¢˜ï¼Œå®˜æ–¹demoä½¿ç”¨çš„æ˜¯å•ä¾‹ï¼Œåœ¨è‹¹æœå®˜æ–¹æ–‡æ¡£æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µè¯ With the NSURLSession API, your app creates one or more sessions, each of which coordinates a group of related data transfer tasks. For example, if youâ€™re creating a web browser, your app might create one session per tab or window, or one session for interactive use and another for background downloads. Within each session, your app adds a series of tasks, each of which represents a request for a specific URL (following HTTP redirects, if necessary). æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œæ ¹æ®ä½¿ç”¨åœºæ™¯çš„ä¸åŒï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸åŒçš„ç­”æ¡ˆï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹APPéƒ½æ˜¯åœ¨å’ŒåŒä¸€æœåŠ¡å™¨æ‰“äº¤é“ï¼Œä¸€ä¸ªsessionå°±å¤Ÿäº†ï¼Œå¦‚æœæœ‰è¿æ¥å¤šä¸ªæœåŠ¡å™¨ã€æˆ–è€…åå°ä¸‹è½½ç­‰åŠŸèƒ½éœ€æ±‚ï¼Œå¯ä»¥ç»™æ¯ä¸ªæœåŠ¡å™¨ã€åå°ä¸‹è½½ä»»åŠ¡åˆ›å»ºå•ç‹¬çš„sessionï¼ˆä½†æ˜¯ä¹Ÿä¸èƒ½æ¯ä¸ªè¯·æ±‚éƒ½å•ç‹¬åˆ›å»ºsessionï¼‰ã€‚ åœ¨æŸ¥æ‰¾èµ„æ–™çš„æ—¶å€™ï¼Œæˆ‘å‘ç°æœ‰åšå®¢æåˆ°å•ä¾‹seesionå¯ä»¥å‡å°‘TCPä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŠ¨æ‰‹éªŒè¯ä¸‹ï¼š å¤šä¸ªç½‘ç»œè¯·æ±‚å¤ç”¨ä¸€ä¸ªAFURLSessionManagerï¼Œè¿ç»­å‘ä¸¤ä¸ªç½‘ç»œè¯·æ±‚ï¼Œç”¨WiresharkæŠ“åŒ…å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡ç½‘ç»œè¯·æ±‚å¤ç”¨äº†ç¬¬ä¸€æ¬¡çš„TCPè¿æ¥ï¼Œæ²¡æœ‰åšä¸‰æ¬¡æ¡æ‰‹ã€‚ ä¸‹å›¾æ˜¯æ¯æ¬¡ç½‘ç»œè¯·æ±‚éƒ½æ–°å»ºä¸€ä¸ªAFURLSessionManagerçš„æŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªç½‘ç»œè¯·æ±‚éƒ½è¿›è¡Œäº†TCPä¸‰æ¬¡æ¡æ‰‹ã€‚ å®éªŒç»“æœçš„ç¡®å¦‚ç½‘ä¸Šæ‰€è¯´ï¼Œå¤ç”¨AFURLSessionManagerå¯ä»¥å‡å°‘ä¸‰æ¬¡æ¡æ‰‹ï¼Œæå‡æ•ˆç‡ã€‚]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSæ¨¡æ‹Ÿå™¨å®‰è£…debugåŒ…]]></title>
    <url>%2F2018%2F08%2F21%2FiOS%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85debug%E5%8C%85%2F</url>
    <content type="text"><![CDATA[ç”±äºé¡¹ç›®æ˜¯Hybridçš„å¹³å°ï¼Œæœ‰ç¬¬ä¸‰æ–¹äººå‘˜éœ€è¦åœ¨ä¸Šé¢å¼€å‘H5åº”ç”¨ï¼Œä½†æ˜¯releaseåŒ…ä¸èƒ½è°ƒè¯•H5ï¼Œåªæœ‰debugæŠ¥å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯é¡¹ç›®æºç ä¸èƒ½äº¤ç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨googleæœç´¢äº†ä¸‹ï¼Œå‘ç°ä¸€ç¯‡éœœç¥çš„æ–‡ç« ï¼Œè®²çš„æ˜¯debugåŒ…å¯ä»¥æ‹·è´åˆ°å…¶å®ƒæœºå™¨è¿è¡Œï¼Œäºæ˜¯å®è·µäº†ä¸€æ³¢ã€‚ ç¯å¢ƒå‡†å¤‡ Xcode Command Line Tools ios-sim ios-simå®‰è£…å‘½ä»¤ï¼šnpm install ios-sim -g æ‹·è´æœ¬åœ°çš„debugåŒ… runä¸€æ¬¡éœ€è¦æ‹·è´çš„é¡¹ç›®ï¼Œå®‰è£…åˆ°æ¨¡æ‹Ÿå™¨ä¸Š æ‰§è¡Œä¸‹é¢å‘½ä»¤è¡Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç›®æ ‡è·¯å¾„/xxx.zipå°±æ˜¯æ‹·è´å‡ºæ¥çš„debugåº”ç”¨åŒ…ï¼Œéœ€è¦æ›¿æ¢ä¸ºè‡ªå·±çš„è·¯å¾„ï¼Œä¾‹å¦‚/Users/crmo/Desktop/debug/debug.zip 1ditto -ck --sequesterRsrc --keepParent `ls -1 -d -t ~/Library/Developer/Xcode/DerivedData/*/Build/Products/*-iphonesimulator/*.app | head -n 1` ç›®æ ‡è·¯å¾„/xxx.zip æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨1. è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨ ios-sim showdevicetypes å¯ä»¥çœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºï¼Œå°±æ˜¯æœ¬æœºå¯ç”¨çš„æ¨¡æ‹Ÿå™¨ï¼Œé€‰æ‹©ä¸€ä¸ªéœ€è¦è¿è¡Œçš„æ¨¡æ‹Ÿå™¨ã€‚ 123456789101112131415161718192021~ ios-sim showdevicetypesApple-Watch-38mm, watchOS 4.3Apple-Watch-42mm, watchOS 4.3Apple-Watch-Series-2-38mm, watchOS 4.3Apple-Watch-Series-2-42mm, watchOS 4.3iPhone-7-Plus, 10.3iPhone-7-Plus, 11.4Apple-Watch-Series-3-38mm, watchOS 4.3Apple-Watch-Series-3-42mm, watchOS 4.3iPhone-5s, 11.4iPhone-6, 11.4iPhone-6-Plus, 11.4iPhone-6s, 11.4iPhone-6s-Plus, 11.4iPhone-7, 11.4iPhone-SE, 11.4iPad-Air, 11.4iPad-Air-2, 11.4iPhone-8, 11.4iPhone-8-Plus, 11.4iPhone-X, 11.4 2. åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ… ios-sim launch åº”ç”¨åŒ…è·¯å¾„/xxx.app â€“devicetypeid æ¨¡æ‹Ÿå™¨ éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œdebug.zipè§£å‹åå°±å¯ä»¥å¾—åˆ°å¯¹åº”åº”ç”¨çš„.appæ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘çš„debugåŒ…æ”¾åœ¨/Users/crmo/Desktop/debug/debug.appï¼Œæ¨¡æ‹Ÿå™¨é€‰æ‹©iPhone-8ï¼Œæœ€ç»ˆçš„å‘½ä»¤æ˜¯ ios-sim launch /Users/crmo/Desktop/debug/debug.app â€“devicetypeid iPhone-8 simctl was not foundé”™è¯¯è§£å†³åœ¨å®è·µæ—¶æµ‹è¯•æœºçš„Command Line Toolsæ²¡æœ‰é…ç½®å¥½ï¼Œå‡ºç°æŠ¥é”™ï¼š 1234simctl was not found.Check that you have Xcode 8.x installed: xcodebuild --versionCheck that you have Xcode 8.x selected: xcode-select --print-path è§£å†³åŠæ³•ï¼š 1.é¦–å…ˆç¡®ä¿æ­£ç¡®å®‰è£…äº†Command Line Toolsï¼Œ å¸è½½Command Line Tools:rm -rf /Library/Developer/CommandLineToolså®‰è£…Command Line Tools:xcode-select â€“install 2.åœ¨xcodeé…ç½®ä¸€ä¸‹Command Line Toolsï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º å‚è€ƒåšå®¢ï¼š unable to find utility â€œsimctlâ€çš„è§£å†³æ–¹æ¡ˆ ç»™ iOS æ¨¡æ‹Ÿå™¨ â€œå®‰è£…â€app æ–‡ä»¶]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[dispatch_syncæ­»é”é—®é¢˜]]></title>
    <url>%2F2018%2F08%2F03%2Fdispatch_sync%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[é—®é¢˜åˆ†æä½¿ç”¨dispatch_syncçš„æ—¶å€™è¦å°å¿ƒè°¨æ…ï¼Œç¨ä¸æ³¨æ„å°±ä¼šå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå…ˆçœ‹ä¸¤ä¸ªå…¸å‹çš„æ¡ˆä¾‹ï¼š æ¡ˆä¾‹ä¸€ 12345678- (void)deadlock1 &#123; dispatch_queue_t queue = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL); dispatch_sync(queue, ^&#123; dispatch_sync(queue, ^&#123; NSLog(@&quot;&quot;); &#125;); &#125;);&#125; æ¡ˆä¾‹äºŒ 1234567891011- (void)deadlock2 &#123; dispatch_queue_t queue1 = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL); dispatch_queue_t queue2 = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL); dispatch_sync(queue1, ^&#123; dispatch_sync(queue2, ^&#123; dispatch_sync(queue1, ^&#123; NSLog(@&quot;&quot;); &#125;); &#125;); &#125;);&#125; ä¸Šé¢ä¸¤ä¸ªæ¡ˆä¾‹æ­»é”çš„åŸå› éƒ½æ˜¯åŒä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—çš„ä»»åŠ¡ç›¸äº’ç­‰å¾…ã€‚ å½“ç„¶å®é™…å·¥ç¨‹ä¸­é‡åˆ°çš„æ­»é”é—®é¢˜ä¼šæ›´åŠ å¤æ‚ï¼Œéš¾ä»¥åˆ†æã€‚ å…¸å‹è¯¯åŒºåœ¨é˜…è¯»ç›¸å…³ä¹¦ç±ã€åšå®¢éƒ½æåˆ°äº†ä¸€ä¸ªæ–¹æ³•dispatch_get_current_queue()ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°å½“å‰é˜Ÿåˆ—ï¼Œäºæ˜¯æœ‰äººå°±ç”¨å®ƒæ¥è§£å†³æ­»é”é—®é¢˜ã€‚ 123456789101112- (void)safeSync:(void(^)())block &#123; if (!block) &#123; return; &#125; if (dispatch_get_current_queue() == queue) &#123; block(); &#125; else &#123; dispatch_sync(queue, ^&#123; block(); &#125;); &#125;&#125; ç¬¬ä¸€çœ¼çœ‹èµ·æ¥å¤©è¡£æ— ç¼ï¼Œå¯¹äºæ¡ˆä¾‹ä¸€çš„ç¡®å¯ä»¥å®Œç¾è§£å†³ï¼Œä½†æ˜¯å¯¹äºæ¡ˆä¾‹äºŒè¿™ç§å¯¹é˜Ÿåˆ—çš„æƒ…å†µå°±åˆ¤æ–­ä¸äº†ã€‚éš¾æ€ªè‹¹æœåœ¨iOS6å°±æ³¨é‡Šäº†è¿™ä¸ªæ–¹æ³•ã€‚ æ¨èé˜…è¯»ï¼š Thread-Safe Class Design]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UIWebViewè·å–è¯¦ç»†æµè§ˆè®°å½•]]></title>
    <url>%2F2018%2F08%2F01%2FUIWebView%E8%8E%B7%E5%8F%96history%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ‰€ç”¨æ–¹æ³•ä¼šä½¿ç”¨åˆ°è‹¹æœç§æœ‰APIï¼Œä¸Šæ¶APP Storeè¯·è°¨æ…ä½¿ç”¨ã€‚ éœ€æ±‚è·å–UIWebViewçš„å‰è¿›åé€€çš„æµè§ˆè®°å½•ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä»A-&gt;B-&gt;C-&gt;Bï¼Œæ­¤æ—¶Bä¸Šä¸€é¡µæ˜¯Aï¼Œä¸‹ä¸€é¡µæ˜¯Cï¼Œéœ€è¦è·å–Aã€Cçš„URLä¿¡æ¯ã€‚ WKWebViewæš´éœ²äº†è¿™ä¸ªå±æ€§ï¼ŒWKBackForwardList *backForwardListã€‚å¯ä»¥å¾ˆå®¹æ˜“çš„å–åˆ°ï¼Œæ— å¥ˆé¡¹ç›®è¿˜æ˜¯ä½¿ç”¨çš„UIWebViewï¼Œäºæ˜¯æœ‰äº†åé¢çš„æ¢ç´¢ã€‚ é¦–å…ˆåœ¨UIWebViewæä¾›çš„APIé‡Œæ‰¾ï¼Œç›¸å…³çš„APIåªæœ‰canGoBackå’ŒcanGoForwardï¼Œå‘½åå¾ˆç›´è§‚ï¼Œæ˜¯å¦å¯ä»¥åé€€å’Œå‰è¿›ï¼Œè¿™æ¡è·¯èµ°ä¸é€šã€‚æƒ³åˆ°æ˜¯å¦å¯ä»¥é€šè¿‡JSçš„Window.historyè·å–åˆ°ï¼ŒæŸ¥äº†ä¸‹APIï¼Œå”¯ä¸€ä¸€ä¸ªæœ‰ç‚¹åƒçš„lengthå±æ€§ï¼Œæ™ºèƒ½å–åˆ°æµè§ˆè®°å½•ä¸­çš„æ‰€æœ‰URLçš„æ•°é‡ï¼Œä¸åŒºåˆ†å‰åï¼Œæ¯”å¦‚åœ¨ä¸Šé¢æåˆ°çš„ä¾‹å­ä¸­ï¼Œåœ¨Bé¡µé¢å–åˆ°çš„lengthæ˜¯3ï¼Œè€Œä¸”ä¸èƒ½å–å‡ºå…·ä½“çš„URLã€‚ æ— å¥ˆåªæœ‰ä¸Šæºç äº†ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯â€œWebKit-7604.1.38.0.7â€å’Œâ€œWebCore-7604.1.38.0.7â€ã€‚ Window.History.lengthå®ç°æœ¬è´¨åœ¨WebCoreé‡Œé¢æ‰¾åˆ°äº†JSæ–¹æ³•Window.History.lengthå®ç°çš„æœ¬è´¨ï¼Œä¸Šä»£ç ï¼š 12345678910// WebCore History.cppunsigned History::length() const&#123; if (!m_frame) return 0; auto* page = m_frame-&gt;page(); if (!page) return 0; return page-&gt;backForward().count();&#125; 123456// WebCore BackForwardController.cppint BackForwardController::count() const&#123; // count = å½“å‰é¡µä¹‹å‰çš„é¡µé¢æ€»æ•° + å½“å‰é¡µä¹‹åçš„é¡µé¢æ€»æ•° + 1 return m_client-&gt;backListCount() + 1 + m_client-&gt;forwardListCount();&#125; åœ¨WebCoreé‡Œé¢backListCount()ã€forwardListCount()å®šä¹‰æ˜¯è™šå‡½æ•°ï¼Œå…·ä½“å®ç°åœ¨WebKitå¯ä»¥æ‰¾åˆ°ã€‚ 12345678910// WebKit BackForwardList.mmint BackForwardList::backListCount()&#123; return m_current == NoCurrentItemIndex ? 0 : m_current;&#125;int BackForwardList::forwardListCount()&#123; return m_current == NoCurrentItemIndex ? 0 : (int)m_entries.size() - (m_current + 1);&#125; è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸‹ï¼Œåé¢ä¼šç”¨åˆ°ã€‚ 1234567891011// WebKit BackForwardList.mm// è·å–ä¹‹å‰æœ€å¤šå‡ æ¡å†å²è®°å½•void BackForwardList::backListWithLimit(int limit, Vector&lt;Ref&lt;HistoryItem&gt;&gt;&amp; list)&#123; list.clear(); if (m_current != NoCurrentItemIndex) &#123; unsigned first = std::max(static_cast&lt;int&gt;(m_current) - limit, 0); for (; first &lt; m_current; ++first) list.append(m_entries[first].get()); &#125;&#125; è·å–Historyåœ¨WebViewçš„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°WebBackForwardListçš„å®šä¹‰ã€‚ 12345/*! @property backForwardList @abstract The backforward list for this WebView.*/ @property (nonatomic, readonly, strong) WebBackForwardList *backForwardList; WebBackForwardListæ˜¯å¯¹BackForwardListçš„ä¸€å±‚å°è£…ï¼Œé˜…è¯»ä¸€ä¸‹å®ƒçš„.hæ–‡ä»¶ï¼Œä¸éš¾æ‰¾åˆ°è·å–æµè§ˆè®°å½•çš„æ–¹æ³•ã€‚ 1234567/*! @method backListWithLimit: @abstract Returns a portion of the list before the current entry. @param limit A cap on the size of the array returned. @result An array of items before the current entry, or nil if there are none. The entries are in the order that they were originally visited.*/- (NSArray *)backListWithLimit:(int)limit; ä¸Šé¢çš„æ–¹æ³•å¯ä»¥è·å–åˆ°ä¸€ä¸ªWebHistoryItemæ•°ç»„ï¼ŒWebHistoryItemä¿å­˜äº†æµè§ˆè®°å½•çš„è¯¦ç»†ä¿¡æ¯ã€‚ è·å–WebBackForwardListUIWebViewæ²¡æœ‰æš´éœ²è·å–WebViewæˆ–è€…WebBackForwardListçš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨KVOæ›²çº¿æ•‘å›½ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°WebViewçš„ç§æœ‰å˜é‡åã€‚ç”¨runtimeå¯ä»¥åšåˆ°ï¼Œä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘å†™äº†ä¸€ä¸ªå·¥å…·ç±»æ¥è¾…åŠ©æœç´¢ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« -runtimeå®ç°ç§æœ‰å˜é‡æœç´¢ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”¨runtimeè·å–ç±»æˆå‘˜å˜é‡åˆ—è¡¨ï¼Œç„¶åç”¨BFSæ¥æœç´¢æˆ‘ä»¬è¦æ‰¾çš„ç±»ã€‚ 12345678910// ä»¥UIWebViewä¸ºæ ¹èŠ‚ç‚¹ï¼ŒBFSæœç´¢WebView[BFSSearchClass searchClass:@"WebView" inClass:@"UIWebView"];// æœç´¢ç»“æœå¦‚ä¸‹// Class Nameï¼šç±»åï¼ŒIvar Nameï¼šå˜é‡åï¼ŒSuper Classï¼šçˆ¶ç±»Class Name:ã€WebViewã€‘,Ivar Name:ã€_webViewã€‘Class Name:ã€UIWebDocumentViewã€‘,Ivar Name:ã€Super Classã€‘Class Name:ã€UIWebBrowserViewã€‘,Ivar Name:ã€browserViewã€‘Class Name:ã€UIWebViewInternalã€‘,Ivar Name:ã€_internalã€‘Root Class:UIWebView æœ‰äº†ä¸Šé¢çš„ç»“è®ºï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨KVCæ¥è·å–åˆ°æµè§ˆè®°å½•äº†ã€‚ 12345678910111213- (void)printWebViewHistory:(UIWebView *)aWebView &#123; id webviewInternal = [aWebView valueForKey:@"_internal"]; id browserView = [webviewInternal valueForKey:@"browserView"]; id webView = [browserView valueForKey:@"_webView"]; id backForwardList = [webView performSelector:@selector(backForwardList)]; // WebHistoryItemå­˜å‚¨çš„å…·ä½“æŸæ¡æµè§ˆè®°å½•ä¿¡æ¯ NSArray *historyItems = [backForwardList performSelector:@selector(backListWithLimit:) withObject:@10]; for (id item in historyItems) &#123; // è·å–æµè§ˆè®°å½•çš„url NSString *url = [item performSelector:@selector(URLString)]; NSLog(@"%@", url); &#125;&#125;]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[runtimeå®ç°ç§æœ‰å˜é‡æœç´¢]]></title>
    <url>%2F2018%2F07%2F31%2Fruntime%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F%E6%90%9C%E7%B4%A2%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡Demo(https://github.com/crmo/BFSSearchClass)åœ°å€ éœ€æ±‚åœ¨å¼€å‘åŠŸèƒ½æ—¶ï¼Œä¸ºäº†æ»¡è¶³äº§å“å˜æ€çš„éœ€æ±‚ï¼Œéš¾å…æœ‰ç³»ç»Ÿç±»æä¾›çš„APIä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œè¿™æ—¶å€™ç§æœ‰å˜é‡å°±å¯ä»¥å‘æŒ¥å®ƒå…‰å’Œçƒ­äº†ã€‚æ€ä¹ˆé€šè¿‡ä¸€ä¸ªç±»ï¼Œä¸€å±‚ä¸€å±‚çš„æ‰¾åˆ°ç‰¹å®šç±»å‹çš„ç§æœ‰æˆå‘˜å˜é‡ï¼Ÿå—ç›ŠäºObjective-Cçš„åŠ¨æ€è¯­è¨€ç‰¹æ€§ï¼Œå°±ç®—è‹¹æœUIKitä¸å¼€æºï¼Œä½†æ˜¯åœ¨runtimeé¢å‰ï¼Œç±»çš„ç»“æ„è¿˜æ˜¯æš´éœ²æ— é—ã€‚æˆ‘çš„æ€è·¯æ˜¯é€å±‚æ‰‹åŠ¨æ‰“å°æˆå‘˜å˜é‡ä¿¡æ¯ï¼Œå¦‚æœæ˜¯UIæ§ä»¶å¯ä»¥ç”¨Revealæ¥åŠ å¿«è¿›åº¦ï¼Œé…åˆKVCæœºåˆ¶ï¼Œè·å–ç§æœ‰å˜é‡å°±å¦‚åŒæ¢å›Šå–ç‰©ä¸€èˆ¬ã€‚åœ¨å¤šæ¬¡é‡åˆ°è¿™ä¸ªé—®é¢˜åï¼Œæˆ‘å†³å®šå®ç°ä¸€ä¸ªå·¥å…·ç±»æ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæ¯•ç«Ÿèƒ½è‡ªåŠ¨åŒ–çš„å°±å°½é‡ä¸è¦æ‰‹åŠ¨ã€‚ æ€è·¯ æœç´¢èŒƒå›´ï¼šæˆå‘˜å˜é‡ã€å±æ€§ å…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š runtimeä¸­çš„æ–¹æ³•class_copyIvarList()ï¼Œå¯ä»¥å–å‡ºç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ç»“æ„ä½“Ivarã€‚ ä»Ivarä¸­å¯ä»¥å–å‡ºæˆå‘˜å˜é‡ç±»å‹Type Encodings ç”¨Type Encodingsè·å–åˆ°ç±»å éå†ç±»çš„æ‰€æœ‰Ivarï¼Œè·å–åˆ°ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡çš„ç±»ä¿¡æ¯ ä½†æ˜¯é—®é¢˜æ²¡è¿™ä¹ˆç®€å•ï¼Œæ¯”å¦‚ClassAæ˜¯ClassBçš„æˆå‘˜å˜é‡ï¼ŒClassBæ˜¯ClassCçš„æˆå‘˜å˜é‡ï¼Œæƒ³é€šè¿‡ClassCæ‰¾åˆ°ClassAï¼Œéœ€è¦å‘ä¸‹æ‰¾ä¸¤å±‚æ‰èƒ½æ‰¾åˆ°ï¼Œè¿˜è¦è€ƒè™‘çˆ¶ç±»çš„æƒ…å†µã€‚æ•´ä¸ªæœç´¢è¿‡ç¨‹å°±æ˜¯ä¸€é¢—ä»¥å¾…æœç´¢ç±»ä¸ºæ ¹çš„æ ‘ï¼Œå¯ä»¥ç”¨BFSæ¥æœç´¢ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼ˆå¦‚å›¾ï¼Œæ•°å­—æ˜¯æœç´¢é¡ºåºï¼‰ï¼š ä»æ ¹èŠ‚ç‚¹å¼€å§‹æœç´¢ é¦–å…ˆéå†å½“å‰èŠ‚ç‚¹çš„çˆ¶ç±»ï¼ŒåŠ å…¥æœç´¢é˜Ÿåˆ— å†å–å‡ºå½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼ŒåŠ å…¥æœç´¢é˜Ÿåˆ— å¦‚ä½•ä»Ivarä¸­è·å–ClassIvarä¸­ä¸èƒ½ç›´æ¥å–å‡ºå¯¹åº”ç±»åï¼Œåªèƒ½å–å‡ºType Encodingsï¼Œé—´æ¥å¯ä»¥å¾—åˆ°ç±»åã€‚ä»å®˜æ–¹æ–‡æ¡£æˆªäº†å¼ å›¾ï¼Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°Codeçš„å®šä¹‰ã€‚ åŸºæœ¬æ•°æ®ç±»å‹ã€idç±»å‹ã€é›†åˆç±»å‹ã€ç»“æ„ä½“ç­‰ç±»å‹å°±ä¸éœ€è¦æœç´¢äº†ï¼Œå¯ä»¥è¿‡æ»¤æ‰ã€‚æˆ‘ä»¬åªæœç´¢ä¸¤ç§ç±»å‹ ç±»ï¼Œä¾‹å¦‚@&quot;UIWebViewInternal&quot; ä»£ç†ï¼Œä¾‹å¦‚@&quot;&lt;UIViewControllerTransitioningDelegate&gt;&quot; ä¼˜åŒ–åŠå­˜åœ¨é—®é¢˜ å¯ä»¥ç”¨ä¸€ä¸ªNSMutableSetå­˜å‚¨å·²ç»æœç´¢è¿‡çš„ç±»ï¼Œæ¯æ¬¡æœç´¢å‰åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å·²ç»æœç´¢è¿‡ è®°å½•æœç´¢æ¬¡æ•°ï¼Œå¯ä»¥é™åˆ¶æœç´¢æ¬¡æ•°ã€‚ å¯¹äºå®šä¹‰ä¸ºidç±»å‹ã€é›†åˆç±»çš„æˆå‘˜å˜é‡æ²¡æœ‰åšå¤„ç†ï¼Œå¯ä»¥ç»§ç»­æ·±å…¥éå†]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSæ¨ªç«–å±æ€»ç»“]]></title>
    <url>%2F2018%2F07%2F23%2FiOS%E6%A8%AA%E7%AB%96%E5%B1%8F%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨Auto Layoutæ¥è¿›è¡Œå¸ƒå±€å°±ä¸ç”¨è‡ªå·±å»ç›‘å¬æ¨ªç«–å±äº‹ä»¶äº†ï¼Œåªéœ€è¦ç»˜åˆ¶å¤šå¥—å¸ƒå±€å³å¯ã€‚ä½†æ˜¯é¡¹ç›®æœ‰å¾ˆå¤šé¡µé¢æ˜¯è‡ªå·±æ‰‹åŠ¨è®¡ç®—çš„ï¼Œäºæ˜¯åªæœ‰æƒ³åŠæ³•å†æ—‹è½¬å±å¹•æ—¶é‡æ–°å¸ƒå±€ã€‚ ç›¸å…³æšä¸¾å±å¹•æ–¹å‘æœ‰3ä¸ªç›¸å…³æšä¸¾ï¼Œç•Œé¢æ–¹å‘UIInterfaceOrientationï¼Œè®¾å¤‡æ–¹å‘UIDeviceOrientationï¼Œæ”¯æŒæ—‹è½¬æ–¹å‘UIInterfaceOrientationMaskã€‚ æ³¨æ„UIInterfaceOrientationä¸UIDeviceOrientationå·¦å³æ–¹å‘æ˜¯ç›¸åçš„ 1234567891011121314151617typedef NS_ENUM(NSInteger, UIInterfaceOrientation) &#123; UIInterfaceOrientationUnknown = UIDeviceOrientationUnknown, UIInterfaceOrientationPortrait = UIDeviceOrientationPortrait, UIInterfaceOrientationPortraitUpsideDown = UIDeviceOrientationPortraitUpsideDown, UIInterfaceOrientationLandscapeLeft = UIDeviceOrientationLandscapeRight, UIInterfaceOrientationLandscapeRight = UIDeviceOrientationLandscapeLeft&#125;;typedef NS_OPTIONS(NSUInteger, UIInterfaceOrientationMask) &#123; UIInterfaceOrientationMaskPortrait = (1 &lt;&lt; UIInterfaceOrientationPortrait), UIInterfaceOrientationMaskLandscapeLeft = (1 &lt;&lt; UIInterfaceOrientationLandscapeLeft), UIInterfaceOrientationMaskLandscapeRight = (1 &lt;&lt; UIInterfaceOrientationLandscapeRight), UIInterfaceOrientationMaskPortraitUpsideDown = (1 &lt;&lt; UIInterfaceOrientationPortraitUpsideDown), UIInterfaceOrientationMaskLandscape = (UIInterfaceOrientationMaskLandscapeLeft | UIInterfaceOrientationMaskLandscapeRight), UIInterfaceOrientationMaskAll = (UIInterfaceOrientationMaskPortrait | UIInterfaceOrientationMaskLandscapeLeft | UIInterfaceOrientationMaskLandscapeRight | UIInterfaceOrientationMaskPortraitUpsideDown), UIInterfaceOrientationMaskAllButUpsideDown = (UIInterfaceOrientationMaskPortrait | UIInterfaceOrientationMaskLandscapeLeft | UIInterfaceOrientationMaskLandscapeRight),&#125;; æ¨ªç«–å±æ§åˆ¶æ§åˆ¶ç•Œé¢æ¨ªç«–å±åˆ‡æ¢æœ‰3ä¸ªé‡è¦çš„ç‚¹ï¼Œæœ€ç»ˆç»“æœä»¥è¿™ä¸‰ä¸ªåœ°æ–¹çš„å€¼å–äº¤é›†ã€‚ 1.info.plistå…¨å±€æ§åˆ¶ å¯ä»¥åœ¨General-&gt;Deplyment Infoç•Œé¢ä¸Šå‹¾é€‰ info.plistæ–‡ä»¶ä¸­é…ç½®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸¤è¾¹ä¼šåŒæ­¥å˜æ›´ 2.AppDelegateä¸­æ ¹æ®ä¸åŒWindowæ§åˆ¶ 1234// AppDelegate- (UIInterfaceOrientationMask)application:(UIApplication *)application supportedInterfaceOrientationsForWindow:(UIWindow *)window &#123; return UIInterfaceOrientationMaskLandscapeLeft | UIInterfaceOrientationMaskPortrait;&#125; 3.åœ¨ViewControllerä¸­æ§åˆ¶å½“å‰é¡µé¢ 12345678// UIViewController- (BOOL)shouldAutorotate &#123; return YES;&#125;- (UIInterfaceOrientationMask)supportedInterfaceOrientations &#123; return UIInterfaceOrientationMaskLandscapeLeft;&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œäº¤é›†ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™ä¼šå¯¼è‡´crash *** Terminating app due to uncaught exception â€˜UIApplicationInvalidInterfaceOrientationâ€™, reason: â€˜Supported orientations has no common orientation with the application, and [ViewControllershouldAutorotate] is returning YESâ€™ æ—‹è½¬äº‹ä»¶ç›‘å¬æ—‹è½¬äº‹ä»¶ä¼ é€’è¿‡ç¨‹1234567op0=&gt;operation: __CFRunLoopDoSources0op1=&gt;operation: UIDeviceop2=&gt;operation: UIWindowop3=&gt;operation: UIViewControllerop4=&gt;operation: UIViewop1-&gt;op2-&gt;op3-&gt;op4 å±å¹•æ—‹è½¬ç›¸å…³äº‹ä»¶viewWillTransitionToSize:withTransitionCoordinator: ViewControllerè¢«çˆ¶å®¹å™¨å˜æ›´sizeæ—¶è°ƒç”¨ï¼ˆä¾‹å¦‚windowæ—‹è½¬æ—¶è°ƒç”¨root view controllerçš„è¯¥æ–¹æ³•ï¼‰ å¦‚æœé‡è½½è¯¥æ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨superä¼ é€’äº‹ä»¶ç»™å­ViewController è¿™ä¸ªæ–¹æ³•æ˜¯æœ€å…³é”®çš„ï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­å¯¹ç•Œé¢è¿›è¡Œé‡æ–°å¸ƒå±€ 12345678910111213- (void)viewWillTransitionToSize:(CGSize)size withTransitionCoordinator:(id &lt;UIViewControllerTransitionCoordinator&gt;)coordinator&#123; // coordinatorç”¨æ¥å¤„ç†è½¬æ¢åŠ¨ç”» [coordinator animateAlongsideTransition:^(id&lt;UIViewControllerTransitionCoordinatorContext&gt; context) &#123; // å¼€å§‹æ—‹è½¬ &#125; completion:^(id&lt;UIViewControllerTransitionCoordinatorContext&gt; context) &#123; // æ—‹è½¬ç»“æŸ &#125;]; // è®°å¾—è°ƒç”¨super [super viewWillTransitionToSize:size withTransitionCoordinator:coordinator];&#125; UIApplicationWillChangeStatusBarOrientationNotification çŠ¶æ€æ å°†è¦æ—‹è½¬ï¼Œè¿™ä¸ªæ—¶å€™å–viewçš„frameè¿˜æ˜¯æ—‹è½¬ä¹‹å‰çš„ NSNotificationä¸­ç”¨key UIApplicationStatusBarOrientationUserInfoKeyå¯ä»¥å–åˆ°å°†è¦æ—‹è½¬åˆ°çš„æ–¹å‘ã€‚ UIApplicationDidChangeStatusBarOrientationNotification çŠ¶æ€æ å·²ç»æ—‹è½¬ï¼Œè¿™ä¸ªæ—¶å€™å–viewçš„frameæ˜¯æ—‹è½¬ä¹‹åçš„ NSNotificationä¸­ç”¨key UIApplicationStatusBarOrientationUserInfoKeyå¯ä»¥å–åˆ°æ—‹è½¬ä¹‹å‰çš„æ–¹å‘ã€‚ UIDeviceOrientationDidChangeNotification è®¾å¤‡æ–¹å‘å˜æ›´ï¼Œåœ¨æ”¶åˆ°é€šçŸ¥æ—¶å–viewçš„frameæ˜¯æ—‹è½¬ä¹‹åçš„ã€‚ åœ¨æ‰‹æœºä¸Šå°†æ—‹è½¬å±å¹•é”å®šä¹‹åï¼Œè®¾å¤‡æ–¹å‘å˜æ›´ä¹‹åæ”¶ä¸åˆ°è¯¥é€šçŸ¥ åœ¨ä»£ç é‡Œé¢é™åˆ¶è®¾å¤‡æ—‹è½¬æ–¹å‘ï¼Œè®¾å¤‡æ–¹å‘å˜æ›´åä¾ç„¶èƒ½æ”¶åˆ°è¯¥é€šçŸ¥ è°ƒç”¨é¡ºåºå¦‚ä¸‹ 12345678910st=&gt;start: æ—‹è½¬å±å¹•e=&gt;end: ç»“æŸop1=&gt;operation: viewWillTransitionToSize:withTransitionCoordinator:op2=&gt;operation: UIApplicationWillChangeStatusBarOrientationNotificationop3=&gt;operation: UIApplicationDidChangeStatusBarOrientationNotificationop4=&gt;operation: viewWillLayoutSubviewsop5=&gt;operation: viewDidLayoutSubviewsop6=&gt;operation: UIDeviceOrientationDidChangeNotificationst-&gt;op1-&gt;op2-&gt;op3-&gt;op4-&gt;op5-&gt;op6-&gt;e è‡ªå®šä¹‰Windowçš„æ—‹è½¬äº‹ä»¶å¦‚æœæƒ³è¦åœ¨è‡ªå®šä¹‰Windowçš„å­Viewæ”¶åˆ°å±å¹•æ—‹è½¬é€šçŸ¥ï¼Œè¦è®¾ç½®UIWindowçš„rootViewControllerï¼Œç„¶åæŠŠæ‰€æœ‰å­viewéƒ½åŠ åˆ°rootViewControllerï¼Œç³»ç»Ÿä¼šå¤„ç†æ¨ªç«–å±äº‹ä»¶ã€‚è¿™é‡Œæˆ‘è¿˜é‡åˆ°ä¸€ä¸ªå‘è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘ã€‚ æ¨èé˜…è¯»https://satanwoo.github.io/2016/09/17/uiwindow-iOS/iOSå±å¹•æ—‹è½¬çŸ¥è¯†ç‚¹ä»¥åŠå®ç°iOS å±å¹•æ—‹è½¬çš„é‚£äº›äº‹ï¼ˆä¸€ï¼‰æµ…è°ˆiOSçš„å¤šWindowå¤„ç†]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘]]></title>
    <url>%2F2018%2F07%2F19%2F%E8%AE%B0%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0UIWindow%E5%AD%90%E7%B1%BB%E7%9A%84%E5%B0%8F%E5%9D%91%2F</url>
    <content type="text"><![CDATA[é—®é¢˜æè¿°é¡¹ç›®ä¸­ä¸ºäº†å®ç°ä¸€ä¸ªå…¨å±€é®ç½©ç•Œé¢ï¼Œä½¿ç”¨äº†ä¸€ä¸ªUIWindowçš„å­ç±»MyWindowï¼ŒMyWindowä¸ºäº†å®ç°å›è°ƒå®šä¹‰äº†ä»£ç†MyWindowDelegateã€‚ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š 123456789101112131415161718192021@protocol MyWindowDelegate &lt;NSObject&gt;@end@interface MyWindow : UIWindow@property (nonatomic, assign)id&lt;MyWindowDelegate&gt; delegate;@end@implementation MyWindow- (instancetype)init&#123; self = [super init]; if (self) &#123; self.windowLevel = UIWindowLevelNormal; self.backgroundColor = [UIColor whiteColor]; UIViewController *vc = [[ViewController2 alloc] init]; self.rootViewController = vc; self.hidden = NO; &#125; return self;&#125;@end ç„¶ååœ¨å®ç°ç•Œé¢æ¨ªå±æ—¶ï¼Œå‘ç°æ•´ä¸ªUIWindowä¸å“åº”æ¨ªç«–å±äº‹ä»¶ã€‚åˆšå¼€å§‹ä»¥ä¸ºæ¨ªç«–å±è®¾ç½®è¢«å…³é—­äº†ï¼ŒæŸ¥äº†å„ç§èµ„æ–™ï¼Œå‘ç°è¿™ç§å†™æ³•æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è®¾ç½®UIWindowçš„rootViewControllerï¼Œç„¶åæŠŠæ‰€æœ‰å­viewéƒ½åŠ åˆ°rootViewControllerï¼Œç³»ç»Ÿä¼šå¤„ç†æ¨ªç«–å±é—®é¢˜ã€‚ é—®é¢˜åˆ†æç”¨RuntimeæŠŠUIWindowçš„ç§æœ‰å˜é‡æ‰“å‡ºæ¥ï¼Œå°±å‘ç°é—®é¢˜äº†ã€‚ 123456789#import &lt;objc/runtime.h&gt;- (void)printUIWindowIvars &#123; Ivar *ivars = class_copyIvarList([UIWindow class], &amp;count); for (int i = 0; i &lt; count; i++) &#123; Ivar ivar = ivars[i]; NSLog(@"%s", ivar_getName(ivar)); &#125;&#125; æˆ‘ä»¬çœ‹çœ‹è¾“å‡ºï¼Œå‘ç°æœ‰ä¸ªç§æœ‰å˜é‡_delegateã€‚ MyWindowçš„å±æ€§delegateè¦†ç›–äº†çˆ¶ç±»UIWindowçš„å˜é‡ï¼Œå¯¼è‡´æ¨ªç«–å±åˆ‡æ¢äº‹ä»¶å¤±æ•ˆã€‚åœ¨ä»£ç†å‘½åçš„æ—¶å€™ä¸€å®šè¦æ³¨æ„å•Šï¼Œdelegateçœ‹æ¥ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®è·µï¼Œåº”è¯¥åŠ å‰ç¼€åŒºåˆ†é¿å…è¦†ç›–çˆ¶ç±»çš„å®ç°ï¼Œç‰¹åˆ«æ˜¯è¿™ç§ç§æœ‰çš„å˜é‡ã€‚]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ä¸ªautoreleasepoolçš„ä½¿ç”¨åœºæ™¯]]></title>
    <url>%2F2018%2F07%2F18%2F%E4%B8%80%E4%B8%AAautoreleasepool%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©åœ¨å­¦ä¹ å¤§ä½¬åšå®¢çš„æ—¶å€™çœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä¸‹é¢ä»£ç ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ 123456// largeNumberæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°for (int i = 0; i &lt; largeNumber; i++) &#123; NSString *str = [NSString stringWithFormat:@"hello -%04d", i]; str = [str stringByAppendingString:@" - world"]; NSLog(@"%@", str);&#125; åˆšå¼€å§‹æ²¡çœ‹å‡ºä»€ä¹ˆé—®é¢˜ï¼Œå°±æ˜¯æ™®é€šçš„å¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯åˆ›å»ºä¸€ä¸ªå±€éƒ¨å˜é‡NSStringã€‚äºæ˜¯å†™äº†ä¸ªDemoéªŒè¯äº†ä¸‹ï¼Œåœ¨è§‚å¯Ÿå†…å­˜çš„æ—¶å€™å‘ç°äº†ç«¯å€ªï¼Œåœ¨å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä¸æ–­é£™å‡ã€‚ é¡¿æ—¶æ˜ç™½äº†ï¼ŒåŸæ¥é—®é¢˜çš„å…³é”®å°±æ˜¯è¿™ä¸ªlargeNumberï¼Œå½“å¾ªç¯æ­¤æ—¶å¾ˆå¤§æ—¶ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡çš„å±€éƒ¨å˜é‡ï¼Œè€Œä¸”å¾—ä¸åˆ°é‡Šæ”¾ï¼Œäºæ˜¯å†…å­˜å°±çˆ†äº†ã€‚è¿™æ—¶å€™å°±è¯¥@autoreleasepoolä¸Šåœºäº†ï¼Œä¼˜åŒ–åä»£ç ï¼š 1234567for (int i = 0; i &lt; largeNumber; i++) &#123; @autoreleasepool &#123; NSString *str = [NSString stringWithFormat:@"hello -%04d", i]; str = [str stringByAppendingString:@" - world"]; NSLog(@"%@", str); &#125;&#125; æŸ¥çœ‹è¿è¡Œå†…å­˜ï¼Œå¯ä»¥çœ‹åˆ°éå¸¸å¹³ç¨³ã€‚]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UITabbarè‡ªå®šä¹‰Badge]]></title>
    <url>%2F2018%2F07%2F10%2FUITabbar%E8%87%AA%E5%AE%9A%E4%B9%89Badge%2F</url>
    <content type="text"><![CDATA[tabBarItemçš„Badgeé»˜è®¤æ ·å¼æ˜¯å¸¦æ•°å­—çš„ï¼Œä½†æ˜¯äº§å“è¦æ±‚åªè¦ä¸€ä¸ªå°çº¢ç‚¹ï¼Œä¸éœ€è¦æ•°å­—ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰Badgeäº†ã€‚ ç”¨Revealåˆ†æUITabBarï¼Œå‘ç°æ¯ä¸ªæŒ‰é’®æ˜¯ä¸€ä¸ªUITabBarButtonï¼Œå±‚çº§å¦‚ä¸‹ï¼š -UITabBarButtonâ€“UITabBarSwappableImageView // å›¾æ ‡â€“UITabBarButtonLabel // æ–‡å­— å¦‚ä½•ä»UITabBarä¸­æ‰¾åˆ°å¯¹åº”indexçš„UITabBarButtonå‘¢ï¼Ÿæˆ‘ä»¬æ–­ç‚¹è°ƒè¯•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å¯ä»¥ç›´æ¥ä»UITabBarä¸­ç”¨KVCå–å‡ºã€‚ å®ç°æ–¹æ¡ˆå¦‚ä¸‹ï¼š ç”¨KVCæ‰¾åˆ°UITabBarSwappableImageViewï¼Œå…³é”®å‡½æ•°__iconViewWithIndex æ–°å»ºBadgeï¼ŒåŠ åˆ°UITabBarSwappableImageViewä¸Š æ–°å»ºBadgeçš„æ—¶å€™è®¾ç½®Tagï¼Œé€šè¿‡Tagæ¥ç§»é™¤Badge ä¸Šä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546static NSInteger const kBadgeViewTagBase = 10000;@implementation UITabBar (badge)// æ˜¾ç¤ºBadge- (void)showBadgeOnItemIndex:(int)index &#123; if (index &gt;= self.items.count) &#123; return; &#125; // å¦‚æœä¹‹å‰æ·»åŠ è¿‡ï¼Œç›´æ¥è®¾ç½®hiddenä¸ºNO UIView *icon = [self __iconViewWithIndex:index]; for (UIView *subView in icon.subviews) &#123; if (subView.tag == kBadgeViewTagBase) &#123; subView.hidden = NO; return; &#125; &#125; UIView *badgeView = [[UIView alloc] init]; badgeView.tag = kBadgeViewTagBase; badgeView.layer.cornerRadius = 5; badgeView.backgroundColor = [UIColor redColor]; badgeView.frame = CGRectMake(icon.frame.size.width - 5, 0, 9, 9); [icon addSubview:badgeView];&#125;// éšè—Badge- (void)hideBadgeOnItemIndex:(int)index &#123; UIView *icon = [self __iconViewWithIndex:index]; for (UIView *subView in icon.subviews) &#123; if (subView.tag == kBadgeViewTagBase) &#123; subView.hidden = YES; &#125; &#125;&#125;// è·å–å›¾æ ‡æ‰€åœ¨View- (UIView *)__iconViewWithIndex:(int)index &#123; UITabBarItem *item = self.items[index]; UIView *tabBarButton = [item valueForKey:@"_view"]; UIView *icon = [tabBarButton valueForKey:@"_info"]; return icon;&#125;@end]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æ–‡å­—é•¿åº¦]]></title>
    <url>%2F2018%2F07%2F09%2F%E8%AE%A1%E7%AE%97%E6%96%87%E5%AD%97%E9%95%BF%E5%BA%A6%2F</url>
    <content type="text"><![CDATA[å®˜æ–¹æ–‡æ¡£ æ–¹æ³•å®šä¹‰1234- (NSRect)boundingRectWithSize:(NSSize)size options:(NSStringDrawingOptions)options attributes:(NSDictionary&lt;NSAttributedStringKey, id&gt; *)attributes context:(NSStringDrawingContext *)context; å‚æ•°å®šä¹‰sizeç»˜åˆ¶çš„é™åˆ¶sizeï¼Œè®¡ç®—å‡ºæ¥çš„å€¼ä¸ä¼šè¶…è¿‡è¿™ä¸ªå¤§å°ã€‚ optionsä¸€äº›é…ç½®é¡¹ã€‚å®šä¹‰å¦‚ä¸‹ï¼š 1234567typedef NS_OPTIONS(NSInteger, NSStringDrawingOptions) &#123; NSStringDrawingUsesLineFragmentOrigin = 1 &lt;&lt; 0, // The specified origin is the line fragment origin, not the base line origin NSStringDrawingUsesFontLeading = 1 &lt;&lt; 1, // Uses the font leading for calculating line heights NSStringDrawingUsesDeviceMetrics = 1 &lt;&lt; 3, // Uses image glyph bounds instead of typographic bounds NSStringDrawingTruncatesLastVisibleLine NS_ENUM_AVAILABLE(10_5, 6_0) = 1 &lt;&lt; 5, // Truncates and adds the ellipsis character to the last visible line if the text doesn't fit into the bounds specified. Ignored if NSStringDrawingUsesLineFragmentOrigin is not also set.&#125; NS_ENUM_AVAILABLE(10_0, 6_0); å®é™…æµ‹è¯•ä½¿ç”¨NSStringDrawingUsesLineFragmentOrigin|NSStringDrawingUsesFontLeadingå¯ä»¥æ»¡è¶³éœ€æ±‚ï¼ŒNSStringDrawingUsesLineFragmentOriginæ˜¯å¿…é¡»çš„ï¼ŒNSStringDrawingUsesFontLeadingåŠ ä¸åŠ åœ¨æµ‹è¯•çš„æ—¶å€™æ²¡å‘ç°åŒºåˆ«ï¼Œä½†æ˜¯åœ¨stackoverflowç›¸å…³è®¨è®ºé‡ŒåŠ ä¸Šäº†ï¼Œç•™ä¸ªå‘ï¼Œåé¢çŸ¥é“ä¸ºä»€ä¹ˆäº†æ¥è¡¥å……å§ã€‚ attributeså­—ä½“ contextä¸Šä¸‹æ–‡ æ³¨æ„äº‹é¡¹ å¦‚æœæ˜¯å¤šè¡Œæ–‡å­—ï¼Œoptionsè¦åŠ ä¸ŠNSStringDrawingUsesLineFragmentOrigin è¿”å›çš„å€¼æ˜¯å°æ•°ï¼Œéœ€è¦è°ƒç”¨ceilå‘ä¸Šå–æ•´ å¾—åˆ°çš„å®½åº¦å¯èƒ½æ¯”å®é™…å®½ ä»£ç ç¤ºä¾‹1234567891011121314151617181920+ (CGSize)getTextLabelSize:(NSString *)message &#123; if ([message length] &gt; 0) &#123; // æ–‡æœ¬æ¡†çš„æœ€å¤§å®½åº¦ float maxWidth = 200; CGRect textRect = [message boundingRectWithSize:CGSizeMake(maxWidth, CGFLOAT_MAX) options:(NSStringDrawingUsesLineFragmentOrigin | NSStringDrawingUsesFontLeading) attributes:@&#123; NSFontAttributeName : [UIFont systemFontOfSize:16] &#125; context:nil]; textRect.size.height = ceilf(textRect.size.height); textRect.size.width = ceilf(textRect.size.width); return CGSizeMake(textRect.size.width, textRect.size.height); &#125; else &#123; return CGSizeZero; &#125;&#125;]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UITextFieldæ§åˆ¶è¾“å…¥é•¿åº¦]]></title>
    <url>%2F2018%2F07%2F06%2FUITextField%E6%8E%A7%E5%88%B6%E8%BE%93%E5%85%A5%E9%95%BF%E5%BA%A6%2F</url>
    <content type="text"><![CDATA[æœ‰äº›æ—¶å€™ä¼šæœ‰æ§åˆ¶è¾“å…¥æ¡†æ–‡å­—é•¿åº¦çš„éœ€æ±‚ï¼Œè®°å½•ä¸€ä¸ªç®€å•çš„æ€è·¯ã€‚ 12345678910111213141516171819- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string &#123; if (string.length == 0) &#123; return YES; &#125; NSInteger limit = 15; // æ–‡æœ¬çš„æœ€å¤§é•¿åº¦ NSString *newStr = [textField.text stringByAppendingString:string]; // ä¿®æ”¹ä¹‹åçš„æ–°å­—ç¬¦ä¸² NSInteger newStrLength = newStr.length; newStrLength -= [textField textInRange:[textField markedTextRange]].length; // å»æ‰é«˜äº®å†…å®¹ï¼Œè¾“å…¥ä¸­æ–‡æ‹¼éŸ³çš„æƒ…å†µ if (newStrLength &gt; limit) &#123; // å¤„ç†composed character, æ¯”å¦‚emoji NSString *tempStr = [newStr substringWithRange:[newStr rangeOfComposedCharacterSequencesForRange:NSMakeRange(0, limit)]]; textField.text = tempStr; return NO; &#125; return YES;&#125; æœ‰ä¸¤ä¸ªå‘æ³¨æ„ä¸‹ï¼š emojiæ˜¯composed characterï¼Œå®ƒæ˜¯ç”±å¤šä¸ªå­—ç¬¦ç»„åˆï¼Œé•¿åº¦ä¸æ˜¯1ã€‚æœ€å¼€å§‹ç”¨çš„substringToIndexä¼šå¯¼è‡´æœ€åä¸€ä¸ªemojiä¹±ç ã€‚ è®¡ç®—é•¿åº¦çš„æ—¶å€™è¦å»æ‰ä¸­æ–‡è¾“å…¥çš„æ—¶å€™é«˜äº®éƒ¨åˆ†]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[property or synthsize]]></title>
    <url>%2F2018%2F07%2F05%2Fproperty%20or%20synthsize%2F</url>
    <content type="text"><![CDATA[@property (nonatomic, retain) NSObject *var; ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„æ–¹æ³•å£°æ˜ ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„å®ç°ï¼ˆæ—©æœŸç‰ˆæœ¬ç¼–è¯‘å™¨ä¸ç”Ÿæˆï¼‰ ç”Ÿæˆæˆå‘˜å˜é‡_varï¼ˆæ—©æœŸç‰ˆæœ¬ç¼–è¯‘å™¨ä¸ç”Ÿæˆï¼‰ @synthsize var = _var ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„å®ç° ç”Ÿæˆvarå¯¹åº”çš„æˆå‘˜å˜é‡_var mrcå¹´ä»£çš„getã€setæ–¹æ³•çš„å†™æ³• 1234567891011- (void)setVar:(NSObject *)var &#123; if (_var != var) &#123; // å¦‚æœå¤šæ¬¡setåŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœä¸åˆ¤æ–­ä¼šå¯¼è‡´å¯¹è±¡è¢«é‡Šæ”¾ // é‡Šæ”¾ä¹‹å‰çš„var [_var release]; _var = [var retain]; &#125;&#125;- (NSObject *)var &#123; return _var;&#125;]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Tagged Pointerå°è®°]]></title>
    <url>%2F2018%2F07%2F04%2FTagged%20Pointer%E5%B0%8F%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä½¿ç”¨çš„æµ‹è¯•ç¯å¢ƒæ˜¯arm64æ¶æ„çœŸæœº ä¸ºäº†æ¢ç©¶Tagged Pointeræœ¬è´¨ï¼Œå¯ä»¥æŸ¥çœ‹runtimeæºç ï¼Œä¸»è¦çœ‹æ–‡ä»¶objc-internal.hã€‚ å®å®šä¹‰å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å®å®šä¹‰ï¼Œåªæœ‰åœ¨64ä½ç³»ç»Ÿæ‰æ”¯æŒTagged Pointerã€‚ 123#if __LP64__#define OBJC_HAVE_TAGGED_POINTERS 1#endif 64-bitçš„macï¼Œtagå­˜å‚¨åœ¨LSBï¼ˆLeast Significant Bit æœ€ä½ä½ï¼‰ã€‚å…¶å®ƒæƒ…å†µæ¯”å¦‚64ä½çš„çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ï¼Œtagå­˜å‚¨åœ¨MSBï¼ˆMost Significant Bit æœ€é«˜ä½ï¼‰ã€‚ 12345678910111213141516171819202122232425262728293031#if TARGET_OS_OSX &amp;&amp; __x86_64__ // 64-bit Mac - tag bit is LSB# define OBJC_MSB_TAGGED_POINTERS 0#else // Everything else - tag bit is MSB# define OBJC_MSB_TAGGED_POINTERS 1#endif#if OBJC_MSB_TAGGED_POINTERS# define _OBJC_TAG_MASK (1UL&lt;&lt;63)# define _OBJC_TAG_INDEX_SHIFT 60# define _OBJC_TAG_SLOT_SHIFT 60# define _OBJC_TAG_PAYLOAD_LSHIFT 4# define _OBJC_TAG_PAYLOAD_RSHIFT 4# define _OBJC_TAG_EXT_MASK (0xfUL&lt;&lt;60)# define _OBJC_TAG_EXT_INDEX_SHIFT 52# define _OBJC_TAG_EXT_SLOT_SHIFT 52# define _OBJC_TAG_EXT_PAYLOAD_LSHIFT 12# define _OBJC_TAG_EXT_PAYLOAD_RSHIFT 12#else# define _OBJC_TAG_MASK 1UL# define _OBJC_TAG_INDEX_SHIFT 1# define _OBJC_TAG_SLOT_SHIFT 0# define _OBJC_TAG_PAYLOAD_LSHIFT 0# define _OBJC_TAG_PAYLOAD_RSHIFT 4# define _OBJC_TAG_EXT_MASK 0xfUL# define _OBJC_TAG_EXT_INDEX_SHIFT 4# define _OBJC_TAG_EXT_SLOT_SHIFT 4# define _OBJC_TAG_EXT_PAYLOAD_LSHIFT 0# define _OBJC_TAG_EXT_PAYLOAD_RSHIFT 12#endif æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªæšä¸¾å®šä¹‰ï¼Œå®šä¹‰äº†é»˜è®¤çš„ä½¿ç”¨Tagged Pointerçš„ç±»ã€‚ä¾‹å¦‚NSStringã€NSNumberã€NSIndexPathã€NSDateï¼ˆOBJC_TAG_NSAtomã€OBJC_TAG_1ã€OBJC_TAG_NSManagedObjectIDä¸çŸ¥é“æ˜¯å•¥æ„æ€ï¼Œè¿˜è¯·çŸ¥é“çš„åŒå­¦å‘Šè¯‰æˆ‘ï¼‰ã€‚ 12345678910111213141516171819enum objc_tag_index_t : uint16_tenum&#123; OBJC_TAG_NSAtom = 0, OBJC_TAG_1 = 1, OBJC_TAG_NSString = 2, OBJC_TAG_NSNumber = 3, OBJC_TAG_NSIndexPath = 4, OBJC_TAG_NSManagedObjectID = 5, OBJC_TAG_NSDate = 6, OBJC_TAG_RESERVED_7 = 7, OBJC_TAG_First60BitPayload = 0, OBJC_TAG_Last60BitPayload = 6, OBJC_TAG_First52BitPayload = 8, OBJC_TAG_Last52BitPayload = 263, OBJC_TAG_RESERVED_264 = 264&#125;; æ–¹æ³•å®šä¹‰åˆ¤æ–­æ˜¯ä¸æ˜¯Tagged Pointer 12345static inline bool_objc_isTaggedPointer(const void * _Nullable ptr) &#123; return ((uintptr_t)ptr &amp; _OBJC_TAG_MASK) == _OBJC_TAG_MASK;&#125; ç”Ÿæˆä¸€ä¸ªTagged Pointerï¼Œæœ€é«˜çš„4ä½æ˜¯taggedï¼Œå‰©ä¸‹çš„æ˜¯æ•°æ® 123456789101112131415static inline void * _Nonnull_objc_makeTaggedPointer(objc_tag_index_t tag, uintptr_t value)&#123; if (tag &lt;= OBJC_TAG_Last60BitPayload) &#123; return (void *) (_OBJC_TAG_MASK | ((uintptr_t)tag &lt;&lt; _OBJC_TAG_INDEX_SHIFT) | ((value &lt;&lt; _OBJC_TAG_PAYLOAD_RSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_LSHIFT)); &#125; else &#123; return (void *) (_OBJC_TAG_EXT_MASK | ((uintptr_t)(tag - OBJC_TAG_First52BitPayload) &lt;&lt; _OBJC_TAG_EXT_INDEX_SHIFT) | ((value &lt;&lt; _OBJC_TAG_EXT_PAYLOAD_RSHIFT) &gt;&gt; _OBJC_TAG_EXT_PAYLOAD_LSHIFT)); &#125;&#125; ä»Tagged Pointerä¸­å–å‡ºå€¼ 1234567891011static inline uintptr_t_objc_getTaggedPointerValue(const void * _Nullable ptr) &#123; // assert(_objc_isTaggedPointer(ptr)); uintptr_t basicTag = ((uintptr_t)ptr &gt;&gt; _OBJC_TAG_INDEX_SHIFT) &amp; _OBJC_TAG_INDEX_MASK; if (basicTag == _OBJC_TAG_INDEX_MASK) &#123; return ((uintptr_t)ptr &lt;&lt; _OBJC_TAG_EXT_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_EXT_PAYLOAD_RSHIFT; &#125; else &#123; return ((uintptr_t)ptr &lt;&lt; _OBJC_TAG_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_RSHIFT; &#125;&#125; NSNumberåº”ç”¨ä¸¾ä¾‹å¯ä»¥ä½¿ç”¨ä¸‹é¢ä»£ç æ¥éªŒè¯NSNumberå¦‚ä½•ä½¿ç”¨Tagged Pointer 1234567891011121314NSNumber *charNumber = [NSNumber numberWithChar:'1'];NSNumber *shortNumber = [NSNumber numberWithShort:1];NSNumber *intNumber = [NSNumber numberWithInt:1];NSNumber *floatNumber = [NSNumber numberWithFloat:1.0];NSNumber *longNumber = [NSNumber numberWithLong:1];NSNumber *doubleNumber = [NSNumber numberWithDouble:1.0];// è¾“å‡ºå˜é‡çš„æŒ‡é’ˆåœ°å€ï¼š// charNumber 0xb000000000000310// shortNumber 0xb000000000000011// intNumber 0xb000000000000012// floatNumber 0xb000000000000014// longNumber 0xb000000000000013// doubleNumber 0xb000000000000015 ä¸éš¾å‘ç°è§„å¾‹ï¼Œéƒ½æ˜¯ä»¥b(1011)å¼€å¤´ æœ€é«˜ä½æ˜¯1ï¼Œè¯´æ˜è¿™ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ªTagged Pointer ç¬¬61-63ä½æ˜¯11ï¼ˆåè¿›åˆ¶æ˜¯3ï¼‰ï¼Œä¹Ÿå°±æ˜¯OBJC_TAG_NSNumberï¼ˆæŸ¥ä¸Šé¢çš„æšä¸¾ï¼‰ ç¬¬1-4ä½æ˜¯NSNumberçš„ç±»å‹ï¼šæ¯”å¦‚ï¼Œcharæ˜¯0ã€shortæ˜¯1ã€intæ˜¯2ã€floatæ˜¯4 å‰©ä¸‹çš„56ä½å°±æ˜¯çœŸæ­£çš„å€¼äº† NSStringåº”ç”¨ä¸¾ä¾‹123456NSString *str1 = [NSString stringWithFormat:@"a"];NSString *str2 = [NSString stringWithFormat:@"ab"];// è¾“å‡ºå˜é‡çš„æŒ‡é’ˆåœ°å€ï¼š// str1: 0xa000000000000611// str2: 0xa000000000062612 ä¸NSNumberç±»ä¼¼ æœ€é«˜ä½æ˜¯1ï¼Œè¯´æ˜è¿™ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ªTagged Pointer ç¬¬61-63ä½æ˜¯11ï¼ˆåè¿›åˆ¶æ˜¯2ï¼‰ï¼Œä¹Ÿå°±æ˜¯OBJC_TAG_NSString ç¬¬1-4ä½æ˜¯å­—ç¬¦ä¸²é•¿åº¦ å‰©ä¸‹çš„56ä½å°±æ˜¯çœŸæ­£çš„å€¼äº† æ›´å¤šç»†èŠ‚æ¨èè¿™ç¯‡æ–‡ç« é‡‡ç”¨Tagged Pointerçš„å­—ç¬¦ä¸² å‚è€ƒæ–‡ç«  iOS Tagged Pointer wiki æ·±å…¥ç†è§£Tagged Pointer]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[URLWithString return nil]]></title>
    <url>%2F2018%2F07%2F03%2FURLWithString%20return%20nil%2F</url>
    <content type="text"><![CDATA[é—®é¢˜æè¿°åœ¨ä½¿ç”¨URLWithStringç”ŸæˆNSURLæ—¶ï¼Œå¦‚æœå‡ºç°ä¸­æ–‡ï¼Œä¼šå¯¼è‡´è¿”å›çš„NSURLä¸ºnilã€‚ä»£ç å¦‚ä¸‹ï¼š 1NSURL *aUrl = [NSURL URLWithString:@&quot;http://ä¸­æ–‡åŸŸå&quot;]; stackoverflowç›¸å…³è®¨è®º æŸ¥è¯¢äº†URLWithStringçš„å®˜æ–¹æ–‡æ¡£ï¼Œå…¶ä¸­æœ‰ä¸€æ®µè¯è§£å†³äº†æˆ‘çš„ç–‘æƒ‘ã€‚ This method expects URLString to contain only characters that are allowed in a properly formed URL. All other characters must be properly percent escaped. Any percent-escaped characters are interpreted using UTF-8 encoding. æ„æ€å°±æ˜¯è¯¥æ–¹æ³•çš„è¾“å…¥å‚æ•°URLStringåªèƒ½åŒ…å«URLçš„åˆæ³•å­—ç¬¦ï¼ŒåŒ…å«éæ³•å­—ç¬¦çš„URLéœ€è¦è¿›è¡Œç™¾åˆ†å·ç¼–ç (percent escaped) ç™¾åˆ†å·ç¼–ç ï¼ˆpercent escapedï¼‰wikiç›¸å…³è¯æ¡ æœ‰ä¸¤ç§æƒ…å†µå¿…é¡»ä½¿ç”¨ç™¾åˆ†å·ç¼–ç  å‚æ•°ä¸­å‡ºç°ä¿ç•™å­—ç¬¦ URLæ‰€å…è®¸çš„å­—ç¬¦åˆ†ä½œä¿ç•™ä¸æœªä¿ç•™ï¼Œä¿ç•™å­—ç¬¦æ˜¯é‚£äº›å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ URLä¸­å‡ºç°éASCIIå­—ç¬¦ å¯¹äºéASCIIå­—ç¬¦, éœ€è¦è½¬æ¢ä¸ºUTF-8å­—èŠ‚åºï¼Œå†è¿›è¡Œç™¾åˆ†å·ç¼–ç  è§£å†³æ–¹æ¡ˆä½¿ç”¨æ–¹æ³•stringByAddingPercentEscapesUsingEncodingå¯¹URLå­—ç¬¦ä¸²ç™¾åˆ†å·ç¼–ç ã€‚ 12NSString *encodeUrl = [url stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]; NSURL *aUrl = [NSURL URLWithString:encodeUrl];]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSæ¶ˆæ¯è½¬å‘å°è®°]]></title>
    <url>%2F2018%2F05%2F31%2FiOS%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91%E5%B0%8F%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[æ¶ˆæ¯è½¬å‘æµç¨‹å›¾ å¦‚æœç±»æ¥æ”¶åˆ°æ— æ³•å¤„ç†çš„æ¶ˆæ¯ï¼Œä¼šè§¦å‘æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼Œæ¥å—è€…åœ¨æ¯ä¸€æ­¥ä¸­å‡æœ‰æœºä¼šå¤„ç†æ¶ˆæ¯ã€‚æ­¥éª¤è¶Šå¾€åï¼Œå¤„ç†æ¶ˆæ¯çš„ä»£ä»·å°±è¶Šå¤§ï¼Œæ‰€ä»¥æœ€å¥½å†ç¬¬ä¸€æ­¥å°±å¤„ç†å®Œã€‚ ç¬¬ä¸€é“é˜²çº¿åœ¨ç±»é‡Œé¢å®ç°ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç†æœªçŸ¥æ¶ˆæ¯ã€‚æ‰§è¡ŒåŠ¨æ€æ–¹æ³•è§£æä¹‹å‰ï¼Œå…ˆä¼šåˆ¤æ–­æ˜¯å¦æ›¾ç»æœ‰åŠ¨æ€è§£æã€‚ resolveInstanceMethodï¼šå¤„ç†å®ä¾‹æ–¹æ³• resolveClassMethodï¼šå¤„ç†ç±»æ–¹æ³• æˆ‘ä»¬æ¥çœ‹ä¸ªDemoï¼Œå…ˆçœ‹è°ƒç”¨æ–¹ä»£ç  123TestA *testA = [[TestA alloc] init];[testA instanceMethod];[TestA classMethod]; å†æ¥çœ‹çœ‹TestAçš„å®šä¹‰ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// TestA.h@interface TestA : NSObject- (void)instanceMethod;+ (void)classMethod;@end// TestA.m@implementation TestA- (void)newInstanceMethod &#123; NSLog(@"newInstanceMethod");&#125;+ (void)newClassMethod &#123; NSLog(@"newClassMethod");&#125;+ (BOOL)resolveInstanceMethod:(SEL)sel &#123; if (sel == @selector(instanceMethod)) &#123; // åŠ¨æ€æ·»åŠ æ–¹æ³•newInstanceMethod Method method = class_getInstanceMethod([self class], @selector(newInstanceMethod)); IMP imp = method_getImplementation(method); class_addMethod([self class], sel, imp, method_getTypeEncoding(method)); // æˆåŠŸå¤„ç†ï¼Œæ¶ˆæ¯è½¬å‘æœºåˆ¶ç»“æŸï¼Œè°ƒç”¨newInstanceMethod return YES; &#125; // ä¸èƒ½å¤„ç†ï¼Œè¿›å…¥ç¬¬äºŒæ­¥ return [super resolveInstanceMethod:sel];&#125;+ (BOOL)resolveClassMethod:(SEL)sel &#123; if (sel == @selector(classMethod)) &#123; // åŠ¨æ€æ·»åŠ æ–¹æ³•newClassMethod Method method = class_getInstanceMethod(object_getClass(self), @selector(newClassMethod)); IMP imp = method_getImplementation(method); class_addMethod(object_getClass(self), sel, imp, method_getTypeEncoding(method)); // æˆåŠŸå¤„ç†ï¼Œæ¶ˆæ¯è½¬å‘æœºåˆ¶ç»“æŸï¼Œè°ƒç”¨newClassMethod return YES; &#125; // ä¸èƒ½å¤„ç†ï¼Œè¿›å…¥ç¬¬äºŒæ­¥ return [super resolveClassMethod:sel];&#125;@end TestAä¸­å¤´æ–‡ä»¶å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰å®ç°ï¼Œå¦‚æœä¸ç”¨æ¶ˆæ¯è½¬å‘æœºåˆ¶å¤„ç†å¼‚å¸¸ï¼Œä¼šå¯¼è‡´crashï¼Œlogæƒ³å¿…å¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰ *** Terminating app due to uncaught exception â€˜NSInvalidArgumentExceptionâ€™, reason: â€˜-[TestA funcA]: unrecognized selector sent to instance 0x6040000125c0â€™ å®ä¾‹æ–¹æ³•å­˜å‚¨åœ¨ç±»å¯¹è±¡ï¼Œç±»æ–¹æ³•å­˜å‚¨åœ¨å…ƒç±»å¯¹è±¡ï¼Œåœ¨è°ƒç”¨class_addMethodæ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ³¨æ„ã€‚ ç¬¬äºŒé“é˜²çº¿ç¬¬äºŒé“é˜²çº¿ä¾èµ–ä¸€ä¸ªå‡½æ•°forwardingTargetForSelectorã€‚ 1234567891011121314151617// ç±»æ–¹æ³•//+ (id)forwardingTargetForSelector:(SEL)aSelector &#123;// //&#125;- (id)forwardingTargetForSelector:(SEL)aSelector &#123; if (aSelector == @selector(instanceMethod)) &#123; // æ¶ˆæ¯è½¬å‘ç»™TestBå®ä¾‹ return [TestB new]; &#125; // æ¶ˆæ¯è½¬å‘å¤±è´¥ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ return nil;&#125;// TestB.m- (void)instanceMethod &#123; NSLog(@"instanceMethod");&#125; ç¬¬ä¸‰é“é˜²çº¿ç¬¬ä¸‰é“é˜²çº¿æœ‰ä¸¤æ­¥ è°ƒç”¨methodSignatureForSelectorï¼Œè·å–æ–°çš„æ–¹æ³•ç­¾åï¼ˆè¿”å›å€¼ç±»å‹ï¼Œå‚æ•°ç±»å‹ï¼‰ è°ƒç”¨forwardInvocationï¼Œè½¬å‘æ¶ˆæ¯ï¼Œ 123456789101112131415// æ–¹æ³•ç­¾åï¼ˆè¿”å›å€¼ç±»å‹ï¼Œå‚æ•°ç±»å‹ï¼‰// ç±»æ–¹æ³•å‡å·æ”¹ä¸ºåŠ å·- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123; NSMethodSignature *signature = [TestB instanceMethodSignatureForSelector:aSelector]; return signature;&#125;// NSInvocationå°è£…äº†æ–¹æ³•è°ƒç”¨ï¼ŒåŒ…æ‹¬ï¼šæ–¹æ³•è°ƒç”¨è€…ã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°// anInvocation.target æ¶ˆæ¯æ¥å—è€…// anInvocation.selector å‡½æ•°å// [anInvocation getArgument:NULL atIndex:0]; è·å–å‚æ•°// ç±»æ–¹æ³•å‡å·æ”¹ä¸ºåŠ å·- (void)forwardInvocation:(NSInvocation *)anInvocation &#123; [anInvocation invokeWithTarget:[TestB new]];&#125;]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¢å¯»Objective-Cå¼•ç”¨è®¡æ•°æœ¬è´¨]]></title>
    <url>%2F2018%2F05%2F26%2F%E6%8E%A2%E5%AF%BBObjective-C%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%9C%AC%E8%B4%A8%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ¶‰åŠåˆ°çš„CPUæ¶æ„ä¸ºarm64ï¼Œå…¶å®ƒæ¶æ„å¤§åŒå°å¼‚ã€‚æºç æ¥è‡ªè‹¹æœå¼€æº-runtimeã€‚ Objective-Cä¸­é‡‡ç”¨å¼•ç”¨è®¡æ•°æœºåˆ¶æ¥ç®¡ç†å†…å­˜ï¼Œåœ¨MRCæ—¶ä»£ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨retainå’Œreleaseï¼Œåœ¨è‹¹æœå¼•å…¥ARCåå¤§éƒ¨åˆ†æ—¶é—´æˆ‘ä»¬ä¸ç”¨å†å…³å¿ƒå¼•ç”¨è®¡æ•°é—®é¢˜ã€‚ä½†æ˜¯ä¸ºäº†æ·±å…¥Objective-Cæœ¬è´¨ï¼Œå¼•ç”¨è®¡æ•°ç©¶ç«Ÿæ˜¯æ€ä¹ˆå®ç°çš„è¿˜æ˜¯å€¼å¾—æˆ‘ä»¬å»æ¢å¯»çš„ã€‚ ISAOCä¸­çš„å¯¹è±¡çš„å®è´¨å…¶å®æ˜¯ç»“æ„ä½“ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æœ‰isaï¼ŒæŒ‡å‘ç±»å¯¹è±¡ï¼ˆæœ‰ä¸€ç§ç¥å¥‡çš„å­˜åœ¨å«åšTagged Pointerï¼‰ï¼Œæºç ä¸­å…³äºå¯¹è±¡ç»“æ„ä½“objc_objectå®šä¹‰å¦‚ä¸‹ï¼š 123456789// objc-private.hstruct objc_object &#123;private: isa_t isa;public: id retain(); void release(); id autorelease(); ... //çœç•¥äº†å…¶å®ƒæ–¹æ³•ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç›´æ¥çœ‹æºç  Tagged Pointeré™¤äº†æœ‰ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡Tagged Pointerï¼Œè¿™ç§ç±»å‹çš„å¯¹è±¡å€¼å°±å­˜åœ¨æŒ‡é’ˆå½“ä¸­ï¼Œå­˜å–æ€§èƒ½é«˜ã€‚å¯ä»¥ç”¨æ¥å­˜å‚¨å°‘é‡æ•°æ®çš„å¯¹è±¡ï¼Œä¾‹å¦‚NSNumberã€NSDateã€NSStringã€‚(æ›´å¤šTagged PointerçŸ¥è¯†ï¼Œå…·ä½“çœ‹è¿™ç¯‡Tagged Pointerå°è®°)ã€‚ä¹Ÿå°±æ²¡æœ‰å¼•ç”¨è®¡æ•°ã€å†…å­˜é‡Šæ”¾çš„é—®é¢˜ã€‚ NONPOINTER ISAarm64æ¶æ„isaå 64ä½ï¼Œè‹¹æœä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå­˜å‚¨ç±»å¯¹è±¡åœ°å€åªç”¨äº†33ä½ï¼Œå‰©ä¸‹çš„ä½ç”¨æ¥å­˜å‚¨ä¸€äº›å…¶å®ƒä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬æ–‡è®¨è®ºçš„å¼•ç”¨è®¡æ•°ã€‚ NONPOINTER ISAå­˜å‚¨çš„å­—æ®µå®šä¹‰å¦‚ä¸‹ï¼š 1234567891011121314151617# if __arm64__# define ISA_MASK 0x0000000ffffffff8ULL# define ISA_MAGIC_MASK 0x000003f000000001ULL# define ISA_MAGIC_VALUE 0x000001a000000001ULL struct &#123; uintptr_t nonpointer : 1; uintptr_t has_assoc : 1; uintptr_t has_cxx_dtor : 1; uintptr_t shiftcls : 33; // MACH_VM_MAX_ADDRESS 0x1000000000 uintptr_t magic : 6; uintptr_t weakly_referenced : 1; uintptr_t deallocating : 1; uintptr_t has_sidetable_rc : 1; uintptr_t extra_rc : 19;# define RC_ONE (1ULL&lt;&lt;45)# define RC_HALF (1ULL&lt;&lt;18) &#125;; extra_rcé‚£å¼•ç”¨è®¡æ•°å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿç§˜å¯†å°±åœ¨extra_rcä¸­ã€‚ extra_rcåªæ˜¯å­˜å‚¨äº†é¢å¤–çš„å¼•ç”¨è®¡æ•°ï¼Œå®é™…çš„å¼•ç”¨è®¡æ•°è®¡ç®—å…¬å¼ï¼šå¼•ç”¨è®¡æ•°=extra_rc+1ã€‚ extra_rcå äº†19ä½ï¼Œå¯ä»¥å­˜å‚¨çš„æœ€å¤§å¼•ç”¨è®¡æ•°ï¼š$2^{19}-1+1=524288$ï¼Œè¶…è¿‡å®ƒå°±éœ€è¦è¿›ä½åˆ°SideTablesã€‚SideTablesæ˜¯ä¸€ä¸ªHashè¡¨ï¼Œæ ¹æ®å¯¹è±¡åœ°å€å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„SideTableï¼ŒSideTableå†…åŒ…å«ä¸€ä¸ªRefcountMapï¼Œæ ¹æ®å¯¹è±¡åœ°å€å–å‡ºå…¶å¼•ç”¨è®¡æ•°ï¼Œç±»å‹æ˜¯size_tã€‚å®ƒæ˜¯ä¸€ä¸ªunsigned longï¼Œæœ€ä½ä¸¤ä½æ˜¯æ ‡å¿—ä½ï¼Œå‰©ä¸‹çš„62ä½ç”¨æ¥å­˜å‚¨å¼•ç”¨è®¡æ•°ã€‚æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºå¼•ç”¨è®¡æ•°çš„ç†è®ºæœ€å¤§å€¼ï¼š$2^{62+19}=2.417851639229258e24$ã€‚ å…¶å®isaèƒ½å­˜å‚¨çš„524288åœ¨æ—¥å¸¸å¼€å‘å·²ç»å®Œå…¨å¤Ÿç”¨äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æä¸ªSide Tableï¼Ÿæˆ‘çŒœæµ‹æ˜¯å› ä¸ºå†å²é—®é¢˜ï¼Œä»¥å‰cpuæ˜¯32ä½çš„ï¼Œisaä¸­èƒ½å­˜å‚¨çš„å¼•ç”¨è®¡æ•°å°±åªæœ‰$2^{7}=128$ã€‚å› æ­¤åœ¨arm64ä¸‹ï¼Œå¼•ç”¨è®¡æ•°é€šå¸¸æ˜¯å­˜å‚¨åœ¨isaä¸­çš„ã€‚ retainæœ‰äº†å‰é¢çš„é“ºå«ï¼Œæˆ‘ä»¬çŸ¥é“å¼•ç”¨è®¡æ•°æ€ä¹ˆå­˜å‚¨çš„äº†ï¼Œé‚£å¼•ç”¨è®¡æ•°åˆæ˜¯æ€ä¹ˆæ”¹å˜çš„å‘¢ï¼Ÿé€šè¿‡å‰–æretainæºç æˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºç»“è®ºäº†ã€‚objc_objectçš„æ–¹æ³•å…¨éƒ¨å®šä¹‰åœ¨objc-object.hæ–‡ä»¶ä¸­ï¼Œå…¨æ˜¯å†…è”å‡½æ•°ï¼Œåº”è¯¥æ˜¯ä¸ºäº†æ€§èƒ½çš„è€ƒè™‘ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹retainçš„å‡½æ•°å®šä¹‰ 1234567891011inline id objc_object::retain()&#123; assert(!isTaggedPointer()); if (fastpath(!ISA()-&gt;hasCustomRR())) &#123; return rootRetain(); &#125; return ((id(*)(objc_object *, SEL))objc_msgSend)(this, SEL_retain);&#125; è¿™å±‚æ¯”è¾ƒç®€å•ï¼Œåšäº†ä¸‰ä»¶äº‹æƒ…ï¼š åˆ¤æ–­æŒ‡é’ˆæ˜¯ä¸æ˜¯Tagged Pointer åˆ¤æ–­æ˜¯å¦æœ‰è‡ªå®šä¹‰retainï¼Œå¦‚æœæœ‰è°ƒç”¨è‡ªå®šä¹‰çš„ã€‚ æœ€åè°ƒç”¨rootRetain æˆ‘ä»¬æ¥çœ‹çœ‹å…³é”®å‡½æ•°rootRetainçš„å®ç°ï¼ˆä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œä»£ç æœ‰æ‰€åˆ å‡ï¼‰ 1234567891011121314151617181920212223242526272829303132333435ALWAYS_INLINE id objc_object::rootRetain(bool tryRetain, bool handleOverflow)&#123; isa_t oldisa; isa_t newisa; // åŠ é”ï¼Œç”¨æ±‡ç¼–æŒ‡ä»¤ldxræ¥ä¿è¯åŸå­æ€§ oldisa = LoadExclusive(&amp;isa.bits); newisa = oldisa; if (newisa.nonpointer = 0) &#123; // newisa.nonpointer = 0è¯´æ˜æ‰€æœ‰ä½æ•°éƒ½æ˜¯åœ°å€å€¼ // é‡Šæ”¾é”ï¼Œä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤clrex ClearExclusive(&amp;isa.bits); // ç”±äºæ‰€æœ‰ä½æ•°éƒ½æ˜¯åœ°å€å€¼ï¼Œç›´æ¥ä½¿ç”¨sidetableæ¥å­˜å‚¨å¼•ç”¨è®¡æ•° return sidetable_retain(); &#125; // å­˜å‚¨extra_rc++åçš„ç»“æœ uintptr_t carry; // extra_rc++ newisa.bits = addc(newisa.bits, RC_ONE, 0, &amp;carry); if (carry == 0) &#123; // extra_rc++åæº¢å‡ºï¼Œè¿›ä½åˆ°side table newisa.extra_rc = RC_HALF; newisa.has_sidetable_rc = true; sidetable_addExtraRC_nolock(RC_HALF); &#125; // å°†newisaå†™å…¥isa StoreExclusive(&amp;isa.bits, oldisa.bits, newisa.bits) return (id)this;&#125; æœ‰ä¸€ä¸ªç»†èŠ‚å¯ä»¥äº†è§£ä¸‹ï¼Œå¦‚ä½•ç”¨æ±‡ç¼–æ¥å®ç°åŸå­æ€§æ“ä½œã€‚ 1234567891011static ALWAYS_INLINEuintptr_t LoadExclusive(uintptr_t *src)&#123; uintptr_t result; // åœ¨å¤šæ ¸CPUä¸‹ï¼Œå¯¹ä¸€ä¸ªåœ°å€çš„è®¿é—®å¯èƒ½å¼•èµ·å†²çªï¼Œldxrè§£å†³äº†å†²çªï¼Œä¿è¯åŸå­æ€§ã€‚ asm("ldxr %x0, [%x1]" : "=r" (result) : "r" (src), "m" (*src)); return result;&#125; releasereleaseä»£ç é€»è¾‘åŸºæœ¬ä¸Šå°±æ˜¯retainåè¿‡æ¥èµ°ä¸€éï¼Œæœ‰ç‚¹ä¸åŒçš„æ˜¯åœ¨å¼•ç”¨è®¡æ•°å‡åˆ°0æ—¶ï¼Œä¼šè°ƒç”¨å¯¹è±¡çš„deallocæ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041ALWAYS_INLINE boolobjc_object::rootRelease(bool performDealloc, bool handleUnderflow)&#123; isa_t oldisa; isa_t newisa; retry: oldisa = LoadExclusive(&amp;isa.bits); newisa = oldisa; if (newisa.nonpointer == 0) &#123; ClearExclusive(&amp;isa.bits); if (sideTableLocked) sidetable_unlock(); return sidetable_release(performDealloc); &#125; uintptr_t carry; // extra_rc-- newisa.bits = subc(newisa.bits, RC_ONE, 0, &amp;carry); if (carry == 0) &#123; // éœ€è¦ä»SideTableå€Ÿä½ï¼Œæˆ–è€…å¼•ç”¨è®¡æ•°ä¸º0 goto underflow; &#125; // å­˜å‚¨å¼•ç”¨è®¡æ•°åˆ°isa StoreReleaseExclusive(&amp;isa.bits, oldisa.bits, newisa.bits) return false; underflow: // ä»SideTableå€Ÿä½ // æˆ–å¼•ç”¨è®¡æ•°ä¸º0ï¼Œè°ƒç”¨delloc // æ­¤å¤„çœç•¥Nå¤šä»£ç  // æ€»ç»“ä¸€ä¸‹:ä¿®æ”¹Side Tableä¸extra_rcï¼Œ // å¼•ç”¨è®¡æ•°å‡ä¸º0æ—¶ï¼Œè°ƒç”¨dealloc if (performDealloc) &#123; ((void(*)(objc_object *, SEL))objc_msgSend)(this, SEL_dealloc); &#125; return true;&#125; å°ç»“ å¼•ç”¨è®¡æ•°å­˜åœ¨å“ªï¼Ÿ Tagged Pointerä¸éœ€è¦å¼•ç”¨è®¡æ•° NONPOINTER ISA(isaçš„ç¬¬ä¸€ä½ä¸º1)çš„å¼•ç”¨è®¡æ•°ä¼˜å…ˆå­˜åœ¨isaä¸­ï¼Œå¤§äº524288äº†è¿›ä½åˆ°Side Tables éNONPOINTER ISAå¼•ç”¨è®¡æ•°å­˜åœ¨Side Tables retain/releaseçš„å®è´¨ æ‰¾åˆ°å¼•ç”¨è®¡æ•°å­˜å‚¨åŒºåŸŸï¼Œç„¶å+1/-1 å¦‚æœæ˜¯NONPOINTER ISAï¼Œè¿˜è¦å¤„ç†è¿›ä½/å€Ÿä½çš„æƒ…å†µ releaseåœ¨å¼•ç”¨è®¡æ•°å‡ä¸º0æ—¶ï¼Œè°ƒç”¨dealloc å‚è€ƒ é»‘ç®±ä¸­çš„ retain å’Œ release æ·±å…¥ç†è§£Tagged Pointer]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Cordovaæºç è§£æï¼ˆäºŒï¼‰- è‡ªå®šä¹‰UserAgent]]></title>
    <url>%2F2018%2F05%2F15%2FCordova%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89-%20%E8%87%AA%E5%AE%9A%E4%B9%89UserAgent%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡åˆ†æçš„æºç æ˜¯åŸºäºCordova 4.2.1ç‰ˆæœ¬ï¼ŒCordovaå®˜ç½‘ã€‚ Cordovaæºç è§£æï¼ˆäºŒï¼‰- è‡ªå®šä¹‰UserAgentUIWebViewæ²¡æœ‰æä¾›è®¾ç½®UserAgentçš„æ¥å£ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªåŠæ³•å¯ä»¥é—´æ¥çš„è®¾ç½®ã€‚ 12NSDictionary* dict = [[NSDictionary alloc] initWithObjectsAndKeys:value, @&quot;UserAgent&quot;, nil];[[NSUserDefaults standardUserDefaults] registerDefaults:dict]; é€šè¿‡è®¾ç½®NSUserDefaultsä¸­UserAgentçš„å€¼æ¥ä¿®æ”¹ï¼Œä½†æ˜¯è¿™ç§è®¾ç½®æ–¹æ³•æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œéœ€è¦åœ¨UIWebViewçš„loadRequestä¹‹å‰è°ƒç”¨æ‰èƒ½ç”Ÿæ•ˆ(åŠ è½½PDFæ¯”è¾ƒç‰¹æ®Š)ã€‚è¿™æ˜¯Cordovaæºç ä¸­å…³äºè¿™ä¸ªé—®é¢˜çš„æè¿° Setting the UserAgent must occur before a UIWebView is instantiated.It is read per instantiation, so it does not affect previously created views.Except! When a PDF is loaded, all currently active UIWebViews reload theirUser-Agent from the NSUserDefaults some time after the DidFinishLoad of the PDF bah! CDVUserAgentUtilåœ¨å¤šWebViewçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ¯ä¸ªWebViewéƒ½æœ‰ä¸åŒçš„UserAgentï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®ç«äº‰çš„é—®é¢˜ï¼Œå¤§å®¶éƒ½è¦ä¿®æ”¹NSUserDefaultsä¸­UserAgentçš„å€¼ï¼Œäºæ˜¯éœ€è¦å¯¹èµ„æºåŠ é”æ¥ä¿è¯æ¯ä¸ªWebViewéƒ½è®¾ç½®é¢„æœŸçš„UserAgentã€‚åœ¨Cordovaä¸­ï¼Œä¸“é—¨æœ‰ä¸€ä¸ªç±»CDVUserAgentUtilæ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ CDVUserAgentUtil.hæ–‡ä»¶ä¸­å®šä¹‰äº†å››ä¸ªæ–¹æ³• 12345678// è·å–UIWebViewé»˜è®¤çš„UserAgent+ (NSString*)originalUserAgent;// è·å–é”+ (void)acquireLock:(void (^)(NSInteger lockToken))block;// é‡Šæ”¾é”+ (void)releaseLock:(NSInteger*)lockToken;// è®¾ç½®UIWebViewçš„UserAgent+ (void)setUserAgent:(NSString*)value lockToken:(NSInteger)lockToken; åŠ é”æ¯æ¬¡åŠ é”æˆåŠŸä¼šè¿”å›ä¸€ä¸ªNSIntegerç±»å‹çš„tokenï¼Œåœ¨é‡Šæ”¾é”çš„æ—¶å€™éœ€è¦æŠŠtokenä¼ å…¥ã€‚tokenä¼šä¸æ–­é€’å¢ï¼Œä¿è¯æ¯æ¬¡åŠ é”è¿”å›çš„tokenéƒ½ä¸å›é‡å¤ã€‚åŠ é”çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415// CDVUserAgentUtil.m+ (void)acquireLock:(void (^)(NSInteger lockToken))block&#123; if (gCurrentLockToken == 0) &#123; gCurrentLockToken = ++gNextLockToken; VerboseLog(@"Gave lock %d", gCurrentLockToken); block(gCurrentLockToken); &#125; else &#123; if (gPendingSetUserAgentBlocks == nil) &#123; gPendingSetUserAgentBlocks = [[NSMutableArray alloc] initWithCapacity:4]; &#125; VerboseLog(@"Waiting for lock"); [gPendingSetUserAgentBlocks addObject:block]; &#125;&#125; è°ƒç”¨acquireLock:ï¼Œé¦–å…ˆä¼šåˆ¤æ–­gCurrentLockTokenæ˜¯å¦ç­‰äº0 å¦‚æœæ˜¯0è¯´æ˜æ²¡æœ‰æ¨¡å—æ­£åœ¨ä¿®æ”¹UserAgentï¼Œèƒ½å¤ŸæˆåŠŸè·å–åˆ°é”ï¼ŒgCurrentLockTokené€’å¢ï¼Œæ ‡è‡´å½“å‰æœ‰æ¨¡å—æ­£åœ¨ä¿®æ”¹UserAgentï¼Œå¹¶å›è°ƒblockï¼Œè¿”å›gCurrentLockToken å¦‚æœä¸ä¸º0è¯´æ˜å½“å‰æœ‰æ¨¡å—æ­£åœ¨ä¿®æ”¹UserAgentï¼Œå°†blockå›è°ƒå­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—gPendingSetUserAgentBlocksä¸­ é‡Šæ”¾é”é‡Šæ”¾é”éœ€è¦ä¼ å…¥tokenï¼Œé‡Šæ”¾é”ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819+ (void)releaseLock:(NSInteger*)lockToken&#123; if (*lockToken == 0) &#123; return; &#125; NSAssert(gCurrentLockToken == *lockToken, @"Got token %ld, expected %ld", (long)*lockToken, (long)gCurrentLockToken); VerboseLog(@"Released lock %d", *lockToken); if ([gPendingSetUserAgentBlocks count] &gt; 0) &#123; void (^block)() = [gPendingSetUserAgentBlocks objectAtIndex:0]; [gPendingSetUserAgentBlocks removeObjectAtIndex:0]; gCurrentLockToken = ++gNextLockToken; NSLog(@"Gave lock %ld", (long)gCurrentLockToken); block(gCurrentLockToken); &#125; else &#123; gCurrentLockToken = 0; &#125; *lockToken = 0;&#125; å¦‚æœè¦é‡Šæ”¾çš„lockTokenä¸º0ï¼Œè¯´æ˜è¿˜æ²¡åŠ è¿‡é”ï¼Œå°±è°ƒç”¨é‡Šæ”¾äº†ï¼Œç›´æ¥è¿”å› ä»é˜Ÿåˆ—gPendingSetUserAgentBlocksä¸­å–å‡ºæœ€æ—©åŠ å…¥çš„blockï¼Œä»é˜Ÿåˆ—ä¸­ç§»é™¤ gCurrentLockTokené€’å¢ç”Ÿæˆæ–°tokenï¼Œå›è°ƒblock å¦‚æœé˜Ÿåˆ—gPendingSetUserAgentBlocksé‡Šæ”¾å®Œæˆï¼Œè¯´æ˜é‡Šæ”¾é”çš„è°ƒç”¨æ¬¡æ•°&gt;åŠ é”çš„æ¬¡æ•°ï¼Œä¸åšæ“ä½œï¼Œç„¶åæŠŠgCurrentLockTokenç½®ä¸º0 è®¾ç½®UserAgentåœ¨Cordovaå®é™…è¿ç”¨ä¸­ï¼Œæ“ä½œé”çš„æ—¶æœºï¼šåŠ é”æ—¶æœºï¼šCDVViewControlleråŠ è½½å®Œæ¯•ï¼Œåœ¨viewDidLoadé‡Œè°ƒç”¨é‡Šæ”¾é”æ—¶æœºï¼š UIWebViewçš„webViewDidFinishLoad:å›è°ƒ UIWebViewçš„webView:didFailLoadWithError:å›è°ƒ CDVViewControllerçš„dealloc CDVViewControllerçš„viewDidUnload åŠ é”ä»£ç ï¼Œçœç•¥äº†ä¸ç›¸å…³ä»£ç  12345678910// CDVViewController.m- (void)viewDidLoad&#123; [CDVUserAgentUtil acquireLock:^(NSInteger lockToken) &#123; _userAgentLockToken = lockToken; [CDVUserAgentUtil setUserAgent:self.userAgent lockToken:lockToken]; NSURLRequest* appReq = [NSURLRequest requestWithURL:appURL cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:20.0]; [self.webViewEngine loadRequest:appReq]; &#125;];&#125; é‡Šæ”¾é”ä»£ç ï¼Œè¿™é‡Œåªçœ‹æ­£å¸¸é€»è¾‘ï¼Œåœ¨ç½‘é¡µåŠ è½½å®Œæˆå›è°ƒwebViewDidFinishLoad:ä¸­é‡Šæ”¾é€»è¾‘ã€‚ä¸è€ƒè™‘å¼‚å¸¸æƒ…å†µï¼Œçœç•¥äº†ä¸ç›¸å…³ä»£ç ã€‚ 123456789// CDVUIWebViewNavigationDelegate.m- (void)webViewDidFinishLoad:(UIWebView*)theWebView&#123; NSLog(@"Finished load of: %@", theWebView.request.URL); CDVViewController* vc = (CDVViewController*)self.enginePlugin.viewController; // It's safe to release the lock even if this is just a sub-frame that's finished loading. [CDVUserAgentUtil releaseLock:vc.userAgentLockToken];&#125; åœ¨webViewDidFinishLoad:å›è°ƒæ—¶ï¼ŒUserAgentå·²ç»è®¾ç½®æˆåŠŸï¼Œæ‰€ä»¥å¯ä»¥é‡Šæ”¾é”ï¼Œè®©å…¶å®ƒWebViewæ“ä½œUserDefaultäº†ã€‚]]></content>
      <tags>
        <tag>æºç å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Cordovaæºç è§£æ]]></title>
    <url>%2F2018%2F05%2F09%2FCordova%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡è®¾è®¡åˆ°çš„æºç æ˜¯åŸºäºCordova 4.2.1ç‰ˆæœ¬ï¼ŒCordovaå®˜ç½‘ã€‚ CDVViewControllerCDVViewControlleræ˜¯Cordovaæœ€ä¸»è¦çš„ç±»ï¼Œå®ƒæŠŠæ‰€æœ‰æ¨¡å—æ•´åˆåœ¨ä¸€èµ·ï¼Œç›´æ¥åˆå§‹åŒ–ä¸€ä¸ªå®ƒçš„å®ä¾‹å°±å¯ä»¥ä½¿ç”¨ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š 123CDVViewController *vc = [[CDVViewController alloc] init];vc.startPage = @"www.baidu.com";[self presentViewController:vc animated:YES completion:nil]; CDVViewControllerä¸»è¦å®ç°çš„åŠŸèƒ½ï¼š æ³¨å†Œã€åˆå§‹åŒ–æ’ä»¶ è¯»å–ã€åº”ç”¨é…ç½®æ–‡ä»¶ åˆå§‹åŒ–å¹¶é…ç½®WebViewï¼Œè®¾ç½®å…¶ä»£ç† ç®¡ç†jsä¸åŸç”Ÿçš„æ–¹æ³•è°ƒç”¨ ç®¡ç†åº”ç”¨ä¸ç½‘é¡µçš„ç”Ÿå‘½å‘¨æœŸã€‚ã€‚ã€‚ å®ƒä¸»è¦çš„å±æ€§æœ‰ï¼š CDVWebViewEngineProtocolï¼šwebviewç›¸å…³çš„å›è°ƒ CDVCommandDelegateï¼šjsä¸åŸç”Ÿæ’ä»¶äº¤äº’æ–¹æ³•ï¼Œæ’ä»¶åˆå§‹åŒ– CDVCommandQueueï¼šå‘½ä»¤æ‰§è¡Œé˜Ÿåˆ— CDVCommandDelegateå’ŒCDVCommandQueueä¼šåœ¨jsè°ƒç”¨åŸç”Ÿæ’ä»¶ä¸æ’ä»¶åˆå§‹åŒ–æåˆ°ï¼Œè¿™é‡Œå…ˆä¸ç»†è¯´ã€‚CDVWebViewEngineProtocolå®šä¹‰äº†WebViewå¼•æ“çš„æŠ½è±¡ç±»ï¼Œå…·ä½“å®ç°ç”±æ’ä»¶æä¾›ï¼Œä¾‹å¦‚CDVUIWebViewEngineå®ç°UIWebViewçš„å¼•æ“ã€‚ CDVWebViewEngineProtocolåè®®å®šä¹‰CDVWebViewEngineProtocolåè®®å…¶å®æ˜¯å¯¹äºWebViewçš„ä¸€å±‚å°è£…ï¼Œå±è”½äº†ä¸åŒWebViewæ¥å£çš„å·®å¼‚ï¼Œç°åœ¨iOSæœ‰UIWebViewä¸WKWebViewã€‚ 1234567891011@protocol CDVWebViewEngineProtocol &lt;NSObject&gt;@property (nonatomic, strong, readonly) UIView* engineWebView;- (id)loadRequest:(NSURLRequest*)request;- (id)loadHTMLString:(NSString*)string baseURL:(NSURL*)baseURL;- (void)evaluateJavaScript:(NSString*)javaScriptString completionHandler:(void (^)(id, NSError*))completionHandler;- (NSURL*)URL;- (BOOL)canLoadRequest:(NSURLRequest*)request;- (instancetype)initWithFrame:(CGRect)frame;- (void)updateWithInfo:(NSDictionary*)info;@end engineWebViewå±æ€§å¯¹å¤–ç›´æ¥æš´éœ²äº†å†…éƒ¨å°è£…çš„WebViewï¼Œå…¶å®ƒæ–¹æ³•éƒ½æ˜¯å¯¹WebViewæ–¹æ³•çš„ä¸€å±‚ç®€å•å°è£…ã€‚ UIWebViewå¼•æ“CDVUIWebViewEngineæˆ‘ä»¬ä»¥UIWebViewçš„å®ç°CDVUIWebViewEngineä¸ºä¾‹è¯´æ˜ï¼Œå®ƒæ˜¯ä»¥æ’ä»¶çš„å½¢å¼å®ç°çš„ï¼Œä¸»è¦ä½œç”¨æ˜¯åˆå§‹åŒ–UIWebViewçš„é…ç½®ï¼Œå¯¹UIWebViewçš„æ–¹æ³•å’Œä»£ç†è¿›è¡Œäº†ä¸€å±‚å°è£…ã€‚å®ƒå®ç°äº†åè®®CDVWebViewEngineProtocolï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§ã€‚ 123456// CDVUIWebViewEngine// UIWebview@property (nonatomic, strong, readwrite) UIView* engineWebView;// UIWebViewçš„ä»£ç†@property (nonatomic, strong, readwrite) id &lt;UIWebViewDelegate&gt; uiWebViewDelegate;@property (nonatomic, strong, readwrite) CDVUIWebViewNavigationDelegate* navWebViewDelegate; åˆå§‹åŒ–ä»initWithFrame:æ–¹æ³•å¼€å§‹ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªUIWebViewï¼Œå¹¶èµ‹å€¼ç»™äº†engineWebViewï¼Œç„¶ååœ¨æ’ä»¶åˆå§‹åŒ–æ–¹æ³•pluginInitializeä¸­åˆå§‹åŒ–UIWebViewçš„ä»£ç†å’Œé…ç½®ã€‚ 123456789101112131415161718192021- (void)pluginInitialize&#123; UIWebView* uiWebView = (UIWebView*)_engineWebView; // åˆ¤æ–­å½“å‰controlleræ˜¯å¦å®ç°äº†UIWebViewDelegate // å¦‚æœå®ç°äº†å°±æŠŠå½“å‰controllerè®¾ç½®ä¸ºCDVUIWebViewDelegateçš„ä»£ç†å®ç° if ([self.viewController conformsToProtocol:@protocol(UIWebViewDelegate)]) &#123; self.uiWebViewDelegate = [[CDVUIWebViewDelegate alloc] initWithDelegate:(id &lt;UIWebViewDelegate&gt;)self.viewController]; uiWebView.delegate = self.uiWebViewDelegate; &#125; // å¦‚æœæ²¡æœ‰å®ç°ï¼Œåˆ›å»ºä¸€ä¸ªCDVUIWebViewNavigationDelegateï¼Œä½œä¸ºCDVUIWebViewDelegateçš„ä»£ç†å®ç° else &#123; self.navWebViewDelegate = [[CDVUIWebViewNavigationDelegate alloc] initWithEnginePlugin:self]; self.uiWebViewDelegate = [[CDVUIWebViewDelegate alloc] initWithDelegate:self.navWebViewDelegate]; uiWebView.delegate = self.uiWebViewDelegate; &#125; // åˆå§‹åŒ–é…ç½®ä¿¡æ¯ // self.commandDelegate.settingsæ˜¯CDVViewControllerçš„é…ç½®ä¿¡æ¯ï¼Œå®šä¹‰åœ¨config.xml [self updateSettings:self.commandDelegate.settings];&#125; jsè°ƒç”¨åŸç”Ÿæ’ä»¶è§£ææ’ä»¶è°ƒç”¨æµç¨‹ï¼š jså‘èµ·è¯·æ±‚gap:// å®ç°WebViewçš„ä»£ç†webView:shouldStartLoadWithRequest:navigationType:ï¼Œæ‹¦æˆªschemeä¸ºgapçš„è¯·æ±‚ æ‰§è¡Œjsæ–¹æ³•cordova.require(&#39;cordova/exec&#39;).nativeFetchMessages()è·å–éœ€è¦æ‰§è¡Œçš„åŸç”Ÿæ’ä»¶çš„ä¿¡æ¯ï¼ˆæ’ä»¶åï¼Œæ’ä»¶æ–¹æ³•ï¼Œå›è°ƒIDï¼Œå‚æ•°ï¼‰ å°†éœ€è¦æ‰§è¡Œçš„åŸç”Ÿæ’ä»¶ä¿¡æ¯æ”¾å…¥å‘½ä»¤é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œ æ‰§è¡ŒåŸç”Ÿæ’ä»¶ï¼Œå¹¶æŠŠç»“æœå›è°ƒç»™js æ’ä»¶è°ƒç”¨å †æ ˆå¦‚å›¾æ‰€ç¤ºï¼š jsè¯·æ±‚æ‹¦æˆªCDVUIWebViewDelegateå®ç°äº†UIWebViewçš„webView:shouldStartLoadWithRequest:navigationType:ä»£ç†ï¼Œåœ¨é¡µé¢åŠ è½½å‰åšä¸€äº›å¤„ç†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364- (BOOL)webView:(UIWebView*)webView shouldStartLoadWithRequest:(NSURLRequest*)request navigationType:(UIWebViewNavigationType)navigationType&#123; BOOL shouldLoad = YES; // 1. åˆ¤æ–­å¦‚æœæœ‰ä»£ç†ï¼Œå…ˆè°ƒç”¨ä»£ç†æ–¹æ³• // è¿™é‡Œçš„_delegateæ˜¯CDVUIWebViewNavigationDelegate if ([_delegate respondsToSelector:@selector(webView:shouldStartLoadWithRequest:navigationType:)]) &#123; shouldLoad = [_delegate webView:webView shouldStartLoadWithRequest:request navigationType:navigationType]; &#125; if (shouldLoad) &#123; // æ˜¯å¦æ˜¯è°ƒè¯•å·¥å…·refresh BOOL isDevToolsRefresh = (request == webView.request); // æ˜¯å¦æ˜¯é¡¶å±‚é¡µé¢ BOOL isTopLevelNavigation = isDevToolsRefresh || [request.URL isEqual:[request mainDocumentURL]]; if (isTopLevelNavigation) &#123; if ([self request:request isEqualToRequestAfterStrippingFragments:webView.request]) &#123; NSString* prevURL = [self evalForCurrentURL:webView]; if ([prevURL isEqualToString:[request.URL absoluteString]]) &#123; VerboseLog(@"Page reload detected."); &#125; else &#123; VerboseLog(@"Detected hash change shouldLoad"); return shouldLoad; &#125; &#125; switch (_state) &#123; case STATE_WAITING_FOR_LOAD_FINISH: // é‡å®šå‘æƒ…å†µï¼Œåˆ¤æ–­loadCountæ˜¯å¦æ˜¯1 if (_loadCount != 1) &#123; NSLog(@"CDVWebViewDelegate: Detected redirect when loadCount=%ld", (long)_loadCount); &#125; break; case STATE_IDLE: case STATE_IOS5_POLLING_FOR_LOAD_START: case STATE_CANCELLED: // é¡µé¢å¯¼èˆªå¼€å§‹ _loadCount = 0; _state = STATE_WAITING_FOR_LOAD_START; break; default: &#123; // å…¶å®ƒæƒ…å†µï¼Œå›è°ƒwebView:didFailLoadWithError: NSString* description = [NSString stringWithFormat:@"CDVWebViewDelegate: Navigation started when state=%ld", (long)_state]; NSLog(@"%@", description); _loadCount = 0; _state = STATE_WAITING_FOR_LOAD_START; if ([_delegate respondsToSelector:@selector(webView:didFailLoadWithError:)]) &#123; NSDictionary* errorDictionary = @&#123;NSLocalizedDescriptionKey : description&#125;; NSError* error = [[NSError alloc] initWithDomain:@"CDVUIWebViewDelegate" code:1 userInfo:errorDictionary]; [_delegate webView:webView didFailLoadWithError:error]; &#125; &#125; &#125; &#125; else &#123; // å±è”½ä¸€äº›æ— æ•ˆç½‘ç«™çš„è®¿é—® shouldLoad = shouldLoad &amp;&amp; [self shouldLoadRequest:request]; &#125; &#125; return shouldLoad;&#125; æ‹¦æˆªjsè°ƒç”¨åŸç”Ÿæ’ä»¶è¯·æ±‚çš„å…³é”®ä»£ç åœ¨CDVUIWebViewNavigationDelegateï¼Œå®ƒå®ç°äº†CDVUIWebViewDelegateçš„ä»£ç†ï¼Œåœ¨CDVUIWebViewDelegateä¼šæŠŠè¯·æ±‚è½¬å‘ç»™å®ƒã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243- (BOOL)webView:(UIWebView*)theWebView shouldStartLoadWithRequest:(NSURLRequest*)request navigationType:(UIWebViewNavigationType)navigationType&#123; NSURL* url = [request URL]; CDVViewController* vc = (CDVViewController*)self.enginePlugin.viewController; // H5è°ƒç”¨åŸç”Ÿæ’ä»¶ï¼Œåé¢åˆ†æ if ([[url scheme] isEqualToString:@"gap"]) &#123; [vc.commandQueue fetchCommandsFromJs]; [vc.commandQueue executePending]; return NO; &#125; // ç»™æ’ä»¶é¢„ç•™äº†ä¸€ä¸ªå¤„ç†URLçš„æ–¹æ³•ï¼Œè°ƒç”¨æ’ä»¶çš„æ–¹æ³•`shouldOverrideLoadWithRequest:navigationType:`ï¼Œè·å–è¿”å›å€¼ // åº”ç”¨ï¼šç³»ç»Ÿé»˜è®¤æ’ä»¶CDVIntentAndNavigationFilterä¸­ï¼Œå®ç°äº†Intentä¸Navigationçš„ç™½åå•æœºåˆ¶ã€‚ BOOL anyPluginsResponded = NO; BOOL shouldAllowRequest = NO; for (NSString* pluginName in vc.pluginObjects) &#123; CDVPlugin* plugin = [vc.pluginObjects objectForKey:pluginName]; SEL selector = NSSelectorFromString(@"shouldOverrideLoadWithRequest:navigationType:"); if ([plugin respondsToSelector:selector]) &#123; anyPluginsResponded = YES; shouldAllowRequest = (((BOOL (*)(id, SEL, id, int))objc_msgSend)(plugin, selector, request, navigationType)); if (!shouldAllowRequest) &#123; break; &#125; &#125; &#125; if (anyPluginsResponded) &#123; return shouldAllowRequest; &#125; // å¤„ç†å…¶å®ƒç±»å‹çš„url,file:ç±»å‹ç›´æ¥è¿”å›YES BOOL shouldAllowNavigation = [self defaultResourcePolicyForURL:url]; if (shouldAllowNavigation) &#123; return YES; &#125; else &#123; [[NSNotificationCenter defaultCenter] postNotification:[NSNotification notificationWithName:CDVPluginHandleOpenURLNotification object:url]]; &#125; return NO;&#125; H5è°ƒç”¨åŸç”Ÿæ’ä»¶Cordovaè°ƒç”¨åŸç”Ÿæ’ä»¶çš„æ–¹å¼æ˜¯é€šè¿‡æ‹¦æˆªgap://çš„URLï¼Œç„¶åæ‰§è¡Œjsä»£ç cordova.require(&#39;cordova/exec&#39;).nativeFetchMessages()è·å–å‚æ•°ï¼Œæ¥å®ç°è°ƒç”¨ã€‚ æˆ‘ä»¬æ¥çœ‹å…³é”®ä»£ç ï¼š 1234567891011// CDVUIWebViewNavigationDelegate.m- (BOOL)webView:(UIWebView*)theWebView shouldStartLoadWithRequest:(NSURLRequest*)request navigationType:(UIWebViewNavigationType)navigationType&#123; CDVViewController* vc = (CDVViewController*)self.enginePlugin.viewController; if ([[url scheme] isEqualToString:@"gap"]) &#123; [vc.commandQueue fetchCommandsFromJs]; [vc.commandQueue executePending]; return NO; &#125;&#125; 12345678910111213141516- (void)fetchCommandsFromJs&#123; __weak CDVCommandQueue* weakSelf = self; NSString* js = @"cordova.require('cordova/exec').nativeFetchMessages()"; [_viewController.webViewEngine evaluateJavaScript:js completionHandler:^(id obj, NSError* error) &#123; if ((error == nil) &amp;&amp; [obj isKindOfClass:[NSString class]]) &#123; NSString* queuedCommandsJSON = (NSString*)obj; // è°ƒç”¨çš„æ’ä»¶ä¿¡æ¯åŠ å…¥åˆ°queueä¸­ [weakSelf enqueueCommandBatch:queuedCommandsJSON]; // è°ƒç”¨æ‰§è¡Œæ–¹æ³• [self executePending]; &#125; &#125;];&#125; è°ƒç”¨jsæ–¹æ³•cordova.require(&#39;cordova/exec&#39;).nativeFetchMessages()ï¼Œè·å–è°ƒç”¨çš„æ’ä»¶ä¿¡æ¯ã€‚ 12// æ’ä»¶ä¿¡æ¯ç¤ºä¾‹[["DevicePlugin1678563772","DevicePlugin","getDeviceInfo",[]]] å‘½ä»¤é˜Ÿåˆ—CDVCommandQueuejsçš„æ¯æ¬¡è°ƒç”¨ä¿¡æ¯ä¼šå°è£…è¢«å°è£…ä¸ºä¸€ä¸ªå‘½ä»¤CDVInvokedUrlCommandï¼ŒCDVInvokedUrlCommandç»§æ‰¿è‡ªNSObjectï¼Œä¸»è¦å­˜å‚¨äº†ä¸‹é¢çš„ä¿¡æ¯ï¼š 123456789// CDVInvokedUrlCommand// å‚æ•°@property (nonatomic, readonly) NSArray* arguments;// å›è°ƒID@property (nonatomic, readonly) NSString* callbackId;// ç±»å@property (nonatomic, readonly) NSString* className;// æ–¹æ³•å@property (nonatomic, readonly) NSString* methodName; CDVCommandQueueç®¡ç†ç€æ‰€æœ‰çš„å‘½ä»¤ï¼Œå®ç°äº†ä¸€ä¸ªå‘½ä»¤çš„é˜Ÿåˆ—ã€‚åœ¨jsè°ƒç”¨åŸç”Ÿæ’ä»¶æ—¶ï¼Œä¼šè°ƒç”¨CDVCommandQueueçš„enqueueCommandBatch:æ–¹æ³•ï¼Œå°†æ’ä»¶è°ƒç”¨ä¿¡æ¯åŠ åˆ°commandBatchHolderæ•°ç»„ä¸­ï¼Œæœ€åcommandBatchHolderæ•°ç»„æ·»åŠ åˆ°CDVCommandQueueçš„queueã€‚ 123456789101112131415161718- (void)enqueueCommandBatch:(NSString*)batchJSON&#123; if ([batchJSON length] &gt; 0) &#123; NSMutableArray* commandBatchHolder = [[NSMutableArray alloc] init]; [_queue addObject:commandBatchHolder]; if ([batchJSON length] &lt; JSON_SIZE_FOR_MAIN_THREAD) &#123; [commandBatchHolder addObject:[batchJSON cdv_JSONObject]]; &#125; else &#123; dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^() &#123; NSMutableArray* result = [batchJSON cdv_JSONObject]; @synchronized(commandBatchHolder) &#123; [commandBatchHolder addObject:result]; &#125; [self performSelectorOnMainThread:@selector(executePending) withObject:nil waitUntilDone:NO]; &#125;); &#125; &#125;&#125; æ’ä»¶çš„æ‰§è¡Œç”±CDVCommandQueueç®¡ç†ï¼Œæ¯ä¸ªCDVViewControlleræœ‰è‡ªå·±çš„é˜Ÿåˆ—ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„æˆå‘˜å˜é‡ã€‚ 1234/* äºŒç»´æ•°ç»„ï¼Œå­˜å‚¨ç€æ‰€æœ‰æ’ä»¶è°ƒç”¨çš„json */NSMutableArray* _queue;/* è®°å½•å¼€å§‹è°ƒç”¨çš„æ—¶é—´ */NSTimeInterval _startExecutionTime; executePendingè´Ÿè´£æ‰§è¡Œå‘½ä»¤é˜Ÿåˆ—ä¸­å¾…æ‰§è¡Œçš„æ’ä»¶ï¼Œå…·ä½“å®ç°å°±æ˜¯éå†æ‰§è¡ŒäºŒç»´æ•°ç»„queueã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849- (void)executePending&#123; // å¦‚æœå·²ç»å¼€å§‹æ‰§è¡Œäº†ï¼Œè¿”å› if (_startExecutionTime &gt; 0) &#123; return; &#125; @try &#123; // è®°å½•å¼€å§‹æ‰§è¡Œçš„æ—¶é—´ _startExecutionTime = [NSDate timeIntervalSinceReferenceDate]; // éå†_queue while ([_queue count] &gt; 0) &#123; NSMutableArray* commandBatchHolder = _queue[0]; NSMutableArray* commandBatch = nil; @synchronized(commandBatchHolder) &#123; if ([commandBatchHolder count] == 0) &#123; break; &#125; commandBatch = commandBatchHolder[0]; &#125; // éå†commandBatch while ([commandBatch count] &gt; 0) &#123; @autoreleasepool &#123; // å–å‡ºcommandBatchçš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œå¹¶ç§»é™¤ NSArray* jsonEntry = [commandBatch cdv_dequeue]; if ([commandBatch count] == 0) &#123; [_queue removeObjectAtIndex:0]; &#125; // ç”¨æ’ä»¶è°ƒç”¨jsonä¿¡æ¯ï¼Œåˆ›å»ºCDVInvokedUrlCommand CDVInvokedUrlCommand* command = [CDVInvokedUrlCommand commandFromJson:jsonEntry]; // è°ƒç”¨æ’ä»¶ [self execute:command]); &#125; // å¯¹äºæ€§èƒ½çš„ä¸€ä¸ªä¼˜åŒ–ï¼Œåé¢ä¼šè¯¦ç»†è¯´ if (([_queue count] &gt; 0) &amp;&amp; ([NSDate timeIntervalSinceReferenceDate] - _startExecutionTime &gt; MAX_EXECUTION_TIME)) &#123; [self performSelector:@selector(executePending) withObject:nil afterDelay:0]; return; &#125; &#125; &#125; &#125; @finally &#123; _startExecutionTime = 0; &#125;&#125; ç”¨Runloopä¼˜åŒ–æ€§èƒ½Cordovaå¯¹äºæ’ä»¶çš„æ‰§è¡Œè¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¿è¯é¡µé¢çš„æµç¨‹åº¦ï¼Œè¿ç”¨äº†RunLoopï¼Œå·§å¦™çš„å°†ä»£ç åˆ†å‰²ä¸ºå¤šå—åˆ†æ¬¡æ‰§è¡Œï¼Œé¿å…ç”±äºæ’ä»¶æ‰§è¡Œå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼Œå½±å“é¡µé¢ç»˜åˆ¶ï¼Œå¯¼è‡´æ‰å¸§ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567891011// CDVCommandQueue.m// MAX_EXECUTION_TIME â‰ˆ 1s / 60 / 2// è®¡ç®—å‡ºç»˜åˆ¶ä¸€å¸§æ—¶é—´çš„ä¸€åŠstatic const double MAX_EXECUTION_TIME = .008;// åˆ¤æ–­æœ¬æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œå¦‚æœå¤§äºMAX_EXECUTION_TIMEï¼Œè°ƒç”¨performSelector:withObject:afterDelayï¼Œç»“æŸæœ¬æ¬¡è°ƒç”¨if (([_queue count] &gt; 0) &amp;&amp; ([NSDate timeIntervalSinceReferenceDate] - _startExecutionTime &gt; MAX_EXECUTION_TIME)) &#123; [self performSelector:@selector(executePending) withObject:nil afterDelay:0]; return;&#125; ä¼˜åŒ–ç­–ç•¥åˆ†æï¼š å°†é˜Ÿåˆ—ä¸­çš„æ’ä»¶åˆ†å‰²ä¸ºå¾ˆå¤šå°å—æ¥æ‰§è¡Œ å¼€å§‹æ‰§è¡ŒexecutePendingæ–¹æ³•æ—¶ï¼Œè®°å½•å¼€å§‹æ—¶é—´ï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªæ’ä»¶æ–¹æ³•åï¼Œåˆ¤æ–­æœ¬æ¬¡æ‰§è¡Œæ—¶é—´æ˜¯å¦è¶…è¿‡MAX_EXECUTION_TIMEï¼Œå¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œç»§ç»­æ‰§è¡Œï¼Œå¦‚æœè¶…è¿‡äº†MAX_EXECUTION_TIMEï¼Œè°ƒç”¨performSelector:withObject:afterDelayï¼Œç»“æŸæœ¬æ¬¡è°ƒç”¨ å¦‚æœè¦ä¿è¯UIæµç•…ï¼Œéœ€è¦æ»¡è¶³æ¡ä»¶CPUæ—¶é—´ + GPUæ—¶é—´ &lt;= 1s/60ï¼Œ ä¸ºäº†ç»™GPUç•™ä¸‹è¶³å¤Ÿçš„æ—¶é—´æ¸²æŸ“ï¼Œè¦å°½é‡è®©CPUå ç”¨æ—¶é—´å°äº1s/60/2 Runloopæ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç³»ç»Ÿåœ¨æ”¶åˆ°kCFRunLoopBeforeWaitingï¼ˆçº¿ç¨‹å³å°†ä¼‘çœ ï¼‰é€šçŸ¥æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡ç•Œé¢çš„æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯åœ¨å®Œæˆsource0çš„å¤„ç†å source0åœ¨è¿™é‡Œå°±æ˜¯æ’ä»¶çš„æ‰§è¡Œä»£ç ï¼Œåœ¨kCFRunLoopBeforeWaitingé€šçŸ¥ä¹‹å‰ï¼Œå¦‚æœsource0æ‰§è¡Œæ—¶é—´è¿‡é•¿å°±ä¼šå¯¼è‡´ç•Œé¢æ²¡æœ‰å¾—åˆ°åŠæ—¶çš„åˆ·æ–°ã€‚ å‡½æ•°performSelector:withObject:afterDelayï¼Œä¼šå°†æ–¹æ³•æ³¨å†Œåˆ°Timerï¼Œç»“æŸsource0è°ƒç”¨ï¼Œå¼€å§‹æ¸²æŸ“ç•Œé¢ã€‚ç•Œé¢æ¸²æŸ“å®Œæˆåï¼ŒRunloopå¼€å§‹sleepï¼Œç„¶åè¢«timerå”¤é†’åˆå¼€å§‹ç»§ç»­å¤„ç†source0ã€‚ æ’ä»¶æ–¹æ³•æ‰§è¡Œæ–¹æ³•æœ€ç»ˆçš„æ‰§è¡Œåœ¨æ–¹æ³•execute:ä¸­ï¼Œä»commandä¸­å–å‡ºè¦æ‰§è¡Œçš„æ’ä»¶ç±»ã€æ–¹æ³•ã€å‚æ•°ï¼Œç„¶åæ‰§è¡Œæ–¹æ³•ã€‚ 123456789101112131415161718192021222324- (BOOL)execute:(CDVInvokedUrlCommand*)command&#123; // è·å–æ’ä»¶å®ä¾‹ CDVPlugin* obj = [_viewController.commandDelegate getCommandInstance:command.className]; BOOL retVal = YES; double started = [[NSDate date] timeIntervalSince1970] * 1000.0; NSString* methodName = [NSString stringWithFormat:@"%@:", command.methodName]; SEL normalSelector = NSSelectorFromString(methodName); if ([obj respondsToSelector:normalSelector]) &#123; ((void (*)(id, SEL, id))objc_msgSend)(obj, normalSelector, command); &#125; else &#123; // There's no method to call, so throw an error. NSLog(@"ERROR: Method '%@' not defined in Plugin '%@'", methodName, command.className); retVal = NO; &#125; double elapsed = [[NSDate date] timeIntervalSince1970] * 1000.0 - started; // ç›‘æ§æ’ä»¶æ–¹æ³•æ‰§è¡Œæ—¶é—´ï¼Œæ‰“å°å‡ºå¤§äº10msçš„æ–¹æ³• if (elapsed &gt; 10) &#123; NSLog(@"THREAD WARNING: ['%@'] took '%f' ms. Plugin should use a background thread.", command.className, elapsed); &#125; return retVal;&#125; åŸç”Ÿå›è°ƒjsåŸç”Ÿæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œä¼šæŠŠç»“æœè¿”å›ç»™jsï¼Œè°ƒç”¨æ–¹æ³•sendPluginResult:callbackId:ï¼Œç”¨CDVPluginResultæ¥ä¼ é€’å›è°ƒå‚æ•°ï¼Œç”¨callbackIdæ¥åŒºåˆ†æ˜¯å“ªæ¬¡è°ƒç”¨ï¼ˆcallbackIdç”±jsäº§ç”Ÿï¼‰ã€‚ 12345678910111213141516171819// CDVCommandDelegateImpl.m- (void)sendPluginResult:(CDVPluginResult*)result callbackId:(NSString*)callbackId&#123; // åˆ¤æ–­callbackIdé•¿åº¦æ˜¯å¦å°äº100 // ç”¨æ­£åˆ™è¡¨è¾¾å¼"[^A-Za-z0-9._-]"æ¥éªŒè¯callbackId if (![self isValidCallbackId:callbackId]) &#123; return; &#125; // çŠ¶æ€ç  int status = [result.status intValue]; // æ˜¯å¦æŒç»­å›è°ƒ BOOL keepCallback = [result.keepCallback boolValue]; // ä¼šå¸¦å“¦å‚æ•° NSString* argumentsAsJSON = [result argumentsAsJSON]; // æ‰§è¡Œjsæ–¹æ³•ï¼Œå›è°ƒ NSString* js = [NSString stringWithFormat:@"cordova.require('cordova/exec').nativeCallback('%@',%d,%@,%d, %d)", callbackId, status, argumentsAsJSON, keepCallback, debug]; [self evalJsHelper:js];&#125; CDVPluginæ³¨å†Œä¸åˆå§‹åŒ–æˆ‘ä»¬å…ˆçœ‹çœ‹é…ç½®æ–‡ä»¶ä¸­æ’ä»¶çš„å®šä¹‰ï¼š 1234567&lt;!-- å®šä¹‰æ’ä»¶åä¸ºHandleOpenUrlçš„æ’ä»¶ --&gt;&lt;feature name="HandleOpenUrl"&gt; &lt;!-- å¯¹åº”çš„iOSç±»åæ˜¯CDVHandleOpenURL --&gt; &lt;param name="ios-package" value="CDVHandleOpenURL" /&gt; &lt;!-- éœ€è¦é»˜è®¤åŠ è½½çš„æ’ä»¶ --&gt; &lt;param name="onload" value="true" /&gt;&lt;/feature&gt; åŠ è½½é»˜è®¤æ’ä»¶åœ¨CDVViewControllerçš„viewDidLoadæ—¶ï¼Œä»Cordovaçš„é…ç½®æ–‡ä»¶config.xmlä¸­ï¼Œè¯»å–å‡ºéœ€è¦é»˜è®¤åŠ è½½çš„æ’ä»¶ï¼Œéå†åˆå§‹åŒ–ã€‚ CDVViewControllerä¸­åˆå§‹åŒ–é»˜è®¤æ’ä»¶ä»£ç ã€‚ 1234567891011121314151617- (void)viewDidLoad &#123; // Load settings [self loadSettings]; if ([self.startupPluginNames count] &gt; 0) &#123; [CDVTimer start:@"TotalPluginStartup"]; for (NSString* pluginName in self.startupPluginNames) &#123; [CDVTimer start:pluginName]; // åˆå§‹åŒ–æ’ä»¶ [self getCommandInstance:pluginName]; [CDVTimer stop:pluginName]; &#125; [CDVTimer stop:@"TotalPluginStartup"]; &#125;&#125; æ’ä»¶åˆå§‹åŒ–æ’ä»¶åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼š åŠ è½½é…ç½®æ–‡ä»¶config.xml æ ¹æ®æ’ä»¶åè·å–å¯¹åº”ç±»å æ ¹æ®ç±»åä»ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœå‘½ä¸­ç›´æ¥è¿”å› æ²¡æœ‰ç¼“å­˜é‡æ–°åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå¹¶å†™å…¥ç¼“å­˜ æ’ä»¶åˆå§‹åŒ–çš„å…¥å£æ˜¯getCommandInstanceï¼Œä¼ å…¥å‚æ•°æ˜¯æ’ä»¶åç§°ï¼Œè¿”å›ä¸€ä¸ªæ’ä»¶çš„å®ä¾‹å¯¹è±¡ã€‚ 12345678910111213141516171819202122232425- (id)getCommandInstance:(NSString*)pluginName&#123; // åœ¨pluginsMapä¸­ç”¨æ’ä»¶åç§°è·å–ç±»åï¼ˆæ’ä»¶åä¸åŒºåˆ†å¤§å°å†™ï¼‰ NSString* className = [self.pluginsMap objectForKey:[pluginName lowercaseString]]; // æ²¡æœ‰é…ç½®æ’ä»¶ï¼Œåˆå§‹åŒ–å¤±è´¥ if (className == nil) &#123; return nil; &#125; // ä»ç¼“å­˜ä¸­è·å–ï¼Œå¦‚æœå‘½ä¸­ç›´æ¥è¿”å›ç¼“å­˜ id obj = [self.pluginObjects objectForKey:className]; if (!obj) &#123; // æ²¡æœ‰ç¼“å­˜ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ obj = [[NSClassFromString(className)alloc] initWithWebViewEngine:_webViewEngine]; if (obj != nil) &#123; // å®ä¾‹åˆ›å»ºæˆåŠŸï¼Œæ³¨å†Œæ’ä»¶ [self registerPlugin:obj withClassName:className]; &#125; else &#123; NSLog(@"CDVPlugin class %@ (pluginName: %@) does not exist.", className, pluginName); &#125; &#125; return obj;&#125; æ³¨å†Œæ’ä»¶çš„å…³é”®æ–¹æ³•registerPlugin:withClassName: 1234567891011121314- (void)registerPlugin:(CDVPlugin*)plugin withClassName:(NSString*)className&#123; if ([plugin respondsToSelector:@selector(setViewController:)]) &#123; [plugin setViewController:self]; &#125; if ([plugin respondsToSelector:@selector(setCommandDelegate:)]) &#123; [plugin setCommandDelegate:_commandDelegate]; &#125; // å†™å…¥ç¼“å­˜ [self.pluginObjects setObject:plugin forKey:className]; [plugin pluginInitialize];&#125; Cordovaè¿˜æä¾›äº†æ’ä»¶åæ³¨å†Œæ’ä»¶çš„æ–¹å¼ï¼Œä½¿ç”¨å‡½æ•°registerPlugin:withPluginName:ï¼Œå®ç°æ–¹å¼å·®ä¸å¤šï¼Œå°±ä¸èµ˜è¿°äº†ã€‚ æ³¨å†Œæ’ä»¶æ­¥éª¤ è®¾ç½®æ’ä»¶çš„viewControllerå’Œdelegate å°†æ’ä»¶ä»¥classNameä¸ºkeyæ”¾å…¥pluginObjectsä¸­ï¼ŒpluginObjectsæ˜¯ä¸€ä¸ªæ’ä»¶çš„ç¼“å­˜ è°ƒç”¨æ’ä»¶çš„pluginInitialize æ’ä»¶é”€æ¯æ’ä»¶é”€æ¯çš„æ—¶æœºæ˜¯åˆ›å»ºæ’ä»¶çš„CDVViewControlleré‡Šæ”¾çš„æ—¶å€™ï¼Œå› ä¸ºæ’ä»¶å®ä¾‹è¢«åˆ›å»ºåè¢«ç¼“å­˜mapå¼•ç”¨ï¼Œå¯¹åº”çš„é”€æ¯ä»£ç ã€‚ 12345678910111213141516// CDVViewController.m- (void)dealloc&#123; [[NSNotificationCenter defaultCenter] removeObserver:self]; [CDVUserAgentUtil releaseLock:&amp;_userAgentLockToken]; [_commandQueue dispose]; [[self.pluginObjects allValues] makeObjectsPerformSelector:@selector(dispose)];&#125;// CDVPlugin.m- (void)dispose&#123; viewController = nil; commandDelegate = nil;&#125; å°ç»“ åœ¨config.xmlæ–‡ä»¶ä¸­é…ç½®æ’ä»¶ï¼Œå£°æ˜æ’ä»¶ä¸ç±»çš„æ˜ å°„å…³ç³»ï¼Œä»¥åŠåŠ è½½ç­–ç•¥ æ’ä»¶çš„åˆå§‹åŒ–æ—¶æ‡’åŠ è½½ï¼Œé™¤äº†onloadé…ç½®ä¸ºYESçš„æ’ä»¶ä¼šé»˜è®¤åŠ è½½ï¼Œå…¶å®ƒæ’ä»¶éƒ½æ˜¯ä½¿ç”¨æ—¶åŠ è½½ æ’ä»¶ä½¿ç”¨äº†ä¸¤ä¸ªMapæ¥ç¼“å­˜ï¼ŒpluginObjectså»ºç«‹äº†ç±»åä¸æ’ä»¶å®ä¾‹å¯¹è±¡çš„æ˜ å°„ï¼ŒpluginsMapå»ºç«‹äº†æ’ä»¶åä¸ç±»åçš„æ˜ å°„ã€‚ åœ¨ä¸€ä¸ªCDVViewControllerä¸­ï¼ŒåŒä¸€ä¸ªæ’ä»¶åŒæ—¶åªä¼šå­˜åœ¨ä¸€ä¸ªå®ä¾‹]]></content>
      <tags>
        <tag>æºç å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµ…æAutoreleasePoolæºç ]]></title>
    <url>%2F2018%2F04%2F14%2F%E6%B5%85%E6%9E%90AutoreleasePool%E6%BA%90%E7%A0%81%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨æ‹œè¯»Dravenesså¤§ä½¬çš„ä¸€ç¯‡æ–‡ç« è‡ªåŠ¨é‡Šæ”¾æ± çš„å‰ä¸–ä»Šç”Ÿ â€”- æ·±å…¥è§£æ autoreleasepoolï¼Œçœ‹åˆ°æ–‡ä¸­ç»™è¯»è€…ç•™äº†ä¸€ä¸ªé—®é¢˜ï¼š æˆ‘åˆ°ç°åœ¨ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆè¦æ ¹æ®å½“å‰é¡µçš„ä¸åŒçŠ¶æ€ kill æ‰ä¸åŒ child çš„é¡µé¢ã€‚ å…³äºAutoreleasePoolæ˜¯ä»€ä¹ˆï¼Œå¼ºåŠ›æ¨èé˜…è¯»åŸæ–‡ï¼Œå†™çš„å¾ˆå¥½ã€‚è¿™é‡Œå°±ä¸è¯´äº†ï¼Œç›´æ¥è®¨è®ºé—®é¢˜ã€‚ é¦–å…ˆæ˜¯æ•´ä¸ªpopæ–¹æ³•çš„å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758static inline void pop(void *token) &#123; AutoreleasePoolPage *page; id *stop; if (token == (void*)EMPTY_POOL_PLACEHOLDER) &#123; // Popping the top-level placeholder pool. if (hotPage()) &#123; // Pool was used. Pop its contents normally. // Pool pages remain allocated for re-use as usual. pop(coldPage()-&gt;begin()); &#125; else &#123; // Pool was never used. Clear the placeholder. setHotPage(nil); &#125; return; &#125; page = pageForPointer(token); stop = (id *)token; if (*stop != POOL_BOUNDARY) &#123; if (stop == page-&gt;begin() &amp;&amp; !page-&gt;parent) &#123; // Start of coldest page may correctly not be POOL_BOUNDARY: // 1. top-level pool is popped, leaving the cold page in place // 2. an object is autoreleased with no pool &#125; else &#123; // Error. For bincompat purposes this is not // fatal in executables built with old SDKs. return badPop(token); &#125; &#125; if (PrintPoolHiwat) printHiwat(); page-&gt;releaseUntil(stop); // memory: delete empty children if (DebugPoolAllocation &amp;&amp; page-&gt;empty()) &#123; // special case: delete everything during page-per-pool debugging AutoreleasePoolPage *parent = page-&gt;parent; page-&gt;kill(); setHotPage(parent); &#125; else if (DebugMissingPools &amp;&amp; page-&gt;empty() &amp;&amp; !page-&gt;parent) &#123; // special case: delete everything for pop(top) // when debugging missing autorelease pools page-&gt;kill(); setHotPage(nil); &#125; else if (page-&gt;child) &#123; // hysteresis: keep one empty child if page is more than half fully if (page-&gt;lessThanHalfFull()) &#123; page-&gt;child-&gt;kill(); &#125; else if (page-&gt;child-&gt;child) &#123; page-&gt;child-&gt;child-&gt;kill(); &#125; &#125;&#125; æˆ‘ä»¬å…ˆçœ‹çœ‹é‡Šæ”¾çš„å‡½æ•°releaseUntilï¼Œå®ƒåœ¨é‡Šæ”¾çš„æ—¶å€™å…¶å®ä¼šä¸€ç›´é¡ºç€parentå¾€å‰é‡Šæ”¾ï¼Œç›´åˆ°å‚æ•°stopï¼Œä¹Ÿå°±æ˜¯è¯´å¯èƒ½ä¸€æ¬¡æ€§é‡Šæ”¾å¥½å‡ ä¸ªpageã€‚ 123456789101112131415161718192021// ä»£ç æœ‰æ‰€åˆ å‡void releaseUntil(id *stop)&#123; while (this-&gt;next != stop) &#123; AutoreleasePoolPage *page = hotPage(); while (page-&gt;empty()) &#123; page = page-&gt;parent; setHotPage(page); &#125; id obj = *--page-&gt;next; memset((void*)page-&gt;next, SCRIBBLE, sizeof(*page-&gt;next)); if (obj != POOL_BOUNDARY) &#123; objc_release(obj); &#125; &#125; setHotPage(this);&#125; ç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ®µæœ‰ç–‘é—®çš„ä»£ç  123456789101112131415161718192021// memory: delete empty childrenif (DebugPoolAllocation &amp;&amp; page-&gt;empty()) &#123; // åˆ†æ”¯1 // special case: delete everything during page-per-pool debugging AutoreleasePoolPage *parent = page-&gt;parent; page-&gt;kill(); setHotPage(parent);&#125; else if (DebugMissingPools &amp;&amp; page-&gt;empty() &amp;&amp; !page-&gt;parent) &#123; // åˆ†æ”¯2 // special case: delete everything for pop(top) // when debugging missing autorelease pools page-&gt;kill(); setHotPage(nil);&#125; else if (page-&gt;child) &#123; // åˆ†æ”¯3 // hysteresis: keep one empty child if page is more than half fully if (page-&gt;lessThanHalfFull()) &#123; page-&gt;child-&gt;kill(); &#125; else if (page-&gt;child-&gt;child) &#123; page-&gt;child-&gt;child-&gt;kill(); &#125;&#125; è¿™å—ä»£ç çš„ä½œç”¨æ˜¯åˆ é™¤ç©ºçš„å­èŠ‚ç‚¹ï¼Œé‡Šæ”¾å†…å­˜ã€‚popä¹‹åä¸‰ç§æƒ…å†µï¼š å½“å‰pageä¸ºç©ºï¼Œç›´æ¥killæ‰å½“å‰pageï¼Œç„¶åæŠŠparentè®¾ç½®ä¸ºhotpageï¼› å½“å‰pageä¸ºç©ºï¼Œè€Œä¸”æ²¡æœ‰parentï¼Œkillæ‰å½“å‰pageï¼Œhotpageç½®ä¸ºç©ºï¼› å½“å‰pageä¸ä¸ºç©ºï¼Œä½†æ˜¯æœ‰childï¼Œå¦‚æœå½“å‰pageçš„ç©ºé—´å ç”¨ä¸åˆ°ä¸€åŠï¼Œé‡Šæ”¾childï¼Œå¦‚æœå½“å‰pageçš„ç©ºé—´å ç”¨è¶…è¿‡ä¸€åŠï¼Œä¸”childè¿˜æœ‰childï¼Œç›´æ¥é‡Šæ”¾è¿™ä¸ªå­™å­è¾ˆçš„pageã€‚ï¼ˆå¯¹äºç¬¬ä¸‰æ­¥æ³¨é‡Šä¸­çš„è§£é‡Šæ˜¯ï¼škeep one empty child if page is more than half fullyï¼‰ æˆ‘ä»¬å†çœ‹çœ‹killçš„å®ç°ï¼Œå¯ä»¥å‘ç°ä»–æ˜¯ä¼šé¡ºç€childä¸€ç›´å¾€åé‡Šæ”¾ï¼Œä¿è¯é‡Šæ”¾èŠ‚ç‚¹çš„child pageéƒ½è¢«é‡Šæ”¾äº†ã€‚ 1234567891011121314151617void kill()&#123; AutoreleasePoolPage *page = this; while (page-&gt;child) page = page-&gt;child; AutoreleasePoolPage *deathptr; do &#123; deathptr = page; page = page-&gt;parent; if (page) &#123; page-&gt;unprotect(); page-&gt;child = nil; page-&gt;protect(); &#125; delete deathptr; &#125; while (deathptr != this);&#125; åˆ°è¿™é‡Œå°±å¯ä»¥å¾—å‡ºç»“è®ºäº†ï¼š popä¹‹åï¼Œæ‰€æœ‰child pageè‚¯å®šéƒ½ä¸ºç©ºäº†ï¼Œä¸”å½“å‰pageä¸€å®šæ˜¯hotPage ç³»ç»Ÿä¸ºäº†èŠ‚çº¦å†…å­˜ï¼Œåˆ¤æ–­ï¼Œå¦‚æœå½“å‰pageç©ºé—´ä½¿ç”¨å°‘äºä¸€åŠï¼Œå°±é‡Šæ”¾æ‰æ‰€æœ‰çš„child pageï¼Œå¦‚æœå½“å‰pageç©ºé—´ä½¿ç”¨å¤§äºä¸€åŠï¼Œå°±ä»å­™å­pageå¼€å§‹é‡Šæ”¾ï¼Œé¢„ç•™ä¸€ä¸ªchild pageã€‚]]></content>
      <tags>
        <tag>æºç å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSç”¨åŸç”Ÿä»£ç è¯»å†™Webviewçš„Local Storage]]></title>
    <url>%2F2018%2F04%2F03%2FiOS%E7%94%A8%E5%8E%9F%E7%94%9F%E4%BB%A3%E7%A0%81%E8%AF%BB%E5%86%99Webview%E7%9A%84Local%20Storage%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯å…¬å¸é¡¹ç›®ä½¿ç”¨çš„Cordovaæ··åˆå¼€å‘çš„ï¼Œæœ‰ä¸€ä¸ªæ¨¡å—ä»¥å‰ç”¨H5å®ç°çš„ï¼Œæ–°ç‰ˆæœ¬ç”¨åŸç”Ÿæ¥å®ç°ï¼Œäºæ˜¯éœ€è¦è¿ç§»æ•°æ®ã€‚H5ä½¿ç”¨çš„Local Storageå­˜çš„æ•°æ®ï¼ŒåŸç”Ÿè¦æ‹¿åˆ°æ•°æ®æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š ç”¨WebViewæ‰§è¡Œjsæ–¹æ³•æ¥è¯»å–æ•°æ®ï¼› æ‰¾åˆ°Local Storageå­˜å‚¨è·¯å¾„ï¼Œç›´æ¥è¯»å–ï¼› æ–¹æ¡ˆä¸€å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œéœ€è¦å¤šå¼€ä¸€ä¸ªWebviewæ¥è¿ç§»æ•°æ®ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ä¸å¥½æ§åˆ¶ï¼Œä¸æ˜¯æœ€ä¼˜è§£ï¼Œæœ¬æ–‡è®¨è®ºçš„æ˜¯æ–¹æ¡ˆäºŒã€‚ ç›´æ¥è¯»å†™Local Storageå…ˆè¯´ç»“è®ºï¼ŒLocal Storageçš„å…¶å®æ˜¯ä¸€ä¸ªSqliteæ•°æ®åº“ï¼Œæˆ‘ä»¬è¦è¯»å†™æ•°æ®åªè¦æ‰¾åˆ°è¿™ä¸ªæ•°æ®åº“ï¼Œç„¶åå°±å¯ä»¥å®ç°æ‰‹åŠ¨è¯»å†™äº†ã€‚ æ•°æ®åº“å­˜æ”¾è·¯å¾„ iOS 5.1åŠä¹‹å‰ä½¿ç”¨UIWebViewï¼šLibrary/Caches/iOS 5.1ä¹‹åä½¿ç”¨UIWebViewï¼šLibrary/WebKit/LocalStorage/WKWebViewï¼šLibrary/WebKit/WebsiteData/LocalStorage/ // UIWebViewå¯ä»¥ä»UserDefaultå–å‡ºLocalStorageçš„è·¯å¾„[[NSUserDefaults standardUserDefaults] objectForKey:@â€WebKitLocalStorageDatabasePathPreferenceKeyâ€] æ•°æ®å­˜å‚¨æ–¹å¼æ•°æ®å­˜åœ¨ItemTableè¡¨ï¼Œåªæœ‰keyå’Œvalueä¸¤ä¸ªå­—æ®µï¼Œkeyç›´æ¥ç”¨NSStringå¯ä»¥å–å‡ºæ¥ï¼Œvalueå–å‡ºæ¥æ˜¯ä¸€ä¸ªNSDataï¼Œéœ€è¦ç”¨NSUTF16LittleEndianStringEncodingè§£ç ã€‚ è¯»å†™æ•°æ®å†™äº†ä¸ªç®€æ˜“çš„Demoï¼Œç”¨çš„FMDBæ¥æ“ä½œæ•°æ®åº“ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚ 12345678910111213// å–æ•°æ®- (NSString *)valueWithKey:(NSString *)key &#123; if ([NSString isNull:key]) &#123; return nil; &#125; __block NSString *result; [self.dataQueue inDatabase:^(FMDatabase *db) &#123; NSData *data = [db dataForQuery:@&quot;select value from ItemTable where key = ?&quot;, key]; result = [[NSString alloc] initWithData:data encoding:NSUTF16LittleEndianStringEncoding]; &#125;]; return result;&#125; 123456789101112131415// å­˜æ•°æ®- (BOOL)saveValue:(NSString *)value forKey:(NSString *)key &#123; if ([NSString isNull:value] || [NSString isNull:key]) &#123; return NO; &#125; __block BOOL result; [self.dataQueue inDatabase:^(FMDatabase *db) &#123; [db executeUpdate:@&quot;delete from ItemTable where key = ?&quot;, key]; NSData *data = [value dataUsingEncoding:NSUTF16LittleEndianStringEncoding]; result = [db executeUpdate:@&quot;insert into ItemTable (key, value) values (?, ?)&quot;, key, data]; &#125;]; return result;&#125; WebKitæºç åˆ†æä¸ºäº†æ‰¾åˆ°Local Storageå­˜æ”¾çš„è·¯å¾„ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œå‘ç°è¿™æ–¹é¢çš„èµ„æ–™å¾ˆå°‘ï¼Œä¹Ÿæ²¡æœ‰æ€•å‡ºç°å„ç§å‘æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å…¼å®¹ï¼Œäºæ˜¯å†³å®šç ”ç©¶ä¸‹WebKitæºç ï¼Œä»æºç é‡Œé¢æ‰¾ç­”æ¡ˆã€‚ Webkitã€WebCoreæºç åœ°å€ã€‚å¯ä»¥çœ‹åˆ°WebKitæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒWebKit-7604.1.38.0.7å’ŒWebKit2-7604.1.38.0.7ï¼Œå‰è€…æ˜¯UIWebViewçš„ï¼Œåè€…æ˜¯WKWebViewçš„ã€‚ è§£å‹WebKit-7604.1.38.0.7ã€‚ç”¨Xcodeæ‰“å¼€å·¥ç¨‹æ–‡ä»¶ï¼Œå·¥ç¨‹åå«WebKitLegacyï¼Œè¿™ä¸ªå‘½åå¤ªå½¢è±¡äº†ï¼ŒWebKitçš„é—äº§ã€‚è‹¦äºå„ç§å†å²åŸå› ï¼Œå…¬å¸é¡¹ç›®è¿˜åœç•™åœ¨UIWebViewçš„é˜¶æ®µï¼Œå¿ƒå¡ã€‚åœ¨WebStorageManager.mç±»ä¸­å¯ä»¥çœ‹åˆ°å…³äºLocal Storageä¿å­˜è·¯å¾„çš„å®šä¹‰ï¼Œè·¯å¾„æ˜¯Library/WebKit/LocalStorage/ã€‚ 1234567891011static void initializeLocalStoragePath()&#123; NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults]; sLocalStoragePath = [defaults objectForKey:WebStorageDirectoryDefaultsKey]; if (!sLocalStoragePath || ![sLocalStoragePath isKindOfClass:[NSString class]]) &#123; NSArray *paths = NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES); NSString *libraryDirectory = [paths objectAtIndex:0]; sLocalStoragePath = [libraryDirectory stringByAppendingPathComponent:@&quot;WebKit/LocalStorage&quot;]; &#125; sLocalStoragePath = [[sLocalStoragePath stringByStandardizingPath] retain];&#125; è§£å‹WebKit2-7604.1.38.0.7ï¼Œè·¯å¾„å®šä¹‰åœ¨WKProcessPool.mmç±»ä¸­ï¼Œè·¯å¾„æ˜¯Library/WebKit/WebsiteData/LocalStorage/ã€‚ 123456789+ (NSURL *)_websiteDataURLForContainerWithURL:(NSURL *)containerURL bundleIdentifierIfNotInContainer:(NSString *)bundleIdentifier&#123; NSURL *url = [containerURL URLByAppendingPathComponent:@&quot;Library&quot; isDirectory:YES]; url = [url URLByAppendingPathComponent:@&quot;WebKit&quot; isDirectory:YES]; if (!WebKit::processHasContainer() &amp;&amp; bundleIdentifier) url = [url URLByAppendingPathComponent:bundleIdentifier isDirectory:YES]; return [url URLByAppendingPathComponent:@&quot;WebsiteData&quot; isDirectory:YES]; è‡³æ­¤å…³äºUIWebViewå’ŒWKWebViewçš„å­˜æ”¾è·¯å¾„æˆ‘ä»¬å·²ç»èƒ½å¤Ÿç¡®å®šäº†ï¼Œé‚£ä¹ˆæ–‡ä»¶åæ˜¯æ€ä¹ˆå®šä¹‰çš„å‘¢ï¼Œè¿™è¦çœ‹WebCoreçš„æºç äº†ï¼Œåœ¨SecurityOriginData.cppä¸­å®šä¹‰äº†æ–‡ä»¶åå‘½åè§„åˆ™ã€‚ 12345678910111213141516171819String SecurityOriginData::databaseIdentifier() const&#123; // Historically, we&apos;ve used the following (somewhat non-sensical) string // for the databaseIdentifier of local files. We used to compute this // string because of a bug in how we handled the scheme for file URLs. // Now that we&apos;ve fixed that bug, we still need to produce this string // to avoid breaking existing persistent state. if (equalIgnoringASCIICase(protocol, &quot;file&quot;)) return ASCIILiteral(&quot;file__0&quot;); StringBuilder stringBuilder; stringBuilder.append(protocol); stringBuilder.append(separatorCharacter); stringBuilder.append(encodeForFileName(host)); stringBuilder.append(separatorCharacter); stringBuilder.appendNumber(port.value_or(0)); return stringBuilder.toString();&#125; ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œå¦‚æœæ˜¯fileåè®®çš„urlï¼Œæ–‡ä»¶åå®šä¹‰ä¸ºfile__0ï¼Œå¦åˆ™ä¼šæ ¹æ®å®ƒçš„urlæ¥ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åã€‚ åœ¨è·Ÿä»£ç çš„æ—¶å€™ï¼Œå‘ç°UIWebViewä¼šæŠŠLocal Storageçš„å­˜å‚¨è·¯å¾„å­˜åœ¨UserDefaulté‡Œï¼Œå­˜å‚¨çš„Keyæ˜¯WebKitLocalStorageDatabasePathPreferenceKeyï¼ˆå®šä¹‰åœ¨WebPreferenceKeysPrivate.hï¼‰ã€‚åœ¨æ–‡ä»¶WebPrefences.mmä¸­å¯ä»¥æ‰¾åˆ°ç›¸å…³ä»£ç  123456789101112131415161718192021222324252627282930- (NSString *)_localStorageDatabasePath&#123; return [[self _stringValueForKey:WebKitLocalStorageDatabasePathPreferenceKey] stringByStandardizingPath];&#125;- (NSString *)_stringValueForKey:(NSString *)key&#123; id s = [self _valueForKey:key]; return [s isKindOfClass:[NSString class]] ? (NSString *)s : nil;&#125;- (id)_valueForKey:(NSString *)key&#123; NSString *_key = KEY(key);#if PLATFORM(IOS) __block id o = nil; dispatch_sync(_private-&gt;readWriteQueue, ^&#123; o = [_private-&gt;values.get() objectForKey:_key]; &#125;);#else id o = [_private-&gt;values.get() objectForKey:_key];#endif if (o) return o; o = [[NSUserDefaults standardUserDefaults] objectForKey:_key]; if (!o &amp;&amp; key != _key) o = [[NSUserDefaults standardUserDefaults] objectForKey:key]; return o;&#125; Local Storageå­˜åœ¨çš„é—®é¢˜åœ¨æŸ¥è¯¢èµ„æ–™çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†å¾ˆå¤šLocal Storageçš„ç¼ºé™·ï¼Œæœ‰ä¸€ç¯‡å…³äºLocal Storageçš„è®ºæ–‡å¯ä»¥å‚è€ƒã€‚æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š ä¸è¦ç”¨Local Storageæ¥åšæŒä¹…åŒ–å­˜å‚¨ï¼Œåœ¨iOSä¸­ï¼Œå‡ºç°å­˜å‚¨ç©ºé—´ç´§å¼ æ—¶ï¼Œå®ƒä¼šè¢«ç³»ç»Ÿæ¸…ç†æ‰ï¼› ä¸è¦ç”¨Local Storageæ¥å­˜å¤§æ•°æ®ï¼Œå®ƒçš„è¯»å†™æ•ˆç‡å¾ˆä½ä¸‹ï¼Œå› ä¸ºå®ƒéœ€è¦åºåˆ—åŒ–/ååºåˆ—åŒ– å®ƒæœ‰5Mçš„å¤§å°é™åˆ¶ æ€»ç»“èµ·æ¥å°±ä¸€å¥è¯ï¼Œä¸è¦æ»¥ç”¨Local Storageã€‚æœ‰å¾ˆå¤šæ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚https://github.com/TheCocoaProject/cordova-plugin-nativestorage å‚è€ƒèµ„æ–™https://github.com/wootwoot1234/react-native-webkit-localstorage-reader/issues/4https://blog.csdn.net/shuimuniao/article/details/8027276https://stackoverflow.com/questions/26465409/restore-localstorage-data-from-old-cordova-app/49604587#49604587https://stackoverflow.com/questions/9067249/how-do-i-access-html5-local-storage-created-by-phonegap-on-ios/49604541#49604541https://issues.apache.org/jira/browse/CB-12509]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AFNetworkingä¸‹è½½æ–‡ä»¶æ—¶æ–‡ä»¶åé•¿åº¦çš„å‘]]></title>
    <url>%2F2018%2F03%2F29%2FAFNetworking%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E6%97%B6%E6%96%87%E4%BB%B6%E5%90%8D%E9%95%BF%E5%BA%A6%E7%9A%84%E5%9D%91%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯æœ€è¿‘é‡åˆ°ä¸€ä¸ªBugï¼Œåœ¨ç”¨AFNetworkingä¸‹è½½æ–‡ä»¶çš„æ—¶å€™è«åå…¶å¦™çš„å¤±è´¥äº†ï¼Œè·Ÿäº†ä¸€ä¸‹å‘ç°ä¸€ä¸ªå°å‘ï¼Œè®°å½•ä¸€ä¸‹é˜²æ­¢ä»¥åå†æ‰è¿›å»ã€‚ iOSå’ŒLinuxçš„æ–‡ä»¶åçš„é•¿åº¦é™åˆ¶ç›¸åŒéƒ½æ˜¯255ä¸ªå­—ç¬¦ï¼ï¼ï¼ é—®é¢˜æ ¹æºæ˜¯æ–‡ä»¶åè¶…åº¦è¶…è¿‡äº†255ä¸ªå­—ç¬¦ï¼ŒAFNetworkingä¸‹è½½æ–‡ä»¶æ˜¯æˆåŠŸäº†ï¼ˆæ¡†æ¶ä¼šæŠŠæ–‡ä»¶ä¸‹è½½åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šCFNetworkDownload_xxx.tmpï¼Œè¿™ä¸ªæ–‡ä»¶åä¸ä¼šå‡ºç°è¿‡é•¿çš„é—®é¢˜ï¼‰ï¼Œä¸‹è½½æˆåŠŸä¹‹åä¼šcopyåˆ°è°ƒç”¨è€…æŒ‡å®šè·¯å¾„ï¼Œåœ¨è¿™é‡ŒæŒ‡å®šçš„æ–‡ä»¶åè¶…è¿‡äº†255ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´åˆ›å»ºæ–‡ä»¶å¤±è´¥ï¼Œäºæ˜¯å›è°ƒæ˜¯æˆåŠŸäº†ï¼Œä½†æ˜¯åœ¨è®¾ç½®çš„è·¯å¾„æ‰¾ä¸åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚ ä¸Šä»£ç ï¼ ä¸‹è½½ä»£ç ï¼š 12345678910// æ³¨æ„å¯¹æ–‡ä»¶åé•¿åº¦è¿›è¡Œå¤„ç†ï¼ï¼ï¼NSString *destination = @&quot;ä¸‹è½½åœ°å€ï¼ˆé•¿åº¦å¤§äº255ï¼‰&quot;;NSURLSessionDownloadTask *aTask = [self.updownloadSessionManager downloadTaskWithRequest:mutableRequest progress:^(NSProgress * _Nonnull downloadProgress) &#123; &#125; destination:^NSURL * _Nonnull(NSURL * _Nonnull targetPath, NSURLResponse * _Nonnull response) &#123; return [NSURL fileURLWithPath:destination]; &#125; completionHandler:^(NSURLResponse * _Nonnull response, NSURL * _Nullable filePath, NSError * _Nullable error) &#123; // ä¸‹è½½æˆåŠŸåä¼šå›è°ƒè¯¥blockï¼Œä½†æ˜¯è·¯å¾„`destination`æ‰¾ä¸åˆ°è¿™ä¸ªæ–‡ä»¶ &#125;]; [aTask resume]; å‡ºé”™çš„åœ°æ–¹AFURLSessionManager.m 123456789101112131415161718192021- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTaskdidFinishDownloadingToURL:(NSURL *)location&#123; self.downloadFileURL = nil; if (self.downloadTaskDidFinishDownloading) &#123; self.downloadFileURL = self.downloadTaskDidFinishDownloading(session, downloadTask, location); if (self.downloadFileURL) &#123; NSError *fileManagerError = nil; // locationæ˜¯ä¸´æ—¶æ–‡ä»¶ï¼Œæ˜¯ä¸‹è½½æˆåŠŸäº† // self.downloadFileURL æ˜¯ç›®æ ‡è·¯å¾„ï¼Œæ–‡ä»¶åè¶…è¿‡255 // ç§»åŠ¨æ–‡ä»¶ä¼šæŠ¥é”™ if (![[NSFileManager defaultManager] moveItemAtURL:location toURL:self.downloadFileURL error:&amp;fileManagerError]) &#123; // å‡ºé”™ä¼šå‘é€šçŸ¥ï¼Œå¯ä»¥ç›‘å¬å¤„ç† [[NSNotificationCenter defaultCenter] postNotificationName:AFURLSessionDownloadTaskDidFailToMoveFileNotification object:downloadTask userInfo:fileManagerError.userInfo]; &#125; &#125; &#125;&#125; æˆ‘ä»¬æ¥çœ‹çœ‹AFURLSessionDownloadTaskDidFailToMoveFileNotificationçš„å®šä¹‰AFURLSessionManager.h 1234/** Posted when a session download task encountered an error when moving the temporary download file to a specified destination. */FOUNDATION_EXPORT NSString * const AFURLSessionDownloadTaskDidFailToMoveFileNotification;]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSç”¨CallKitå®ç°æ¥ç”µè¯†åˆ«]]></title>
    <url>%2F2018%2F03%2F03%2FiOS%E7%94%A8CallKit%E5%AE%9E%E7%8E%B0%E6%9D%A5%E7%94%B5%E8%AF%86%E5%88%AB%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ€è¿‘éœ€è¦å®ç°ä¸€ä¸ªæ–°éœ€æ±‚ï¼Œç”¨iOS 10å‡ºçš„CallKitå®ç°å°†APPçš„é€šè®¯å½•çš„ä¿¡æ¯åŒæ­¥åˆ°ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä¸æŠŠäººå‘˜ä¿¡æ¯åŠ åˆ°é€šè®¯å½•ä¸­ï¼Œå®ç°æ¥ç”µå·ç è¯†åˆ«ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨xxå®‰å…¨å«å£«ã€xxç®¡å®¶ä¸­å¾ˆæ—©å°±å®ç°äº†ï¼Œä½†æ˜¯ç½‘ä¸Šç›¸å…³çš„èµ„æ–™è¾ƒå°‘ï¼Œè€Œä¸”å®˜æ–¹çš„æ–‡æ¡£å†™çš„å¤ªç®€å•äº†ï¼Œå¾ˆå¤šå‘è¿˜è¦è‡ªå·±å»æ‘¸ç´¢ã€‚äºæ˜¯è®°å½•ä¸€ä¸‹å’Œå„ä½åˆ†äº«ï¼Œå¦‚æœ‰é”™è¯¯ä¹‹å¤„è¯·å„ä½æŒ‡å‡ºï¼ PS: å…ˆè¯´ä¸ªé¢˜å¤–è¯å§ï¼ŒCallKitåŠŸèƒ½åœ¨iOS 10çš„æ—¶å€™è¿˜ä¸å¤ªç¨³å®šï¼ŒiOS 10åˆšå‡ºæ¥çš„æ—¶å€™ä¸ºäº†ä½“éªŒéªšæ‰°æ‹¦æˆªåŠŸèƒ½ï¼Œæ‰‹è´±è£…äº†ä¸¤ä¸ªä¸åŒçš„æ‹¦æˆªAPPï¼Œç„¶åå°±æ‚²å‰§äº†ã€‚ç›—ä¸€å¼ ç½‘ä¸Šçš„å›¾ï¼š ç„¶åå„ç§é‡å¯ã€é‡è£…APPéƒ½æ²¡æœ‰ç”¨ï¼Œå†™çš„Demoä¹Ÿè·‘ä¸èµ·æ¥ï¼Œå”¯ä¸€çš„åŠæ³•åªæœ‰é‡ç½®ç³»ç»Ÿã€‚è¯´å¤šäº†éƒ½æ˜¯æ³ªï¼ æœ¬æ–‡æ¶‰åŠçš„Demoã€‚ ä¸€ã€Call Directory app extensionå®ç°æ¥ç”µè¯†åˆ«ã€æ¥ç”µæ‹¦æˆªåŠŸèƒ½éœ€è¦ä½¿ç”¨CallKitå½“ä¸­çš„Call Directory app extensionï¼Œé¦–å…ˆï¼Œéœ€è¦äº†è§£extensionã€‚å…³äºextensionç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ã€‚æ¨èä¸¤ç¯‡æ–‡ç« ï¼Œè‹±æ–‡å¥½çš„æ¨èçœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜æœ‰ä¸€ç¯‡ä¸­æ–‡åšå®¢ã€‚ ä½¿ç”¨Call Directory Extensionä¸»è¦éœ€è¦å’Œ3ä¸ªç±»æ‰“äº¤é“ï¼Œåˆ†åˆ«æ˜¯CXCallDirectoryProviderã€CXCallDirectoryExtensionContextã€CXCallDirectoryManagerã€‚ CXCallDirectoryProvider å®˜æ–¹æ–‡æ¡£ï¼šThe principal object for a Call Directory app extension for a host app. æ­£å¦‚å®˜æ–¹æ–‡æ¡£æ‰€è¯´ï¼Œè¿™æ˜¯Call Directory app extensionæœ€é‡è¦çš„ä¸€ä¸ªç±»ã€‚ç”¨ç³»ç»Ÿæ¨¡æ¿æ–°å»ºCall Directory Extensionä¹‹åä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ªCXCallDirectoryProviderã€‚å…¥å£æ–¹æ³•ï¼š123456789// æœ‰ä¸¤ç§æƒ…å†µæ”¹æ–¹æ³•ä¼šè¢«è°ƒç”¨// 1.ç¬¬ä¸€æ¬¡æ‰“å¼€è®¾ç½®-ç”µè¯-æ¥ç”µé˜»æ­¢ä¸èº«ä»½è¯†åˆ«å¼€å…³æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨// 2.è°ƒç”¨CXCallDirectoryManagerçš„reloadExtensionWithIdentifieræ–¹æ³•ä¼šè°ƒç”¨- (void)beginRequestWithExtensionContext:(CXCallDirectoryExtensionContext *)context &#123; context.delegate = self; // æ·»åŠ å·ç è¯†åˆ«ä¿¡æ¯ä¸å·ç æ‹¦æˆªåˆ—è¡¨ [self addIdentificationPhoneNumbersToContext:context]; [context completeRequestWithCompletionHandler:nil];&#125; CXCallDirectoryExtensionContext å®˜æ–¹æ–‡æ¡£ï¼šA programmatic interface for adding identification and blocking entries to a Call Directory app extension.CXCallDirectoryExtensionContext objects are not initialized directly, but are instead passed as arguments to the CXCallDirectoryProvider instance method beginRequestWithExtensionContext:. å¤§è‡´æ„æ€å°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ºCall Directory app extensionæ·»åŠ å·ç è¯†åˆ«ã€å·ç æ‹¦æˆªçš„å…¥å£ã€‚CXCallDirectoryExtensionContextä¸éœ€è¦è‡ªå·±åˆå§‹åŒ–ï¼Œå®ƒä¼šä½œä¸ºCXCallDirectoryProviderçš„beginRequestWithExtensionContextå‡½æ•°çš„å‚æ•°ä¼ é€’ç»™ä½¿ç”¨è€…ã€‚å®ƒçš„ä¸»è¦æ–¹æ³•æœ‰ä¸¤ä¸ªï¼š 12345// è®¾ç½®å·ç è¯†åˆ«ä¿¡æ¯- (void)addIdentificationEntryWithNextSequentialPhoneNumber:(CXCallDirectoryPhoneNumber)phoneNumber label:(NSString *)label;// è®¾ç½®å·ç æ‹¦æˆªåˆ—è¡¨- (void)addBlockingEntryWithNextSequentialPhoneNumber:(CXCallDirectoryPhoneNumber)phoneNumber; åœ¨è®¾ç½®æ—¶å€™è¦æ³¨æ„ï¼š å·ç ä¸èƒ½é‡å¤ï¼Œä¸ç„¶ä¼šæŠ¥é”™CXErrorCodeCallDirectoryManagerErrorDuplicateEntries å·ç å¿…é¡»æŒ‰ç…§å‡åºå†™å…¥ï¼Œä¸ç„¶ä¼šæŠ¥é”™CXErrorCodeCallDirectoryManagerErrorEntriesOutOfOrder å·ç å¿…é¡»æ ¼å¼åŒ–åä¼ å…¥ï¼Œæ‰‹æœºå·ç å¿…é¡»åŠ ä¸Šå›½å®¶ç ï¼Œä¾‹å¦‚18012341234å°±ä¸è¡Œï¼Œéœ€è¦åŠ ä¸Š86ï¼Œæ„é€ æˆ8618012341234ï¼›å›ºè¯éœ€è¦æ ¼å¼ä¸ºï¼šå›½å®¶ç +åŒºå·ï¼ˆå»æ‰ç¬¬ä¸€ä¸ª0ï¼‰+å·ç ï¼Œä¾‹å¦‚010-61001234æ ¼å¼åŒ–ä¹‹åä¸ºï¼Œ861061001234ã€‚å¦‚æœå·ç æ ¼å¼é”™è¯¯ï¼Œä¼šå¯¼è‡´è¯†åˆ«ä¸å‡ºæ¥ã€‚ ä¸Šé™æ•°æ®æ˜¯200ä¸‡ï¼ˆåœ¨å…¶å®ƒæ–‡ç« é‡Œçœ‹åˆ°çš„ï¼Œç„¶åè‡ªå·±æµ‹è¯•äº†ä¸‹ï¼Œæ„é€ äº†200ä¸‡æ¡æ•°æ®å†™å…¥çš„æ—¶å€™ä¼šæŠ¥é”™CXErrorCodeCallDirectoryManagerErrorMaximumEntriesExceededï¼Œ150ä¸‡æ¡æ•°æ®æ˜¯OKçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ•°æ®ä¸Šé™ä¸€å®šè¦æ³¨æ„ã€‚å®æµ‹å®‰è£…äº†XXå®‰å…¨å«å£«ã€XXç®¡å®¶å®ç°éªšæ‰°ç”µè¯æ‹¦æˆªç”¨äº†3ä¸ªextensionï¼Œå¯èƒ½æ•°æ®é‡å¤ªå¤§å°±æ˜¯ä¸€ä¸ªåŸå› ã€‚ï¼‰ åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡æ‰“å¼€è®¾ç½®æ—¶ï¼Œä¼šè°ƒç”¨beginRequestWithExtensionContextï¼Œè¿™æ—¶å€™ä¸å®œå†™å¤ªå¤šæ•°æ®ï¼Œä¸ç„¶ä¼šå¡åœ¨è®¾ç½®é‚£é‡Œè½¬åœˆï¼Œç”¨æˆ·ä½“éªŒå¾ˆå·®ã€‚å¯ä»¥å…ˆå†™éƒ¨åˆ†æ•°æ®ï¼Œç„¶åå›åˆ°ä¸»APPäº†è°ƒç”¨reloadExtensionWithIdentifierå»åˆ·æ–°ã€‚ CXCallDirectoryManager å®˜æ–¹æ–‡æ¡£ï¼šThe programmatic interface to an object that manages a Call Directory app extension. CXCallDirectoryManagerä¸»è¦ä½œç”¨æ˜¯ç®¡ç†Call Directory app extensionã€‚æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š 123456// é‡æ–°è®¾ç½®å·ç è¯†åˆ«ã€ç”µè¯æ‹¦æˆªåˆ—è¡¨// è°ƒç”¨è¯¥æ–¹æ³•åä¼šé‡ç½®ä¹‹å‰è®¾ç½®çš„åˆ—è¡¨ï¼Œç„¶åè°ƒç”¨beginRequestWithExtensionContext:- (void)reloadExtensionWithIdentifier:(NSString *)identifier completionHandler:(nullable void (^)(NSError *_Nullable error))completion;// è·å–extensionæ˜¯å¦å¯ç”¨ï¼Œéœ€è¦åœ¨â€œè®¾ç½®-ç”µè¯-æ¥ç”µé˜»æ­¢ä¸èº«ä»½è¯†åˆ«"ä¸­å¼€å¯æƒé™- (void)getEnabledStatusForExtensionWithIdentifier:(NSString *)identifier completionHandler:(void (^)(CXCallDirectoryEnabledStatus enabledStatus, NSError *_Nullable error))completion; äºŒã€å®æˆ˜ å…ˆä¸ŠDemoåœ°å€ã€‚ä¸‹é¢ä¼šä¸€æ­¥æ­¥è®²è§£ã€‚ åˆ›å»ºextensionæ–°å»ºä¸€ä¸ªTargetï¼ˆFile-New-Targetï¼‰ã€‚ ä¼šè‡ªåŠ¨å»ºç«‹ä¸€ä¸ªç›®å½•ï¼Œé»˜è®¤æœ‰ä¸‰ä¸ªæ–‡ä»¶ã€‚åœ¨.mæ–‡ä»¶ä¸­æœ‰ç³»ç»Ÿç»™å‡ºçš„ç¤ºä¾‹ä»£ç  æˆ‘ä»¬æ¥çœ‹çœ‹ç³»ç»Ÿçš„æ¨¡æ¿ä»£ç ï¼Œé¦–å…ˆæ˜¯å…¥å£å‡½æ•° 1234567891011121314- (void)beginRequestWithExtensionContext:(CXCallDirectoryExtensionContext *)context &#123; context.delegate = self; if (context.isIncremental) &#123; [self addOrRemoveIncrementalBlockingPhoneNumbersToContext:context]; [self addOrRemoveIncrementalIdentificationPhoneNumbersToContext:context]; &#125; else &#123; [self addAllBlockingPhoneNumbersToContext:context]; [self addAllIdentificationPhoneNumbersToContext:context]; &#125; [context completeRequestWithCompletionHandler:nil];&#125; CallDirectoryHandleræˆ‘åœ¨Xcode 9ç”Ÿæˆçš„ä»£ç ï¼Œcontext.isIncrementalæ˜¯iOS 11æ‰å¢åŠ çš„ï¼Œè¿˜æœ‰æ‰€æœ‰çš„removeçš„æ–¹æ³•ä¹Ÿæ˜¯iOS 11æ‰æœ‰çš„ï¼Œä¸ºäº†é€‚é…iOS 10ï¼Œè¿˜æ˜¯ä¸æ¨èä½¿ç”¨ã€‚ç³»ç»Ÿæ¨¡æ¿ä»£ç å¤§è‡´é€»è¾‘å°±æ˜¯ï¼Œå…ˆæ·»åŠ å·ç è¯†åˆ«ã€å·ç æ‹¦æˆªè®°å½•ï¼Œæ·»åŠ å®Œæˆåè°ƒç”¨completeRequestWithCompletionHandler:å®Œæˆæ•´ä¸ªè¿‡ç¨‹ã€‚ç”±äºå·ç æ‹¦æˆªæ¯”è¾ƒç®€å•ï¼Œåªæ˜¯å†™å…¥ä¸€ä¸ªå·ç çš„æ•°ç»„ï¼Œæœ¬æ–‡å°±ä»¥å·ç è¯†åˆ«ä¸ºä¾‹ï¼Œå·ç è¯†åˆ«æ–¹æ³•ç³»ç»Ÿæ¨¡æ¿è¿™ä¹ˆå†™çš„ï¼š12345678910- (void)addAllIdentificationPhoneNumbersToContext:(CXCallDirectoryExtensionContext *)context &#123; CXCallDirectoryPhoneNumber allPhoneNumbers[] = &#123; 8618788888888, 8618885555555 &#125;; NSArray&lt;NSString *&gt; *labels = @[ @"é€é¤ç”µè¯", @"è¯ˆéª—ç”µè¯" ]; NSUInteger count = (sizeof(allPhoneNumbers) / sizeof(CXCallDirectoryPhoneNumber)); for (NSUInteger i = 0; i &lt; count; i += 1) &#123; CXCallDirectoryPhoneNumber phoneNumber = allPhoneNumbers[i]; NSString *label = labels[i]; [context addIdentificationEntryWithNextSequentialPhoneNumber:phoneNumber label:label]; &#125;&#125; è¿™ä¹ˆå¤šä»£ç ï¼Œæ ¸å¿ƒå°±æ˜¯ä¸€è¡Œ[context addIdentificationEntryWithNextSequentialPhoneNumber:phoneNumber label:label];,æ³¨æ„phoneNumberæ˜¯CXCallDirectoryPhoneNumberç±»å‹ï¼Œå…¶å®å°±æ˜¯long longç±»å‹ã€‚åœ¨è¿™ä¸ªå‡½æ•°é‡Œï¼Œéœ€è¦æŠŠéœ€è¦è¯†åˆ«çš„å·ç å’Œè¯†åˆ«ä¿¡æ¯ï¼Œä¸€æ¡ä¸€æ¡çš„å†™å…¥ æ£€æŸ¥æˆæƒå¼€å¯extensionåŠŸèƒ½éœ€è¦åœ¨â€œè®¾ç½®-ç”µè¯-æ¥ç”µé˜»æ­¢ä¸èº«ä»½è¯†åˆ«â€ä¸­å¼€å¯ï¼Œæˆ‘ä»¬åœ¨å†™å…¥æ•°æ®æ—¶ç¬¬ä¸€æ­¥æ˜¯å¼•å¯¼ç”¨æˆ·ç»™æˆ‘ä»¬çš„extensionæˆæƒã€‚123456789 CXCallDirectoryManager *manager = [CXCallDirectoryManager sharedInstance]; [manage getEnabledStatusForExtensionWithIdentifier:self.externsionIdentifier completionHandler:^(CXCallDirectoryEnabledStatus enabledStatus, NSError * _Nullable error) &#123; // æ ¹æ®errorï¼ŒenabledStatusåˆ¤æ–­æˆæƒæƒ…å†µ// error == nil &amp;&amp; enabledStatus == CXCallDirectoryEnabledStatusEnabled è¯´æ˜å¯ç”¨// error è§ CXErrorCodeCallDirectoryManagerError// enabledStatus è§ CXCallDirectoryEnabledStatus &#125;]; å†™å…¥æ•°æ®ç”¨æˆ·åœ¨è®¾ç½®å¼€å¯åï¼Œè°ƒç”¨reloadExtensionWithIdentifierå³å¯è§¦å‘CallDirectoryHandleræ›´æ–°æ•°æ®é€»è¾‘ã€‚ 1234CXCallDirectoryManager *manager = [CXCallDirectoryManager sharedInstance];[manager reloadExtensionWithIdentifier:self.externsionIdentifier completionHandler:^(NSError * _Nullable error) &#123; // error è§ CXErrorCodeCallDirectoryManagerError&#125;]; éªŒè¯æ¥ä¸‹æ¥åœ¨çœŸæœºä¸‹è·‘ä¸‹ï¼ˆä¸€å®šè¦åœ¨æ’äº†ç”µè¯å¡çš„iPhoneä¸Šè°ƒè¯•ï¼Œæ¨¡æ‹Ÿå™¨ä¸è¡Œï¼ï¼‰ï¼Œå†™å…¥æˆåŠŸåï¼Œæ‰“å¼€ç”µè¯ï¼Œæ‹¨å·18788888888ï¼Œæç¤ºâ€é€é¤ç”µè¯â€ã€‚è¯´æ˜å†™å…¥æˆåŠŸï¼ ä¸‰ã€extensionå’Œcontaining appæ•°æ®å…±äº«ä¸Šé¢çš„æ­¥éª¤ä¸­ï¼Œå·ç ä¿¡æ¯æ˜¯å†™æ­»åœ¨ä»£ç ä¸­çš„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­è¿™äº›å·ç ä¿¡æ¯è‚¯å®šä¸æ˜¯å†™æ­»çš„ï¼Œä¸€èˆ¬éœ€è¦ä»æœåŠ¡å™¨è·å–ã€‚è¿™å°±éœ€è¦æˆ‘ä»¬çš„APPä¸extensionè¿›è¡Œé€šä¿¡ï¼Œéœ€è¦ç”¨åˆ°APP Groupsï¼Œæ€ä¹ˆç”¨ç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« äº†ï¼Œæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œæ¨èä¸€ç¯‡ã€‚å…¶å®æœ¬è´¨å°±æ˜¯é€šè¿‡APP Groupsï¼Œå¼€è¾Ÿä¸€ç‰‡ç©ºé—´ï¼Œextensionå’Œcontaining appéƒ½å¯ä»¥è®¿é—®ï¼Œç„¶åæˆ‘ä»¬çš„APPå°±å¯ä»¥é€šè¿‡NSUserDefaultsã€æ–‡ä»¶ã€æ•°æ®åº“ç­‰æ–¹å¼å…±äº«æ•°æ®ç»™extensionäº†ã€‚å‰æœŸæˆ‘ä½¿ç”¨è¿‡NSUserDefaultsï¼Œæ•ˆç‡å¾ˆä½ï¼Œå¤§æ¦‚åœ¨5ä¸‡æ•°æ®çš„æ—¶å€™å°±çˆ†å†…å­˜äº†ï¼Œä½¿ç”¨extensionä¸€å®šè¦æ³¨æ„å†…å­˜ï¼Œä¸ç„¶å¾ˆå®¹æ˜“è¢«ç³»ç»Ÿå¹²æ‰ï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ã€‚Demoä¸­é‡‡ç”¨çš„æ˜¯è¯»å†™æ–‡ä»¶çš„æ–¹å¼ï¼Œå¤§è‡´æ€è·¯ï¼ˆå…·ä½“å®ç°çœ‹Demoï¼‰ï¼š åœ¨APPä¸­æŠŠæ•°æ®åºåˆ—åŒ–ä¹‹åå†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ åœ¨extensionä¸­è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œè¯»å–ä¸€è¡Œï¼Œè°ƒç”¨ä¸€æ¬¡addIdentificationEntryWithNextSequentialPhoneNumberï¼Œç„¶ååŠæ—¶é‡Šæ”¾è¿™ç§æ–¹å¼ç†è®ºä¸Šæ˜¯å¯ä»¥è¾¾åˆ°æœ€å¤§é™åˆ¶200wæ¡çš„ï¼ˆå®é™…æµ‹è¯•150ä¸‡æ²¡æœ‰é—®é¢˜ï¼‰ã€‚ è·å–APP Groupsæ–‡ä»¶è·¯å¾„1234NSFileManager *fileManager = [NSFileManager defaultManager]; NSURL *containerURL = [[NSFileManager defaultManager] containerURLForSecurityApplicationGroupIdentifier:self.groupIdentifier]; containerURL = [containerURL URLByAppendingPathComponent:@"CallDirectoryData"]; NSString* filePath = containerURL.path; è¿›åº¦ç›‘æ§åœ¨xxå®‰å…¨å«å£«ä¸­ï¼Œå¼€å¯éªšæ‰°ç”µè¯æ‹¦æˆªåŠŸèƒ½æœ‰ä¸€ä¸ªè¿›åº¦æ¡ï¼Œéå¸¸çš„ç›´è§‚ã€‚ä½†æ˜¯åœ¨extensionä¸­æ˜¯æ²¡æ³•æ›´æ–°UIçš„ï¼Œæœ‰ä¸€ç§å®ç°æ–¹å¼ï¼Œå¯ä»¥ç”¨å¼€æºæ¡†æ¶MMWormholeæ¥å®ç°APPä¸extensioné€šä¿¡ï¼Œç„¶åæŠŠè¿›åº¦ä»extensionä¼ åˆ°APPä¸­ï¼Œåœ¨APPä¸­æ›´æ–°è¿›åº¦æ¡ã€‚ç†è®ºä¸Šè¯¥æ–¹æ¡ˆæ˜¯å¯è¡Œçš„ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å°è¯•ä¸‹ã€‚ å…³äºä¸Šæ¶åœ¨åŠ ä¸ŠCallKitç¬¬ä¸€æ¬¡ä¸Šæ¶æ—¶ï¼Œæ”¶åˆ°äº†è‹¹æœçš„æ‹’ä¿¡ï¼Œè¯´CallKitåœ¨ä¸­å›½åŒºè¢«ç¦æ­¢äº†ã€‚ åæ¥è§‚å¯Ÿäº†ä¸‹xxå®‰å…¨å«å£«ä¸€ç›´åœ¨æ­£å¸¸æ›´æ–°ï¼ŒçŒœæƒ³è‹¹æœåªæ˜¯ç¦æ­¢äº†CallKitå…³äºVOIPè¿™éƒ¨åˆ†åŠŸèƒ½ã€‚é‡åˆ°è‹¹æœçš„æ‹’ä¿¡ä¸è¦æ…Œï¼Œå½•åˆ¶ä¸€ä¸ªæ¥ç”µè¯†åˆ«çš„åŠŸèƒ½æ¼”ç¤ºè§†é¢‘ï¼Œæ”¾åˆ°Youtubeï¼Œç„¶ååœ¨å¤‡æ³¨é‡Œé¢è§£é‡Šä¸€ä¸‹ï¼Œå°±å¯ä»¥é€šè¿‡å®¡æ ¸äº†ã€‚ ç»™ä¸€ä¸ªå®¡æ ¸å¤‡æ³¨æ¨¡æ¿ï¼š å…³äºCallKitï¼Œæˆ‘ä»¬éµå®ˆä¸­å›½çš„æ³•å¾‹ï¼Œæ²¡æœ‰ä½¿ç”¨VOIPï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨äº†Call Directoryã€‚æˆ‘ä»¬åº”ç”¨å†…æœ‰ä¸€ä¸ªå…¬å¸å†…éƒ¨é€šè®¯å½•ï¼Œä¸ºäº†å¢åŠ ç”¨æˆ·å‘˜å·¥æ²Ÿé€šæ•ˆç‡ï¼Œæˆ‘ä»¬åœ¨ç”µè¯é¡µé¢è‡ªåŠ¨è¯†åˆ«å†…éƒ¨é€šè®¯å½•çš„äººå‘˜ ï¼Œå¹¶å±•ç¤ºå§“åä¸å²—ä½ã€‚æˆ‘ä»¬å½•åˆ¶äº†ä¸€ä¸ªæ¼”ç¤ºè§†é¢‘ï¼šè§†é¢‘åœ°å€ å‚è€ƒé“¾æ¥https://developer.apple.com/documentation/callkithttps://developer.apple.com/videos/play/wwdc2016/230/https://colin1994.github.io/2016/06/17/Call-Directory-Extension-Study/https://yunissong.github.io/2017/03/29/CallKit/http://www.jianshu.com/p/7f88cbe7948chttps://www.raywenderlich.com/150015/callkit-tutorial-ios]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSçš„Cookieç®¡ç†]]></title>
    <url>%2F2018%2F03%2F01%2FiOS%E7%9A%84Cookie%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯æœ€è¿‘æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨çš„å»ç¼“å­˜cookieï¼Œç„¶åå¯åŠ¨APPçš„æ—¶å€™è®¾ç½®ç¼“å­˜è¿‡çš„cookieï¼Œé¡¹ç›®ç½‘ç»œæ¡†æ¶ç”¨çš„æ˜¯Afnetworkingã€‚ è§£å†³æ–¹æ¡ˆç¿»äº†ä¸‹Afnetworkingçš„issueï¼Œå‘ç°äº†ä½œè€…å¯¹äºcookieçš„è§£é‡Š Afnetworkingæ²¡æœ‰å¯¹Cookieåšè¿‡å¤„ç† ä½¿ç”¨NSHTTPCookieStorageå³å¯å®ç°cookieçš„ç®¡ç†ã€‚ä¸Šä»£ç ï¼ å­˜cookie 1234NSArray *cookies = [[NSHTTPCookieStorage sharedHTTPCookieStorage] cookiesForURL:[NSURL URLWithString:url]];NSData *data = [NSKeyedArchiver archivedDataWithRootObject:cookies];NSUserDefaults *userDefaults = [NSUserDefaults standardUserDefaults];[userDefaults setObject:data forKey:@&quot;cookie&quot;]; è®¾ç½®cookie 12345678NSData *cookiesdata = [[NSUserDefaults standardUserDefaults] objectForKey:@&quot;m3cookie&quot;]; if([cookiesdata length]) &#123; NSArray *cookies = [NSKeyedUnarchiver unarchiveObjectWithData:cookiesdata]; NSHTTPCookie *cookie; for (cookie in cookies) &#123; [[NSHTTPCookieStorage sharedHTTPCookieStorage] setCookie:cookie]; &#125; &#125; æ¸…ç†cookie 12345NSHTTPCookie *cookie;NSHTTPCookieStorage *storage = [NSHTTPCookieStorage sharedHTTPCookieStorage];for (cookie in [storage cookies]) &#123; [storage deleteCookie:cookie];&#125; å‚è€ƒæ–‡ç« ï¼š NSHTTPCookieStorageå®˜æ–¹æ–‡æ¡£Persisting Cookies In An iOS Application?Clear cookies for response in AFNetworking 2]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[imageNamedä¸imageWithContentsOfFileå°ç»“]]></title>
    <url>%2F2018%2F03%2F01%2FimageNamed%E4%B8%8EimageWithContentsOfFile%E5%B0%8F%E7%BB%93%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è¦è®²imageNamedä¸imageWithContentsOfFileçš„å·®å¼‚ï¼Œéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œä¸å®æˆ˜ä¸­é‡åˆ°çš„å‘ã€‚ å¥½ä¹…æ²¡å†™è¿‡åšå®¢äº†ï¼Œä»€ä¹ˆå·¥ä½œå¤ªå¿™ï¼ŒåŠ ç­å¤ªæ™šæˆ‘å°±ä¸è¯´äº†ï¼Œéƒ½æ€ªè‡ªå·±å¤ªæ‡’ğŸ˜‚ï¼Œæ—¶é—´éƒ½æ˜¯æŒ¤å‡ºæ¥çš„ã€‚çœ‹ç€å„ä½å¤§ç‰›å†™çš„æ–‡ç« ï¼Œç®€ç›´è¿‡ç˜¾ï¼Œå¸Œæœ›æœ‰ä¸€å¤©è‡ªå·±ä¹Ÿèƒ½å†™å‡ºè¿™ä¹ˆé«˜è´¨é‡ã€å¹²è´§å¯†é›†çš„æ–‡ç« ï¼Œå…ˆä»ç®€å•çš„åšèµ·å§ã€‚ ä»å·®å¼‚è¯´èµ·ä»ç£ç›˜åŠ è½½å›¾ç‰‡ï¼ŒUIImageä¸»è¦æä¾›äº†ä¸¤ç§æ–¹å¼ï¼š +(UIImage )imageNamed:(NSString )name;+(UIImage )imageWithContentsOfFile:(NSString )path; å…³äºè¿™ä¸¤ç§æ–¹æ³•çš„ä½¿ç”¨æ—¶æœºï¼Œè‹¹æœå®˜æ–¹æ–‡æ¡£æè¿°å¦‚ä¸‹ï¼š Use the imageNamed:inBundle:compatibleWithTraitCollection: method (or the imageNamed: method) to create an image from an image asset or image file located in your appâ€™s main bundle (or some other known bundle). Because these methods cache the image data automatically, they are especially recommended for images that you use frequently.Use the imageWithContentsOfFile: or initWithContentsOfFile: method to create an image object where the initial data is not in a bundle. These methods load the image data from disk each time, so you should not use them to load the same image repeatedly. ä¹Ÿå°±æ˜¯è¯´ï¼ŒimageNamed:ç¬¬ä¸€æ¬¡åŠ è½½å›¾ç‰‡æ—¶ä¼šç¼“å­˜å›¾ç‰‡åˆ°å†…å­˜ï¼Œé€‚åˆä½¿ç”¨é¢‘ç¹çš„å›¾ç‰‡ï¼ŒimageWithContentsOfFile:ä¸ä¼šæŠŠå›¾ç‰‡ç¼“å­˜åˆ°å†…å­˜ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½è¦é‡æ–°ä»ç£ç›˜åŠ è½½ä¸€æ¬¡ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­æˆ‘ä»¬è¦æ ¹æ®ä¸šåŠ¡æ¥åˆ¤æ–­è°ƒç”¨å…·ä½“çš„æ–¹æ³•ï¼Œæ¥æœ€ä¼˜åŒ–å†…å­˜ä¸æ€§èƒ½ã€‚ä¸¾ä¸ªä¾‹å­ï¼š ç™»é™†èƒŒæ™¯å›¾ï¼Œåªä¼šåœ¨ç”¨æˆ·ç™»é™†çš„æ—¶å€™ä½¿ç”¨ï¼Œè€Œä¸”å›¾ç‰‡è¾ƒå¤§ï¼Œå°±å»ºè®®ç”¨imageWithContentsOfFile:åŠ è½½ï¼› åº•å¯¼èˆªå›¾æ ‡ï¼Œå›¾æ ‡è¾ƒå°ï¼Œä½¿ç”¨é¢‘ç¹ï¼Œå°±å»ºè®®ä½¿ç”¨imageNamed:åŠ è½½ï¼› imageNamed:æ–¹æ³•è¿˜æœ‰ä¸ªé™åˆ¶ï¼Œå®ƒæ˜¯åœ¨main bundleé‡Œæ‰¾å›¾ç‰‡ï¼Œå¦‚æœå›¾ç‰‡æ”¾åœ¨Images.xcassetsæˆ–è€…ç›´æ¥æŠŠå›¾ç‰‡æ–¹åœ¨å·¥ç¨‹é‡Œï¼Œå‚æ•°ç›´æ¥ä¼ å›¾ç‰‡åå¯ä»¥æ‰¾åˆ°ã€‚åƒæˆ‘å¸çš„å›¾ç‰‡æ˜¯æ”¾åœ¨å•ç‹¬å»ºç«‹çš„bundleé‡Œï¼Œå¦‚æœè¦ç”¨imageNamed:åŠ è½½çš„è¯æ–‡ä»¶åå‰é¢å°±è¦åŠ ä¸Šbundleåï¼Œåƒè¿™æ ·a.bundle/b.pngã€‚ å±å¹•é€‚é…é—®é¢˜iOSçš„å›¾ç‰‡æ–‡ä»¶éœ€è¦æä¾›3ç§å°ºå¯¸çš„1xã€2xã€3xï¼Œæ ¹æ®ä¸åŒçš„å±å¹•å°ºå¯¸æˆ‘ä»¬éœ€è¦åŠ è½½ä¸åŒçš„å›¾ç‰‡ï¼Œå…³äºä¸åŒå±å¹•çš„å›¾ç‰‡åŠ è½½ï¼Œè‹¹æœå·²ç»å¸®æˆ‘ä»¬å°è£…å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å°†3ä¸­å°ºå¯¸çš„å›¾ç‰‡æ”¾åˆ°å·¥ç¨‹ä¸­ï¼Œç„¶åè°ƒç”¨imageNamed:æˆ–è€…imageWithContentsOfFile:ï¼Œå®ƒä¼šè‡ªåŠ¨æ ¹æ®å±å¹•å°ºå¯¸æ¥åŠ è½½ä¸åŒçš„å›¾ç‰‡ã€‚å…³äºimageNamed:ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¿™ä¹ˆä¸€æ®µè®¨è®ºï¼š This method looks in the system caches for an image object with the specified name and returns the variant of that image that is best suited for the main screen. imageWithContentsOfFile:è¿˜æ²¡æ‰¾åˆ°å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼ˆå¦‚æœå„ä½çŸ¥é“ï¼Œæ¬¢è¿å„ä½å¤§ç‰›åœ¨è¯„è®ºä¸­æå‡ºï¼‰ï¼Œä¸è¿‡æˆ‘æµ‹è¯•è¿‡æ˜¯å¯ä»¥çš„ã€‚ ä½¿ç”¨imageWithContentsOfFileçš„ä¸€ä¸ªå‘åœ¨ä½¿ç”¨imageWithContentsOfFile:åŠ è½½å›¾ç‰‡çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªå‘ï¼Œå…ˆä¸Šä»£ç ï¼š 1234567+ (UIImage *)imageWithName:(NSString *)name type:(NSString *)type inBundle:(NSString *)bundle &#123; NSString *imageBundlePath = [[NSBundle mainBundle] pathForResource:bundle ofType:@&quot;bundle&quot;]; NSBundle *imageBundle = [NSBundle bundleWithPath:imageBundlePath]; NSString *imagePath = [imageBundle pathForResource:name ofType:type]; UIImage *image = [UIImage imageWithContentsOfFile:imagePath]; return image;&#125; å¾ˆç®€å•çš„ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯è·å–bundleå…¨è·¯å¾„ï¼Œç„¶åå†è·å–åˆ°bundleé‡Œå›¾ç‰‡çš„å…¨è·¯å¾„ï¼Œç„¶åè°ƒç”¨imageWithContentsOfFile:åŠ è½½å›¾ç‰‡ã€‚åœ¨ä½¿ç”¨çš„æ—¶å€™ä¹Ÿå¾ˆæ­£å¸¸ï¼Œä½†æ˜¯æœ‰ä¸€å¤©å‘ç°æŸå¼ å›¾åŠ è½½ä¸å‡ºæ¥äº†ã€‚æ£€æŸ¥èµ„æºæ–‡ä»¶ï¼Œåªæœ‰2xçš„å›¾ï¼ˆåˆæ˜¯ä¸€ä¸ªå·æ‡’çš„ç¨‹åºå‘˜ã€‚ã€‚ã€‚å¾ˆä¸å»ºè®®è¿™ä¹ˆç©ï¼Œè™½ç„¶åªæœ‰2xçš„å›¾ï¼Œåœ¨æ‰€æœ‰å±å¹•éƒ½èƒ½æ˜¾ç¤ºï¼Œä½†æ˜¯ä¼šé€ æˆå›¾ç‰‡çš„å‹ç¼©ä¸æ”¾å¤§ï¼Œæ¯ä¸ªç»†èŠ‚éƒ½å¾ˆé‡è¦ï¼ï¼ï¼ï¼‰ï¼Œå¦‚æœåŠ ä¸Š1xçš„å›¾å°±å¯ä»¥åŠ è½½å‡ºæ¥äº†ã€‚ç»è¿‡è°ƒè¯•å‘ç°é—®é¢˜å°±å‡ºåœ¨pathForResource:ofTypeä¸Šï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ç²¾ç¡®åŒ¹é…è°ƒç”¨è€…è¾“å…¥çš„æ–‡ä»¶åï¼Œä¸ä¼šè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ååé¢çš„@2xã€‚ä¿®æ”¹åçš„ä»£ç ï¼š 12345678+ (UIImage *)imageWithName:(NSString *)name type:(NSString *)type inBundle:(NSString *)bundle &#123; NSString *imageBundlePath = [[NSBundle mainBundle] pathForResource:bundle ofType:@&quot;bundle&quot;]; NSBundle *imageBundle = [NSBundle bundleWithPath:imageBundlePath]; NSString *imageFullName = [name stringByAppendingPathExtension:type]; NSString *imagePath = [[imageBundle resourcePath] stringByAppendingPathComponent:imageFullName]; UIImage *image = [UIImage imageWithContentsOfFile:imagePath]; return image;&#125;]]></content>
      <tags>
        <tag>iOSçŸ¥è¯†å°ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­£åˆ™è¡¨è¾¾å¼ç¬”è®°]]></title>
    <url>%2F2016%2F11%2F20%2F%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%AC%94%E8%AE%B0%2F</url>
    <content type="text"><![CDATA[æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregular expressionï¼‰æè¿°äº†ä¸€ç§å­—ç¬¦ä¸²åŒ¹é…çš„æ¨¡å¼ï¼Œå¯ä»¥ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªä¸²æ˜¯å¦å«æœ‰æŸç§å­ä¸²ã€å°†åŒ¹é…çš„å­—ä¸²åšæ›¿æ¢æˆ–è€…ä»æŸä¸ªä¸²ä¸­å–å‡ºç¬¦åˆæŸä¸ªæ¡ä»¶çš„å­—ä¸²ç­‰ã€‚ æ­£åˆ™è¡¨è¾¾å¼åœ¨çº¿æµ‹è¯•ï¼šhttp://www.regexpal.com/ å…ƒå­—ç¬¦å¸¸ç”¨å…ƒå­—ç¬¦ï¼š ä»£ç  è¯´æ˜ . åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦ \w åŒ¹é…å­—æ¯æˆ–æ•°å­—æˆ–ä¸‹åˆ’çº¿æˆ–æ±‰å­— \d åŒ¹é…æ•°å­— \s åŒ¹é…ç©ºæ ¼ \b åŒ¹é…å•è¯çš„å¼€å§‹æˆ–ç»“æŸ ^ åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ï¼Œå¦‚æœæ˜¯å¤„ç†å¤šè¡Œï¼Œæ„ä¹‰å˜æˆè¡Œå¼€å§‹å¤„ $ åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸï¼Œå¦‚æœæ˜¯å¤„ç†å¤šè¡Œï¼Œæ„ä¹‰å˜æˆè¡Œç»“æŸå¤„ é™å®šç¬¦å¸¸ç”¨é™å®šç¬¦ï¼š ä»£ç  è¯´æ˜ * *å‰é¢çš„å†…å®¹é‡å¤ä»»æ„æ¬¡ + +å‰é¢çš„å†…å®¹é‡å¤ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ ? é‡å¤é›¶æ¬¡æˆ–ä¸€æ¬¡ {n} é‡å¤næ¬¡ {n, } é‡å¤æ¬¡æ•°å¤§äºç­‰äºn {n,m} é‡å¤æ¬¡æ•°å¤§äºç­‰äºnå°äºç­‰äºm å­—ç¬¦ç±»[auiou] åŒ¹é…ä»»ä½•ä¸€ä¸ªè‹±æ–‡å…ƒéŸ³å­—æ¯[.?!] åŒ¹é…æ ‡ç‚¹ç¬¦å·ï¼ˆ. ? !ï¼‰ åä¹‰ ä»£ç  è¯´æ˜ \W åŒ¹é…ä»»æ„ä¸æ˜¯å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€æ±‰å­—çš„å­—ç¬¦ \S åŒ¹é…ä»»æ„ä¸æ˜¯ç©ºç™½ç¬¦çš„å­—ç¬¦ \D åŒ¹é…ä»»æ„éæ•°å­—çš„å­—ç¬¦ \B åŒ¹é…ä¸æ˜¯å•è¯å¼€å¤´æˆ–ç»“æŸçš„ä½ç½® [^x] åŒ¹é…é™¤äº†xä»¥å¤–çš„ä»»æ„å­—ç¬¦ [^abcd] åŒ¹é…é™¤äº†abcdä»¥å¤–çš„ä»»æ„å­—ç¬¦ åˆ†ç»„ ä»£ç  è¯´æ˜ (exp) åŒ¹é…expï¼Œå¹¶æ•è·æ–‡æœ¬åˆ°è‡ªåŠ¨å‘½åç»„ä¸­ (?&lt;name&gt;exp) åŒ¹é…exp,å¹¶æ•è·æ–‡æœ¬åˆ°åç§°ä¸ºnameçš„ç»„é‡Œï¼Œä¹Ÿå¯ä»¥å†™æˆ(?`name`exp) (?:exp) åŒ¹é…expï¼Œä¸æ•è·åŒ¹é…çš„æ–‡æœ¬ï¼Œä¹Ÿä¸ç»™æ¬¡åˆ†ç»„åˆ†é…ç»„å· (?=exp) åŒ¹é…expå‰é¢çš„ä½ç½® (?&lt;=exp) åŒ¹é…expåé¢çš„ä½ç½® (?!exp) åŒ¹é…åé¢è·Ÿçš„ä¸æ˜¯expçš„ä½ç½® (?&lt;!exp) åŒ¹é…å‰é¢ä¸æ˜¯expçš„ä½ç½® (?#comment) æ³¨é‡Š è´ªå©ªä¸æ‡’æƒ°é€šå¸¸é‡å¤é™å®šç¬¦çš„è¡Œä¸ºæ˜¯åŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ï¼Œåœ¨é™å®šç¬¦åé¢åŠ ?ä½¿ä¹‹æˆä¸ºæƒ°æ€§é™å®šç¬¦ï¼Œä¾‹å¦‚*?çš„å«ä¹‰ä¸ºé‡å¤ä»»æ„æ¬¡æ•°ï¼Œä½†æ˜¯å°½å¯èƒ½å°‘]]></content>
      <tags>
        <tag>å…¶å®ƒ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Golangç¼–ç è§„èŒƒ]]></title>
    <url>%2F2016%2F11%2F20%2FGolang%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%2F</url>
    <content type="text"><![CDATA[gofmt å¤§éƒ¨åˆ†çš„æ ¼å¼é—®é¢˜å¯ä»¥é€šè¿‡gofmtè§£å†³ï¼Œgofmtè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œä¿è¯æ‰€æœ‰çš„goä»£ç ä¸å®˜æ–¹æ¨èçš„æ ¼å¼ä¿æŒä¸€è‡´ï¼Œäºæ˜¯æ‰€æœ‰æ ¼å¼æœ‰å…³é—®é¢˜ï¼Œéƒ½ä»¥gofmtçš„ç»“æœä¸ºå‡†ã€‚ è¡Œé•¿ ä¸€è¡Œæœ€é•¿ä¸è¶…è¿‡80ä¸ªå­—ç¬¦ï¼Œè¶…è¿‡çš„ä½¿ç”¨æ¢è¡Œå±•ç¤ºï¼Œå°½é‡ä¿æŒæ ¼å¼ä¼˜é›…ã€‚ æ³¨é‡Š åœ¨ç¼–ç é˜¶æ®µåº”è¯¥åŒæ­¥å†™å¥½å˜é‡ã€å‡½æ•°ã€åŒ…çš„æ³¨é‡Šï¼Œæœ€åå¯ä»¥åˆ©ç”¨godocå¯¼å‡ºæ–‡æ¡£ã€‚æ³¨é‡Šå¿…é¡»æ˜¯å®Œæ•´çš„å¥å­ï¼Œå¥å­çš„ç»“å°¾åº”è¯¥ç”¨å¥å·ä½œä¸ºç»“å°¾ï¼ˆè‹±æ–‡å¥å·ï¼‰ã€‚æ³¨é‡Šæ¨èç”¨è‹±æ–‡ï¼Œå¯ä»¥åœ¨å†™ä»£ç è¿‡ç¨‹ä¸­é”»ç‚¼è‹±æ–‡çš„é˜…è¯»å’Œä¹¦å†™èƒ½åŠ›ã€‚è€Œä¸”ç”¨è‹±æ–‡ä¸ä¼šå‡ºç°å„ç§ç¼–ç çš„é—®é¢˜ã€‚æ¯ä¸ªåŒ…éƒ½åº”è¯¥æœ‰ä¸€ä¸ªåŒ…æ³¨é‡Šï¼Œä¸€ä¸ªä½äºpackageå­å¥ä¹‹å‰çš„å—æ³¨é‡Šæˆ–è¡Œæ³¨é‡Šã€‚åŒ…å¦‚æœæœ‰å¤šä¸ªgoæ–‡ä»¶ï¼Œåªéœ€è¦å‡ºç°åœ¨ä¸€ä¸ªgoæ–‡ä»¶ä¸­å³å¯ã€‚ 12// pingåŒ…å®ç°äº†å¸¸ç”¨çš„pingç›¸å…³çš„å‡½æ•°package ping å¯¼å‡ºå‡½æ•°æ³¨é‡Šï¼Œç¬¬ä¸€æ¡è¯­å¥åº”è¯¥ä¸ºä¸€æ¡æ¦‚æ‹¬è¯­å¥ï¼Œå¹¶ä¸”ä½¿ç”¨è¢«å£°æ˜çš„åå­—ä½œä¸ºå¼€å¤´ã€‚ 12// æ±‚aå’Œbçš„å’Œï¼Œè¿”å›sumã€‚func Myfunction(sum int) (a, b int) &#123; å‘½å éœ€è¦æ³¨é‡Šæ¥è¡¥å……çš„å‘½åå°±ä¸ç®—æ˜¯å¥½å‘½åã€‚ ä½¿ç”¨å¯æœç´¢çš„åç§°ï¼šå•å­—æ¯åç§°å’Œæ•°å­—å¸¸é‡å¾ˆéš¾ä»ä¸€å¤§å †æ–‡å­—ä¸­æœç´¢å‡ºæ¥ã€‚å•å­—æ¯åç§°ä»…é€‚ç”¨äºçŸ­æ–¹æ³•ä¸­çš„æœ¬åœ°å˜é‡ï¼Œåç§°é•¿çŸ­åº”ä¸å…¶ä½œç”¨åŸŸç›¸å¯¹åº”ã€‚è‹¥å˜é‡æˆ–å¸¸é‡å¯èƒ½åœ¨ä»£ç ä¸­å¤šå¤„ä½¿ç”¨ï¼Œåˆ™åº”èµ‹å…¶ä»¥ä¾¿äºæœç´¢çš„åç§°ã€‚ åšæœ‰æ„ä¹‰çš„åŒºåˆ†ï¼šProductå’ŒProductInfoå’ŒProductDataæ²¡æœ‰åŒºåˆ«ï¼ŒNameStringå’ŒNameæ²¡æœ‰åŒºåˆ«ï¼Œè¦åŒºåˆ†åç§°ï¼Œå°±è¦ä»¥è¯»è€…èƒ½é‰´åˆ«ä¸åŒä¹‹å¤„çš„æ–¹å¼æ¥åŒºåˆ† ã€‚ å‡½æ•°å‘½åè§„åˆ™ï¼šé©¼å³°å¼å‘½åï¼Œåå­—å¯ä»¥é•¿ä½†æ˜¯å¾—æŠŠåŠŸèƒ½ï¼Œå¿…è¦çš„å‚æ•°æè¿°æ¸…æ¥šï¼Œå‡½æ•°åååº”å½“æ˜¯åŠ¨è¯æˆ–åŠ¨è¯çŸ­è¯­ï¼Œå¦‚postPaymentã€deletePageã€saveã€‚å¹¶ä¾Javabeanæ ‡å‡†åŠ ä¸Šgetã€setã€iså‰ç¼€ã€‚ä¾‹å¦‚ï¼šxxx + With + éœ€è¦çš„å‚æ•°å + And + éœ€è¦çš„å‚æ•°å + â€¦.. ç»“æ„ä½“å‘½åè§„åˆ™ï¼šç»“æ„ä½“ååº”è¯¥æ˜¯åè¯æˆ–åè¯çŸ­è¯­ï¼Œå¦‚Customeã€WikiPageã€Accountã€AddressParserï¼Œé¿å…ä½¿ç”¨Managerã€Processorã€Dataã€Infoã€è¿™æ ·çš„ç±»åï¼Œç±»åä¸åº”å½“æ˜¯åŠ¨è¯ã€‚ åŒ…åå‘½åè§„åˆ™ï¼šåŒ…ååº”è¯¥ä¸ºå°å†™å•è¯ï¼Œä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–è€…æ··åˆå¤§å°å†™ã€‚ æ¥å£å‘½åè§„åˆ™ï¼šå•ä¸ªå‡½æ•°çš„æ¥å£åä»¥â€erâ€ä½œä¸ºåç¼€ï¼Œå¦‚Reader,Writerã€‚æ¥å£çš„å®ç°åˆ™å»æ‰â€œerâ€ã€‚ 123type Reader interface &#123; Read(p []byte) (n int, err error)&#125; ä¸¤ä¸ªå‡½æ•°çš„æ¥å£åç»¼åˆä¸¤ä¸ªå‡½æ•°å1234type WriteFlusher interface &#123; Write([]byte) (int, error) Flush() error&#125; ä¸‰ä¸ªä»¥ä¸Šå‡½æ•°çš„æ¥å£åï¼ŒæŠ½è±¡è¿™ä¸ªæ¥å£çš„åŠŸèƒ½ï¼Œç±»ä¼¼äºç»“æ„ä½“å12345type Car interface &#123; Start([]byte) Stop() error Recover()&#125; å¸¸é‡ å¸¸é‡å‡éœ€ä½¿ç”¨å…¨éƒ¨å¤§å†™å­—æ¯ç»„æˆï¼Œå¹¶ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†è¯ï¼š 1const APP_VER = &quot;1.0&quot; å¦‚æœæ˜¯æšä¸¾ç±»å‹çš„å¸¸é‡ï¼Œéœ€è¦å…ˆåˆ›å»ºç›¸åº”ç±»å‹ï¼š 123456type Scheme stringconst ( HTTP Scheme = &quot;http&quot; HTTPS Scheme = &quot;https&quot;) å¦‚æœæ¨¡å—çš„åŠŸèƒ½è¾ƒä¸ºå¤æ‚ã€å¸¸é‡åç§°å®¹æ˜“æ··æ·†çš„æƒ…å†µä¸‹ï¼Œä¸ºäº†æ›´å¥½åœ°åŒºåˆ†æšä¸¾ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å®Œæ•´çš„å‰ç¼€ï¼š 1234567type PullRequestStatus intconst ( PULL_REQUEST_STATUS_CONFLICT PullRequestStatus = iota PULL_REQUEST_STATUS_CHECKING PULL_REQUEST_STATUS_MERGEABLE) å˜é‡ å˜é‡å‘½ååŸºæœ¬ä¸Šéµå¾ªç›¸åº”çš„è‹±æ–‡è¡¨è¾¾æˆ–ç®€å†™,åœ¨ç›¸å¯¹ç®€å•çš„ç¯å¢ƒï¼ˆå¯¹è±¡æ•°é‡å°‘ã€é’ˆå¯¹æ€§å¼ºï¼‰ä¸­ï¼Œå¯ä»¥å°†ä¸€äº›åç§°ç”±å®Œæ•´å•è¯ç®€å†™ä¸ºå•ä¸ªå­—æ¯ï¼Œä¾‹å¦‚ï¼š user å¯ä»¥ç®€å†™ä¸º u userID å¯ä»¥ç®€å†™ uidè‹¥å˜é‡ç±»å‹ä¸º bool ç±»å‹ï¼Œåˆ™åç§°åº”ä»¥ Has, Is, Can æˆ– Allow å¼€å¤´ï¼š 1234var isExist boolvar hasConflict boolvar canManage boolvar allowGitHook bool å˜é‡å‘½åæƒ¯ä¾‹ å˜é‡åç§°ä¸€èˆ¬éµå¾ªé©¼å³°æ³•ï¼Œä½†é‡åˆ°ç‰¹æœ‰åè¯æ—¶ï¼Œéœ€è¦éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š å¦‚æœå˜é‡ä¸ºç§æœ‰ï¼Œä¸”ç‰¹æœ‰åè¯ä¸ºé¦–ä¸ªå•è¯ï¼Œåˆ™ä½¿ç”¨å°å†™ï¼Œå¦‚ apiClient å…¶å®ƒæƒ…å†µéƒ½åº”å½“ä½¿ç”¨è¯¥åè¯åŸæœ‰çš„å†™æ³•ï¼Œå¦‚ APIClientã€repoIDã€UserID é”™è¯¯ç¤ºä¾‹ï¼šUrlArrayï¼Œåº”è¯¥å†™æˆurlArrayæˆ–è€…URLArray ä¸‹é¢åˆ—ä¸¾äº†ä¸€äº›å¸¸è§çš„ç‰¹æœ‰åè¯ï¼š 123456789101112131415161718192021222324252627282930313233343536// A GonicMapper that contains a list of common initialisms taken from golang/lintvar LintGonicMapper = GonicMapper&#123; &quot;API&quot;: true, &quot;ASCII&quot;: true, &quot;CPU&quot;: true, &quot;CSS&quot;: true, &quot;DNS&quot;: true, &quot;EOF&quot;: true, &quot;GUID&quot;: true, &quot;HTML&quot;: true, &quot;HTTP&quot;: true, &quot;HTTPS&quot;: true, &quot;ID&quot;: true, &quot;IP&quot;: true, &quot;JSON&quot;: true, &quot;LHS&quot;: true, &quot;QPS&quot;: true, &quot;RAM&quot;: true, &quot;RHS&quot;: true, &quot;RPC&quot;: true, &quot;SLA&quot;: true, &quot;SMTP&quot;: true, &quot;SSH&quot;: true, &quot;TLS&quot;: true, &quot;TTL&quot;: true, &quot;UI&quot;: true, &quot;UID&quot;: true, &quot;UUID&quot;: true, &quot;URI&quot;: true, &quot;URL&quot;: true, &quot;UTF8&quot;: true, &quot;VM&quot;: true, &quot;XML&quot;: true, &quot;XSRF&quot;: true, &quot;XSS&quot;: true,&#125; structè§„èŒƒ structç”³æ˜å’Œåˆå§‹åŒ–æ ¼å¼é‡‡ç”¨å¤šè¡Œï¼š å®šä¹‰å¦‚ä¸‹ï¼š 1234type User struct&#123; Username string Email string&#125; åˆå§‹åŒ–å¦‚ä¸‹ï¼š 1234u := User&#123; Username: &quot;test&quot;, Email: &quot;test@gmail.com&quot;,&#125; æ§åˆ¶ç»“æ„ ififæ¥å—åˆå§‹åŒ–è¯­å¥ï¼Œçº¦å®šå¦‚ä¸‹æ–¹å¼å»ºç«‹å±€éƒ¨å˜é‡ 123if err := file.Chmod(0664); err != nil &#123; return err&#125; foré‡‡ç”¨çŸ­å£°æ˜å»ºç«‹å±€éƒ¨å˜é‡ 1234sum := 0for i := 0; i &lt; 10; i++ &#123; sum += i&#125; returnå°½æ—©returnï¼šä¸€æ—¦æœ‰é”™è¯¯å‘ç”Ÿï¼Œé©¬ä¸Šè¿”å› 12345678910f, err := os.Open(name)if err != nil &#123; return err&#125;d, err := f.Stat()if err != nil &#123; f.Close() return err&#125;codeUsing(f, d) é”™è¯¯å¤„ç† errorä½œä¸ºå‡½æ•°çš„å€¼è¿”å›,å¿…é¡»å¯¹errorè¿›è¡Œå¤„ç† é”™è¯¯æè¿°å¦‚æœæ˜¯è‹±æ–‡å¿…é¡»ä¸ºå°å†™ï¼Œä¸éœ€è¦æ ‡ç‚¹ç»“å°¾ é‡‡ç”¨ç‹¬ç«‹çš„é”™è¯¯æµè¿›è¡Œå¤„ç† ä¸è¦é‡‡ç”¨ä¸‹é¢çš„å¤„ç†é”™è¯¯å†™æ³• 12345if err != nil &#123; // error handling&#125; else &#123; // normal code&#125; é‡‡ç”¨ä¸‹é¢çš„å†™æ³• 12345if err != nil &#123; // error handling return // or continue, etc.&#125;// normal code ä½¿ç”¨å‡½æ•°çš„è¿”å›å€¼æ—¶ï¼Œåˆ™é‡‡ç”¨ä¸‹é¢çš„æ–¹å¼ 123456x, err := f()if err != nil &#123; // error handling return&#125;// use x panic å°½é‡ä¸è¦ä½¿ç”¨panicï¼Œé™¤éä½ çŸ¥é“ä½ åœ¨åšä»€ä¹ˆ import å¯¹importçš„åŒ…è¿›è¡Œåˆ†ç»„ç®¡ç†ï¼Œç”¨æ¢è¡Œç¬¦åˆ†å‰²ï¼Œè€Œä¸”æ ‡å‡†åº“ä½œä¸ºåˆ†ç»„çš„ç¬¬ä¸€ç»„ã€‚å¦‚æœä½ çš„åŒ…å¼•å…¥äº†ä¸‰ç§ç±»å‹çš„åŒ…ï¼Œæ ‡å‡†åº“åŒ…ï¼Œç¨‹åºå†…éƒ¨åŒ…ï¼Œç¬¬ä¸‰æ–¹åŒ…ï¼Œå»ºè®®é‡‡ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œç»„ç»‡ä½ çš„åŒ… 123456789101112package mainimport ( &quot;fmt&quot; &quot;os&quot; &quot;kmg/a&quot; &quot;kmg/b&quot; &quot;code.google.com/a&quot; &quot;github.com/b&quot;) åœ¨é¡¹ç›®ä¸­ä¸è¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å…¥åŒ…ï¼š 12345// é”™è¯¯ç¤ºä¾‹import â€œ../netâ€// æ­£ç¡®çš„åšæ³•import â€œgithub.com/repo/proj/src/netâ€ goimportsä¼šè‡ªåŠ¨å¸®ä½ æ ¼å¼åŒ– å‚æ•°ä¼ é€’ å¯¹äºå°‘é‡æ•°æ®ï¼Œä¸è¦ä¼ é€’æŒ‡é’ˆ å¯¹äºå¤§é‡æ•°æ®çš„structå¯ä»¥è€ƒè™‘ä½¿ç”¨æŒ‡é’ˆ ä¼ å…¥å‚æ•°æ˜¯mapï¼Œsliceï¼Œchanä¸è¦ä¼ é€’æŒ‡é’ˆï¼Œå› ä¸ºmapï¼Œsliceï¼Œchanæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸éœ€è¦ä¼ é€’æŒ‡é’ˆçš„æŒ‡é’ˆ å•å…ƒæµ‹è¯• å•å…ƒæµ‹è¯•æ–‡ä»¶åå‘½åè§„èŒƒä¸º example_test.goæµ‹è¯•ç”¨ä¾‹çš„å‡½æ•°åç§°å¿…é¡»ä»¥ Test å¼€å¤´ï¼Œä¾‹å¦‚ï¼šTestExample]]></content>
      <tags>
        <tag>å…¶å®ƒ</tag>
      </tags>
  </entry>
</search>
