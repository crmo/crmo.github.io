<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CR.MO`s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://crmo.github.io/"/>
  <updated>2018-12-02T08:21:32.062Z</updated>
  <id>https://crmo.github.io/</id>
  
  <author>
    <name>CR.MO</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Core Animationå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰</title>
    <link href="https://crmo.github.io/2018/12/02/Core%20Animation%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://crmo.github.io/2018/12/02/Core Animationå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰/</id>
    <published>2018-12-01T16:00:00.000Z</published>
    <updated>2018-12-02T08:21:32.062Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ˜¯æˆ‘é˜…è¯»ä¹¦ç±ã€ŠiOS CORE ANIMATION ADVANCED TECHNIQUESã€‹çš„è¯»ä¹¦ç¬”è®°ï¼Œæ„Ÿè°¢åŸä¹¦ä½œè€…åŠè¯‘è€…çš„åˆ†äº«ï¼<br>æ¨èå¤§å®¶æœ‰æ—¶é—´å¯ä»¥è¯»è¯»åŸä¹¦ï¼Œå†™çš„å¾ˆç²¾å½©ã€‚<a href="https://zsisme.gitbooks.io/ios-/content/index.html" target="_blank" rel="noopener">ä¸­æ–‡ç‰ˆ</a></p></blockquote><h2 id="ä¸€ã€Core-Animationå®šä¹‰"><a href="#ä¸€ã€Core-Animationå®šä¹‰" class="headerlink" title="ä¸€ã€Core Animationå®šä¹‰"></a>ä¸€ã€Core Animationå®šä¹‰</h2><p>ä»€ä¹ˆæ˜¯<code>Core Animation</code>ï¼Œç›¸ä¿¡å¾ˆå¤šåŒå­¦å¯¹äºå®ƒæ—¢ç†Ÿæ‚‰åˆé™Œç”Ÿï¼Œä»åå­—ä¸Šæ¥çœ‹å®ƒåº”è¯¥æ˜¯ä¸€ä¸ªåšåŠ¨ç”»çš„æ¡†æ¶ï¼Œå…¶å®åŠ¨ç”»åªæ˜¯å®ƒçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ›¾ç»å«åš<code>Layer Kit</code>ã€‚</p><p>å¼•ç”¨ä¹¦ä¸­çš„å®šä¹‰ï¼š</p><blockquote><p>Core Animationæ˜¯ä¸€ä¸ªå¤åˆå¼•æ“ï¼Œå®ƒçš„èŒè´£å°±æ˜¯å°½å¯èƒ½å¿«åœ°ç»„åˆå±å¹•ä¸Šä¸åŒçš„å¯è§†å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹æ˜¯è¢«åˆ†è§£æˆç‹¬ç«‹çš„<code>Layer</code>ï¼Œå¹¶å­˜å‚¨åœ¨<code>Layer Tree</code>ä¸­ã€‚äºæ˜¯è¿™ä¸ªæ ‘å½¢æˆäº†UIKitä»¥åŠåœ¨iOSåº”ç”¨ç¨‹åºå½“ä¸­ä½ æ‰€èƒ½åœ¨å±å¹•ä¸Šçœ‹è§çš„ä¸€åˆ‡çš„åŸºç¡€ã€‚</p></blockquote><p>çœ‹å®Œè¿˜æ˜¯ä¸€è„¸æ‡µé€¼ï¼Ÿæ²¡å…³ç³»ï¼Œåœ¨è¿™ä¸€ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘å°†æŠ½ä¸å‰¥èŒ§ï¼Œå¸¦é¢†å¤§å®¶æ­å¼€<code>Core Animation</code>çš„ç¥ç§˜é¢çº±ã€‚</p><h2 id="äºŒã€UIViewä¸CALayer"><a href="#äºŒã€UIViewä¸CALayer" class="headerlink" title="äºŒã€UIViewä¸CALayer"></a>äºŒã€UIViewä¸CALayer</h2><p>æˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸­ï¼Œæ¥è§¦æœ€å¤šçš„å°±æ˜¯<code>UIView</code>ï¼ŒUIViewå¯ä»¥å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œå¯ä»¥æ”¯æŒåŸºäº<code>Core Graphics</code>ç»˜å›¾ï¼Œå¯ä»¥åšä»¿å°„å˜æ¢ï¼ˆä¾‹å¦‚æ—‹è½¬æˆ–è€…ç¼©æ”¾ï¼‰ï¼Œæˆ–è€…ç®€å•çš„ç±»ä¼¼äºæ»‘åŠ¨æˆ–è€…æ¸å˜çš„åŠ¨ç”»ã€‚</p><p>æ¯ä¸ª<code>UIView</code>éƒ½åŒ…å«ä¸€ä¸ª<code>CALayer</code>å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<code>backing layer</code>ã€‚<code>CALayer</code>ä¸<code>UIView</code>æœ€å¤§çš„åŒºåˆ«æ˜¯å®ƒä¸å¤„ç†ç”¨æˆ·çš„äº¤äº’ï¼Œå®ƒçš„èŒè´£æ˜¯è´Ÿè´£å±å¹•ä¸Šçš„æ˜¾ç¤ºå’ŒåŠ¨ç”»ã€‚<code>UIView</code>è´Ÿè´£å¤„ç†ç”¨æˆ·äº¤äº’ï¼Œå¹¶ç®¡ç†<code>CALayer</code>ã€‚</p><p><code>UIView</code>å…¶å®å°±æ˜¯å¯¹<code>CALayer</code>çš„é«˜çº§å°è£…ï¼Œä¸ºä»€ä¹ˆè‹¹æœä¸ç›´æ¥ç”¨ä¸€ä¸ªç®€å•å±‚çº§æ¥å¤„ç†æ‰€æœ‰äº‹æƒ…ï¼ŸåŸå› åœ¨äºè¦åšèŒè´£åˆ†ç¦»ï¼Œè¿™æ ·ä¹Ÿèƒ½é¿å…å¾ˆå¤šé‡å¤ä»£ç ã€‚åœ¨iOSå’ŒMac OSä¸¤ä¸ªå¹³å°ä¸Šï¼Œäº‹ä»¶å’Œç”¨æˆ·äº¤äº’æœ‰å¾ˆå¤šåœ°æ–¹çš„ä¸åŒï¼ŒåŸºäºå¤šç‚¹è§¦æ§çš„ç”¨æˆ·ç•Œé¢å’ŒåŸºäºé¼ æ ‡é”®ç›˜æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆiOSæœ‰<code>UIKit</code>å’Œ<code>UIView</code>ï¼Œä½†æ˜¯Mac OSæœ‰<code>AppKit</code>å’Œ<code>NSView</code>çš„åŸå› ã€‚ä»–ä»¬åŠŸèƒ½ä¸Šå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯åœ¨å®ç°ä¸Šæœ‰ç€æ˜¾è‘—çš„åŒºåˆ«ã€‚</p><h3 id="CALayerç‹¬æœ‰åŠŸèƒ½"><a href="#CALayerç‹¬æœ‰åŠŸèƒ½" class="headerlink" title="CALayerç‹¬æœ‰åŠŸèƒ½"></a>CALayerç‹¬æœ‰åŠŸèƒ½</h3><p>æœ‰ä¸€äº›UIViewæ²¡æœ‰æš´éœ²å‡ºæ¥çš„CALayerçš„åŠŸèƒ½ï¼š</p><ul><li>é˜´å½±ï¼Œåœ†è§’ï¼Œå¸¦é¢œè‰²çš„è¾¹æ¡†</li><li>3Då˜æ¢</li><li>éçŸ©å½¢èŒƒå›´</li><li>é€æ˜é®ç½©</li><li>å¤šçº§éçº¿æ€§åŠ¨ç”»</li></ul><h2 id="ä¸‰ã€backing-image"><a href="#ä¸‰ã€backing-image" class="headerlink" title="ä¸‰ã€backing image"></a>ä¸‰ã€backing image</h2><p><code>backing image</code>æ˜¯<code>CALayer</code>çš„é‡è¦éƒ¨åˆ†ï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°å„ç§å¤æ‚çš„UIã€‚æœ‰ä¸¤ç§è®¾ç½®<code>backing image</code>çš„æ–¹æ³•:</p><ol><li>è®¾ç½®CALayerçš„<code>contents</code>å±æ€§</li><li>ç›´æ¥ç”¨<code>Core Graphics</code>ç»˜åˆ¶</li></ol><h3 id="contents"><a href="#contents" class="headerlink" title="contents"></a>contents</h3><p>CALayeræœ‰ä¸€ä¸ªå±æ€§å«åš<code>contents</code>ï¼Œè¿™ä¸ªå±æ€§çš„ç±»å‹è¢«å®šä¹‰ä¸ºidï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ ç»™<code>contents</code>èµ‹çš„ä¸æ˜¯CGImageï¼Œé‚£ä¹ˆä½ å¾—åˆ°çš„å›¾å±‚å°†æ˜¯ç©ºç™½çš„ã€‚</p><blockquote><p><code>contents</code>è¿™ä¸ªå¥‡æ€ªçš„è¡¨ç°æ˜¯ç”±Mac OSçš„å†å²åŸå› é€ æˆçš„ã€‚å®ƒä¹‹æ‰€ä»¥è¢«å®šä¹‰ä¸ºidç±»å‹ï¼Œæ˜¯å› ä¸ºåœ¨Mac OSç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªå±æ€§å¯¹CGImageå’ŒNSImageç±»å‹çš„å€¼éƒ½èµ·ä½œç”¨ã€‚å¦‚æœä½ è¯•å›¾åœ¨iOSå¹³å°ä¸Šå°†UIImageçš„å€¼èµ‹ç»™å®ƒï¼Œåªèƒ½å¾—åˆ°ä¸€ä¸ªç©ºç™½çš„å›¾å±‚ã€‚ä¸€äº›åˆè¯†Core Animationçš„iOSå¼€å‘è€…å¯èƒ½ä¼šå¯¹è¿™ä¸ªæ„Ÿåˆ°å›°æƒ‘ã€‚</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªDemoï¼Œåœ¨<code>CALayer</code>ä¸­åŠ è½½äº†ä¸€å¼ å›¾ç‰‡ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> lightGrayColor];</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    view.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:view];</span><br><span class="line">    <span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    [view.layer addSublayer:layer];</span><br><span class="line">    layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [UIImage imageNamed:@"test"]ä¼šæ ¹æ®ä¸åŒæœºå‹å–ä¸åŒå€å›¾</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"test"</span>];</span><br><span class="line">    <span class="comment">// UIImageè½¬CGImageRefæ—¶scaleå±æ€§ä¸¢å¤±</span></span><br><span class="line">    <span class="built_in">CGImageRef</span> imageRef = image.CGImage;</span><br><span class="line">    layer.contents = (__bridge <span class="keyword">id</span>)imageRef;</span><br><span class="line">    <span class="comment">// è®¾ç½®å›¾ç‰‡ç¼©æ”¾</span></span><br><span class="line">    <span class="comment">// å¦‚æœcontentsGravityè®¾ç½®ä¸ºè‡ªåŠ¨ç¼©æ”¾ï¼Œå¯ä»¥ä¸ç”¨è®¾ç½®è¿™ä¸ªå±æ€§</span></span><br><span class="line">    layer.contentsScale = image.scale;</span><br><span class="line">    <span class="comment">// è®¾ç½®å›¾ç‰‡å±…ä¸­ä¸ç¼©æ”¾</span></span><br><span class="line">    layer.contentsGravity = kCAGravityCenter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="contentsGravity"><a href="#contentsGravity" class="headerlink" title="contentsGravity"></a>contentsGravity</h4><p><code>UIImageView</code>ä¸­é€šè¿‡è®¾ç½®<code>contentMode</code>æ¥è®¾ç½®å›¾ç‰‡æ‹‰ä¼¸æ–¹å¼ï¼Œåœ¨<code>CALayer</code>ä¸­æœ‰ä¸€ä¸ªå¯¹åº”å±æ€§<code>contentsGravity</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªNSStringç±»å‹ï¼Œé»˜è®¤å€¼æ˜¯<code>kCAGravityResize</code>ã€‚<br>å®ƒçš„å¯é€‰çš„å€¼æœ‰ï¼š</p><ul><li>kCAGravityCenter</li><li>kCAGravityTop</li><li>kCAGravityBottom</li><li>kCAGravityLeft</li><li>kCAGravityRight</li><li>kCAGravityTopLeft</li><li>kCAGravityTopRight</li><li>kCAGravityBottomLeft</li><li>kCAGravityBottomRight</li><li>kCAGravityResize</li><li>kCAGravityResizeAspect</li><li>kCAGravityResizeAspectFill</li></ul><h4 id="UIImageè½¬CGImageæ‹‰ä¼¸ä¸¢å¤±é—®é¢˜"><a href="#UIImageè½¬CGImageæ‹‰ä¼¸ä¸¢å¤±é—®é¢˜" class="headerlink" title="UIImageè½¬CGImageæ‹‰ä¼¸ä¸¢å¤±é—®é¢˜"></a>UIImageè½¬CGImageæ‹‰ä¼¸ä¸¢å¤±é—®é¢˜</h4><p>å’ŒUIImageä¸åŒï¼ŒCGImageæ²¡æœ‰æ‹‰ä¼¸çš„æ¦‚å¿µã€‚ä½¿ç”¨UIImageç±»å»è¯»å–å›¾ç‰‡çš„æ—¶å€™ï¼Œå®ƒä¼šè¯»å–äº†å±å¹•ï¼ˆ1xã€2xã€3xï¼‰å¯¹åº”å°ºå¯¸çš„å›¾ç‰‡ã€‚ä½†æ˜¯ç”¨CGImageæ¥è®¾ç½®<code>layer.contents</code>æ—¶ï¼Œæ‹‰ä¼¸è¿™ä¸ªå› ç´ åœ¨è½¬æ¢çš„æ—¶å€™å°±ä¸¢å¤±äº†ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨è®¾ç½®<code>contentsScale</code>æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="contentsScale"><a href="#contentsScale" class="headerlink" title="contentsScale"></a>contentsScale</h4><p>å¦‚æœ<code>contentsScale</code>è®¾ç½®ä¸º1.0ï¼Œå°†ä¼šä»¥æ¯ä¸ªç‚¹1ä¸ªåƒç´ ç»˜åˆ¶å›¾ç‰‡ï¼Œå¦‚æœè®¾ç½®ä¸º2.0ï¼Œåˆ™ä¼šä»¥æ¯ä¸ªç‚¹2ä¸ªåƒç´ ç»˜åˆ¶å›¾ç‰‡ã€‚<code>UIView</code>ä¸­å¯¹åº”<code>contentScaleFactor</code>å±æ€§ã€‚</p><h4 id="contentsCenter"><a href="#contentsCenter" class="headerlink" title="contentsCenter"></a>contentsCenter</h4><p>contentsCenteræ˜¯ä¸€ä¸ªCGRectï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªå›ºå®šçš„è¾¹æ¡†å’Œä¸€ä¸ªåœ¨å›¾å±‚ä¸Šå¯æ‹‰ä¼¸çš„åŒºåŸŸã€‚ç±»ä¼¼äº<code>UIImage</code>é‡Œçš„<code>resizableImageWithCapInsets</code> æ–¹æ³•ï¼Œåªæ˜¯å®ƒå¯ä»¥è¿ç”¨åˆ°ä»»ä½•<code>backing image</code>ï¼Œç”šè‡³åŒ…æ‹¬<code>Core Graphics</code>ç»˜åˆ¶çš„å›¾å½¢ã€‚</p><p><img src="images/15436482245238.jpg" alt=""></p><h3 id="Custom-Drawing"><a href="#Custom-Drawing" class="headerlink" title="Custom Drawing"></a>Custom Drawing</h3><p>ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ç›´æ¥ç”¨<code>Core Graphics</code>ç»˜åˆ¶<code>backing image</code>ï¼Œå…·ä½“å®ç°æ–¹å¼æ˜¯é€šè¿‡ç»§æ‰¿<code>UIView</code>å¹¶å®ç°<code>drawRect</code>æ¥è‡ªå®šä¹‰ç»˜åˆ¶ã€‚</p><h4 id="CALayerDelegate"><a href="#CALayerDelegate" class="headerlink" title="CALayerDelegate"></a>CALayerDelegate</h4><p>è¦ç†è§£<code>drawRect</code>çš„å·¥ä½œåŸç†ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹<code>CALayerDelegate</code>ã€‚<br><code>CALayer</code>æœ‰ä¸€ä¸ªå¯é€‰çš„delegateï¼Œé€šè¿‡å®ç°<code>CALayerDelegate</code>ï¼Œå°±å¯ä»¥è‡ªå®šä¹‰<code>CALayer</code>çš„<code>backing image</code>ã€‚<br><code>CALayerDelegate</code>ä¸­æœ‰ä¸¤ä¸ªå€¼å¾—å…³æ³¨çš„æ–¹æ³•ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”±-displayæ–¹æ³•çš„é»˜è®¤å®ç°è°ƒç”¨ï¼Œä½ åº”è¯¥å®ç°æ•´ä¸ªæ˜¾ç¤ºè¿‡ç¨‹ï¼ˆé€šå¸¸é€šè¿‡è®¾ç½®'contents'å±æ€§ï¼‰</span></span><br><span class="line"><span class="comment">// å¦‚æœå®ç°äº†è¯¥æ–¹æ³•ï¼Œå°±ä¸ä¼šè°ƒç”¨drawLayer:inContext:äº†</span></span><br><span class="line">- (<span class="keyword">void</span>)displayLayer:(<span class="built_in">CALayer</span> *)layer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”±-drawInContextæ–¹æ³•çš„é»˜è®¤å®ç°è°ƒç”¨</span></span><br><span class="line"><span class="comment">// å¦‚æœæ²¡æœ‰å®ç°displayLayer:ï¼Œå°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx;</span><br></pre></td></tr></table></figure><p>ç»™ä¸ªç®€å•çš„Demoï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> lightGrayColor];</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    view.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:view];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    [view.layer addSublayer:layer];</span><br><span class="line">    layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®ä»£ç†</span></span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// displayæ–¹æ³•å¿…é¡»æ‰‹åŠ¨è°ƒç”¨ï¼Œä¸ç„¶ä¸ä¼šæ‰§è¡Œç»˜åˆ¶</span></span><br><span class="line">    [layer display]; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx &#123;</span><br><span class="line">    <span class="comment">// ç”»ä¸€ä¸ªåœ†ç¯</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> redColor].CGColor);</span><br><span class="line">    <span class="built_in">CGContextStrokeEllipseInRect</span>(ctx, layer.bounds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>[layer display]</code>éœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼Œ<code>CALayer</code>ä¸ä¼šè‡ªåŠ¨é‡ç»˜å®ƒçš„å†…å®¹ï¼Œè€Œæ˜¯æŠŠé‡ç»˜å†³å®šæƒäº¤ç»™äº†å¼€å‘è€…ã€‚</p></blockquote><h4 id="drawRect"><a href="#drawRect" class="headerlink" title="drawRect"></a>drawRect</h4><p>ç†è§£äº†<code>CALayerDelegate</code>å†æ¥çœ‹<code>drawRect</code>å°±ç®€å•å¾ˆå¤šäº†ï¼Œ<code>UIView</code>æŠŠ<code>CALayerDelegate</code>è®¾ç½®ä¸ºè‡ªå·±ï¼Œå¹¶å®ç°äº†<code>displayLayer:</code>ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦å…³å¿ƒè¿™äº›ç»†èŠ‚ï¼Œåªéœ€è¦é‡å†™<code>drawRect</code>ï¼Œåœ¨æ–¹æ³•å†…ç»˜åˆ¶<code>backing image</code>å³å¯ã€‚</p><p><strong>drawRectè°ƒç”¨æ—¶æœº</strong></p><p>å½“<code>UIView</code>åœ¨å±å¹•ä¸Šå‡ºç°çš„æ—¶å€™ï¼Œ<code>drawRect</code>æ–¹æ³•å°±ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ç„¶åå†…å®¹å°±ä¼šè¢«ç¼“å­˜èµ·æ¥ç›´åˆ°å®ƒéœ€è¦è¢«æ›´æ–°ï¼Œé€šå¸¸æ˜¯å› ä¸ºæ‰‹åŠ¨è°ƒç”¨äº†<code>setNeedsDisplay</code>ï¼Œæˆ–å½±å“åˆ°è¡¨ç°æ•ˆæœçš„å±æ€§å€¼è¢«æ›´æ”¹æ—¶ï¼Œå¦‚boundså±æ€§ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨<code>setNeedsDisplay</code>åï¼Œä¸ä¼šé©¬ä¸Šè§¦å‘<code>drawRect</code>ï¼Œè€Œæ˜¯è¦ç­‰åˆ°æ¥æ”¶åˆ°RunLoopçš„<code>kCFRunLoopBeforeWaiting</code>é€šçŸ¥åè§¦å‘<code>drawRect</code>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="images/15436511549803.jpg" alt="drawRectè°ƒç”¨æ ˆ"></p><p><strong>å¦‚éå¿…é¡»ï¼Œå‹¿é‡å†™drawRect</strong></p><p><code>drawRect</code>æ–¹æ³•æ²¡æœ‰é»˜è®¤çš„å®ç°ï¼Œå› ä¸ºå¯¹UIViewæ¥è¯´ï¼Œ<code>backing image</code>å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚å¦‚æœ<code>UIView</code>æ£€æµ‹åˆ°<code>drawRect</code>æ–¹æ³•è¢«è°ƒç”¨äº†ï¼Œå®ƒå°±ä¼šä¸ºè§†å›¾åˆ†é…ä¸€ä¸ª<code>backing image</code>ï¼Œè¿™ä¸ª<code>backing image</code>çš„åƒç´ å°ºå¯¸ç­‰äº<code>è§†å›¾å¤§å° * contentsScale</code>ï¼›åä¹‹åˆ™ä¸ä¼šåˆ›å»º<code>backing image</code>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰ç»˜åˆ¶çš„ä»»åŠ¡å°±ä¸è¦åœ¨é‡å†™ä¸€ä¸ªç©ºçš„<code>drawRect</code>ã€‚</p><blockquote><p>åœ¨åšå®éªŒçš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªæœ‰è¶£ç°è±¡ï¼Œåœ¨åŒä¸€ä¸ªRunLoopå¾ªç¯é‡Œï¼Œå…ˆè°ƒç”¨<code>setNeedsDisplay</code>ï¼Œå†è®¾ç½®<code>view.layer</code>çš„<code>contents</code>ï¼Œç³»ç»Ÿå°±ä¸ä¼šè°ƒç”¨<code>drawRect</code>æ–¹æ³•äº†(éš¾é“æ˜¯å› ä¸ºè®¾ç½®<code>contents</code>ä¼šæŠŠ<code>needsDisplay</code>è®¾ç½®ä¸ºNOï¼Ÿï¼Ÿ)ã€‚</p></blockquote><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å¦‚æœæˆ‘ä»¬åªæ˜¯å†™ä¸€ä¸ªç®€å•çš„ç™»å½•ç•Œé¢ï¼Œå…¶å®ç”¨<code>UIView</code>è¿™ç§é«˜çº§æ¥å£å°±å¤Ÿäº†ã€‚ä½†æ˜¯ä¸ºäº†å®ç°å¤æ‚UIä¸ä¸æ»‘ä½“éªŒï¼Œä½¿ç”¨<code>Core Animation</code>å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼ˆç¼ºç‚¹æ˜¯é—¨æ§›é«˜ç‚¹ï¼Œç¼–ç å¤æ‚åº¦è¦é«˜äº›ï¼‰ã€‚<br>æœ¬æ–‡è¦ç‚¹æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li><code>Core Animation</code>æ˜¯ä¸€ä¸ªè´Ÿè´£å¤„ç†å›¾å±‚ã€å±å¹•ç»˜åˆ¶ã€åŠ¨ç”»ç­‰çš„å¤åˆå¼•æ“</li><li><code>UIView</code>æ˜¯å¯¹<code>CALayer</code>çš„é«˜çº§å°è£…ï¼Œæ¯ä¸ª<code>UIView</code>åŒ…å«ä¸€ä¸ª<code>CALayer</code>å®ä¾‹ã€‚</li><li>åœ¨<code>CALayer</code>ä¸Šç»˜åˆ¶å†…å®¹ï¼Œéœ€è¦è®¾ç½®å®ƒçš„<code>backing image</code>ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š<ul><li>è®¾ç½®CALayerçš„<code>contents</code>å±æ€§</li><li>ç›´æ¥ç”¨<code>Core Graphics</code>ç»˜åˆ¶</li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯æˆ‘é˜…è¯»ä¹¦ç±ã€ŠiOS CORE ANIMATION ADVANCED TECHNIQUESã€‹çš„è¯»ä¹¦ç¬”è®°ï¼Œæ„Ÿè°¢åŸä¹¦ä½œè€…åŠè¯‘è€…çš„åˆ†äº«ï¼&lt;br&gt;æ¨èå¤§å®¶æœ‰æ—¶é—´å¯ä»¥è¯»è¯»åŸä¹¦ï¼Œå†™çš„å¾ˆç²¾å½©ã€‚&lt;a href=&quot;https://zsisme.gitbooks.
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>App Storeä¸Šæ¶æ¼«è°ˆ</title>
    <link href="https://crmo.github.io/2018/11/15/App%20Store%E4%B8%8A%E6%9E%B6%E6%BC%AB%E8%B0%88/"/>
    <id>https://crmo.github.io/2018/11/15/App Storeä¸Šæ¶æ¼«è°ˆ/</id>
    <published>2018-11-14T16:00:00.000Z</published>
    <updated>2018-12-02T07:46:38.531Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘å¿™ç€å†™BugğŸ˜‚ï¼Œå¥½ä¹…æ²¡æœ‰å†™æ–‡ç« äº†ã€‚ä»Šå¤©å’Œå¤§å®¶åˆ†äº«ä¸‹æˆ‘æœ€è¿‘ä¸Šæ¶ç¬¬äºŒä¸ªç‹¬ç«‹å¼€å‘çš„APPâ€œè¯†ä¹‹â€çš„ä¸Šæ¶ç»éªŒï¼ˆå…¶å®å°±æ˜¯ä¸ºäº†åšä¸€æ³¢å¹¿å‘Šï¼‰ã€‚</p><blockquote><p>é‡ç‚¹æ¥äº†ï¼ï¼ï¼<br>è¯†ä¹‹ï¼Œäººå·¥æ™ºèƒ½AIè¯†åˆ«ï¼ŒåŠ¨ç‰©ã€æ¤ç‰©ã€Logoã€æ±½è½¦è½¦å‹ã€èœå“ã€é€šç”¨ï¼ˆè¯†åˆ«å„ç§ä¸œè¥¿ï¼‰ç»Ÿç»Ÿå¯ä»¥è¯†åˆ«ã€‚åªéœ€ç”¨ç›¸æœºæ‹ä¸€å¼ ç…§ç‰‡ï¼Œæˆ–è€…ä»ç›¸å†Œä¸­é€‰æ‹©è¦è¯†åˆ«çš„å›¾ç‰‡ï¼Œå³å¯å¾—åˆ°ç­”æ¡ˆã€‚ä½¿ç”¨å®Œå…¨å…è´¹ä½¿ç”¨ï¼Œè§£å†³æ‚¨çš„çŸ¥è¯†ç„¦è™‘ï¼<br>ä¸‹è½½é“¾æ¥ï¼š<a href="http://t.cn/EAs5ubq" target="_blank" rel="noopener">http://t.cn/EAs5ubq</a><br>äº”æ˜Ÿå¥½è¯„æˆªå›¾è¿”ç°ğŸ’•</p></blockquote><p>å¥½äº†ï¼Œé‡ç‚¹ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥èŠç‚¹é—²è¯ğŸ˜ã€‚</p><h2 id="èŠèŠå®¡æ ¸"><a href="#èŠèŠå®¡æ ¸" class="headerlink" title="èŠèŠå®¡æ ¸"></a>èŠèŠå®¡æ ¸</h2><p>â€œè¯†ä¹‹â€æ˜¯æˆ‘ä¸Šæ¶çš„ç¬¬äºŒä¸ªç‹¬ç«‹å¼€å‘APPï¼Œ2å¤©æå®šå®¡æ ¸æˆåŠŸä¸Šæ¶ï¼ˆç¬¬ä¸€ä¸ªAPPæ˜¯3å¤©ï¼‰ï¼Œæœ‰äº›å¿ƒå¾—å’Œå¤§å®¶åˆ†äº«ä¸‹ã€‚<br>ä¸å¾—ä¸è¯´è‹¹æœå®¡æ ¸å›¢é˜Ÿç°åœ¨çš„æ•ˆç‡å¾ˆé«˜ï¼Œä¸€èˆ¬ä¸€å¤©å°±å¯ä»¥å®¡æ ¸å®Œæˆï¼Œæˆ‘è®°å¾—æˆ‘åˆšå¼€å§‹åšiOSé‚£ä¼šï¼Œå®¡æ ¸ä¸€æ¬¡è¦ä¸€å‘¨ï¼ŒçœŸçš„å¤ªæ¼«é•¿äº†ã€‚<br>æ¯æ¬¡æäº¤æ–°ç‰ˆæœ¬ä¹‹åï¼Œç¬¬äºŒå¤©æ—©ä¸Šèµ·åºŠç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æ”¶é‚®ä»¶ã€‚ç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„æ ‡é¢˜çš„é‚®ä»¶ï¼Œå¿ƒæ€ç¬é—´è¹¦äº†ã€‚</p><p><img src="/images/WechatIMG82.jpeg" alt="WechatIMG82"></p><p>ä½†æ˜¯ä¸è¦æ…Œï¼Œè¿™åªæ˜¯è‹¹æœæ€€ç–‘ä½ å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå¹¶ä¸ä»£è¡¨çœŸçš„æœ‰é—®é¢˜ã€‚å…ˆé™ä¸‹å¿ƒæ¥ï¼Œè¯»è¯»è¿™ç¯‡<a href="https://developer.apple.com/cn/app-store/review/guidelines" target="_blank" rel="noopener">ä¸Šæ¶è¿‡å®¡ç§˜ç±</a>ã€‚</p><p>ç„¶å<code>ä»”ç»†é˜…è¯»</code>è‹¹æœçš„ç­”å¤ï¼Œä»”ç»†æ£æ‘©å®¡æ ¸å›¢é˜Ÿçš„ç”¨æ„ã€‚æŠŠå®¡æ ¸å›¢é˜Ÿå½“åšå°ç™½ç”¨æˆ·ï¼Œç«™åœ¨ä»–ä»¬çš„è§’åº¦æ¥æ€è€ƒä»–ä»¬æå‡ºçš„é—®é¢˜ï¼Œç„¶åå¯¹ç…§<a href="https://developer.apple.com/cn/app-store/review/guidelines" target="_blank" rel="noopener">è‹¹æœå®¡æ ¸æ¡ä¾‹</a>ä»”ç»†æ£€æŸ¥ã€‚å¦‚æœç¡®è®¤è‡ªå·±ä¸å­˜åœ¨é—®é¢˜ï¼Œå°±ç›´æ¥å›å¤é‚®ä»¶è¯´æ˜ï¼Œé’ˆå¯¹å®¡æ ¸å›¢é˜Ÿæå‡ºçš„é—®é¢˜è¯¦ç»†è§£é‡Šï¼ˆä¸éœ€è¦é‡æ–°æäº¤äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼Œä¸€èˆ¬éš”å¤©å°±èƒ½æ”¶åˆ°å®¡æ ¸å›¢é˜Ÿçš„ç­”å¤ã€‚</p><blockquote><p>è¿™é‡Œæœ‰ä¸ªæŠ€å·§æˆ‘å±¡è¯•ä¸çˆ½ï¼Œæäº¤å®¡æ ¸æ—¶ï¼Œå¯ä»¥é™„ä¸Šä¸€ä¸ªæ¼”ç¤ºè§†é¢‘ã€‚å› ä¸ºAPPçš„ä¸šåŠ¡é€»è¾‘ä¸€èˆ¬æ¯”è¾ƒå¤æ‚ï¼Œå•é æ–‡å­—æè¿°éš¾ä»¥è¡¨è¿°æ¸…æ¥šï¼ˆæƒ³æƒ³äº§å“ç»ç†å½“é¢äº¤ä»£çš„åŠŸèƒ½éƒ½ç»å¸¸è¢«åšåï¼Œåˆ«è¯´çŸ­çŸ­ä¸€å°é‚®ä»¶äº†ï¼‰ï¼Œè€Œä¸”é•¿æ–‡æœ¬ä¼šè®©äººçœ‹ç€å¾ˆæŠ“ç‹‚ï¼Œå®¡æ ¸å›¢é˜Ÿä¸€å¤©å¯†é›†çš„å®¡æ ¸ï¼Œçœ‹ç€é•¿ç¯‡å¤§è®ºå¿ƒæƒ…è‡ªç„¶ä¸å¥½ã€‚è¿™æ—¶å€™é™„ä¸Šä¸€ä¸ªç²¾å¿ƒå½•åˆ¶çš„æ¼”ç¤ºè§†é¢‘ï¼Œä¸€çœ¼å°±å¯ä»¥çœ‹æ‡‚ä½ çš„APPæ˜¯å¹²å˜›çš„ã€‚<br>è§†é¢‘æ¨èä¸Šä¼ åˆ°Youtubeæ–¹ä¾¿å›½å¤–è§‚çœ‹ã€‚</p></blockquote><p>å¦‚æœç¡®è®¤APPçœŸçš„å­˜åœ¨é—®é¢˜ï¼Œé‚£å°±ä¹–ä¹–çš„ä¿®æ”¹å§ï¼Œä¿®æ”¹ä¹‹åé‡æ–°æäº¤å®¡æ ¸ï¼ˆé¢ã€‚ã€‚ã€‚é©¬ç”²åŒ…ä»€ä¹ˆçš„ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ï¼‰ã€‚</p><blockquote><p>ä»Šå¹´10æœˆåä¸Šæ¶çš„APPéƒ½éœ€è¦æä¾›éšç§æ”¿ç­–ï¼Œ<a href="http://crmo.github.io/2018/10/13/åº”å¯¹è‹¹æœéšç§æ”¿ç­–çœ‹æˆ‘å°±å¤Ÿäº†/">è¿™ç¯‡æ–‡ç« </a>æ•™ä½ è½»æ¾åº”å¯¹ã€‚</p></blockquote><h2 id="å®é™…æ¡ˆä¾‹"><a href="#å®é™…æ¡ˆä¾‹" class="headerlink" title="å®é™…æ¡ˆä¾‹"></a>å®é™…æ¡ˆä¾‹</h2><p>è¿™é‡Œå’Œå¤§å®¶åˆ†äº«ä¸‹â€œè¯†ä¹‹â€çš„ä¸Šæ¶è¿‡ç¨‹ï¼Œâ€é¦™è•‰æ’­æ”¾å™¨â€œçš„ä¸Šæ¶è¿‡ç¨‹çœ‹<a href="http://crmo.github.io/2018/10/07/è®°â€œé¦™è•‰æ’­æ”¾å™¨â€ä¸Šæ¶çš„è¾›é…¸å†ç¨‹/">è¿™ç¯‡æ–‡ç« </a>ã€‚<br>æäº¤çš„ç¬¬äºŒå¤©å°±æ”¶åˆ°æ‹’ä¿¡ï¼Œæ¶‰åŠåˆ°çš„æ¡æ¬¾ï¼š<code>3.1.4</code>ã€<code>4.2</code>ï¼ˆè¿™æ¬¡ç»ˆäºæ²¡æœ‰åˆºæ¿€çš„2.1å¤§ç¤¼åŒ…äº†ï¼‰ã€‚ä¸‹é¢æ˜¯å®¡æ ¸å›¢é˜Ÿçš„å›å¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Guideline 3.1.4 - Business - Payments - Content Codes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Your app enables additional features or functionality when used with augmented reality markers or QR codes. However, those features are not available in the app to users without the necessary markers.</span><br><span class="line"></span><br><span class="line">Next Steps</span><br><span class="line"></span><br><span class="line">To resolve this issue, please provide a means to access these features from within the app, such as through achievements or in-app purchase. If they can be freely obtained, such as through a link to a website, please revise your app to include clear instructions for obtaining the necessary markers or codes.</span><br><span class="line"></span><br><span class="line">Please note that apps cannot require users to purchase unrelated products or engage in advertising or marketing activities to unlock app functionality.</span><br><span class="line"></span><br><span class="line">Guideline 4.2 - Design - Minimum Functionality</span><br><span class="line"></span><br><span class="line">We noticed that your app includes an AR or QR scanner but does not include any additional content or functionality unless the user has access to the AR marker or QR code. While we understand that your app displays additional content when an AR marker or QR code is scanned, to users who do not have access to the AR markers or QR codes, your app only appears to display a camera view.</span><br><span class="line"></span><br><span class="line">Next Steps</span><br><span class="line"></span><br><span class="line">We encourage you to provide your users with additional content in your app, including directions on how to use your app and information on how to obtain any necessary AR markers or QR codes.</span><br><span class="line"></span><br><span class="line">To ensure users have the best experience, apps should provide valuable utility or entertainment, draw people in by offering compelling capabilities or content, or enable people to do something they couldn&apos;t do before or in a way they couldn&apos;t do it before.</span><br></pre></td></tr></table></figure><p>é˜…è¯»ç†è§£æ—¶é—´å¼€å§‹äº†ï¼Œç¬¬ä¸€éçœ‹å®Œæˆ‘æ˜¯ä¸€è„¸æ‡µé€¼çš„ï¼Œå›å¤ä¸­æåˆ°äº†ä¸¤ä¸ªå…³é”®è¯<code>AR markers</code>å’Œ<code>QR codes</code>ï¼Œå¯æ˜¯æˆ‘æ ¹æœ¬æ²¡æœ‰ç”¨åˆ°è¿™äº›ä¸œè¥¿ã€‚äºæ˜¯æˆ‘å†·é™ä¸‹æ¥ï¼ŒæŸ¥äº†ä¸‹å®¡æ ¸æŒ‡å—ã€‚</p><p><img src="/images/15422845505208.jpg" alt="15422845505208"></p><p><img src="/images/15422846190717.jpg" alt="15422846190717"></p><p>ç»“åˆå®¡æ ¸æŒ‡å—å°±èƒ½ç†è§£å®¡æ ¸å›¢é˜Ÿçš„ç”¨æ„äº†ï¼Œä»–ä»¬æ²¡æœ‰ç†è§£æˆ‘çš„APPçš„åŠŸèƒ½ï¼Œæˆ‘çš„APPä¸»è¦é¡µé¢æ˜¯ä¸€ä¸ªç›¸æœºï¼Œæ‹ä¸€å¼ ç…§ç‰‡ï¼Œç„¶åè¯†åˆ«å›¾ç‰‡ä¸­çš„ç‰©ä½“æ˜¯å•¥ã€‚<br>å®¡æ ¸å›¢é˜Ÿçš„ç†è§£æ˜¯APPéœ€è¦é…åˆç‰¹æ®Šçš„å®ä½“ç‰©ä½“æˆ–è€…äºŒç»´ç æ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå¦åˆ™APPå°±æ²¡æœ‰ä»»ä½•ç”¨é€”ã€‚è¿™æ˜¾ç„¶æ˜¯è¯¯è§£æˆ‘äº†ï¼Œäºæ˜¯æˆ‘å½•åˆ¶äº†ä¸€ä¸ªè§†é¢‘ï¼Œè¯¦ç»†çš„æ¼”ç¤ºäº†APPçš„åŠŸèƒ½ï¼Œé…ä¸Šæ–‡å­—è¯´æ˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Dear Apple Review Team:</span><br><span class="line">    Thank you for your patience review, we have done a detailed check on the following questions.</span><br><span class="line">    Our app does not depend on specific markers or QR codes,users can use our app recognize anything,such as cars,plants,animals,dishes,logos.</span><br><span class="line">    We made this app to help users identify objects around them.For example, if the user sees a beautiful plant and wants to know what it is,he can open our appï¼Œthen take a photo use camera,our app will tell him what is this in the photo.</span><br><span class="line">    We recorded a detailed demo video to illustrate our features:https://youtu.be/1okyq-ZJGzU</span><br><span class="line">    Finally, thank you again for your hard review.</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå¤©ä¸Šæ¶æˆåŠŸã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘å¿™ç€å†™BugğŸ˜‚ï¼Œå¥½ä¹…æ²¡æœ‰å†™æ–‡ç« äº†ã€‚ä»Šå¤©å’Œå¤§å®¶åˆ†äº«ä¸‹æˆ‘æœ€è¿‘ä¸Šæ¶ç¬¬äºŒä¸ªç‹¬ç«‹å¼€å‘çš„APPâ€œè¯†ä¹‹â€çš„ä¸Šæ¶ç»éªŒï¼ˆå…¶å®å°±æ˜¯ä¸ºäº†åšä¸€æ³¢å¹¿å‘Šï¼‰ã€‚&lt;/p
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>èŠèŠiOSå¼€å‘ä¸­çš„JSBridge</title>
    <link href="https://crmo.github.io/2018/10/22/%E8%81%8A%E8%81%8AiOS%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84JSBridge/"/>
    <id>https://crmo.github.io/2018/10/22/èŠèŠiOSå¼€å‘ä¸­çš„JSBridge/</id>
    <published>2018-10-21T16:00:00.000Z</published>
    <updated>2018-10-22T13:40:18.102Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/tower-bridge-2324875_1280.jpg" alt="tower-bridge-2324875_1280"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Hybrid Appï¼ˆæ··åˆæ¨¡å¼ç§»åŠ¨åº”ç”¨ï¼‰æ˜¯æŒ‡ä»‹äºweb-appã€native-appè¿™ä¸¤è€…ä¹‹é—´çš„appï¼Œå…¼å…·â€œNative Appè‰¯å¥½ç”¨æˆ·äº¤äº’ä½“éªŒçš„ä¼˜åŠ¿â€å’Œâ€œWeb Appè·¨å¹³å°å¼€å‘çš„ä¼˜åŠ¿â€ã€‚è°ˆåˆ°Hybrid Appï¼ŒJSä¸Native codeçš„äº¤äº’å°±æ˜¯ä¸€ä¸ªç»•ä¸å¼€çš„è¯é¢˜ï¼Œè¿™æ—¶å°±éœ€è¦â€œä¸€åº§æ¡¥â€æ¥è¿æ¥ä¸¤ç«¯ã€‚<br><code>JSBridge</code>æ¶èµ·äº†ä¸€åº§è¿æ¥<code>JavaScript</code>ä¸<code>Native Code</code>çš„æ¡¥æ¢ï¼Œè®©ä¸¤ç«¯å¯ä»¥ç›¸äº’è°ƒç”¨ã€‚</p><p><img src="/images/JSBridge.png" alt="JSBridge"></p><p>æœ¬æ–‡åŸºäº<code>UIWebView</code>ï¼Œå°†ä¼šåˆ†åˆ«ä»‹ç»3ç§æ–¹æ¡ˆã€‚é€šè¿‡<code>Iframe</code>ã€<code>Ajax</code>ã€<code>JSCore</code>æ¥å®ç°JSBridgeï¼Œæ¶‰åŠåˆ°çš„<a href="https://github.com/crmo/CRJSBridgeDemo" target="_blank" rel="noopener">Demoåœ°å€</a>ï¼Œé¡ºæ‰‹ç»™ä¸ªStarå‘—ğŸ˜ã€‚</p><h2 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a>å®ç°æ–¹æ¡ˆ</h2><h3 id="Iframe"><a href="#Iframe" class="headerlink" title="Iframe"></a>Iframe</h3><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´å…¥ä¸»é¢˜ï¼Œé¦–å…ˆè®²çš„è¿™ç§æ–¹æ¡ˆæ¯”è¾ƒå¸¸è§ã€‚<code>WebViewJavascriptBridge</code>ä¸<code>Cordava</code>éƒ½æ˜¯é‡‡ç”¨çš„è¯¥æ–¹æ¡ˆï¼ˆæ¨èçœ‹çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« <a href="http://crmo.github.io/2018/05/09/Cordovaæºç è§£æ/">Cordovaæºç è§£æ</a>ï¼‰ã€‚<br>æ ¸å¿ƒæ€è·¯å°±æ˜¯åœ¨UIWebViewæ‹¦æˆªIframeçš„srcï¼ŒåŒæ–¹æå‰çº¦å®šå¥½åè®®ï¼Œä¾‹å¦‚<code>https://__jsbridge__</code>å°±æ˜¯ä¸€æ¬¡è°ƒç”¨å¼€å§‹ã€‚<br>å¯ä»¥å­¦ä¹ <code>Cordova</code>çš„ç­–ç•¥ï¼Œå°†å¹¶å‘çš„å¤šæ¬¡è°ƒç”¨æ‰“åŒ…åˆå¹¶ä¸ºä¸€æ¬¡å¤„ç†ï¼Œå¯ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>1.JSæš´éœ²ä¸€ä¸ªæ–¹æ³•ç»™Nativeï¼Œæ¥æ”¶æ‰§è¡Œç»“æœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">responseFromObjC</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!callback) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    callback(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.Nativeå®ç°<code>UIWebView</code>çš„ä»£ç†ï¼Œåœ¨<code>webView:shouldStartLoadWithRequest:navigationType:</code>æ–¹æ³•æ‹¦æˆªè¯·æ±‚ï¼Œè¯†åˆ«åˆ°ç‰¹å®šURLï¼Œå¼€å§‹ä¸€æ¬¡è°ƒç”¨æµç¨‹ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‹¦æˆªJSè°ƒç”¨åŸç”Ÿæ ¸å¿ƒæ–¹æ³•</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)webView:(<span class="built_in">UIWebView</span> *)webView shouldStartLoadWithRequest:(<span class="built_in">NSURLRequest</span> *)request navigationType:(<span class="built_in">UIWebViewNavigationType</span>)navigationType &#123;</span><br><span class="line">    <span class="built_in">NSURL</span> *url = request.URL;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­urlæ˜¯å¦æ˜¯JSBridgeè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">if</span> ([url.host isEqualToString:<span class="string">@"__jsbridge__"</span>]) &#123;</span><br><span class="line">       <span class="comment">// å¤„ç†JSè°ƒç”¨Native</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.JSå¼€å¯ä¸€ä¸ªIframeï¼ŒåŠ è½½ä¸€ä¸ªç‰¹å®šçš„URLï¼Œå¼€å§‹ä¸€æ¬¡è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line">iframe.style.display = <span class="string">'none'</span>;</span><br><span class="line">iframe.src = <span class="string">'https://__jsbridge__?action='</span>+ action + <span class="string">'&amp;data='</span> + data;</span><br><span class="line"><span class="built_in">document</span>.documentElement.appendChild(iframe);</span><br></pre></td></tr></table></figure><p>4.Nativeæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œè°ƒç”¨JSæ–¹æ³•<code>responseFromObjC</code>å°†ç»“æœå›ä¼ ç»™JSã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// è·å–è°ƒç”¨å‚æ•°ï¼Œdemoçš„è°ƒç”¨æ–¹å¼æ˜¯ï¼š'https://__jsbridge__?action=action&amp;data='</span></span><br><span class="line"><span class="comment">// å‚æ•°ç›´æ¥æ”¾åœ¨queryé‡Œé¢çš„ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯jsæš´éœ²ä¸€ä¸ªæ–¹æ³•ç»™åŸç”Ÿï¼ŒåŸç”Ÿè°ƒç”¨æ–¹æ³•è·å–æ•°æ®</span></span><br><span class="line"><span class="built_in">NSURLComponents</span> *urlComponents = [<span class="built_in">NSURLComponents</span> componentsWithURL:url resolvingAgainstBaseURL:<span class="literal">YES</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *queryItems = urlComponents.queryItems;</span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *params = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSURLQueryItem</span> *queryItem <span class="keyword">in</span> queryItems) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *key = queryItem.name;</span><br><span class="line">    <span class="built_in">NSString</span> *value = queryItem.value;</span><br><span class="line">    [params setObject:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">NSString</span> *action = params[<span class="string">@"action"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *data = params[<span class="string">@"data"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ([action isEqualToString:<span class="string">@"alertMessage"</span>]) &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼Œè·å–æ•°æ®</span></span><br><span class="line">    <span class="comment">// jsæš´éœ²æ–¹æ³•`responseFromObjC`ç»™åŸç”Ÿï¼ŒåŸç”Ÿé€šè¿‡è¯¥æ–¹æ³•å›è°ƒ</span></span><br><span class="line">    <span class="comment">// åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸ºäº†å®ç°å®ç°jså¹¶å‘åŸç”Ÿæ–¹æ³•ï¼Œæœ€å¥½å¸¦ä¸€ä¸ªcallBackIDï¼Œæ¥åŒºåˆ†ä¸åŒçš„è°ƒç”¨</span></span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"responseFromObjC('%@')"</span>, data]];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"responseFromObjC('Unkown action'"</span>]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PS:demoä»£ç ä¸ºäº†ç®€åŒ–ï¼Œç›´æ¥å°†å‚æ•°æ”¾åœ¨URLçš„queryé‡Œï¼Œå¦‚æœåªä¼ è¾“ä¸€äº›ç®€å•æ•°æ®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯JSå…ˆå°†å‚æ•°å­˜æ”¾èµ·æ¥ï¼Œé€šè¿‡URLä¼ é€’ä¸€ä¸ªkeyç»™Nativeï¼Œå†æš´éœ²ä¸€ä¸ªé€šè¿‡keyå–æ•°æ®çš„æ–¹æ³•ï¼ŒNativeä¸»åŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•å–ã€‚</p><h3 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h3><p>ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯JSä½¿ç”¨<code>XMLHttpRequest</code>å‘èµ·è¯·æ±‚ï¼Œåœ¨Nativeæ‹¦æˆªè¾¾åˆ°è°ƒç”¨çš„ç›®çš„ã€‚é€šè¿‡è‡ªå®šä¹‰<code>NSURLProtocol</code>å¯ä»¥æ‹¦æˆªåˆ°Ajaxè¯·æ±‚ã€‚Demoé‡Œæœ‰è¯¦ç»†çš„ä»£ç å’Œæ³¨é‡Šï¼Œå»ºè®®ç»“åˆDemoä¸€èµ·çœ‹ã€‚</p><h4 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>1.æ–°å»ºç±»ç»§æ‰¿è‡ª<code>NSURLProtocol</code>ï¼Œå¹¶æ³¨å†Œã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">NSURLProtocol</span> registerClass:[CRURLProtocol <span class="keyword">class</span>]];</span><br></pre></td></tr></table></figure><p>2.å®ç°è‡ªå®šä¹‰<code>NSURLProtocol</code>ï¼Œåœ¨<code>startLoading</code>æ–¹æ³•æ‹¦æˆªAjaxè¯·æ±‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startLoading &#123;</span><br><span class="line">    <span class="built_in">NSURL</span> *url = [[<span class="keyword">self</span> request] URL];</span><br><span class="line">    <span class="comment">// æ‹¦æˆªâ€œhttp://__jsbridge__â€è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> ([url.host isEqualToString:<span class="string">@"__jsbridge__"</span>]) &#123;</span><br><span class="line">       <span class="comment">// å¤„ç†JSè°ƒç”¨Native</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.JSå‘èµ·Ajaxè¯·æ±‚ï¼ŒURLä¸ºæå‰çº¦å®šçš„ç‰¹æ®Šå€¼ï¼Œä¾‹å¦‚ï¼šhttp://<strong>jsbridge</strong>ã€‚è¯·æ±‚å‚æ•°æ”¾åœ¨<code>Request Body</code>é‡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è°ƒç”¨åŸç”Ÿ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callNative</span>(<span class="params">action, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="built_in">window</span>.XMLHttpRequest(),</span><br><span class="line">        url = <span class="string">'http://__jsbridge__'</span>;</span><br><span class="line">        xhr.open(<span class="string">'POST'</span>, url, <span class="literal">false</span>);</span><br><span class="line">        xhr.send(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">                    action: action,</span><br><span class="line">                    data: data</span><br><span class="line">                    &#125;));</span><br><span class="line">        <span class="keyword">return</span> xhr.responseText;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.Naiveæ‹¦æˆªåˆ°è¯·æ±‚ï¼Œè·å–å‚æ•°ï¼Œæ‰§è¡ŒNativeæ–¹æ³•ï¼Œæœ€åé€šè¿‡Ajaxçš„<code>Response</code>æŠŠç»“æœè¿”å›ç»™JSã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 2. ä»HTTPBodyä¸­å–å‡ºè°ƒç”¨å‚æ•°</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *dic = [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:<span class="keyword">self</span>.request.HTTPBody options:<span class="built_in">NSJSONReadingAllowFragments</span> error:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSString</span> *action = dic[<span class="string">@"action"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *data = dic[<span class="string">@"data"</span>];</span><br><span class="line"><span class="built_in">NSData</span> *responseData;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ ¹æ®actionè½¬å‘åˆ°ä¸åŒæ–¹æ³•å¤„ç†ï¼Œparamæºå¸¦å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> ([action isEqualToString:<span class="string">@"alertMessage"</span>]) &#123;</span><br><span class="line">    responseData = [data dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    responseData = [<span class="string">@"Unknown action"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å¤„ç†å®Œæˆï¼Œå°†ç»“æœè¿”å›ç»™js</span></span><br><span class="line">[<span class="keyword">self</span> sendResponseWithResponseCode:<span class="number">200</span> data:responseData mimeType:<span class="string">@"text/html"</span>];</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)sendResponseWithResponseCode:(<span class="built_in">NSInteger</span>)statusCode data:(<span class="built_in">NSData</span>*)data mimeType:(<span class="built_in">NSString</span>*)mimeType &#123;</span><br><span class="line">    <span class="built_in">NSHTTPURLResponse</span>* response = [[<span class="built_in">NSHTTPURLResponse</span> alloc] initWithURL:[[<span class="keyword">self</span> request] URL] statusCode:statusCode HTTPVersion:<span class="string">@"HTTP/1.1"</span> headerFields:@&#123;<span class="string">@"Content-Type"</span> : mimeType&#125;];</span><br><span class="line">    </span><br><span class="line">    [[<span class="keyword">self</span> client] URLProtocol:<span class="keyword">self</span> didReceiveResponse:response cacheStoragePolicy:<span class="built_in">NSURLCacheStorageNotAllowed</span>];</span><br><span class="line">    <span class="keyword">if</span> (data != <span class="literal">nil</span>) &#123;</span><br><span class="line">        [[<span class="keyword">self</span> client] URLProtocol:<span class="keyword">self</span> didLoadData:data];</span><br><span class="line">    &#125;</span><br><span class="line">    [[<span class="keyword">self</span> client] URLProtocolDidFinishLoading:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JSCore"><a href="#JSCore" class="headerlink" title="JSCore"></a>JSCore</h3><p>å‰ä¸¤ç§æ–¹æ¡ˆè™½ç„¶å®ç°æ–¹æ³•ä¸ä¸€è‡´ï¼Œä½†æ˜¯æ€è·¯éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œç”±äºJSä¸èƒ½ç›´æ¥è°ƒç”¨Nativeæ–¹æ³•ï¼Œé€šè¿‡æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼Œæ‰¾åˆ°ä¸€ä¸ªè½½ä½“æ¥ä¼ é€’ä¿¡æ¯ã€‚<br>ç¬¬ä¸‰ç§æ–¹æ¡ˆå°±æ¯”è¾ƒç›´æ¥äº†ï¼Œä½¿ç”¨iOS7æ¨å‡ºçš„é»‘ç§‘æŠ€<code>JavaScriptCore</code>ï¼Œå°†Nativeæ–¹æ³•ç›´æ¥æš´éœ²ç»™JSï¼Œæ‰“é€šä¸¤ç«¯çš„æ•°æ®é€šé“ã€‚è°ˆåˆ°<code>JavaScriptCore</code>ä¸å¾—ä¸è¯´çš„æ˜¯bang590çš„<code>JSPatch</code>ï¼Œè¿˜æœ‰ReactNativeã€Weexç­‰éƒ½æ˜¯åˆ©ç”¨<code>JavaScriptCore</code>æ¥å®ç°å„ç§ç‚«é…·çš„åŠŸèƒ½ã€‚(å¼ºåŠ›æ¨èä¸€æœ¬Lefe_xçš„ä¹¦<a href="https://github.com/awesome-tips/iOS-Tips/blob/master/resources/ä¸€ä»½èµ°å¿ƒçš„JS-Nativeäº¤äº’ç”µå­ä¹¦.pdf" target="_blank" rel="noopener">ã€Šä¸€ä»½èµ°å¿ƒçš„JS-Nativeäº¤äº’ç”µå­ä¹¦ã€‹</a>ï¼Œéå¸¸ç²¾å½©)ã€‚<br>ä¸è¿‡è¿™ç§æ–¹æ¡ˆæœ‰ä¸ªç¼ºé™·ï¼Œ<code>UIWebView</code>æ²¡æœ‰æš´éœ²<code>JSContext</code>ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡KVCæ‹¿åˆ°ï¼Œä½†æ˜¯æ¯•ç«Ÿä¸æ˜¯ä¸€ç§å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œä¸çŸ¥é“ä¸Šæ¶ä¼šä¸ä¼šæœ‰é£é™©ï¼ˆæ±‚çŸ¥é“çš„åŒå­¦æŒ‡æ•™ä¸€ä¸‹ï¼‰ã€‚</p><h4 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>å®ç°æµç¨‹å°±ä¸ç»†è¯´äº†ï¼Œæµç¨‹æ¯”è¾ƒç®€å•ï¼ŒDemoé‡Œé¢æœ‰ã€‚è¯´è¯´å…³é”®å®ç°ä»£ç </p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)injectJSBridge &#123;</span><br><span class="line">    <span class="comment">// è·å–JSContext</span></span><br><span class="line">    JSContext *context = [_webView valueForKeyPath:<span class="string">@"documentView.webView.mainFrame.javaScriptContext"</span>];</span><br><span class="line">    <span class="comment">// ç»™JSæ³¨å…¥æ–¹æ³•callNative</span></span><br><span class="line">    context[<span class="string">@"callNative"</span>] = ^(JSValue *action, JSValue *data) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *actionStr = [action toString];</span><br><span class="line">        <span class="built_in">NSString</span> *dataStr = [data toString];</span><br><span class="line">        <span class="keyword">if</span> ([actionStr isEqualToString:<span class="string">@"alertMessage"</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> dataStr;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">@"Unkown action"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JSè°ƒç”¨éå¸¸ç®€å•ï¼Œä¸€å¥è¯æå®šã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callNative(<span class="string">"alertMessage"</span>, <span class="string">"Hello world!"</span>)</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h2><p>ä¸ºäº†éªŒè¯ä¸‰ç§æ–¹æ¡ˆçš„æ€§èƒ½ï¼Œè®¾è®¡äº†ä¸ªç®€å•çš„å®éªŒï¼Œåˆ†åˆ«æ‰§è¡Œäº†100ã€1000ã€10000æ¬¡è°ƒç”¨ï¼Œæµ‹è¯•æ‰‹æœºiPhone Xï¼Œç³»ç»ŸiOS 12ï¼Œæ—¶é—´å¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br>å…ˆè¯´ç»“è®ºï¼ŒJSCoreçš„æ€§èƒ½æ˜¯æœ€ä¼˜çš„ï¼Œ<code>JSCore&gt;Ajax&gt;Iframe</code>ã€‚åœ¨ä½å¹¶å‘çš„æ—¶å€™ä¸‰ç§æ–¹æ¡ˆå·®è·ä¸å¤§ï¼Œæ‰§è¡Œæ¬¡æ•°10000æ¬¡æ—¶Iframeæ•ˆç‡å°±å¾ˆä½äº†ï¼ŒAjaxæ¬¡ä¹‹ï¼ŒJSCoreæ€§èƒ½å¾ˆç¨³å®šã€‚å½“ç„¶å®é™…ä½¿ç”¨çš„æ—¶å€™ä¸ä¼šå‡ºç°è°ƒç”¨10000æ¬¡è¿™ç§æé™æƒ…å†µã€‚<br><code>Cordova</code>å¯¹äºå¹¶å‘æœ‰ä¸ªä¼˜åŒ–ç­–ç•¥ï¼Œå¾ˆå€¼å¾—å‚è€ƒï¼Œå°†å¹¶å‘çš„å¤šæ¬¡è°ƒç”¨æ‰“åŒ…åˆå¹¶ä¸ºä¸€æ¬¡å¤„ç†ã€‚</p><p><img src="/images/15401284999756.jpg" alt="15401284999756"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/tower-bridge-2324875_1280.jpg&quot; alt=&quot;tower-bridge-2324875_1280&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>iOSå®šä¹‰é•¿å­—ç¬¦ä¸²çš„å®ç”¨å®</title>
    <link href="https://crmo.github.io/2018/10/16/iOS%E5%AE%9A%E4%B9%89%E9%95%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%AE%9E%E7%94%A8%E5%AE%8F/"/>
    <id>https://crmo.github.io/2018/10/16/iOSå®šä¹‰é•¿å­—ç¬¦ä¸²çš„å®ç”¨å®/</id>
    <published>2018-10-15T16:00:00.000Z</published>
    <updated>2018-10-17T00:58:11.756Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨çœ‹<code>WebViewJavascriptBridge</code>æºç çš„æ—¶å€™å‘ç°ä¸€ä¸ªç¥å¥‡çš„å®ï¼Œåœ¨å®šä¹‰è¾ƒé•¿å­—ç¬¦ä¸²æ—¶å¾ˆå®ç”¨ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œå°†ä¸€æ®µjsä»£ç å­˜åˆ°ä¸€ä¸ªå˜é‡ï¼Œä¸ºäº†ä¾¿äºé˜…è¯»éœ€è¦åŠ å…¥æ¢è¡Œï¼Œéœ€è¦åœ¨æ¯è¡Œç»“æŸåŠ ä¸Š<code>\</code>ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str = <span class="string">@"function() &#123; \</span></span><br><span class="line"><span class="string">if (window.WebViewJavascriptBridge) &#123; \</span></span><br><span class="line"><span class="string">return; \</span></span><br><span class="line"><span class="string">&#125; \</span></span><br><span class="line"><span class="string">&#125;)(); \</span></span><br><span class="line"><span class="string">"</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œå¯ä»¥ç”¨å®æ¥ä¼˜åŒ–ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define LONG_STRING_DEFINE(x) #x</span></span><br><span class="line"><span class="built_in">NSString</span> *str = @LONG_STRING_DEFINE(function() &#123;</span><br><span class="line"><span class="keyword">if</span> (window.WebViewJavascriptBridge) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)();</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å®å±•å¼€åä»£ç å¦‚ä¸‹</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str = <span class="string">@";(function() &#123; if (window.WebViewJavascriptBridge) &#123; return; &#125;)();"</span>;</span><br></pre></td></tr></table></figure><h2 id="ç”¨Xcodeçœ‹å®å±•å¼€"><a href="#ç”¨Xcodeçœ‹å®å±•å¼€" class="headerlink" title="ç”¨Xcodeçœ‹å®å±•å¼€"></a>ç”¨Xcodeçœ‹å®å±•å¼€</h2><p>æ‰“å¼€<code>Assistant Editor</code>ï¼Œé€‰æ‹©<code>Preproces</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°å±•å¼€çš„å®ã€‚</p><p><img src="/images/15396963641371.jpg" alt="15396963641371"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©åœ¨çœ‹&lt;code&gt;WebViewJavascriptBridge&lt;/code&gt;æºç çš„æ—¶å€™å‘ç°ä¸€ä¸ªç¥å¥‡çš„å®ï¼Œåœ¨å®šä¹‰è¾ƒé•¿å­—ç¬¦ä¸²æ—¶å¾ˆå®ç”¨ã€‚&lt;br&gt;ä¸¾ä¸ªä¾‹å­ï¼Œå°†ä¸€æ®µjsä»£ç å­˜åˆ°ä¸€ä¸ªå˜é‡ï¼Œä¸ºäº†ä¾¿äºé˜…è¯»éœ€è¦åŠ å…¥æ¢è¡Œï¼Œéœ€è¦åœ¨æ¯è¡Œç»“æŸåŠ ä¸Š&lt;code&gt;\&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;figu
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>åº”å¯¹iOSéšç§æ”¿ç­–ä¸‰æ­¥æ›²</title>
    <link href="https://crmo.github.io/2018/10/13/%E5%BA%94%E5%AF%B9%E8%8B%B9%E6%9E%9C%E9%9A%90%E7%A7%81%E6%94%BF%E7%AD%96%E7%9C%8B%E6%88%91%E5%B0%B1%E5%A4%9F%E4%BA%86/"/>
    <id>https://crmo.github.io/2018/10/13/åº”å¯¹è‹¹æœéšç§æ”¿ç­–çœ‹æˆ‘å°±å¤Ÿäº†/</id>
    <published>2018-10-12T16:00:00.000Z</published>
    <updated>2018-10-21T15:32:19.907Z</updated>
    
    <content type="html"><![CDATA[<p>å›½åº†å‡æœŸå›æ¥å‡†å¤‡æäº¤æ–°ç‰ˆæœ¬åˆ°App Storeï¼Œé‡åˆ°è‹¹æœæ–°æ”¿ç­–ï¼Œå®æµ‹ä¸‹æ¥å½±å“ä¸å¤§ï¼Œåº”å¯¹è¿˜ç®—æ¯”è¾ƒç®€å•ï¼Œæ€»ç»“ä¸€ä¸‹åˆ†äº«ç»™å¤§å®¶ã€‚</p><h2 id="æ”¿ç­–è¯´æ˜"><a href="#æ”¿ç­–è¯´æ˜" class="headerlink" title="æ”¿ç­–è¯´æ˜"></a>æ”¿ç­–è¯´æ˜</h2><p><img src="/images/QQ20181012-090233.png" alt="QQ20181012-090233"></p><p>ä»2018å¹´10æœˆ3å·èµ·ï¼Œæ‰€æœ‰æ–°æäº¤çš„Appéƒ½å¿…é¡»æä¾›éšç§æ¡ä¾‹ï¼Œ<a href="https://developer.apple.com/news/?id=08312018a" target="_blank" rel="noopener">å®˜æ–¹è¿æ¥</a>ã€‚</p><p>å¯¹äºéšç§æ¡ä¾‹ï¼Œè‹¹æœå®¡æ ¸æ¡ä¾‹æ˜¯è¿™ä¹ˆè¯´æ˜çš„ã€‚</p><p><img src="/images/QQ20181012-085839.png" alt="QQ20181012-085839"></p><p>éœ€è¦åœ¨ä¸¤ä¸ªåœ°æ–¹æä¾›éšç§æ¡ä¾‹ï¼š</p><ol><li>å…ƒæ•°æ®</li><li>åº”ç”¨å†…æœ‰æ˜æ˜¾çš„å…¥å£</li></ol><h2 id="ç”Ÿæˆéšç§æ¡ä¾‹"><a href="#ç”Ÿæˆéšç§æ¡ä¾‹" class="headerlink" title="ç”Ÿæˆéšç§æ¡ä¾‹"></a>ç”Ÿæˆéšç§æ¡ä¾‹</h2><p>å…³äºéšç§æ¡ä¾‹ï¼Œç½‘ä¸Šæœ‰å„ç§æ¨¡æ¿ï¼Œå¼„ä¸€ä¸ªæ”¹æ”¹å°±è¡Œäº†ï¼Œè¿™é‡Œæ¨èä¸€ä¸ª<a href="https://www.freeprivacypolicy.com" target="_blank" rel="noopener">è‡ªåŠ¨ç”Ÿæˆçš„ç½‘ç«™</a>ã€‚<br>å…è´¹ç”Ÿæˆï¼Œè¿˜æä¾›ä¸€ä¸ªé“¾æ¥ï¼ŒæŒ‚åœ¨å®ƒä»¬ç½‘ç«™ï¼Œå°±ä¸ç”¨è‡ªå·±ææœåŠ¡å™¨äº†ã€‚ä¾‹å¦‚<a href="https://www.freeprivacypolicy.com/privacy/view/cb2289ee81ec0d2f61ec1790bccf861d" target="_blank" rel="noopener">æˆ‘ç»™Appç”Ÿæˆçš„éšç§æ¡ä¾‹</a></p><p><img src="/images/QQ20181012-090746.png" alt="QQ20181012-090746"></p><h2 id="é›†æˆéšç§æ¡ä¾‹"><a href="#é›†æˆéšç§æ¡ä¾‹" class="headerlink" title="é›†æˆéšç§æ¡ä¾‹"></a>é›†æˆéšç§æ¡ä¾‹</h2><p>ç¬¬ä¸€æ­¥ï¼šæŠŠåˆšåˆšç”Ÿæˆçš„URLå¡«åœ¨å…ƒæ•°æ®é‡Œ</p><p><img src="/images/QQ20181012-091050.png" alt="QQ20181012-091050"></p><p>ç¬¬äºŒæ­¥ï¼šåœ¨åº”ç”¨å†…åŠ ä¸€ä¸ªé¡µé¢ï¼Œå¼€ä¸€ä¸ªWebViewåŠ è½½åˆšåˆšç”Ÿæˆçš„URLï¼Œä¾‹å¦‚æˆ‘å°±æ”¾åœ¨äº†â€œå…³äº-éšç§æ¡ä¾‹â€</p><p>ç¬¬ä¸‰æ­¥ï¼šæäº¤å®¡æ ¸æ—¶ï¼Œåœ¨å¤‡æ³¨é‡Œé¢è¯´æ˜ï¼Œéšç§æ¡ä¾‹çš„å…¥å£åœ¨å“ªé‡Œã€‚ï¼ˆè¿™ä¸€æ­¥å¯èƒ½ä¸è¦ä¹Ÿè¡Œï¼Œä¸è¿‡ä¸ºäº†ç¨³å¦¥æˆ‘åŠ ä¸Šäº†ï¼Œç»™è‹¹æœå®¡æ ¸å›¢é˜Ÿè®²æ¸…æ¥šæ€»æ˜¯å¥½çš„ï¼‰</p><p>ç¬¬äºŒå¤©å°±ä¸Šæ¶æˆåŠŸäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å›½åº†å‡æœŸå›æ¥å‡†å¤‡æäº¤æ–°ç‰ˆæœ¬åˆ°App Storeï¼Œé‡åˆ°è‹¹æœæ–°æ”¿ç­–ï¼Œå®æµ‹ä¸‹æ¥å½±å“ä¸å¤§ï¼Œåº”å¯¹è¿˜ç®—æ¯”è¾ƒç®€å•ï¼Œæ€»ç»“ä¸€ä¸‹åˆ†äº«ç»™å¤§å®¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ”¿ç­–è¯´æ˜&quot;&gt;&lt;a href=&quot;#æ”¿ç­–è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;æ”¿ç­–è¯´æ˜&quot;&gt;&lt;/a&gt;æ”¿ç­–è¯´æ˜&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®°â€œé¦™è•‰æ’­æ”¾å™¨â€ä¸Šæ¶çš„è¾›é…¸å†ç¨‹</title>
    <link href="https://crmo.github.io/2018/10/07/%E8%AE%B0%E2%80%9C%E9%A6%99%E8%95%89%E6%92%AD%E6%94%BE%E5%99%A8%E2%80%9D%E4%B8%8A%E6%9E%B6%E7%9A%84%E8%BE%9B%E9%85%B8%E5%8E%86%E7%A8%8B/"/>
    <id>https://crmo.github.io/2018/10/07/è®°â€œé¦™è•‰æ’­æ”¾å™¨â€ä¸Šæ¶çš„è¾›é…¸å†ç¨‹/</id>
    <published>2018-10-06T16:00:00.000Z</published>
    <updated>2018-10-07T08:50:30.398Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>å…ˆè¯´ç‚¹åºŸè¯ï¼Œä»äº‹iOSå¼€å‘ä»¥æ¥ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„APPä¸Šæ¶App Storeï¼Œå¹¶ä¸”ç™»ä¸Šè‹¹æœæ¨èæ¦œå•ï¼Œè¿™å¯èƒ½æ˜¯å¤§å¤šæ•°iOSerçš„æ¢¦æƒ³ã€‚åœ¨è„‘å­é‡Œäº§ç”Ÿäº†å„ç§æƒ³æ³•ï¼Œä½†æ˜¯å‘ç°è‡ªå·±èƒ½æƒ³åˆ°çš„åˆ«äººéƒ½åšäº†ï¼Œå¹¶ä¸”åšçš„å¾ˆå¥½ï¼ŒåŠ ä¸Šå·¥ä½œç”Ÿæ´»ä¸Šçš„å¾ˆå¤šäº‹æƒ…ï¼ˆä¸»è¦æ˜¯æ‡’ğŸ˜ï¼‰ï¼Œä¸€æ‹–å°±æ˜¯3å¹´ã€‚<br>åæ¥å› ä¸ºè‡ªå·±çš„çœŸå®éœ€æ±‚ï¼ŒApp Storeæ‰¾ä¸åˆ°èƒ½æ»¡è¶³éœ€æ±‚çš„äº§å“ï¼Œå°±åšäº†ä¸€ä¸ªæ’­æ”¾å™¨è‡ªå·±ç”¨ï¼Œåœ¨ä¸­ç§‹å‡æœŸç‹ ä¸‹å¿ƒæ¥ï¼Œä¹°äº†å¼€å‘è€…è´¦å·ï¼ˆ688ï¼Œå¿ƒç—›ï¼ï¼å°±å½“ä¸ºäº†æ¢¦æƒ³å……å€¼å§ã€‚ï¼‰ï¼ŒæŠŠè¿™ä¸ªæ’­æ”¾å™¨ä¸Šæ¶äº†ã€‚</p><h2 id="è´­ä¹°å¼€å‘è€…è´¦å·"><a href="#è´­ä¹°å¼€å‘è€…è´¦å·" class="headerlink" title="è´­ä¹°å¼€å‘è€…è´¦å·"></a>è´­ä¹°å¼€å‘è€…è´¦å·</h2><p>å…³äºæ€ä¹ˆä¹°ä¸ªäººå¼€å‘è€…è´¦å·ï¼Œç½‘ä¸Šçš„æ•™ç¨‹ä¸€æŠ“ä¸€å¤§æŠŠï¼Œæ•´ä¸ªè´­ä¹°æµç¨‹ä¹Ÿæ²¡å•¥å¥½æ³¨æ„çš„ï¼Œæ ¹æ®æç¤ºä¸€æ­¥ä¸€æ­¥èµ°å°±OKäº†ã€‚ä½†æ˜¯åˆ°äº†æœ€åä»˜æ¬¾ç¯èŠ‚æŠŠæˆ‘å¡äº†ä¸€å‘¨ï¼ˆåŠäº†ä¸¤å¼ ä¿¡ç”¨å¡ã€‚ã€‚ã€‚ï¼‰ï¼Œå¿…é¡»è¦<code>visa+é“¶è”</code>åŒæ ‡çš„ä¿¡ç”¨å¡ï¼Œæ³¨æ„ä¸€å®šè¦åŒæ ‡ï¼Œåªæœ‰visaæˆ–è€…åªæœ‰é“¶è”éƒ½ä¸è¡Œã€‚<br>ä»˜äº†æ¬¾ä¸€å¤©å·¦å³è‹¹æœå°±ä¼šå‘æ¥é‚®ä»¶ï¼Œæä¾›èº«ä»½è¯æ­£åé¢ç…§ç‰‡å°±å¯ä»¥äº†ã€‚</p><h2 id="ä¸Šæ¶App-Store"><a href="#ä¸Šæ¶App-Store" class="headerlink" title="ä¸Šæ¶App Store"></a>ä¸Šæ¶App Store</h2><p>ä¸Šæ¶æµç¨‹å°±è½»è½¦ç†Ÿè·¯äº†ï¼Œæ‰“åŒ…ä¸Šä¼ ã€å¡«å†™å„ç§APPè¯´æ˜ã€ä¸Šä¼ å›¾æ ‡ã€å®£ä¼ å›¾ã€æäº¤å®¡æ ¸ã€‚æ¿€åŠ¨çš„æˆ‘ä¸€æ™šä¸Šæ²¡ç¡å¥½è§‰ï¼Œç¬¬äºŒå¤©æ—©ä¸Šæ‰“å¼€é‚®ç®±ï¼Œç­‰å¾…æˆ‘çš„å±…ç„¶æ˜¯<code>2.1å¤§ç¤¼åŒ…</code>ï¼ˆGuideline 2.1 - Information Neededï¼‰ã€‚</p><p><img src="/images/WechatIMG59.png" alt="WechatIMG59"></p><p>ä¸€çœ‹æˆ‘å°±æ‡µé€¼äº†ï¼Œä¸Šæ¶è¿™ä¹ˆå¤šæ¬¡ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¹ˆä¸¥å‰çš„å›å¤ï¼Œæ„Ÿè§‰åˆ†åˆ†é’Ÿè¦è¢«å°å·ã€‚ç»è¿‡å¤šæ–¹å’¨è¯¢ï¼Œå‘ç°è¿™æ˜¯è‹¹æœä»Šå¹´æ–°æ¨å‡ºçš„å¤§ç¤¼åŒ…ï¼Œå¾ˆå¤šäººéƒ½é‡åˆ°è¿‡ï¼Œä¸€èˆ¬æ˜¯æœºå™¨å®¡æ ¸å›å¤çš„ï¼Œé‡åˆ°è¿™ç§æƒ…å†µåˆ«æ…Œï¼ˆé™¤éä½ æ˜¯é©¬ç”²åŒ…ã€æˆ–è€…æŠ„è¢­çš„ä¹‹ç±»çš„APPï¼‰ï¼Œä»”ç»†æ£€æŸ¥æ¡ä¾‹ï¼Œç„¶åé€æ¡ç­”å¤ï¼ˆæœ€å¥½ç”¨è‹±æ–‡ï¼‰ã€‚<br>æœ€åæˆ‘è¿˜å½•åˆ¶äº†ä¸€ä¸ªè§†é¢‘ï¼Œæ¥æ¼”ç¤ºæˆ‘çš„APPçš„ä¸»è¦åŠŸèƒ½ï¼Œä¸Šä¼ åˆ°<code>youtube</code>ï¼Œé™„åœ¨äº†å¤‡æ³¨ã€‚<br>åˆ†äº«ä¸‹æˆ‘çš„ç­”å¤æ¨¡æ¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">å°Šæ•¬çš„è‹¹æœå®¡æ ¸å›¢é˜Ÿï¼š</span><br><span class="line">    æ„Ÿè°¢æ‚¨çš„è€å¿ƒå®¡æ ¸ï¼Œé’ˆå¯¹ä¸‹é¢é—®é¢˜ï¼Œæˆ‘ä»¬åšäº†è¯¦ç»†çš„æ£€æŸ¥</span><br><span class="line">    </span><br><span class="line">å…³äº Guideline 2.1</span><br><span class="line"></span><br><span class="line">1.1.6 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åŒ…å«ä»»ä½•çš„è™šå‡ä¸è¯¯å¯¼ä¿¡æ¯ï¼Œå…¨éƒ¨éƒ½æ˜¯çœŸå®æœ‰æ•ˆçš„</span><br><span class="line">2.3.0 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åœ¨é€šè¿‡å®¡æ ¸åä¿®æ”¹ä»»ä½•æ¦‚å¿µå’ŒåŠŸèƒ½</span><br><span class="line">2.3.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åŒ…å«ä»»ä½•éšè—åŠŸèƒ½ï¼Œæ²¡æœ‰åŒ…å«èµŒåšã€å½©ç¥¨ç½‘ç«™</span><br><span class="line">3.1.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€å†…æ²¡æœ‰ä»»ä½•å†…è´­ã€æ”¯ä»˜åŠŸèƒ½ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯å…è´¹æä¾›ç»™ç”¨æˆ·</span><br><span class="line">3.2.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€å†…éƒ¨åŒ…å«ä»»ä½•è´·æ¬¾ç­‰é‡‘èæœåŠ¡</span><br><span class="line">4.3.0 - â€œé¦™è•‰æ’­æ”¾å™¨â€åŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹å¼€å‘ï¼Œä¸å­˜åœ¨æŠ„è¢­æˆ–è€…å¤§é‡ç›¸ä¼¼</span><br><span class="line">5.2.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰æ³•äººå®ä½“å’Œç‰ˆæƒé£é™©</span><br><span class="line">5.2.3 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰æä¾›æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œæˆ–è€…å…¶å®ƒå­˜åœ¨ç‰ˆæƒé—®é¢˜çš„éŸ³è§†é¢‘</span><br><span class="line">5.3.4 - â€œé¦™è•‰æ’­æ”¾å™¨â€ä»…åœ¨ä¸­å›½åŒºä¸Šæ¶ï¼Œæ²¡æœ‰è¿è§„å†…å®¹</span><br><span class="line"></span><br><span class="line">å…³äº Guideline 2.3.7</span><br><span class="line"></span><br><span class="line">æˆ‘å·²ç»æŒ‰ç…§è¯´æ˜ï¼Œä¿®æ”¹äº†å…ƒæ•°æ®ï¼Œè¯·å®¡æ ¸å›¢é˜Ÿå†æ¬¡å®¡æ ¸ã€‚</span><br><span class="line"></span><br><span class="line">æœ€åå†æ¬¡æ„Ÿè°¢æ‚¨è¾›è‹¦çš„å®¡æ ¸ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dear Apple Review Team:</span><br><span class="line">    Thank you for your patience review, we have done a detailed check on the following questions.</span><br><span class="line">    </span><br><span class="line">About Guideline 2.1</span><br><span class="line"></span><br><span class="line">1.1.6 - &quot;Banana Player&quot; does not contain any false and misleading information, all of which are true and effective</span><br><span class="line">2.3.0 - &quot;Banana Player&quot; does not modify any concepts and features after passing the review</span><br><span class="line">2.3.1 - &quot;Banana Player&quot; does not contain any hidden features, does not contain gambling, lottery sites</span><br><span class="line">3.1.1 - There is no in-app purchase and payment function in the â€œBanana Playerâ€, all functions are provided to the user free of charge.</span><br><span class="line">3.2.1 - &quot;Banana Player&quot; contains any financial services such as loans</span><br><span class="line">4.3.0 - The &quot;Banana Player&quot; feature is developed independently, without plagiarism or a lot of similarity</span><br><span class="line">5.2.1 - &quot;Banana Player&quot; has no legal entity and copyright risk</span><br><span class="line">5.2.3 - &quot;Banana Player&quot; does not provide file sharing services, or other audio and video with copyright issues</span><br><span class="line">5.3.4 - &quot;Banana Player&quot; is only available in China, no illegal content</span><br><span class="line"></span><br><span class="line">About Guideline 2.3.7</span><br><span class="line"></span><br><span class="line">I have modified the metadata according to the instructions, please review the team again.</span><br><span class="line"></span><br><span class="line">Finally, thank you again for your hard review.</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå¤©å®¡æ ¸é€šè¿‡ï¼ŒæˆåŠŸä¸Šæ¶ï¼</p><h2 id="æ‰“ä¸ªå¹¿å‘Š"><a href="#æ‰“ä¸ªå¹¿å‘Š" class="headerlink" title="æ‰“ä¸ªå¹¿å‘Š"></a>æ‰“ä¸ªå¹¿å‘Š</h2><blockquote><p>ä¸‹è½½ğŸ”—ï¼š<a href="https://dwz.cn/HvVix2hH" target="_blank" rel="noopener">https://dwz.cn/HvVix2hH</a></p></blockquote><p>â€œé¦™è•‰æ’­æ”¾å™¨â€æ˜¯æˆ‘ç‹¬ç«‹å¼€å‘çš„ç¬¬ä¸€æ¬¾APPï¼Œå…è´¹æ— å¹¿å‘Šã€‚ä¸»è¦åŠŸèƒ½åœ¨æ‰‹æœºä¸Šæ’­æ”¾ä»ç½‘ç›˜ã€å…‰ç›˜ã€ç½‘ç«™ä¸‹è½½çš„éŸ³é¢‘èµ„æ–™ã€è¯¾ç¨‹ã€éŸ³ä¹ã€‚æ— éœ€æ•°æ®çº¿ï¼Œç”¨Wi-Fiå°±å¯ä»¥æ‹·è´æ–‡ä»¶åˆ°æ‰‹æœºï¼Œè‡ªåŠ¨è®°å½•æ’­æ”¾è¿›åº¦ã€‚<br>å¦‚æœæœ‰éœ€æ±‚å¯ä»¥æ”¯æŒä¸€æ³¢ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿è”ç³»æˆ‘ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;å…ˆè¯´ç‚¹åºŸè¯ï¼Œä»äº‹iOSå¼€å‘ä»¥æ¥ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„APPä¸Šæ¶App Storeï¼Œå¹¶ä¸”ç™»ä¸Šè‹¹æœæ¨èæ¦œå•ï¼Œè¿™å¯èƒ½æ˜¯å¤§
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€ä¸ªè¡Œç»“æŸç¬¦å¼•å‘çš„JSæŠ¥é”™</title>
    <link href="https://crmo.github.io/2018/09/05/%E8%AE%B0%E4%B8%80%E4%B8%AA%E8%A1%8C%E7%BB%93%E6%9D%9F%E7%AC%A6%E5%BC%95%E5%8F%91%E7%9A%84JS%E6%8A%A5%E9%94%99/"/>
    <id>https://crmo.github.io/2018/09/05/è®°ä¸€ä¸ªè¡Œç»“æŸç¬¦å¼•å‘çš„JSæŠ¥é”™/</id>
    <published>2018-09-04T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.773Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªç¥å¥‡çš„Bugï¼Œé€šè¿‡<code>UIWebView</code>çš„<code>stringByEvaluatingJavaScriptFromString:</code>æ–¹æ³•æ‰§è¡Œä¸€æ®µ<code>JavaScript</code>ä»£ç æ—¶ï¼Œ<code>JavaScript</code>æŠ¥é”™:</p><blockquote><p>SyntaxError: Unexpected EOF</p></blockquote><p>ç»è¿‡ä»”ç»†çš„æ’æŸ¥ï¼Œå‘ç°å¾…æ‰§è¡Œçš„<code>JavaScript</code>ä»£ç é‡Œé¢åŒ…å«<code>U+2028</code>å­—ç¬¦ã€‚è¿˜æ‰¾åˆ°äº†<a href="https://stackoverflow.com/questions/2965293/javascript-parse-error-on-u2028-unicode-character" target="_blank" rel="noopener">Stack Overflowç›¸å…³è®¨è®º</a>ã€‚<br><code>JavaScript</code>è§£æå™¨ä¼šæŠŠè¡Œåˆ†éš”ç¬¦<code>U+2028</code>å’Œæ®µè½åˆ†éš”ç¬¦<code>U+2029</code>è§£ææˆä¸€è¡Œçš„ç»“æŸï¼Œä»£ç é‡Œè¦æ˜¯åŒ…å«è¿™ä¸¤ä¸ªå­—ç¬¦ç›¸å½“äºæ¢è¡Œï¼Œä¾‹å¦‚ï¼š</p><blockquote><p>alert(â€œ\u2028â€)</p></blockquote><p>å°±ä¼šè¢«è§£æä¸º</p><blockquote><p>alert(â€œ<br>â€œ)</p></blockquote><p>äºæ˜¯å°±äº§ç”Ÿäº†è¯­æ³•é”™è¯¯ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æˆ‘ç”¨çš„æ–¹æ³•æ¯”è¾ƒç®€å•ã€ç²—æš´ï¼Œåœ¨æ‰§è¡Œ<code>JavaScript</code>ä»£ç å‰ï¼Œç›´æ¥è¿‡æ»¤æ‰è¿™ä¸¤ä¸ªå­—ç¬¦ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line">    javaScriptString = [javaScriptString stringByReplacingOccurrencesOfString:<span class="string">@"\u2028"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    javaScriptString = [javaScriptString stringByReplacingOccurrencesOfString:<span class="string">@"\u2029"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    <span class="built_in">NSString</span>* ret = [(<span class="built_in">UIWebView</span>*)_engineWebView stringByEvaluatingJavaScriptFromString:javaScriptString];</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;æœ€è¿‘é‡åˆ°ä¸€ä¸ªç¥å¥‡çš„Bugï¼Œé€šè¿‡&lt;code&gt;UIWebView&lt;/code&gt;çš„&lt;code&gt;stringByEvaluating
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ä»ä¸€ä¸ªAFNetworkingå¾ªç¯å¼•ç”¨è¯´èµ·</title>
    <link href="https://crmo.github.io/2018/08/28/%E4%BB%8E%E4%B8%80%E4%B8%AAAFNetworking%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E8%AF%B4%E8%B5%B7/"/>
    <id>https://crmo.github.io/2018/08/28/ä»ä¸€ä¸ªAFNetworkingå¾ªç¯å¼•ç”¨è¯´èµ·/</id>
    <published>2018-08-27T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.791Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡åˆ†æä½¿ç”¨ä»£ç æ˜¯<a href="https://github.com/AFNetworking/AFNetworking/releases" target="_blank" rel="noopener">AFNetworking 3.2.1</a></p></blockquote><p>æœ€è¿‘ä½¿ç”¨<code>Instruments</code>ä¸­çš„<code>Leaks</code>åˆ†æé¡¹ç›®å†…å­˜æ³„éœ²ï¼Œå‘ç°äº†ä¸€ä¸ªAFNetworkingçš„å¾ªç¯å¼•ç”¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/15354171666142.jpg" alt="15354171666142"></p><p>é€šè¿‡è°ƒç”¨æ ˆå‘ç°äº§ç”Ÿæ³„éœ²çš„ä»£ç åœ¨è¿™é‡Œï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AFURLSessionManager.m</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithSessionConfiguration:(<span class="built_in">NSURLSessionConfiguration</span> *)configuration &#123;</span><br><span class="line">    <span class="comment">// ... åˆå§‹åŒ–ä»£ç ï¼Œçœç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¼è‡´å¾ªç¯å¼•ç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">self</span>.session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:<span class="keyword">self</span>.sessionConfiguration delegate:<span class="keyword">self</span> delegateQueue:<span class="keyword">self</span>.operationQueue];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... å…¶å®ƒåˆå§‹åŒ–ä»£ç ï¼Œçœç•¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§è‡´åŸå› å°±æ˜¯AFURLSessionManagerå¼•ç”¨NSURLSessionï¼ŒåŒæ—¶è®¾ç½®NSURLSessionçš„delegateä¸ºè‡ªå·±ï¼ŒNSURLSessionä¼šå¼ºå¼•ç”¨delegateï¼Œäºæ˜¯äº§ç”Ÿäº†å¾ªç¯å¼•ç”¨ã€‚</p><blockquote><p>å…³äºNSURLSessionçš„delegateå®˜æ–¹è¯´æ˜ï¼š<br>This delegate object is responsible for handling authentication challenges, for making caching decisions, and for handling other session-related events. The session object keeps a strong reference to this delegate until your app exits or explicitly invalidates the session. If you do not invalidate the session, your app leaks memory until it exits.</p></blockquote><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨AFNetworkingå®˜æ–¹issuesæ‰¾åˆ°äº†ç›¸å…³çš„é—®é¢˜<a href="https://github.com/AFNetworking/AFNetworking/issues/1528" target="_blank" rel="noopener">Possible memory leak in AFURLSessionManager</a>ã€‚ä½œè€…çš„å›ç­”å¦‚ä¸‹ï¼š</p><p><img src="/images/15353328585634.jpg" alt="15353328585634"></p><p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ol><li>è¿™æ˜¯æœ€å¸¸è§ä¹Ÿæ˜¯ä½œè€…æ¨èçš„æ–¹æ³•ï¼Œåªåˆ›å»ºä¸€ä¸ªAFURLSessionManagerï¼Œæ•´ä¸ªAPPå…±äº«ï¼Œè™½ç„¶è¿˜æ˜¯æœ‰å¾ªç¯å¼•ç”¨ï¼Œä½†æ˜¯å°±æ²¡æœ‰å†…å­˜æ³„éœ²çš„é—®é¢˜äº†ã€‚</li><li>å¦‚æœè¦ä½¿ç”¨å¤šä¸ªAFURLSessionManagerï¼Œåœ¨ä½¿ç”¨å®Œæˆåæ‰‹åŠ¨è°ƒç”¨<code>invalidateSessionCancelingTasks:</code>æ¥æ–­å¼€å¾ªç¯å¼•ç”¨ã€‚ï¼ˆè¿™ç§æ–¹æ¡ˆä¸æ¨èï¼Œå…·ä½“åŸå› çœ‹ä¸‹ä¸€å°èŠ‚ï¼‰</li></ol><h2 id="AFURLSessionManagerå¤ç”¨"><a href="#AFURLSessionManagerå¤ç”¨" class="headerlink" title="AFURLSessionManagerå¤ç”¨"></a>AFURLSessionManagerå¤ç”¨</h2><p>å…³äºAFURLSessionManageræ˜¯å¦ä½¿ç”¨å•ä¾‹è¿™ä¸ªé—®é¢˜ï¼Œå®˜æ–¹demoä½¿ç”¨çš„æ˜¯å•ä¾‹ï¼Œåœ¨è‹¹æœå®˜æ–¹æ–‡æ¡£æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µè¯</p><blockquote><p>With the NSURLSession API, your app creates one or more sessions, each of which coordinates a group of related data transfer tasks. For example, if youâ€™re creating a web browser, your app might create one session per tab or window, or one session for interactive use and another for background downloads. Within each session, your app adds a series of tasks, each of which represents a request for a specific URL (following HTTP redirects, if necessary).</p></blockquote><p>æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œæ ¹æ®ä½¿ç”¨åœºæ™¯çš„ä¸åŒï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸åŒçš„ç­”æ¡ˆï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹APPéƒ½æ˜¯åœ¨å’ŒåŒä¸€æœåŠ¡å™¨æ‰“äº¤é“ï¼Œä¸€ä¸ª<code>session</code>å°±å¤Ÿäº†ï¼Œå¦‚æœæœ‰è¿æ¥å¤šä¸ªæœåŠ¡å™¨ã€æˆ–è€…åå°ä¸‹è½½ç­‰åŠŸèƒ½éœ€æ±‚ï¼Œå¯ä»¥ç»™æ¯ä¸ªæœåŠ¡å™¨ã€åå°ä¸‹è½½ä»»åŠ¡åˆ›å»ºå•ç‹¬çš„<code>session</code>ï¼ˆä½†æ˜¯ä¹Ÿä¸èƒ½æ¯ä¸ªè¯·æ±‚éƒ½å•ç‹¬åˆ›å»ºsessionï¼‰ã€‚</p><p>åœ¨æŸ¥æ‰¾èµ„æ–™çš„æ—¶å€™ï¼Œæˆ‘å‘ç°æœ‰åšå®¢æåˆ°å•ä¾‹seesionå¯ä»¥å‡å°‘TCPä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŠ¨æ‰‹éªŒè¯ä¸‹ï¼š</p><p>å¤šä¸ªç½‘ç»œè¯·æ±‚å¤ç”¨ä¸€ä¸ª<code>AFURLSessionManager</code>ï¼Œè¿ç»­å‘ä¸¤ä¸ªç½‘ç»œè¯·æ±‚ï¼Œç”¨<code>Wireshark</code>æŠ“åŒ…å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡ç½‘ç»œè¯·æ±‚å¤ç”¨äº†ç¬¬ä¸€æ¬¡çš„TCPè¿æ¥ï¼Œæ²¡æœ‰åšä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p><img src="/images/15354191775340.jpg" alt="15354191775340"></p><p>ä¸‹å›¾æ˜¯æ¯æ¬¡ç½‘ç»œè¯·æ±‚éƒ½æ–°å»ºä¸€ä¸ª<code>AFURLSessionManager</code>çš„æŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªç½‘ç»œè¯·æ±‚éƒ½è¿›è¡Œäº†TCPä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p><img src="/images/15354193039698.jpg" alt="15354193039698"></p><p>å®éªŒç»“æœçš„ç¡®å¦‚ç½‘ä¸Šæ‰€è¯´ï¼Œå¤ç”¨<code>AFURLSessionManager</code>å¯ä»¥å‡å°‘ä¸‰æ¬¡æ¡æ‰‹ï¼Œæå‡æ•ˆç‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡åˆ†æä½¿ç”¨ä»£ç æ˜¯&lt;a href=&quot;https://github.com/AFNetworking/AFNetworking/releases&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;AFNetworking 3.2.1&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>iOSæ¨¡æ‹Ÿå™¨å®‰è£…debugåŒ…</title>
    <link href="https://crmo.github.io/2018/08/21/iOS%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85debug%E5%8C%85/"/>
    <id>https://crmo.github.io/2018/08/21/iOSæ¨¡æ‹Ÿå™¨å®‰è£…debugåŒ…/</id>
    <published>2018-08-20T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.803Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºé¡¹ç›®æ˜¯Hybridçš„å¹³å°ï¼Œæœ‰ç¬¬ä¸‰æ–¹äººå‘˜éœ€è¦åœ¨ä¸Šé¢å¼€å‘H5åº”ç”¨ï¼Œä½†æ˜¯releaseåŒ…ä¸èƒ½è°ƒè¯•H5ï¼Œåªæœ‰debugæŠ¥å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯é¡¹ç›®æºç ä¸èƒ½äº¤ç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨googleæœç´¢äº†ä¸‹ï¼Œå‘ç°ä¸€ç¯‡éœœç¥çš„<a href="https://juejin.im/post/57b01f298ac247005f0acb0a" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œè®²çš„æ˜¯debugåŒ…å¯ä»¥æ‹·è´åˆ°å…¶å®ƒæœºå™¨è¿è¡Œï¼Œäºæ˜¯å®è·µäº†ä¸€æ³¢ã€‚</p><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ul><li>Xcode</li><li>Command Line Tools</li><li>ios-sim</li></ul><blockquote><p>ios-simå®‰è£…å‘½ä»¤ï¼šnpm install ios-sim -g</p></blockquote><h2 id="æ‹·è´æœ¬åœ°çš„debugåŒ…"><a href="#æ‹·è´æœ¬åœ°çš„debugåŒ…" class="headerlink" title="æ‹·è´æœ¬åœ°çš„debugåŒ…"></a>æ‹·è´æœ¬åœ°çš„debugåŒ…</h2><ol><li>runä¸€æ¬¡éœ€è¦æ‹·è´çš„é¡¹ç›®ï¼Œå®‰è£…åˆ°æ¨¡æ‹Ÿå™¨ä¸Š</li></ol><ol><li>æ‰§è¡Œä¸‹é¢å‘½ä»¤è¡Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<code>ç›®æ ‡è·¯å¾„/xxx.zip</code>å°±æ˜¯æ‹·è´å‡ºæ¥çš„debugåº”ç”¨åŒ…ï¼Œéœ€è¦æ›¿æ¢ä¸ºè‡ªå·±çš„è·¯å¾„ï¼Œä¾‹å¦‚<code>/Users/crmo/Desktop/debug/debug.zip</code></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ditto -ck --sequesterRsrc --keepParent `ls -1 -d -t ~/Library/Developer/Xcode/DerivedData/*/Build/Products/*-iphonesimulator/*.app | head -n 1` ç›®æ ‡è·¯å¾„/xxx.zip</span><br></pre></td></tr></table></figure><h2 id="æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨"><a href="#æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨" class="headerlink" title="æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨"></a>æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨</h2><h3 id="1-è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨"><a href="#1-è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨" class="headerlink" title="1. è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨"></a>1. è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨</h3><blockquote><p>ios-sim showdevicetypes</p></blockquote><p>å¯ä»¥çœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºï¼Œå°±æ˜¯æœ¬æœºå¯ç”¨çš„æ¨¡æ‹Ÿå™¨ï¼Œé€‰æ‹©ä¸€ä¸ªéœ€è¦è¿è¡Œçš„æ¨¡æ‹Ÿå™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~ ios-sim showdevicetypes</span><br><span class="line">Apple-Watch-38mm, watchOS 4.3</span><br><span class="line">Apple-Watch-42mm, watchOS 4.3</span><br><span class="line">Apple-Watch-Series-2-38mm, watchOS 4.3</span><br><span class="line">Apple-Watch-Series-2-42mm, watchOS 4.3</span><br><span class="line">iPhone-7-Plus, 10.3</span><br><span class="line">iPhone-7-Plus, 11.4</span><br><span class="line">Apple-Watch-Series-3-38mm, watchOS 4.3</span><br><span class="line">Apple-Watch-Series-3-42mm, watchOS 4.3</span><br><span class="line">iPhone-5s, 11.4</span><br><span class="line">iPhone-6, 11.4</span><br><span class="line">iPhone-6-Plus, 11.4</span><br><span class="line">iPhone-6s, 11.4</span><br><span class="line">iPhone-6s-Plus, 11.4</span><br><span class="line">iPhone-7, 11.4</span><br><span class="line">iPhone-SE, 11.4</span><br><span class="line">iPad-Air, 11.4</span><br><span class="line">iPad-Air-2, 11.4</span><br><span class="line">iPhone-8, 11.4</span><br><span class="line">iPhone-8-Plus, 11.4</span><br><span class="line">iPhone-X, 11.4</span><br></pre></td></tr></table></figure><h3 id="2-åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…"><a href="#2-åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…" class="headerlink" title="2. åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…"></a>2. åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…</h3><blockquote><p>ios-sim launch åº”ç”¨åŒ…è·¯å¾„/xxx.app â€“devicetypeid æ¨¡æ‹Ÿå™¨</p></blockquote><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œdebug.zipè§£å‹åå°±å¯ä»¥å¾—åˆ°å¯¹åº”åº”ç”¨çš„.appæ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘çš„debugåŒ…æ”¾åœ¨<code>/Users/crmo/Desktop/debug/debug.app</code>ï¼Œæ¨¡æ‹Ÿå™¨é€‰æ‹©iPhone-8ï¼Œæœ€ç»ˆçš„å‘½ä»¤æ˜¯</p><blockquote><p>ios-sim launch /Users/crmo/Desktop/debug/debug.app â€“devicetypeid iPhone-8</p></blockquote><h2 id="simctl-was-not-foundé”™è¯¯è§£å†³"><a href="#simctl-was-not-foundé”™è¯¯è§£å†³" class="headerlink" title="simctl was not foundé”™è¯¯è§£å†³"></a>simctl was not foundé”™è¯¯è§£å†³</h2><p>åœ¨å®è·µæ—¶æµ‹è¯•æœºçš„<code>Command Line Tools</code>æ²¡æœ‰é…ç½®å¥½ï¼Œå‡ºç°æŠ¥é”™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">simctl was not found.</span><br><span class="line">Check that you have Xcode 8.x installed:</span><br><span class="line">xcodebuild --versionCheck that you have Xcode 8.x selected:</span><br><span class="line">xcode-select --print-path</span><br></pre></td></tr></table></figure><p><strong>è§£å†³åŠæ³•ï¼š</strong></p><p>1.é¦–å…ˆç¡®ä¿æ­£ç¡®å®‰è£…äº†Command Line Toolsï¼Œ</p><blockquote><p>å¸è½½Command Line Tools:rm -rf /Library/Developer/CommandLineTools<br>å®‰è£…Command Line Tools:xcode-select â€“install</p></blockquote><p>2.åœ¨xcodeé…ç½®ä¸€ä¸‹Command Line Toolsï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/images/15348328228775.jpg" alt="15348328228775"></p><hr><p>å‚è€ƒåšå®¢ï¼š</p><ul><li><a href="http://www.hudongdong.com/bug/772.html" target="_blank" rel="noopener">unable to find utility â€œsimctlâ€çš„è§£å†³æ–¹æ¡ˆ</a></li><li><a href="https://juejin.im/post/57b01f298ac247005f0acb0a" target="_blank" rel="noopener">ç»™ iOS æ¨¡æ‹Ÿå™¨ â€œå®‰è£…â€app æ–‡ä»¶</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç”±äºé¡¹ç›®æ˜¯Hybridçš„å¹³å°ï¼Œæœ‰ç¬¬ä¸‰æ–¹äººå‘˜éœ€è¦åœ¨ä¸Šé¢å¼€å‘H5åº”ç”¨ï¼Œä½†æ˜¯releaseåŒ…ä¸èƒ½è°ƒè¯•H5ï¼Œåªæœ‰debugæŠ¥å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯é¡¹ç›®æºç ä¸èƒ½äº¤ç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨googleæœç´¢äº†ä¸‹ï¼Œå‘ç°ä¸€ç¯‡éœœç¥çš„&lt;a href=&quot;https://juejin.im/post/57b01f298
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>dispatch_syncæ­»é”é—®é¢˜</title>
    <link href="https://crmo.github.io/2018/08/03/dispatch_sync%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98/"/>
    <id>https://crmo.github.io/2018/08/03/dispatch_syncæ­»é”é—®é¢˜/</id>
    <published>2018-08-02T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.816Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>ä½¿ç”¨<code>dispatch_sync</code>çš„æ—¶å€™è¦å°å¿ƒè°¨æ…ï¼Œç¨ä¸æ³¨æ„å°±ä¼šå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå…ˆçœ‹ä¸¤ä¸ªå…¸å‹çš„æ¡ˆä¾‹ï¼š</p><p>æ¡ˆä¾‹ä¸€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)deadlock1 &#123;</span><br><span class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_sync(queue, ^&#123;</span><br><span class="line">        dispatch_sync(queue, ^&#123;</span><br><span class="line">            NSLog(@&quot;&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¡ˆä¾‹äºŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (void)deadlock2 &#123;</span><br><span class="line">    dispatch_queue_t queue1 = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_queue_t queue2 = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_sync(queue1, ^&#123;</span><br><span class="line">        dispatch_sync(queue2, ^&#123;</span><br><span class="line">            dispatch_sync(queue1, ^&#123;</span><br><span class="line">                NSLog(@&quot;&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤ä¸ªæ¡ˆä¾‹æ­»é”çš„åŸå› éƒ½æ˜¯åŒä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—çš„ä»»åŠ¡ç›¸äº’ç­‰å¾…ã€‚ å½“ç„¶å®é™…å·¥ç¨‹ä¸­é‡åˆ°çš„æ­»é”é—®é¢˜ä¼šæ›´åŠ å¤æ‚ï¼Œéš¾ä»¥åˆ†æã€‚</p><h2 id="å…¸å‹è¯¯åŒº"><a href="#å…¸å‹è¯¯åŒº" class="headerlink" title="å…¸å‹è¯¯åŒº"></a>å…¸å‹è¯¯åŒº</h2><p>åœ¨é˜…è¯»ç›¸å…³ä¹¦ç±ã€åšå®¢éƒ½æåˆ°äº†ä¸€ä¸ªæ–¹æ³•<code>dispatch_get_current_queue()</code>ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°å½“å‰é˜Ÿåˆ—ï¼Œäºæ˜¯æœ‰äººå°±ç”¨å®ƒæ¥è§£å†³æ­»é”é—®é¢˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (void)safeSync:(void(^)())block &#123;</span><br><span class="line">    if (!block) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (dispatch_get_current_queue() == queue) &#123;</span><br><span class="line">        block();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        dispatch_sync(queue, ^&#123;</span><br><span class="line">            block();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€çœ¼çœ‹èµ·æ¥å¤©è¡£æ— ç¼ï¼Œå¯¹äºæ¡ˆä¾‹ä¸€çš„ç¡®å¯ä»¥å®Œç¾è§£å†³ï¼Œä½†æ˜¯å¯¹äºæ¡ˆä¾‹äºŒè¿™ç§å¯¹é˜Ÿåˆ—çš„æƒ…å†µå°±åˆ¤æ–­ä¸äº†ã€‚éš¾æ€ªè‹¹æœåœ¨iOS6å°±æ³¨é‡Šäº†è¿™ä¸ªæ–¹æ³•ã€‚</p><hr><p>æ¨èé˜…è¯»ï¼š</p><p><a href="https://www.objc.io/issues/2-concurrency/thread-safe-class-design/#pitfalls-of-gcd" target="_blank" rel="noopener">Thread-Safe Class Design</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜åˆ†æ&quot;&gt;&lt;a href=&quot;#é—®é¢˜åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜åˆ†æ&quot;&gt;&lt;/a&gt;é—®é¢˜åˆ†æ&lt;/h2&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;dispatch_sync&lt;/code&gt;çš„æ—¶å€™è¦å°å¿ƒè°¨æ…ï¼Œç¨ä¸æ³¨æ„å°±ä¼šå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå…ˆçœ‹ä¸¤ä¸ªå…¸å‹çš„æ¡ˆä¾‹ï¼š&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>UIWebViewè·å–è¯¦ç»†æµè§ˆè®°å½•</title>
    <link href="https://crmo.github.io/2018/08/01/UIWebView%E8%8E%B7%E5%8F%96history/"/>
    <id>https://crmo.github.io/2018/08/01/UIWebViewè·å–history/</id>
    <published>2018-07-31T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.824Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ‰€ç”¨æ–¹æ³•ä¼šä½¿ç”¨åˆ°è‹¹æœç§æœ‰APIï¼Œä¸Šæ¶APP Storeè¯·è°¨æ…ä½¿ç”¨ã€‚</p></blockquote><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>è·å–<code>UIWebView</code>çš„å‰è¿›åé€€çš„æµè§ˆè®°å½•ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä»A-&gt;B-&gt;C-&gt;Bï¼Œæ­¤æ—¶Bä¸Šä¸€é¡µæ˜¯Aï¼Œä¸‹ä¸€é¡µæ˜¯Cï¼Œéœ€è¦è·å–Aã€Cçš„URLä¿¡æ¯ã€‚</p><blockquote><p>WKWebViewæš´éœ²äº†è¿™ä¸ªå±æ€§ï¼Œ<code>WKBackForwardList *backForwardList</code>ã€‚å¯ä»¥å¾ˆå®¹æ˜“çš„å–åˆ°ï¼Œæ— å¥ˆé¡¹ç›®è¿˜æ˜¯ä½¿ç”¨çš„<code>UIWebView</code>ï¼Œäºæ˜¯æœ‰äº†åé¢çš„æ¢ç´¢ã€‚</p></blockquote><p>é¦–å…ˆåœ¨<code>UIWebView</code>æä¾›çš„APIé‡Œæ‰¾ï¼Œç›¸å…³çš„APIåªæœ‰<code>canGoBack</code>å’Œ<code>canGoForward</code>ï¼Œå‘½åå¾ˆç›´è§‚ï¼Œæ˜¯å¦å¯ä»¥åé€€å’Œå‰è¿›ï¼Œè¿™æ¡è·¯èµ°ä¸é€šã€‚<br>æƒ³åˆ°æ˜¯å¦å¯ä»¥é€šè¿‡JSçš„Window.historyè·å–åˆ°ï¼ŒæŸ¥äº†ä¸‹APIï¼Œå”¯ä¸€ä¸€ä¸ªæœ‰ç‚¹åƒçš„<code>length</code>å±æ€§ï¼Œæ™ºèƒ½å–åˆ°æµè§ˆè®°å½•ä¸­çš„æ‰€æœ‰URLçš„æ•°é‡ï¼Œä¸åŒºåˆ†å‰åï¼Œæ¯”å¦‚åœ¨ä¸Šé¢æåˆ°çš„ä¾‹å­ä¸­ï¼Œåœ¨Bé¡µé¢å–åˆ°çš„<code>length</code>æ˜¯3ï¼Œè€Œä¸”ä¸èƒ½å–å‡ºå…·ä½“çš„URLã€‚</p><p><img src="/images/15325235986699.jpg" alt="15325235986699"></p><p>æ— å¥ˆåªæœ‰ä¸Šæºç äº†ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯<a href="https://opensource.apple.com/release/ios-110.html" target="_blank" rel="noopener">â€œWebKit-7604.1.38.0.7â€å’Œâ€œWebCore-7604.1.38.0.7â€</a>ã€‚</p><h2 id="Window-History-lengthå®ç°æœ¬è´¨"><a href="#Window-History-lengthå®ç°æœ¬è´¨" class="headerlink" title="Window.History.lengthå®ç°æœ¬è´¨"></a>Window.History.lengthå®ç°æœ¬è´¨</h2><p>åœ¨WebCoreé‡Œé¢æ‰¾åˆ°äº†JSæ–¹æ³•<code>Window.History.length</code>å®ç°çš„æœ¬è´¨ï¼Œä¸Šä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebCore History.cpp</span></span><br><span class="line"><span class="keyword">unsigned</span> History::length() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!m_frame)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">auto</span>* page = m_frame-&gt;page();</span><br><span class="line">    <span class="keyword">if</span> (!page)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> page-&gt;backForward().count();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebCore BackForwardController.cpp</span></span><br><span class="line"><span class="keyword">int</span> BackForwardController::count() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// count = å½“å‰é¡µä¹‹å‰çš„é¡µé¢æ€»æ•° + å½“å‰é¡µä¹‹åçš„é¡µé¢æ€»æ•° + 1</span></span><br><span class="line">    <span class="keyword">return</span> m_client-&gt;backListCount() + <span class="number">1</span> + m_client-&gt;forwardListCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>WebCore</code>é‡Œé¢<code>backListCount()</code>ã€<code>forwardListCount()</code>å®šä¹‰æ˜¯è™šå‡½æ•°ï¼Œå…·ä½“å®ç°åœ¨<code>WebKit</code>å¯ä»¥æ‰¾åˆ°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebKit BackForwardList.mm</span></span><br><span class="line"><span class="keyword">int</span> BackForwardList::backListCount()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> m_current == NoCurrentItemIndex ? <span class="number">0</span> : m_current;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> BackForwardList::forwardListCount()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> m_current == NoCurrentItemIndex ? <span class="number">0</span> : (<span class="keyword">int</span>)m_entries.size() - (m_current + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸‹ï¼Œåé¢ä¼šç”¨åˆ°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebKit BackForwardList.mm</span></span><br><span class="line"><span class="comment">// è·å–ä¹‹å‰æœ€å¤šå‡ æ¡å†å²è®°å½•</span></span><br><span class="line"><span class="keyword">void</span> BackForwardList::backListWithLimit(<span class="keyword">int</span> limit, Vector&lt;Ref&lt;HistoryItem&gt;&gt;&amp; <span class="built_in">list</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">list</span>.clear();</span><br><span class="line">    <span class="keyword">if</span> (m_current != NoCurrentItemIndex) &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> first = <span class="built_in">std</span>::max(<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(m_current) - limit, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (; first &lt; m_current; ++first)</span><br><span class="line">            <span class="built_in">list</span>.append(m_entries[first].get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è·å–History"><a href="#è·å–History" class="headerlink" title="è·å–History"></a>è·å–History</h2><p>åœ¨<code>WebView</code>çš„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°<code>WebBackForwardList</code>çš„å®šä¹‰ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment">    @property backForwardList</span></span><br><span class="line"><span class="comment">    @abstract The backforward list for this WebView.</span></span><br><span class="line"><span class="comment">*/</span>    </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">strong</span>) WebBackForwardList *backForwardList;</span><br></pre></td></tr></table></figure><p><code>WebBackForwardList</code>æ˜¯å¯¹<code>BackForwardList</code>çš„ä¸€å±‚å°è£…ï¼Œé˜…è¯»ä¸€ä¸‹å®ƒçš„.hæ–‡ä»¶ï¼Œä¸éš¾æ‰¾åˆ°è·å–æµè§ˆè®°å½•çš„æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line">    @method backListWithLimit:</span><br><span class="line">    @abstract Returns a portion of the list before the current entry.</span><br><span class="line">    @param limit A cap on the size of the array returned.</span><br><span class="line">    @result An array of items before the current entry, or nil if there are none.  The entries are in the order that they were originally visited.</span><br><span class="line">*/</span><br><span class="line">- (NSArray *)backListWithLimit:(int)limit;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•å¯ä»¥è·å–åˆ°ä¸€ä¸ª<code>WebHistoryItem</code>æ•°ç»„ï¼Œ<code>WebHistoryItem</code>ä¿å­˜äº†æµè§ˆè®°å½•çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h2 id="è·å–WebBackForwardList"><a href="#è·å–WebBackForwardList" class="headerlink" title="è·å–WebBackForwardList"></a>è·å–WebBackForwardList</h2><p><code>UIWebView</code>æ²¡æœ‰æš´éœ²è·å–<code>WebView</code>æˆ–è€…<code>WebBackForwardList</code>çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨KVOæ›²çº¿æ•‘å›½ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°<code>WebView</code>çš„ç§æœ‰å˜é‡åã€‚ç”¨runtimeå¯ä»¥åšåˆ°ï¼Œä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘å†™äº†ä¸€ä¸ªå·¥å…·ç±»æ¥è¾…åŠ©æœç´¢ï¼Œå…·ä½“å¯ä»¥çœ‹<a href="https://crmo.github.io/2018/07/31/runtimeå®ç°ç§æœ‰å˜é‡æœç´¢/">è¿™ç¯‡æ–‡ç« -runtimeå®ç°ç§æœ‰å˜é‡æœç´¢</a>ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”¨runtimeè·å–ç±»æˆå‘˜å˜é‡åˆ—è¡¨ï¼Œç„¶åç”¨BFSæ¥æœç´¢æˆ‘ä»¬è¦æ‰¾çš„ç±»ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥UIWebViewä¸ºæ ¹èŠ‚ç‚¹ï¼ŒBFSæœç´¢WebView</span></span><br><span class="line">[BFSSearchClass searchClass:<span class="string">@"WebView"</span> inClass:<span class="string">@"UIWebView"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœç´¢ç»“æœå¦‚ä¸‹</span></span><br><span class="line"><span class="comment">// Class Nameï¼šç±»åï¼ŒIvar Nameï¼šå˜é‡åï¼ŒSuper Classï¼šçˆ¶ç±»</span></span><br><span class="line">Class Name:ã€WebViewã€‘,Ivar Name:ã€_webViewã€‘</span><br><span class="line">Class Name:ã€<span class="built_in">UIWebDocumentView</span>ã€‘,Ivar Name:ã€Super Classã€‘</span><br><span class="line">Class Name:ã€<span class="built_in">UIWebBrowserView</span>ã€‘,Ivar Name:ã€browserViewã€‘</span><br><span class="line">Class Name:ã€<span class="built_in">UIWebViewInternal</span>ã€‘,Ivar Name:ã€_internalã€‘</span><br><span class="line">Root Class:<span class="built_in">UIWebView</span></span><br></pre></td></tr></table></figure><p>æœ‰äº†ä¸Šé¢çš„ç»“è®ºï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨KVCæ¥è·å–åˆ°æµè§ˆè®°å½•äº†ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)printWebViewHistory:(<span class="built_in">UIWebView</span> *)aWebView &#123;</span><br><span class="line">    <span class="keyword">id</span> webviewInternal = [aWebView valueForKey:<span class="string">@"_internal"</span>];</span><br><span class="line">    <span class="keyword">id</span> browserView = [webviewInternal valueForKey:<span class="string">@"browserView"</span>];</span><br><span class="line">    <span class="keyword">id</span> webView = [browserView valueForKey:<span class="string">@"_webView"</span>];</span><br><span class="line">    <span class="keyword">id</span> backForwardList = [webView performSelector:<span class="keyword">@selector</span>(backForwardList)];</span><br><span class="line">    <span class="comment">// WebHistoryItemå­˜å‚¨çš„å…·ä½“æŸæ¡æµè§ˆè®°å½•ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">NSArray</span> *historyItems = [backForwardList performSelector:<span class="keyword">@selector</span>(backListWithLimit:) withObject:@<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">id</span> item <span class="keyword">in</span> historyItems) &#123;</span><br><span class="line">        <span class="comment">// è·å–æµè§ˆè®°å½•çš„url </span></span><br><span class="line">        <span class="built_in">NSString</span> *url = [item performSelector:<span class="keyword">@selector</span>(URLString)];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ‰€ç”¨æ–¹æ³•ä¼šä½¿ç”¨åˆ°è‹¹æœç§æœ‰APIï¼Œä¸Šæ¶APP Storeè¯·è°¨æ…ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;éœ€æ±‚&quot;&gt;&lt;a href=&quot;#éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;éœ€æ±‚&quot;&gt;&lt;/a&gt;éœ€æ±‚&lt;/h2&gt;&lt;p&gt;
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>runtimeå®ç°ç§æœ‰å˜é‡æœç´¢</title>
    <link href="https://crmo.github.io/2018/07/31/runtime%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F%E6%90%9C%E7%B4%A2/"/>
    <id>https://crmo.github.io/2018/07/31/runtimeå®ç°ç§æœ‰å˜é‡æœç´¢/</id>
    <published>2018-07-30T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.834Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡Demo(<a href="https://github.com/crmo/BFSSearchClass)åœ°å€" target="_blank" rel="noopener">https://github.com/crmo/BFSSearchClass)åœ°å€</a></p></blockquote><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>åœ¨å¼€å‘åŠŸèƒ½æ—¶ï¼Œä¸ºäº†æ»¡è¶³äº§å“å˜æ€çš„éœ€æ±‚ï¼Œéš¾å…æœ‰ç³»ç»Ÿç±»æä¾›çš„APIä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œè¿™æ—¶å€™ç§æœ‰å˜é‡å°±å¯ä»¥å‘æŒ¥å®ƒå…‰å’Œçƒ­äº†ã€‚æ€ä¹ˆé€šè¿‡ä¸€ä¸ªç±»ï¼Œä¸€å±‚ä¸€å±‚çš„æ‰¾åˆ°ç‰¹å®šç±»å‹çš„ç§æœ‰æˆå‘˜å˜é‡ï¼Ÿ<br>å—ç›ŠäºObjective-Cçš„åŠ¨æ€è¯­è¨€ç‰¹æ€§ï¼Œå°±ç®—è‹¹æœ<code>UIKit</code>ä¸å¼€æºï¼Œä½†æ˜¯åœ¨runtimeé¢å‰ï¼Œç±»çš„ç»“æ„è¿˜æ˜¯æš´éœ²æ— é—ã€‚æˆ‘çš„æ€è·¯æ˜¯é€å±‚æ‰‹åŠ¨æ‰“å°æˆå‘˜å˜é‡ä¿¡æ¯ï¼Œå¦‚æœæ˜¯UIæ§ä»¶å¯ä»¥ç”¨Revealæ¥åŠ å¿«è¿›åº¦ï¼Œé…åˆKVCæœºåˆ¶ï¼Œè·å–ç§æœ‰å˜é‡å°±å¦‚åŒæ¢å›Šå–ç‰©ä¸€èˆ¬ã€‚<br>åœ¨å¤šæ¬¡é‡åˆ°è¿™ä¸ªé—®é¢˜åï¼Œæˆ‘å†³å®šå®ç°ä¸€ä¸ªå·¥å…·ç±»æ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæ¯•ç«Ÿèƒ½è‡ªåŠ¨åŒ–çš„å°±å°½é‡ä¸è¦æ‰‹åŠ¨ã€‚</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><blockquote><p>æœç´¢èŒƒå›´ï¼šæˆå‘˜å˜é‡ã€å±æ€§</p></blockquote><p>å…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>runtimeä¸­çš„æ–¹æ³•<code>class_copyIvarList()</code>ï¼Œå¯ä»¥å–å‡ºç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ç»“æ„ä½“<code>Ivar</code>ã€‚</li><li>ä»Ivarä¸­å¯ä»¥å–å‡ºæˆå‘˜å˜é‡ç±»å‹<code>Type Encodings</code></li><li>ç”¨<code>Type Encodings</code>è·å–åˆ°ç±»å</li><li>éå†ç±»çš„æ‰€æœ‰<code>Ivar</code>ï¼Œè·å–åˆ°ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡çš„ç±»ä¿¡æ¯</li></ol><p>ä½†æ˜¯é—®é¢˜æ²¡è¿™ä¹ˆç®€å•ï¼Œæ¯”å¦‚ClassAæ˜¯ClassBçš„æˆå‘˜å˜é‡ï¼ŒClassBæ˜¯ClassCçš„æˆå‘˜å˜é‡ï¼Œæƒ³é€šè¿‡ClassCæ‰¾åˆ°ClassAï¼Œéœ€è¦å‘ä¸‹æ‰¾ä¸¤å±‚æ‰èƒ½æ‰¾åˆ°ï¼Œè¿˜è¦è€ƒè™‘çˆ¶ç±»çš„æƒ…å†µã€‚<br>æ•´ä¸ªæœç´¢è¿‡ç¨‹å°±æ˜¯ä¸€é¢—ä»¥å¾…æœç´¢ç±»ä¸ºæ ¹çš„æ ‘ï¼Œå¯ä»¥ç”¨BFSæ¥æœç´¢ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼ˆå¦‚å›¾ï¼Œæ•°å­—æ˜¯æœç´¢é¡ºåºï¼‰ï¼š</p><ol><li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹æœç´¢</li><li>é¦–å…ˆéå†å½“å‰èŠ‚ç‚¹çš„çˆ¶ç±»ï¼ŒåŠ å…¥æœç´¢é˜Ÿåˆ—</li><li>å†å–å‡ºå½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼ŒåŠ å…¥æœç´¢é˜Ÿåˆ—</li></ol><p><img src="/images/QQ20180731-202956@2x.png" alt="QQ20180731-202956@2x"></p><h2 id="å¦‚ä½•ä»Ivarä¸­è·å–Class"><a href="#å¦‚ä½•ä»Ivarä¸­è·å–Class" class="headerlink" title="å¦‚ä½•ä»Ivarä¸­è·å–Class"></a>å¦‚ä½•ä»Ivarä¸­è·å–Class</h2><p>Ivarä¸­ä¸èƒ½ç›´æ¥å–å‡ºå¯¹åº”ç±»åï¼Œåªèƒ½å–å‡º<code>Type Encodings</code>ï¼Œé—´æ¥å¯ä»¥å¾—åˆ°ç±»åã€‚ä»<a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>æˆªäº†å¼ å›¾ï¼Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°Codeçš„å®šä¹‰ã€‚</p><p><img src="/images/15329163411347.jpg" alt="15329163411347"></p><p>åŸºæœ¬æ•°æ®ç±»å‹ã€idç±»å‹ã€é›†åˆç±»å‹ã€ç»“æ„ä½“ç­‰ç±»å‹å°±ä¸éœ€è¦æœç´¢äº†ï¼Œå¯ä»¥è¿‡æ»¤æ‰ã€‚æˆ‘ä»¬åªæœç´¢ä¸¤ç§ç±»å‹</p><ol><li>ç±»ï¼Œä¾‹å¦‚<code>@&quot;UIWebViewInternal&quot;</code></li><li>ä»£ç†ï¼Œä¾‹å¦‚<code>@&quot;&lt;UIViewControllerTransitioningDelegate&gt;&quot;</code></li></ol><h2 id="ä¼˜åŒ–åŠå­˜åœ¨é—®é¢˜"><a href="#ä¼˜åŒ–åŠå­˜åœ¨é—®é¢˜" class="headerlink" title="ä¼˜åŒ–åŠå­˜åœ¨é—®é¢˜"></a>ä¼˜åŒ–åŠå­˜åœ¨é—®é¢˜</h2><ol><li>å¯ä»¥ç”¨ä¸€ä¸ª<code>NSMutableSet</code>å­˜å‚¨å·²ç»æœç´¢è¿‡çš„ç±»ï¼Œæ¯æ¬¡æœç´¢å‰åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å·²ç»æœç´¢è¿‡</li><li>è®°å½•æœç´¢æ¬¡æ•°ï¼Œå¯ä»¥é™åˆ¶æœç´¢æ¬¡æ•°ã€‚</li><li>å¯¹äºå®šä¹‰ä¸ºidç±»å‹ã€é›†åˆç±»çš„æˆå‘˜å˜é‡æ²¡æœ‰åšå¤„ç†ï¼Œå¯ä»¥ç»§ç»­æ·±å…¥éå†</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡Demo(&lt;a href=&quot;https://github.com/crmo/BFSSearchClass)åœ°å€&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/crmo/BFSSearchC
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>iOSæ¨ªç«–å±æ€»ç»“</title>
    <link href="https://crmo.github.io/2018/07/23/iOS%E6%A8%AA%E7%AB%96%E5%B1%8F%E6%80%BB%E7%BB%93/"/>
    <id>https://crmo.github.io/2018/07/23/iOSæ¨ªç«–å±æ€»ç»“/</id>
    <published>2018-07-22T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.843Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨<code>Auto Layout</code>æ¥è¿›è¡Œå¸ƒå±€å°±ä¸ç”¨è‡ªå·±å»ç›‘å¬æ¨ªç«–å±äº‹ä»¶äº†ï¼Œåªéœ€è¦ç»˜åˆ¶å¤šå¥—å¸ƒå±€å³å¯ã€‚ä½†æ˜¯é¡¹ç›®æœ‰å¾ˆå¤šé¡µé¢æ˜¯è‡ªå·±æ‰‹åŠ¨è®¡ç®—çš„ï¼Œäºæ˜¯åªæœ‰æƒ³åŠæ³•å†æ—‹è½¬å±å¹•æ—¶é‡æ–°å¸ƒå±€ã€‚</p><h2 id="ç›¸å…³æšä¸¾"><a href="#ç›¸å…³æšä¸¾" class="headerlink" title="ç›¸å…³æšä¸¾"></a>ç›¸å…³æšä¸¾</h2><p>å±å¹•æ–¹å‘æœ‰3ä¸ªç›¸å…³æšä¸¾ï¼Œç•Œé¢æ–¹å‘<code>UIInterfaceOrientation</code>ï¼Œè®¾å¤‡æ–¹å‘<code>UIDeviceOrientation</code>ï¼Œæ”¯æŒæ—‹è½¬æ–¹å‘<code>UIInterfaceOrientationMask</code>ã€‚</p><blockquote><p>æ³¨æ„UIInterfaceOrientationä¸UIDeviceOrientationå·¦å³æ–¹å‘æ˜¯ç›¸åçš„</p></blockquote><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">UIInterfaceOrientation</span>) &#123;</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationUnknown</span>            = <span class="built_in">UIDeviceOrientationUnknown</span>,</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationPortrait</span>           = <span class="built_in">UIDeviceOrientationPortrait</span>,</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationPortraitUpsideDown</span> = <span class="built_in">UIDeviceOrientationPortraitUpsideDown</span>,</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationLandscapeLeft</span>      = <span class="built_in">UIDeviceOrientationLandscapeRight</span>,</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationLandscapeRight</span>     = <span class="built_in">UIDeviceOrientationLandscapeLeft</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, <span class="built_in">UIInterfaceOrientationMask</span>) &#123;</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskPortrait</span> = (<span class="number">1</span> &lt;&lt; <span class="built_in">UIInterfaceOrientationPortrait</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> = (<span class="number">1</span> &lt;&lt; <span class="built_in">UIInterfaceOrientationLandscapeLeft</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskLandscapeRight</span> = (<span class="number">1</span> &lt;&lt; <span class="built_in">UIInterfaceOrientationLandscapeRight</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskPortraitUpsideDown</span> = (<span class="number">1</span> &lt;&lt; <span class="built_in">UIInterfaceOrientationPortraitUpsideDown</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskLandscape</span> = (<span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeRight</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskAll</span> = (<span class="built_in">UIInterfaceOrientationMaskPortrait</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeRight</span> | <span class="built_in">UIInterfaceOrientationMaskPortraitUpsideDown</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskAllButUpsideDown</span> = (<span class="built_in">UIInterfaceOrientationMaskPortrait</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeRight</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ¨ªç«–å±æ§åˆ¶"><a href="#æ¨ªç«–å±æ§åˆ¶" class="headerlink" title="æ¨ªç«–å±æ§åˆ¶"></a>æ¨ªç«–å±æ§åˆ¶</h2><p>æ§åˆ¶ç•Œé¢æ¨ªç«–å±åˆ‡æ¢æœ‰3ä¸ªé‡è¦çš„ç‚¹ï¼Œæœ€ç»ˆç»“æœä»¥è¿™ä¸‰ä¸ªåœ°æ–¹çš„å€¼å–äº¤é›†ã€‚</p><p><strong>1.info.plistå…¨å±€æ§åˆ¶</strong></p><p>å¯ä»¥åœ¨<code>General-&gt;Deplyment Info</code>ç•Œé¢ä¸Šå‹¾é€‰</p><p><img src="/images/15320065885480.jpg" alt="15320065885480"></p><p> info.plistæ–‡ä»¶ä¸­é…ç½®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸¤è¾¹ä¼šåŒæ­¥å˜æ›´</p><p><img src="/images/15320512384395.jpg" alt="15320512384395"></p><p><strong>2.AppDelegateä¸­æ ¹æ®ä¸åŒWindowæ§åˆ¶</strong></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDelegate</span></span><br><span class="line">- (<span class="built_in">UIInterfaceOrientationMask</span>)application:(<span class="built_in">UIApplication</span> *)application supportedInterfaceOrientationsForWindow:(<span class="built_in">UIWindow</span> *)window &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> | <span class="built_in">UIInterfaceOrientationMaskPortrait</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.åœ¨ViewControllerä¸­æ§åˆ¶å½“å‰é¡µé¢</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// UIViewController</span><br><span class="line">- (BOOL)shouldAutorotate &#123;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIInterfaceOrientationMask)supportedInterfaceOrientations &#123;</span><br><span class="line">    return UIInterfaceOrientationMaskLandscapeLeft;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œäº¤é›†ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™ä¼šå¯¼è‡´crash</p></blockquote><p>*** Terminating app due to uncaught exception â€˜UIApplicationInvalidInterfaceOrientationâ€™, reason: â€˜Supported orientations has no common orientation with the application, and [ViewController<br>shouldAutorotate] is returning YESâ€™</p><p><img src="/images/15320548897266-1.jpg" alt="15320548897266"></p><h2 id="æ—‹è½¬äº‹ä»¶ç›‘å¬"><a href="#æ—‹è½¬äº‹ä»¶ç›‘å¬" class="headerlink" title="æ—‹è½¬äº‹ä»¶ç›‘å¬"></a>æ—‹è½¬äº‹ä»¶ç›‘å¬</h2><h3 id="æ—‹è½¬äº‹ä»¶ä¼ é€’è¿‡ç¨‹"><a href="#æ—‹è½¬äº‹ä»¶ä¼ é€’è¿‡ç¨‹" class="headerlink" title="æ—‹è½¬äº‹ä»¶ä¼ é€’è¿‡ç¨‹"></a>æ—‹è½¬äº‹ä»¶ä¼ é€’è¿‡ç¨‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">op0=&gt;operation: __CFRunLoopDoSources0</span><br><span class="line">op1=&gt;operation: UIDevice</span><br><span class="line">op2=&gt;operation: UIWindow</span><br><span class="line">op3=&gt;operation: UIViewController</span><br><span class="line">op4=&gt;operation: UIView</span><br><span class="line"></span><br><span class="line">op1-&gt;op2-&gt;op3-&gt;op4</span><br></pre></td></tr></table></figure><h3 id="å±å¹•æ—‹è½¬ç›¸å…³äº‹ä»¶"><a href="#å±å¹•æ—‹è½¬ç›¸å…³äº‹ä»¶" class="headerlink" title="å±å¹•æ—‹è½¬ç›¸å…³äº‹ä»¶"></a>å±å¹•æ—‹è½¬ç›¸å…³äº‹ä»¶</h3><p>viewWillTransitionToSize:withTransitionCoordinator:</p><ul><li>ViewControllerè¢«çˆ¶å®¹å™¨å˜æ›´sizeæ—¶è°ƒç”¨ï¼ˆä¾‹å¦‚windowæ—‹è½¬æ—¶è°ƒç”¨root view controllerçš„è¯¥æ–¹æ³•ï¼‰</li><li>å¦‚æœé‡è½½è¯¥æ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨superä¼ é€’äº‹ä»¶ç»™å­ViewController</li><li>è¿™ä¸ªæ–¹æ³•æ˜¯æœ€å…³é”®çš„ï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­å¯¹ç•Œé¢è¿›è¡Œé‡æ–°å¸ƒå±€</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewWillTransitionToSize:(CGSize)size withTransitionCoordinator:(id &lt;UIViewControllerTransitionCoordinator&gt;)coordinator</span><br><span class="line">&#123;</span><br><span class="line">    // coordinatorç”¨æ¥å¤„ç†è½¬æ¢åŠ¨ç”»</span><br><span class="line">    [coordinator animateAlongsideTransition:^(id&lt;UIViewControllerTransitionCoordinatorContext&gt; context)</span><br><span class="line">     &#123;</span><br><span class="line">         // å¼€å§‹æ—‹è½¬</span><br><span class="line">     &#125; completion:^(id&lt;UIViewControllerTransitionCoordinatorContext&gt; context)</span><br><span class="line">     &#123;</span><br><span class="line">         // æ—‹è½¬ç»“æŸ</span><br><span class="line">     &#125;];</span><br><span class="line">     // è®°å¾—è°ƒç”¨super</span><br><span class="line">    [super viewWillTransitionToSize:size withTransitionCoordinator:coordinator];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UIApplicationWillChangeStatusBarOrientationNotification </p><ul><li>çŠ¶æ€æ å°†è¦æ—‹è½¬ï¼Œè¿™ä¸ªæ—¶å€™å–viewçš„frameè¿˜æ˜¯æ—‹è½¬ä¹‹å‰çš„</li><li>NSNotificationä¸­ç”¨key <code>UIApplicationStatusBarOrientationUserInfoKey</code>å¯ä»¥å–åˆ°å°†è¦æ—‹è½¬åˆ°çš„æ–¹å‘ã€‚</li></ul><p>UIApplicationDidChangeStatusBarOrientationNotification </p><ul><li>çŠ¶æ€æ å·²ç»æ—‹è½¬ï¼Œè¿™ä¸ªæ—¶å€™å–viewçš„frameæ˜¯æ—‹è½¬ä¹‹åçš„</li><li>NSNotificationä¸­ç”¨key <code>UIApplicationStatusBarOrientationUserInfoKey</code>å¯ä»¥å–åˆ°æ—‹è½¬ä¹‹å‰çš„æ–¹å‘ã€‚</li></ul><p>UIDeviceOrientationDidChangeNotification </p><ul><li>è®¾å¤‡æ–¹å‘å˜æ›´ï¼Œåœ¨æ”¶åˆ°é€šçŸ¥æ—¶å–viewçš„frameæ˜¯æ—‹è½¬ä¹‹åçš„ã€‚</li><li>åœ¨æ‰‹æœºä¸Šå°†æ—‹è½¬å±å¹•é”å®šä¹‹åï¼Œè®¾å¤‡æ–¹å‘å˜æ›´ä¹‹åæ”¶ä¸åˆ°è¯¥é€šçŸ¥</li><li>åœ¨ä»£ç é‡Œé¢é™åˆ¶è®¾å¤‡æ—‹è½¬æ–¹å‘ï¼Œè®¾å¤‡æ–¹å‘å˜æ›´åä¾ç„¶èƒ½æ”¶åˆ°è¯¥é€šçŸ¥</li></ul><p>è°ƒç”¨é¡ºåºå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: æ—‹è½¬å±å¹•</span><br><span class="line">e=&gt;end: ç»“æŸ</span><br><span class="line">op1=&gt;operation: viewWillTransitionToSize:withTransitionCoordinator:</span><br><span class="line">op2=&gt;operation: UIApplicationWillChangeStatusBarOrientationNotification</span><br><span class="line">op3=&gt;operation: UIApplicationDidChangeStatusBarOrientationNotification</span><br><span class="line">op4=&gt;operation: viewWillLayoutSubviews</span><br><span class="line">op5=&gt;operation: viewDidLayoutSubviews</span><br><span class="line">op6=&gt;operation: UIDeviceOrientationDidChangeNotification</span><br><span class="line"></span><br><span class="line">st-&gt;op1-&gt;op2-&gt;op3-&gt;op4-&gt;op5-&gt;op6-&gt;e</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰Windowçš„æ—‹è½¬äº‹ä»¶"><a href="#è‡ªå®šä¹‰Windowçš„æ—‹è½¬äº‹ä»¶" class="headerlink" title="è‡ªå®šä¹‰Windowçš„æ—‹è½¬äº‹ä»¶"></a>è‡ªå®šä¹‰Windowçš„æ—‹è½¬äº‹ä»¶</h2><p>å¦‚æœæƒ³è¦åœ¨è‡ªå®šä¹‰Windowçš„å­Viewæ”¶åˆ°å±å¹•æ—‹è½¬é€šçŸ¥ï¼Œè¦è®¾ç½®UIWindowçš„rootViewControllerï¼Œç„¶åæŠŠæ‰€æœ‰å­viewéƒ½åŠ åˆ°rootViewControllerï¼Œç³»ç»Ÿä¼šå¤„ç†æ¨ªç«–å±äº‹ä»¶ã€‚è¿™é‡Œæˆ‘è¿˜é‡åˆ°ä¸€ä¸ªå‘<a href="https://crmo.github.io/2018/07/19/è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘/">è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘</a>ã€‚</p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><p><a href="https://satanwoo.github.io/2016/09/17/uiwindow-iOS/" target="_blank" rel="noopener">https://satanwoo.github.io/2016/09/17/uiwindow-iOS/</a><br><a href="https://tbd.ink/2017/07/05/iOS/17070501.iOSå±å¹•æ—‹è½¬çŸ¥è¯†ç‚¹ä»¥åŠå®ç°/index/" target="_blank" rel="noopener">iOSå±å¹•æ—‹è½¬çŸ¥è¯†ç‚¹ä»¥åŠå®ç°</a><br><a href="https://imtangqi.com/2017/03/08/handle-orientation-changes-one/" target="_blank" rel="noopener">iOS å±å¹•æ—‹è½¬çš„é‚£äº›äº‹ï¼ˆä¸€ï¼‰</a><br><a href="https://satanwoo.github.io/2016/09/17/uiwindow-iOS/" target="_blank" rel="noopener">æµ…è°ˆiOSçš„å¤šWindowå¤„ç†</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä½¿ç”¨&lt;code&gt;Auto Layout&lt;/code&gt;æ¥è¿›è¡Œå¸ƒå±€å°±ä¸ç”¨è‡ªå·±å»ç›‘å¬æ¨ªç«–å±äº‹ä»¶äº†ï¼Œåªéœ€è¦ç»˜åˆ¶å¤šå¥—å¸ƒå±€å³å¯ã€‚ä½†æ˜¯é¡¹ç›®æœ‰å¾ˆå¤šé¡µé¢æ˜¯è‡ªå·±æ‰‹åŠ¨è®¡ç®—çš„ï¼Œäºæ˜¯åªæœ‰æƒ³åŠæ³•å†æ—‹è½¬å±å¹•æ—¶é‡æ–°å¸ƒå±€ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç›¸å…³æšä¸¾&quot;&gt;&lt;a href=&quot;#ç›¸å…³æšä¸¾&quot; class=&quot;h
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘</title>
    <link href="https://crmo.github.io/2018/07/19/%E8%AE%B0%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0UIWindow%E5%AD%90%E7%B1%BB%E7%9A%84%E5%B0%8F%E5%9D%91/"/>
    <id>https://crmo.github.io/2018/07/19/è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘/</id>
    <published>2018-07-18T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.852Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>é¡¹ç›®ä¸­ä¸ºäº†å®ç°ä¸€ä¸ªå…¨å±€é®ç½©ç•Œé¢ï¼Œä½¿ç”¨äº†ä¸€ä¸ªUIWindowçš„å­ç±»<code>MyWindow</code>ï¼Œ<code>MyWindow</code>ä¸ºäº†å®ç°å›è°ƒå®šä¹‰äº†ä»£ç†<code>MyWindowDelegate</code>ã€‚ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">MyWindowDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyWindow</span> : <span class="title">UIWindow</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>)<span class="keyword">id</span>&lt;MyWindowDelegate&gt; delegate;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyWindow</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.windowLevel = <span class="built_in">UIWindowLevelNormal</span>;</span><br><span class="line">        <span class="keyword">self</span>.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        <span class="built_in">UIViewController</span> *vc = [[ViewController2 alloc] init];</span><br><span class="line">        <span class="keyword">self</span>.rootViewController = vc;</span><br><span class="line">        <span class="keyword">self</span>.hidden = <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨å®ç°ç•Œé¢æ¨ªå±æ—¶ï¼Œå‘ç°æ•´ä¸ªUIWindowä¸å“åº”æ¨ªç«–å±äº‹ä»¶ã€‚åˆšå¼€å§‹ä»¥ä¸ºæ¨ªç«–å±è®¾ç½®è¢«å…³é—­äº†ï¼ŒæŸ¥äº†å„ç§èµ„æ–™ï¼Œå‘ç°è¿™ç§å†™æ³•æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è®¾ç½®UIWindowçš„rootViewControllerï¼Œç„¶åæŠŠæ‰€æœ‰å­viewéƒ½åŠ åˆ°rootViewControllerï¼Œç³»ç»Ÿä¼šå¤„ç†æ¨ªç«–å±é—®é¢˜ã€‚</p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>ç”¨RuntimeæŠŠUIWindowçš„ç§æœ‰å˜é‡æ‰“å‡ºæ¥ï¼Œå°±å‘ç°é—®é¢˜äº†ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)printUIWindowIvars &#123;</span><br><span class="line">    Ivar *ivars = class_copyIvarList([<span class="built_in">UIWindow</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        Ivar ivar = ivars[i];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, ivar_getName(ivar));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹è¾“å‡ºï¼Œå‘ç°æœ‰ä¸ªç§æœ‰å˜é‡<code>_delegate</code>ã€‚</p><p><img src="/images/15319834677166.jpg" alt="15319834677166"></p><p><code>MyWindow</code>çš„å±æ€§<code>delegate</code>è¦†ç›–äº†çˆ¶ç±»<code>UIWindow</code>çš„å˜é‡ï¼Œå¯¼è‡´æ¨ªç«–å±åˆ‡æ¢äº‹ä»¶å¤±æ•ˆã€‚åœ¨ä»£ç†å‘½åçš„æ—¶å€™ä¸€å®šè¦æ³¨æ„å•Šï¼Œ<code>delegate</code>çœ‹æ¥ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®è·µï¼Œåº”è¯¥åŠ å‰ç¼€åŒºåˆ†é¿å…è¦†ç›–çˆ¶ç±»çš„å®ç°ï¼Œç‰¹åˆ«æ˜¯è¿™ç§ç§æœ‰çš„å˜é‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;é¡¹ç›®ä¸­ä¸ºäº†å®ç°ä¸€ä¸ªå…¨å±€é®ç½©ç•Œé¢ï¼Œä½¿ç”¨äº†ä¸€ä¸ªUIWindowçš„å­ç±»&lt;code&gt;MyWindow&lt;/code&gt;ï¼Œ&lt;code&gt;My
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªautoreleasepoolçš„ä½¿ç”¨åœºæ™¯</title>
    <link href="https://crmo.github.io/2018/07/18/%E4%B8%80%E4%B8%AAautoreleasepool%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
    <id>https://crmo.github.io/2018/07/18/ä¸€ä¸ªautoreleasepoolçš„ä½¿ç”¨åœºæ™¯/</id>
    <published>2018-07-17T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.861Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨å­¦ä¹ å¤§ä½¬åšå®¢çš„æ—¶å€™çœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä¸‹é¢ä»£ç ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// largeNumberæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; largeNumber; i++) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"hello -%04d"</span>, i];</span><br><span class="line">    str = [str stringByAppendingString:<span class="string">@" - world"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆšå¼€å§‹æ²¡çœ‹å‡ºä»€ä¹ˆé—®é¢˜ï¼Œå°±æ˜¯æ™®é€šçš„å¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯åˆ›å»ºä¸€ä¸ªå±€éƒ¨å˜é‡<code>NSString</code>ã€‚äºæ˜¯å†™äº†ä¸ªDemoéªŒè¯äº†ä¸‹ï¼Œåœ¨è§‚å¯Ÿå†…å­˜çš„æ—¶å€™å‘ç°äº†ç«¯å€ªï¼Œåœ¨å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä¸æ–­é£™å‡ã€‚</p><p><img src="/images/15318782609811.jpg" alt="15318782609811"></p><p>é¡¿æ—¶æ˜ç™½äº†ï¼ŒåŸæ¥é—®é¢˜çš„å…³é”®å°±æ˜¯è¿™ä¸ª<code>largeNumber</code>ï¼Œå½“å¾ªç¯æ­¤æ—¶å¾ˆå¤§æ—¶ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡çš„å±€éƒ¨å˜é‡ï¼Œè€Œä¸”å¾—ä¸åˆ°é‡Šæ”¾ï¼Œäºæ˜¯å†…å­˜å°±çˆ†äº†ã€‚è¿™æ—¶å€™å°±è¯¥<code>@autoreleasepool</code>ä¸Šåœºäº†ï¼Œä¼˜åŒ–åä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; largeNumber; i++) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *str = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"hello -%04d"</span>, i];</span><br><span class="line">        str = [str stringByAppendingString:<span class="string">@" - world"</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿è¡Œå†…å­˜ï¼Œå¯ä»¥çœ‹åˆ°éå¸¸å¹³ç¨³ã€‚</p><p><img src="/images/15318784002251.jpg" alt="15318784002251"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©åœ¨å­¦ä¹ å¤§ä½¬åšå®¢çš„æ—¶å€™çœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä¸‹é¢ä»£ç ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>UITabbarè‡ªå®šä¹‰Badge</title>
    <link href="https://crmo.github.io/2018/07/10/UITabbar%E8%87%AA%E5%AE%9A%E4%B9%89Badge/"/>
    <id>https://crmo.github.io/2018/07/10/UITabbarè‡ªå®šä¹‰Badge/</id>
    <published>2018-07-09T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.882Z</updated>
    
    <content type="html"><![CDATA[<p>tabBarItemçš„Badgeé»˜è®¤æ ·å¼æ˜¯å¸¦æ•°å­—çš„ï¼Œä½†æ˜¯äº§å“è¦æ±‚åªè¦ä¸€ä¸ªå°çº¢ç‚¹ï¼Œä¸éœ€è¦æ•°å­—ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰Badgeäº†ã€‚</p><p>ç”¨Revealåˆ†æUITabBarï¼Œå‘ç°æ¯ä¸ªæŒ‰é’®æ˜¯ä¸€ä¸ª<code>UITabBarButton</code>ï¼Œå±‚çº§å¦‚ä¸‹ï¼š</p><blockquote><p>-UITabBarButton<br>â€“UITabBarSwappableImageView // å›¾æ ‡<br>â€“UITabBarButtonLabel // æ–‡å­—</p></blockquote><p>å¦‚ä½•ä»<code>UITabBar</code>ä¸­æ‰¾åˆ°å¯¹åº”indexçš„<code>UITabBarButton</code>å‘¢ï¼Ÿæˆ‘ä»¬æ–­ç‚¹è°ƒè¯•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å¯ä»¥ç›´æ¥ä»<code>UITabBar</code>ä¸­ç”¨KVCå–å‡ºã€‚</p><p><img src="/images/QQ20180711-174329.png" alt="QQ20180711-174329"></p><p>å®ç°æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li>ç”¨KVCæ‰¾åˆ°UITabBarSwappableImageViewï¼Œå…³é”®å‡½æ•°<code>__iconViewWithIndex</code></li><li>æ–°å»ºBadgeï¼ŒåŠ åˆ°UITabBarSwappableImageViewä¸Š</li><li>æ–°å»ºBadgeçš„æ—¶å€™è®¾ç½®Tagï¼Œé€šè¿‡Tagæ¥ç§»é™¤Badge</li></ul><p>ä¸Šä»£ç </p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSInteger</span> <span class="keyword">const</span> kBadgeViewTagBase = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UITabBar</span> (<span class="title">badge</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºBadge</span></span><br><span class="line">- (<span class="keyword">void</span>)showBadgeOnItemIndex:(<span class="keyword">int</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.items.count) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœä¹‹å‰æ·»åŠ è¿‡ï¼Œç›´æ¥è®¾ç½®hiddenä¸ºNO</span></span><br><span class="line">    <span class="built_in">UIView</span> *icon = [<span class="keyword">self</span> __iconViewWithIndex:index];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *subView <span class="keyword">in</span> icon.subviews) &#123;</span><br><span class="line">        <span class="keyword">if</span> (subView.tag == kBadgeViewTagBase) &#123;</span><br><span class="line">            subView.hidden = <span class="literal">NO</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIView</span> *badgeView = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line">    badgeView.tag = kBadgeViewTagBase;</span><br><span class="line">    badgeView.layer.cornerRadius = <span class="number">5</span>;</span><br><span class="line">    badgeView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    badgeView.frame = <span class="built_in">CGRectMake</span>(icon.frame.size.width - <span class="number">5</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">9</span>);</span><br><span class="line">    [icon addSubview:badgeView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšè—Badge</span></span><br><span class="line">- (<span class="keyword">void</span>)hideBadgeOnItemIndex:(<span class="keyword">int</span>)index &#123;</span><br><span class="line">    <span class="built_in">UIView</span> *icon = [<span class="keyword">self</span> __iconViewWithIndex:index];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *subView <span class="keyword">in</span> icon.subviews) &#123;</span><br><span class="line">        <span class="keyword">if</span> (subView.tag == kBadgeViewTagBase) &#123;</span><br><span class="line">            subView.hidden = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å›¾æ ‡æ‰€åœ¨View</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)__iconViewWithIndex:(<span class="keyword">int</span>)index &#123;</span><br><span class="line">    <span class="built_in">UITabBarItem</span> *item = <span class="keyword">self</span>.items[index];</span><br><span class="line">    <span class="built_in">UIView</span> *tabBarButton = [item valueForKey:<span class="string">@"_view"</span>];</span><br><span class="line">    <span class="built_in">UIView</span> *icon = [tabBarButton valueForKey:<span class="string">@"_info"</span>];</span><br><span class="line">    <span class="keyword">return</span> icon;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;tabBarItemçš„Badgeé»˜è®¤æ ·å¼æ˜¯å¸¦æ•°å­—çš„ï¼Œä½†æ˜¯äº§å“è¦æ±‚åªè¦ä¸€ä¸ªå°çº¢ç‚¹ï¼Œä¸éœ€è¦æ•°å­—ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰Badgeäº†ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨Revealåˆ†æUITabBarï¼Œå‘ç°æ¯ä¸ªæŒ‰é’®æ˜¯ä¸€ä¸ª&lt;code&gt;UITabBarButton&lt;/code&gt;ï¼Œå±‚çº§å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;b
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æ–‡å­—é•¿åº¦</title>
    <link href="https://crmo.github.io/2018/07/09/%E8%AE%A1%E7%AE%97%E6%96%87%E5%AD%97%E9%95%BF%E5%BA%A6/"/>
    <id>https://crmo.github.io/2018/07/09/è®¡ç®—æ–‡å­—é•¿åº¦/</id>
    <published>2018-07-08T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.871Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://developer.apple.com/documentation/foundation/nsstring/1524729-boundingrectwithsize?language=occ" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p></blockquote><h2 id="æ–¹æ³•å®šä¹‰"><a href="#æ–¹æ³•å®šä¹‰" class="headerlink" title="æ–¹æ³•å®šä¹‰"></a>æ–¹æ³•å®šä¹‰</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSRect</span>)boundingRectWithSize:(<span class="built_in">NSSize</span>)size </span><br><span class="line">                       options:(<span class="built_in">NSStringDrawingOptions</span>)options </span><br><span class="line">                    attributes:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSAttributedStringKey</span>, <span class="keyword">id</span>&gt; *)attributes </span><br><span class="line">                       context:(<span class="built_in">NSStringDrawingContext</span> *)context;</span><br></pre></td></tr></table></figure><h2 id="å‚æ•°å®šä¹‰"><a href="#å‚æ•°å®šä¹‰" class="headerlink" title="å‚æ•°å®šä¹‰"></a>å‚æ•°å®šä¹‰</h2><h3 id="size"><a href="#size" class="headerlink" title="size"></a>size</h3><p>ç»˜åˆ¶çš„é™åˆ¶sizeï¼Œè®¡ç®—å‡ºæ¥çš„å€¼ä¸ä¼šè¶…è¿‡è¿™ä¸ªå¤§å°ã€‚</p><h3 id="options"><a href="#options" class="headerlink" title="options"></a>options</h3><p>ä¸€äº›é…ç½®é¡¹ã€‚å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSInteger</span>, <span class="built_in">NSStringDrawingOptions</span>) &#123;</span><br><span class="line">    <span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span> = <span class="number">1</span> &lt;&lt; <span class="number">0</span>, <span class="comment">// The specified origin is the line fragment origin, not the base line origin</span></span><br><span class="line">    <span class="built_in">NSStringDrawingUsesFontLeading</span> = <span class="number">1</span> &lt;&lt; <span class="number">1</span>, <span class="comment">// Uses the font leading for calculating line heights</span></span><br><span class="line">    <span class="built_in">NSStringDrawingUsesDeviceMetrics</span> = <span class="number">1</span> &lt;&lt; <span class="number">3</span>, <span class="comment">// Uses image glyph bounds instead of typographic bounds</span></span><br><span class="line">    <span class="built_in">NSStringDrawingTruncatesLastVisibleLine</span> <span class="built_in">NS_ENUM_AVAILABLE</span>(<span class="number">10</span>_5, <span class="number">6</span>_0) = <span class="number">1</span> &lt;&lt; <span class="number">5</span>, <span class="comment">// Truncates and adds the ellipsis character to the last visible line if the text doesn't fit into the bounds specified. Ignored if NSStringDrawingUsesLineFragmentOrigin is not also set.</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="built_in">NS_ENUM_AVAILABLE</span>(<span class="number">10</span>_0, <span class="number">6</span>_0);</span><br></pre></td></tr></table></figure><p>å®é™…æµ‹è¯•ä½¿ç”¨<code>NSStringDrawingUsesLineFragmentOrigin|NSStringDrawingUsesFontLeading</code>å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œ<code>NSStringDrawingUsesLineFragmentOrigin</code>æ˜¯å¿…é¡»çš„ï¼Œ<code>NSStringDrawingUsesFontLeading</code>åŠ ä¸åŠ åœ¨æµ‹è¯•çš„æ—¶å€™æ²¡å‘ç°åŒºåˆ«ï¼Œä½†æ˜¯åœ¨<a href="https://stackoverflow.com/questions/13621084/boundingrectwithsize-for-nsattributedstring-returning-wrong-size/15399767#15399767" target="_blank" rel="noopener">stackoverflowç›¸å…³è®¨è®º</a>é‡ŒåŠ ä¸Šäº†ï¼Œç•™ä¸ªå‘ï¼Œåé¢çŸ¥é“ä¸ºä»€ä¹ˆäº†æ¥è¡¥å……å§ã€‚</p><h3 id="attributes"><a href="#attributes" class="headerlink" title="attributes"></a>attributes</h3><p>å­—ä½“</p><h3 id="context"><a href="#context" class="headerlink" title="context"></a>context</h3><p>ä¸Šä¸‹æ–‡</p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol><li>å¦‚æœæ˜¯å¤šè¡Œæ–‡å­—ï¼Œoptionsè¦åŠ ä¸Š<code>NSStringDrawingUsesLineFragmentOrigin</code></li><li>è¿”å›çš„å€¼æ˜¯å°æ•°ï¼Œéœ€è¦è°ƒç”¨<code>ceil</code>å‘ä¸Šå–æ•´</li><li>å¾—åˆ°çš„å®½åº¦å¯èƒ½æ¯”å®é™…å®½</li></ol><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">CGSize</span>)getTextLabelSize:(<span class="built_in">NSString</span> *)message &#123;</span><br><span class="line">    <span class="keyword">if</span> ([message length] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// æ–‡æœ¬æ¡†çš„æœ€å¤§å®½åº¦</span></span><br><span class="line">        <span class="keyword">float</span> maxWidth = <span class="number">200</span>;</span><br><span class="line">        <span class="built_in">CGRect</span> textRect = [message</span><br><span class="line">                           boundingRectWithSize:<span class="built_in">CGSizeMake</span>(maxWidth, <span class="built_in">CGFLOAT_MAX</span>)</span><br><span class="line">                           options:(<span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span> |</span><br><span class="line">                                    <span class="built_in">NSStringDrawingUsesFontLeading</span>)</span><br><span class="line">                           attributes:@&#123;</span><br><span class="line">                                        <span class="built_in">NSFontAttributeName</span> :</span><br><span class="line">                                            [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">16</span>]</span><br><span class="line">                                        &#125;</span><br><span class="line">                           context:<span class="literal">nil</span>];</span><br><span class="line">        textRect.size.height = ceilf(textRect.size.height);</span><br><span class="line">        textRect.size.width = ceilf(textRect.size.width);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">CGSizeMake</span>(textRect.size.width, textRect.size.height);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">CGSizeZero</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/documentation/foundation/nsstring/1524729-boundingrectwithsize?language=occ&quot; target=&quot;_b
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>UITextFieldæ§åˆ¶è¾“å…¥é•¿åº¦</title>
    <link href="https://crmo.github.io/2018/07/06/UITextField%E6%8E%A7%E5%88%B6%E8%BE%93%E5%85%A5%E9%95%BF%E5%BA%A6/"/>
    <id>https://crmo.github.io/2018/07/06/UITextFieldæ§åˆ¶è¾“å…¥é•¿åº¦/</id>
    <published>2018-07-05T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.894Z</updated>
    
    <content type="html"><![CDATA[<p>æœ‰äº›æ—¶å€™ä¼šæœ‰æ§åˆ¶è¾“å…¥æ¡†æ–‡å­—é•¿åº¦çš„éœ€æ±‚ï¼Œè®°å½•ä¸€ä¸ªç®€å•çš„æ€è·¯ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string &#123;</span><br><span class="line">    <span class="keyword">if</span> (string.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSInteger</span> limit = <span class="number">15</span>; <span class="comment">// æ–‡æœ¬çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line">    <span class="built_in">NSString</span> *newStr = [textField.text stringByAppendingString:string]; <span class="comment">// ä¿®æ”¹ä¹‹åçš„æ–°å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="built_in">NSInteger</span> newStrLength = newStr.length;</span><br><span class="line">    newStrLength -= [textField textInRange:[textField markedTextRange]].length; <span class="comment">// å»æ‰é«˜äº®å†…å®¹ï¼Œè¾“å…¥ä¸­æ–‡æ‹¼éŸ³çš„æƒ…å†µ</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (newStrLength &gt; limit) &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†composed character, æ¯”å¦‚emoji</span></span><br><span class="line">        <span class="built_in">NSString</span> *tempStr = [newStr substringWithRange:[newStr rangeOfComposedCharacterSequencesForRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, limit)]];</span><br><span class="line">        textField.text = tempStr;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ä¸ªå‘æ³¨æ„ä¸‹ï¼š</p><ol><li>emojiæ˜¯<code>composed character</code>ï¼Œå®ƒæ˜¯ç”±å¤šä¸ªå­—ç¬¦ç»„åˆï¼Œé•¿åº¦ä¸æ˜¯1ã€‚æœ€å¼€å§‹ç”¨çš„<code>substringToIndex</code>ä¼šå¯¼è‡´æœ€åä¸€ä¸ªemojiä¹±ç ã€‚</li><li>è®¡ç®—é•¿åº¦çš„æ—¶å€™è¦å»æ‰ä¸­æ–‡è¾“å…¥çš„æ—¶å€™é«˜äº®éƒ¨åˆ†</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ‰äº›æ—¶å€™ä¼šæœ‰æ§åˆ¶è¾“å…¥æ¡†æ–‡å­—é•¿åº¦çš„éœ€æ±‚ï¼Œè®°å½•ä¸€ä¸ªç®€å•çš„æ€è·¯ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>property or synthsize</title>
    <link href="https://crmo.github.io/2018/07/05/property%20or%20synthsize/"/>
    <id>https://crmo.github.io/2018/07/05/property or synthsize/</id>
    <published>2018-07-04T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.910Z</updated>
    
    <content type="html"><![CDATA[<p>@property (nonatomic, retain) NSObject *var;</p><ul><li>ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„æ–¹æ³•å£°æ˜</li><li>ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„å®ç°ï¼ˆ<strong>æ—©æœŸç‰ˆæœ¬ç¼–è¯‘å™¨ä¸ç”Ÿæˆ</strong>ï¼‰</li><li>ç”Ÿæˆæˆå‘˜å˜é‡_varï¼ˆ<strong>æ—©æœŸç‰ˆæœ¬ç¼–è¯‘å™¨ä¸ç”Ÿæˆ</strong>ï¼‰</li></ul><p>@synthsize var = _var</p><ul><li>ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„å®ç°</li><li>ç”Ÿæˆvarå¯¹åº”çš„æˆå‘˜å˜é‡_var</li></ul><blockquote><p>mrcå¹´ä»£çš„getã€setæ–¹æ³•çš„å†™æ³•</p></blockquote><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setVar:(<span class="built_in">NSObject</span> *)var &#123;</span><br><span class="line">    <span class="keyword">if</span> (_var != var) &#123; <span class="comment">// å¦‚æœå¤šæ¬¡setåŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœä¸åˆ¤æ–­ä¼šå¯¼è‡´å¯¹è±¡è¢«é‡Šæ”¾</span></span><br><span class="line">        <span class="comment">// é‡Šæ”¾ä¹‹å‰çš„var</span></span><br><span class="line">        [_var release];</span><br><span class="line">        _var = [var <span class="keyword">retain</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSObject</span> *)var &#123;</span><br><span class="line">    <span class="keyword">return</span> _var;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;@property (nonatomic, retain) NSObject *var;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„æ–¹æ³•å£°æ˜&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„å®ç°ï¼ˆ&lt;strong&gt;æ—©æœŸç‰ˆæœ¬ç¼–è¯‘å™¨ä¸ç”Ÿæˆ&lt;/strong&gt;ï¼‰&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>Tagged Pointerå°è®°</title>
    <link href="https://crmo.github.io/2018/07/04/Tagged%20Pointer%E5%B0%8F%E8%AE%B0/"/>
    <id>https://crmo.github.io/2018/07/04/Tagged Pointerå°è®°/</id>
    <published>2018-07-03T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.998Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä½¿ç”¨çš„æµ‹è¯•ç¯å¢ƒæ˜¯arm64æ¶æ„çœŸæœº</p></blockquote><p>ä¸ºäº†æ¢ç©¶Tagged Pointeræœ¬è´¨ï¼Œå¯ä»¥æŸ¥çœ‹runtimeæºç ï¼Œä¸»è¦çœ‹æ–‡ä»¶<code>objc-internal.h</code>ã€‚</p><h2 id="å®å®šä¹‰"><a href="#å®å®šä¹‰" class="headerlink" title="å®å®šä¹‰"></a>å®å®šä¹‰</h2><p>å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å®å®šä¹‰ï¼Œåªæœ‰åœ¨64ä½ç³»ç»Ÿæ‰æ”¯æŒ<code>Tagged Pointer</code>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __LP64__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OBJC_HAVE_TAGGED_POINTERS 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>64-bitçš„macï¼Œtagå­˜å‚¨åœ¨LSBï¼ˆLeast Significant Bit æœ€ä½ä½ï¼‰ã€‚å…¶å®ƒæƒ…å†µæ¯”å¦‚64ä½çš„çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ï¼Œtagå­˜å‚¨åœ¨MSBï¼ˆMost Significant Bit æœ€é«˜ä½ï¼‰ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#if TARGET_OS_OSX &amp;&amp; __x86_64__</span></span><br><span class="line">    <span class="comment">// 64-bit Mac - tag bit is LSB</span></span><br><span class="line"><span class="meta">#   define OBJC_MSB_TAGGED_POINTERS 0</span></span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">    <span class="comment">// Everything else - tag bit is MSB</span></span><br><span class="line"><span class="meta">#   define OBJC_MSB_TAGGED_POINTERS 1</span></span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#if OBJC_MSB_TAGGED_POINTERS</span></span><br><span class="line"><span class="meta">#   define _OBJC_TAG_MASK (1UL<span class="meta-string">&lt;&lt;63)</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_INDEX_SHIFT 60</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_SLOT_SHIFT 60</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_PAYLOAD_LSHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_PAYLOAD_RSHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_MASK (0xfUL&lt;&lt;60)</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_INDEX_SHIFT 52</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_SLOT_SHIFT 52</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_PAYLOAD_LSHIFT 12</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_PAYLOAD_RSHIFT 12</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#else</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_MASK 1UL</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_INDEX_SHIFT 1</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_SLOT_SHIFT 0</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_PAYLOAD_LSHIFT 0</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_PAYLOAD_RSHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_MASK 0xfUL</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_INDEX_SHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_SLOT_SHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_PAYLOAD_LSHIFT 0</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_PAYLOAD_RSHIFT 12</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#endif</span></span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªæšä¸¾å®šä¹‰ï¼Œå®šä¹‰äº†é»˜è®¤çš„ä½¿ç”¨<code>Tagged Pointer</code>çš„ç±»ã€‚ä¾‹å¦‚NSStringã€NSNumberã€NSIndexPathã€NSDateï¼ˆOBJC_TAG_NSAtomã€OBJC_TAG_1ã€OBJC_TAG_NSManagedObjectIDä¸çŸ¥é“æ˜¯å•¥æ„æ€ï¼Œè¿˜è¯·çŸ¥é“çš„åŒå­¦å‘Šè¯‰æˆ‘ï¼‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="keyword">objc_tag_index_t</span> : <span class="keyword">uint16_t</span></span><br><span class="line"><span class="keyword">enum</span></span><br><span class="line">&#123;</span><br><span class="line">    OBJC_TAG_NSAtom            = <span class="number">0</span>, </span><br><span class="line">    OBJC_TAG_1                 = <span class="number">1</span>, </span><br><span class="line">    OBJC_TAG_NSString          = <span class="number">2</span>, </span><br><span class="line">    OBJC_TAG_NSNumber          = <span class="number">3</span>, </span><br><span class="line">    OBJC_TAG_NSIndexPath       = <span class="number">4</span>, </span><br><span class="line">    OBJC_TAG_NSManagedObjectID = <span class="number">5</span>, </span><br><span class="line">    OBJC_TAG_NSDate            = <span class="number">6</span>, </span><br><span class="line">    OBJC_TAG_RESERVED_7        = <span class="number">7</span>, </span><br><span class="line"></span><br><span class="line">    OBJC_TAG_First60BitPayload = <span class="number">0</span>, </span><br><span class="line">    OBJC_TAG_Last60BitPayload  = <span class="number">6</span>, </span><br><span class="line">    OBJC_TAG_First52BitPayload = <span class="number">8</span>, </span><br><span class="line">    OBJC_TAG_Last52BitPayload  = <span class="number">263</span>, </span><br><span class="line"></span><br><span class="line">    OBJC_TAG_RESERVED_264      = <span class="number">264</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•å®šä¹‰"><a href="#æ–¹æ³•å®šä¹‰" class="headerlink" title="æ–¹æ³•å®šä¹‰"></a>æ–¹æ³•å®šä¹‰</h2><p>åˆ¤æ–­æ˜¯ä¸æ˜¯<code>Tagged Pointer</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">bool</span></span><br><span class="line">_objc_isTaggedPointer(<span class="keyword">const</span> <span class="keyword">void</span> * _Nullable ptr) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> ((uintptr_t)ptr &amp; _OBJC_TAG_MASK) == _OBJC_TAG_MASK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆä¸€ä¸ª<code>Tagged Pointer</code>ï¼Œæœ€é«˜çš„4ä½æ˜¯taggedï¼Œå‰©ä¸‹çš„æ˜¯æ•°æ®</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> * _Nonnull</span><br><span class="line">_objc_makeTaggedPointer(objc_tag_index_t tag, uintptr_t value)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (tag &lt;= OBJC_TAG_Last60BitPayload) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">void</span> *)</span><br><span class="line">            (_OBJC_TAG_MASK | </span><br><span class="line">             ((uintptr_t)tag &lt;&lt; _OBJC_TAG_INDEX_SHIFT) | </span><br><span class="line">             ((value &lt;&lt; _OBJC_TAG_PAYLOAD_RSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_LSHIFT));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">void</span> *)</span><br><span class="line">            (_OBJC_TAG_EXT_MASK |</span><br><span class="line">             ((uintptr_t)(tag - OBJC_TAG_First52BitPayload) &lt;&lt; _OBJC_TAG_EXT_INDEX_SHIFT) |</span><br><span class="line">             ((value &lt;&lt; _OBJC_TAG_EXT_PAYLOAD_RSHIFT) &gt;&gt; _OBJC_TAG_EXT_PAYLOAD_LSHIFT));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»<code>Tagged Pointer</code>ä¸­å–å‡ºå€¼</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> uintptr_t</span><br><span class="line">_objc_getTaggedPointerValue(<span class="keyword">const</span> <span class="keyword">void</span> * _Nullable ptr) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// assert(_objc_isTaggedPointer(ptr));</span></span><br><span class="line">    uintptr_t basicTag = ((uintptr_t)ptr &gt;&gt; _OBJC_TAG_INDEX_SHIFT) &amp; _OBJC_TAG_INDEX_MASK;</span><br><span class="line">    <span class="keyword">if</span> (basicTag == _OBJC_TAG_INDEX_MASK) &#123;</span><br><span class="line">        <span class="keyword">return</span> ((uintptr_t)ptr &lt;&lt; _OBJC_TAG_EXT_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_EXT_PAYLOAD_RSHIFT;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((uintptr_t)ptr &lt;&lt; _OBJC_TAG_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_RSHIFT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="NSNumberåº”ç”¨ä¸¾ä¾‹"><a href="#NSNumberåº”ç”¨ä¸¾ä¾‹" class="headerlink" title="NSNumberåº”ç”¨ä¸¾ä¾‹"></a>NSNumberåº”ç”¨ä¸¾ä¾‹</h2><p>å¯ä»¥ä½¿ç”¨ä¸‹é¢ä»£ç æ¥éªŒè¯NSNumberå¦‚ä½•ä½¿ç”¨<code>Tagged Pointer</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSNumber</span> *charNumber = [<span class="built_in">NSNumber</span> numberWithChar:<span class="string">'1'</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *shortNumber = [<span class="built_in">NSNumber</span> numberWithShort:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *intNumber = [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *floatNumber = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">1.0</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *longNumber = [<span class="built_in">NSNumber</span> numberWithLong:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *doubleNumber = [<span class="built_in">NSNumber</span> numberWithDouble:<span class="number">1.0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºå˜é‡çš„æŒ‡é’ˆåœ°å€ï¼š</span></span><br><span class="line"><span class="comment">// charNumber 0xb000000000000310</span></span><br><span class="line"><span class="comment">// shortNumber 0xb000000000000011</span></span><br><span class="line"><span class="comment">// intNumber 0xb000000000000012</span></span><br><span class="line"><span class="comment">// floatNumber 0xb000000000000014</span></span><br><span class="line"><span class="comment">// longNumber 0xb000000000000013</span></span><br><span class="line"><span class="comment">// doubleNumber 0xb000000000000015</span></span><br></pre></td></tr></table></figure><p>ä¸éš¾å‘ç°è§„å¾‹ï¼Œéƒ½æ˜¯ä»¥b(1011)å¼€å¤´</p><ul><li>æœ€é«˜ä½æ˜¯1ï¼Œè¯´æ˜è¿™ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ª<code>Tagged Pointer</code></li><li>ç¬¬61-63ä½æ˜¯11ï¼ˆåè¿›åˆ¶æ˜¯3ï¼‰ï¼Œä¹Ÿå°±æ˜¯<code>OBJC_TAG_NSNumber</code>ï¼ˆæŸ¥ä¸Šé¢çš„æšä¸¾ï¼‰</li><li>ç¬¬1-4ä½æ˜¯NSNumberçš„ç±»å‹ï¼šæ¯”å¦‚ï¼Œcharæ˜¯0ã€shortæ˜¯1ã€intæ˜¯2ã€floatæ˜¯4</li><li>å‰©ä¸‹çš„56ä½å°±æ˜¯çœŸæ­£çš„å€¼äº†</li></ul><h2 id="NSStringåº”ç”¨ä¸¾ä¾‹"><a href="#NSStringåº”ç”¨ä¸¾ä¾‹" class="headerlink" title="NSStringåº”ç”¨ä¸¾ä¾‹"></a>NSStringåº”ç”¨ä¸¾ä¾‹</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str1 = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"a"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *str2 = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"ab"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºå˜é‡çš„æŒ‡é’ˆåœ°å€ï¼š</span></span><br><span class="line"><span class="comment">// str1: 0xa000000000000611</span></span><br><span class="line"><span class="comment">// str2: 0xa000000000062612</span></span><br></pre></td></tr></table></figure><p>ä¸NSNumberç±»ä¼¼</p><ul><li>æœ€é«˜ä½æ˜¯1ï¼Œè¯´æ˜è¿™ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ª<code>Tagged Pointer</code></li><li>ç¬¬61-63ä½æ˜¯11ï¼ˆåè¿›åˆ¶æ˜¯2ï¼‰ï¼Œä¹Ÿå°±æ˜¯<code>OBJC_TAG_NSString</code></li><li>ç¬¬1-4ä½æ˜¯å­—ç¬¦ä¸²é•¿åº¦</li><li>å‰©ä¸‹çš„56ä½å°±æ˜¯çœŸæ­£çš„å€¼äº†</li></ul><blockquote><p>æ›´å¤šç»†èŠ‚æ¨èè¿™ç¯‡æ–‡ç« <a href="http://www.cocoachina.com/ios/20150918/13449.html" target="_blank" rel="noopener">é‡‡ç”¨Tagged Pointerçš„å­—ç¬¦ä¸²</a></p></blockquote><hr><p>å‚è€ƒæ–‡ç« </p><ul><li><a href="https://www.jianshu.com/p/e354f9137ba8" target="_blank" rel="noopener">iOS Tagged Pointer</a></li><li><a href="https://en.wikipedia.org/wiki/Tagged_pointer" target="_blank" rel="noopener">wiki</a></li><li><a href="http://www.infoq.com/cn/articles/deep-understanding-of-tagged-pointer" target="_blank" rel="noopener">æ·±å…¥ç†è§£Tagged Pointer</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„æµ‹è¯•ç¯å¢ƒæ˜¯arm64æ¶æ„çœŸæœº&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸ºäº†æ¢ç©¶Tagged Pointeræœ¬è´¨ï¼Œå¯ä»¥æŸ¥çœ‹runtimeæºç ï¼Œä¸»è¦çœ‹æ–‡ä»¶&lt;code&gt;objc-internal.h&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
</feed>
