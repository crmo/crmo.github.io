<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CR.MO`s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://crmo.github.io/"/>
  <updated>2020-01-22T14:32:54.065Z</updated>
  <id>https://crmo.github.io/</id>
  
  <author>
    <name>CR.MO</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å°æ—¥å†éšç§æ”¿ç­–</title>
    <link href="https://crmo.github.io/2020/01/22/%E5%B0%8F%E6%97%A5%E5%8E%86%E9%9A%90%E7%A7%81%E6%94%BF%E7%AD%96/"/>
    <id>https://crmo.github.io/2020/01/22/å°æ—¥å†éšç§æ”¿ç­–/</id>
    <published>2020-01-21T16:00:00.000Z</published>
    <updated>2020-01-22T14:32:54.065Z</updated>
    
    <content type="html"><![CDATA[<p>Privacy Policy</p><p>Effective date: October 10, 2018</p><p>å°æ—¥å† (â€œusâ€, â€œweâ€, or â€œourâ€) operates the å°æ—¥å† mobile application (the â€œServiceâ€).</p><p>This page informs you of our policies regarding the collection, use, and disclosure of personal data when you use our Service and the choices you have associated with that data. Our Privacy Policy for å°æ—¥å† is created with the help of the Free Privacy Policy Generator.</p><p>We use your data to provide and improve the Service. By using the Service, you agree to the collection and use of information in accordance with this policy. Unless otherwise defined in this Privacy Policy, terms used in this Privacy Policy have the same meanings as in our Terms and Conditions.</p><p>Information Collection And Use</p><p>We collect several different types of information for various purposes to provide and improve our Service to you.</p><p>Types of Data Collected</p><p>Personal Data</p><p>While using our Service, we may ask you to provide us with certain personally identifiable information that can be used to contact or identify you (â€œPersonal Dataâ€). Personally identifiable information may include, but is not limited to:</p><p>First name and last name<br>Cookies and Usage Data<br>Usage Data</p><p>When you access the Service by or through a mobile device, we may collect certain information automatically, including, but not limited to, the type of mobile device you use, your mobile device unique ID, the IP address of your mobile device, your mobile operating system, the type of mobile Internet browser you use, unique device identifiers and other diagnostic data (â€œUsage Dataâ€).</p><p>Tracking &amp; Cookies Data</p><p>We use cookies and similar tracking technologies to track the activity on our Service and hold certain information.</p><p>Cookies are files with small amount of data which may include an anonymous unique identifier. Cookies are sent to your browser from a website and stored on your device. Tracking technologies also used are beacons, tags, and scripts to collect and track information and to improve and analyze our Service.</p><p>You can instruct your browser to refuse all cookies or to indicate when a cookie is being sent. However, if you do not accept cookies, you may not be able to use some portions of our Service.</p><p>Examples of Cookies we use:</p><p>Session Cookies. We use Session Cookies to operate our Service.<br>Preference Cookies. We use Preference Cookies to remember your preferences and various settings.<br>Security Cookies. We use Security Cookies for security purposes.<br>Use of Data</p><p>å°æ—¥å† uses the collected data for various purposes:</p><p>To provide and maintain the Service<br>To notify you about changes to our Service<br>To allow you to participate in interactive features of our Service when you choose to do so<br>To provide customer care and support<br>To provide analysis or valuable information so that we can improve the Service<br>To monitor the usage of the Service<br>To detect, prevent and address technical issues<br>Transfer Of Data</p><p>Your information, including Personal Data, may be transferred to â€” and maintained on â€” computers located outside of your state, province, country or other governmental jurisdiction where the data protection laws may differ than those from your jurisdiction.</p><p>If you are located outside China and choose to provide information to us, please note that we transfer the data, including Personal Data, to China and process it there.</p><p>Your consent to this Privacy Policy followed by your submission of such information represents your agreement to that transfer.</p><p>å°æ—¥å† will take all steps reasonably necessary to ensure that your data is treated securely and in accordance with this Privacy Policy and no transfer of your Personal Data will take place to an organization or a country unless there are adequate controls in place including the security of your data and other personal information.</p><p>Disclosure Of Data</p><p>Legal Requirements</p><p>å°æ—¥å† may disclose your Personal Data in the good faith belief that such action is necessary to:</p><p>To comply with a legal obligation<br>To protect and defend the rights or property of å°æ—¥å†<br>To prevent or investigate possible wrongdoing in connection with the Service<br>To protect the personal safety of users of the Service or the public<br>To protect against legal liability<br>Security Of Data</p><p>The security of your data is important to us, but remember that no method of transmission over the Internet, or method of electronic storage is 100% secure. While we strive to use commercially acceptable means to protect your Personal Data, we cannot guarantee its absolute security.</p><p>Service Providers</p><p>We may employ third party companies and individuals to facilitate our Service (â€œService Providersâ€), to provide the Service on our behalf, to perform Service-related services or to assist us in analyzing how our Service is used.</p><p>These third parties have access to your Personal Data only to perform these tasks on our behalf and are obligated not to disclose or use it for any other purpose.</p><p>Links To Other Sites</p><p>Our Service may contain links to other sites that are not operated by us. If you click on a third party link, you will be directed to that third partyâ€™s site. We strongly advise you to review the Privacy Policy of every site you visit.</p><p>We have no control over and assume no responsibility for the content, privacy policies or practices of any third party sites or services.</p><p>Childrenâ€™s Privacy</p><p>Our Service does not address anyone under the age of 18 (â€œChildrenâ€).</p><p>We do not knowingly collect personally identifiable information from anyone under the age of 18. If you are a parent or guardian and you are aware that your Children has provided us with Personal Data, please contact us. If we become aware that we have collected Personal Data from children without verification of parental consent, we take steps to remove that information from our servers.</p><p>Changes To This Privacy Policy</p><p>We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page.</p><p>We will let you know via email and/or a prominent notice on our Service, prior to the change becoming effective and update the â€œeffective dateâ€ at the top of this Privacy Policy.</p><p>You are advised to review this Privacy Policy periodically for any changes. Changes to this Privacy Policy are effective when they are posted on this page.</p><p>Contact Us</p><p>If you have any questions about this Privacy Policy, please contact us:</p><p>By visiting this page on our website: <a href="https://crmo.github.io">https://crmo.github.io</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Privacy Policy&lt;/p&gt;
&lt;p&gt;Effective date: October 10, 2018&lt;/p&gt;
&lt;p&gt;å°æ—¥å† (â€œusâ€, â€œweâ€, or â€œourâ€) operates the å°æ—¥å† mobile application (the â€œServic
      
    
    </summary>
    
    
      <category term="éšç§æ”¿ç­–" scheme="https://crmo.github.io/tags/%E9%9A%90%E7%A7%81%E6%94%BF%E7%AD%96/"/>
    
  </entry>
  
  <entry>
    <title>UIButton çŠ¶æ€å°ç»“</title>
    <link href="https://crmo.github.io/2019/10/07/UIButton%20%E7%8A%B6%E6%80%81%E5%B0%8F%E7%BB%93/"/>
    <id>https://crmo.github.io/2019/10/07/UIButton çŠ¶æ€å°ç»“/</id>
    <published>2019-10-06T16:00:00.000Z</published>
    <updated>2019-10-07T07:57:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p>æˆ‘ä»¬å…ˆä»ä¸€ä¸ªé—®é¢˜è¯´èµ·ï¼Œå°æ˜åŒå­¦æ¥åˆ°äº§å“çš„ä¸€ä¸ªæ–°éœ€æ±‚ï¼šå®ç°ä¸€ä¸ª <code>UIButton</code>ï¼Œè¦æ±‚åœ¨ normalã€selectedã€highlighted ä¸‰ç§çŠ¶æ€ä¸‹å±•ç¤ºä¸åŒæ–‡æ¡ˆã€‚è¿™ç®€ç›´å¤ªç®€å•äº†ï¼Œå°æ˜åŒå­¦1åˆ†é’Ÿä¸åˆ°å°±å®ç°äº†ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[button setTitle:<span class="string">@"normal"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">[button setTitle:<span class="string">@"highlighted"</span> forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">[button setTitle:<span class="string">@"selected"</span> forState:<span class="built_in">UIControlStateSelected</span>];</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</p><p>çš„ç¡®æœ‰é—®é¢˜ï¼å½“ <code>button</code> çŠ¶æ€ä¸º <code>selected</code> æ—¶ï¼Œç‚¹å‡»æŒ‰é’®ï¼Œæ–‡æ¡ˆå±•ç¤º <code>normal</code>ï¼Œå½“å‰çŠ¶æ€åº”è¯¥æ˜¯ <code>UIControlStateHighlighted</code>ï¼Œæ€ä¹ˆå±•ç¤ºäº† <code>UIControlStateNormal</code> çš„æ–‡æ¡ˆï¼Ÿ</p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p><code>UIButton</code> æœ‰5ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ï¼šdefault(normal), highlighted, focused, selected, disabledï¼Œé€šè¿‡å±æ€§ <code>state</code> å¯ä»¥æ‹¿åˆ°å½“å‰çŠ¶æ€å€¼ <code>UIControlState</code>ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>) <span class="built_in">UIControlState</span> state;                  <span class="comment">// could be more than one state (e.g. disabled|selected). synthesized from other flags.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, <span class="built_in">UIControlState</span>) &#123;</span><br><span class="line">    <span class="built_in">UIControlStateNormal</span>       = <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">UIControlStateHighlighted</span>  = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,                  <span class="comment">// used when UIControl isHighlighted is set</span></span><br><span class="line">    <span class="built_in">UIControlStateDisabled</span>     = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line">    <span class="built_in">UIControlStateSelected</span>     = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,                  <span class="comment">// flag usable by app (see below)</span></span><br><span class="line">    <span class="built_in">UIControlStateFocused</span> <span class="built_in">NS_ENUM_AVAILABLE_IOS</span>(<span class="number">9</span>_0) = <span class="number">1</span> &lt;&lt; <span class="number">3</span>, <span class="comment">// Applicable only when the screen supports focus</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°ä½è¿ç®—æˆ‘ä»¬å°±å¯ä»¥çŒœåˆ°è¿™ä¸ªçŠ¶æ€å¯ä»¥ç»„åˆï¼Œè€Œä¸”æœ‰å¥å¾ˆå…³é”®çš„æ³¨é‡Šï¼š</p><blockquote><p>could be more than one state (e.g. disabled|selected). synthesized from other flags.<br>state ä¸æ˜¯å•ç‹¬çš„çŠ¶æ€ï¼Œå¯ä»¥æ˜¯å¤šç§çŠ¶æ€çš„æ··åˆã€‚</p></blockquote><p>æˆ‘ä»¬åœ¨å›åˆ°ä¸Šé¢çš„å°æ˜åŒå­¦é‡åˆ°çš„é—®é¢˜ï¼Œå½“ <code>button</code> çŠ¶æ€ä¸º <code>selected</code> æ—¶ï¼Œç‚¹å‡»æŒ‰é’®ï¼ŒæŒ‰é’®æ­¤æ—¶çš„çŠ¶æ€å…¶å®æ˜¯ <code>UIControlStateHighlighted | UIControlStateSelected</code>ã€‚åœ¨<a href="https://developer.apple.com/documentation/uikit/uibutton/1624018-settitle?language=objc" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¹ˆä¸€å¥è¯ï¼š</p><blockquote><p>If a title is not specified for a state, the default behavior is to use the title associated with the UIControlStateNormal state</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´å°æ˜åŒå­¦å…¶å®æ¼è®¾ç½®äº†ä¸€ç§çŠ¶æ€ï¼Œç„¶åç³»ç»Ÿå±•ç¤ºäº†æŒ‰é’®çš„é»˜è®¤çŠ¶æ€ <code>UIControlStateNormal</code>ï¼ŒæŒ‰é’®çŠ¶æ€å¹¶ä¸æ˜¯æ˜¯ <code>UIControlStateNormal</code>ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>1ã€<code>UIControlState</code> æ˜¯ä¸ªç»„åˆçŠ¶æ€ï¼Œåœ¨ <code>setTitle:forState:</code>ã€<code>setImage:forState:</code> æ—¶ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰ <code>UIControlStateSelected</code> çŠ¶æ€ï¼Œä¸€å®šè¦æ³¨æ„è‡ªå®šä¹‰ <code>UIControlStateHighlighted | UIControlStateSelected</code>ã€‚<br>2ã€å¦‚æœæŒ‰é’®çš„å½“å‰çŠ¶æ€æ²¡æœ‰è‡ªå®šä¹‰ï¼Œä½¿ç”¨ <code>UIControlStateNormal</code> å®šä¹‰çš„å€¼ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ¡ˆä¾‹&quot;&gt;&lt;a href=&quot;#æ¡ˆä¾‹&quot; class=&quot;headerlink&quot; title=&quot;æ¡ˆä¾‹&quot;&gt;&lt;/a&gt;æ¡ˆä¾‹&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬å…ˆä»ä¸€ä¸ªé—®é¢˜è¯´èµ·ï¼Œå°æ˜åŒå­¦æ¥åˆ°äº§å“çš„ä¸€ä¸ªæ–°éœ€æ±‚ï¼šå®ç°ä¸€ä¸ª &lt;code&gt;UIButton&lt;/code&gt;ï¼Œè¦æ±‚åœ¨ normalã€select
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>2019å¹´iOSé¢è¯•æ”»ç•¥</title>
    <link href="https://crmo.github.io/2019/06/16/2019%E5%B9%B4iOS%E9%9D%A2%E8%AF%95%E6%94%BB%E7%95%A5/"/>
    <id>https://crmo.github.io/2019/06/16/2019å¹´iOSé¢è¯•æ”»ç•¥/</id>
    <published>2019-06-15T16:00:00.000Z</published>
    <updated>2019-06-30T08:39:23.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç¬”è€…å·¥ä½œç»éªŒ4å¹´ï¼Œç»è¿‡ä¸€å¹´çš„ç²¾å¿ƒå‡†å¤‡ï¼Œæ‹¿åˆ°äº†å­—èŠ‚è·³åŠ¨å’Œè…¾è®¯çš„ Offerï¼Œåœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘çš„ä¸€äº›å¿ƒå¾—ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°æœ‰éœ€è¦çš„åŒå­¦ã€‚</p></blockquote><h2 id="ä¸€ã€æ‘†æ­£å¿ƒæ€"><a href="#ä¸€ã€æ‘†æ­£å¿ƒæ€" class="headerlink" title="ä¸€ã€æ‘†æ­£å¿ƒæ€"></a>ä¸€ã€æ‘†æ­£å¿ƒæ€</h2><p>æˆ‘åŠ äº†å¥½å‡ ä¸ª iOS æŠ€æœ¯äº¤æµç¾¤ï¼Œå‘ç°å¤§å®¶éƒ½æœ‰ä¸€ä¸ªå…±è¯† â€iOS æ²¡äººè¦äº†â€œ ğŸ˜‚ï¼Œå…¶å®å¾ˆå¤§éƒ¨åˆ†æ˜¯å¤§ä½¬ä»¬çš„è‡ªå˜²ï¼ˆå½“çœŸä½ å°±è¾“äº†ï¼‰ï¼Œä¸è¿‡ä¹Ÿä»ä¾§é¢å°è¯å‡ºç§»åŠ¨ç«¯å¼€å‘å¸‚åœºçš„è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼ŒåŠ ä¸Šå¸‚åœºå¤§ç¯å¢ƒä¸å¥½ï¼Œæƒ³è¦æ–©è·å¤§å‚ Offer éš¾åº¦è¶Šæ¥è¶Šå¤§ã€‚</p><p>ä½†æ˜¯ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬æ²¡å¿…è¦ä¸ºè¿™äº›äº‹æƒ…æ‰€çƒ¦æ‰°ï¼Œè¶Šæ˜¯å¯’å†¬ï¼Œæˆ‘ä»¬æ›´åº”å½“å……å®è‡ªå·±ï¼Œè®©è‡ªå·±å˜å¾—ç¨€ç¼ºï¼Œå¸‚åœºæ€»ä¼šç»™åˆ°ä½ æ»¡æ„çš„æŠ¥é…¬ã€‚æˆ‘ä»¬æ—¢ç„¶é€‰æ‹©äº†è¿™ä¸ªé«˜é€Ÿå‘å±•çš„è¡Œä¸šï¼Œè‡ªå·±å°±åº”è¯¥å……æ»¡æ´»åŠ›ï¼Œä¿æŒå­¦ä¹ çš„å¿ƒæ€å’Œæƒ¯æ€§ã€‚</p><p>æ‰€ä»¥åº”å¯¹èµ„æœ¬å¯’å†¬ï¼Œæˆ‘ä»¬åº”è¯¥ä¿æŒå¹³å’Œçš„å¿ƒæ€ï¼Œæ½œå¿ƒå­¦ä¹ ï¼Œç­‰å¾…æœºä¼šã€‚</p><p>åˆ†äº«ä¸‹ä¸ºäº†å¤§å‚Offeræ‰€åšçš„å‡†å¤‡å·¥ä½œï¼š</p><ol><li>åšæŒé˜…è¯»æŠ€æœ¯ä¹¦ç±ã€æŠ€æœ¯åšå®¢ã€æŠ€æœ¯æ–‡æ¡£</li><li>è¾“å‡ºæŠ€æœ¯åšå®¢</li><li>é˜…è¯»å¼€æºé¡¹ç›®æºç </li><li>å°è¯•ç‹¬ç«‹å¼€å‘ï¼Œç‹¬ç«‹å®Œæˆè‡ªå·±çš„APP</li><li>ç»ƒä¹ ç®—æ³•é¢˜</li></ol><h2 id="äºŒã€é˜…è¯»æŠ€æœ¯ä¹¦ç±ã€åšå®¢"><a href="#äºŒã€é˜…è¯»æŠ€æœ¯ä¹¦ç±ã€åšå®¢" class="headerlink" title="äºŒã€é˜…è¯»æŠ€æœ¯ä¹¦ç±ã€åšå®¢"></a>äºŒã€é˜…è¯»æŠ€æœ¯ä¹¦ç±ã€åšå®¢</h2><p>é€šè¿‡é˜…è¯»æŠ€æœ¯ä¹¦ç±ã€åšå®¢ã€æ–‡æ¡£ï¼Œå¯ä»¥å¿«é€Ÿå­¦ä¹ åˆ°å¤§ä½¬ä»¬æ€»ç»“çš„ç»éªŒï¼Œå®Œå–„è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ï¼Œæ‰©å®½çŸ¥è¯†é¢ã€‚åˆ†äº«ä¸‹æˆ‘è·å–çŸ¥è¯†çš„æ¸ é“å§ï¼š</p><ul><li><p>æ˜é‡‘ï¼š<a href="https://juejin.im" target="_blank" rel="noopener">æ˜é‡‘</a>æˆ‘æœºä¼šæ¯å¤©éƒ½è¦ä¸Šå»çœ‹çœ‹ï¼Œä¸ªäººè®¤ä¸ºæ˜é‡‘æ˜¯å›½å†… iOS æŠ€æœ¯ç¤¾åŒºä¸­å«é‡‘é‡è¾ƒé«˜çš„äº†ï¼Œå¼ºåŠ›æ¨èæ˜é‡‘ä¸Šçš„ä¸€ä¸ªä¸“æ ã€Šè€å¸æœº iOS å‘¨æŠ¥ã€‹ï¼Œæ˜¯ä¸€çº¿å¤§ä½¬ä»¬ç²¾å¿ƒæŒ‘é€‰çš„æ–‡ç« ï¼Œçœ‹å°±å¯¹äº†ğŸ˜ã€‚</p></li><li><p>å°ä¸“æ ï¼šè¿™æ˜¯ä¸€ä¸ªä»˜è´¹çš„çŸ¥è¯†å¹³å°ï¼Œç”±äºä»˜è´¹çš„åŸå› ï¼Œä½œè€…åœ¨æ–‡ç« æ›´æ–°é¢‘ç‡å’Œæ›´æ–°è´¨é‡ä¸Šéƒ½æœ‰æ‰€ä¿è¯ã€‚æˆ‘è®¢é˜…äº†35ä¸ªä¸“æ ï¼ˆåˆ«é—®æˆ‘éƒ½å­¦å®Œæ²¡ï¼Œè®¢é˜…äº†å°±ç®—å­¦ä¹ äº†ğŸ˜‚ï¼‰ã€‚æ¨èå‡ ä¸ªä¸é”™çš„ä¸“æ ï¼Œ<a href="https://xiaozhuanlan.com/LeetCodeGIF?rel=8008493458" target="_blank" rel="noopener">ã€Šåœ¨PPTåŠ¨ç”»ä¸­å­¦ç®—æ³•ã€‹</a>ã€<a href="https://xiaozhuanlan.com/wwdc19?rel=8008493458" target="_blank" rel="noopener">ã€ŠWWDC19 å†…å‚ã€‹</a>ã€<a href="https://xiaozhuanlan.com/colin?rel=8008493458" target="_blank" rel="noopener">ã€ŠiOS å›¾åƒå¤„ç†ã€‹</a>ã€<a href="https://xiaozhuanlan.com/daydaystudy?rel=8008493458" target="_blank" rel="noopener">ã€Šå›¾è§£æ•°æ®ç»“æ„ã€‹</a>ã€<a href="https://xiaozhuanlan.com/Effective-Mac?rel=8008493458" target="_blank" rel="noopener">ã€ŠMac é«˜æ•ˆå¼€å‘æŒ‡å—ã€‹</a>ã€<a href="https://xiaozhuanlan.com/app-architecture?rel=8008493458" target="_blank" rel="noopener">ã€ŠApp æ¶æ„ã€‹</a></p></li><li><p>çŸ¥è¯†å°é›†ï¼šè¿™æ˜¯ä¸ªå…¬ä¼—å·ï¼Œæ˜¯ä¸€ç¾¤å¤§ä½¬å…±åŒç»´æŠ¤çš„ï¼Œæ›´æ–°é¢‘ç¹ï¼Œæ–‡ç« è´¨é‡ä¸é”™ã€‚</p></li><li><p>ä¹¦ç±æ¨èï¼šã€ŠEffective Objective-C 2.0  ç¼–å†™é«˜è´¨é‡iOSä¸OS Xä»£ç çš„52ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹ã€ã€ŠObjective-C é«˜çº§ç¼–ç¨‹ iOSå’ŒOS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹ã€ã€ŠOBJECTIVEï¼Cç¼–ç¨‹ä¹‹é“  IOSè®¾è®¡æ¨¡å¼è§£æã€‹ã€ã€Šé«˜æ€§èƒ½iOSåº”ç”¨å¼€å‘ã€‹ã€ã€ŠiOS Core Animation Advanced Techniquesã€‹ã€ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹ã€‚è¿™äº›ä¹¦æˆ‘è¯»äº†å¥½å‡ éï¼Œæ¯æ¬¡è¯»éƒ½æœ‰æ–°çš„æ”¶è·ã€‚</p></li><li><p>åšå®¢æ¨èï¼šè¿™ç¯‡æ–‡ç« æ€»ç»“çš„å¾ˆå¥½ï¼Œç›´æ¥åˆ†äº«ç»™å¤§å®¶<a href="https://juejin.im/post/5a941ef96fb9a06346201d9e" target="_blank" rel="noopener">é«˜è´¨é‡ iOS åšå®¢æ¨è</a>ã€‚</p></li><li><p>æå®¢æ—¶é—´ï¼šæå®¢æ—¶é—´æ˜¯ä¸“é—¨ä¸ºç¨‹åºå‘˜æ‰“é€ çš„çŸ¥è¯†æœåŠ¡å¹³å°ï¼Œæ¶µç›–äº†å„ä¸ªé¢†åŸŸçš„çŸ¥è¯†ï¼Œä¸Šé¢çš„è¯¾ç¨‹å€¼å¾—ä¸€å­¦ï¼Œæ¨èæ»´æ»´æŠ€æœ¯ä¸“å®¶æˆ´é“­å¤§ä½¬çš„è¯¾ç¨‹ <a href="http://gk.link/a/103UK" target="_blank" rel="noopener">ã€ŠiOSå¼€å‘é«˜æ‰‹è¯¾ã€‹</a>ã€‚</p></li></ul><h2 id="ä¸‰ã€è¾“å‡ºæŠ€æœ¯åšå®¢"><a href="#ä¸‰ã€è¾“å‡ºæŠ€æœ¯åšå®¢" class="headerlink" title="ä¸‰ã€è¾“å‡ºæŠ€æœ¯åšå®¢"></a>ä¸‰ã€è¾“å‡ºæŠ€æœ¯åšå®¢</h2><p>åªé˜…è¯»ä¹¦ç±ã€æ–‡ç« è¿˜è¿œè¿œä¸å¤Ÿï¼Œè¾“å‡ºæ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹å¼ï¼Œåœ¨è¾“å‡ºçš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå‘ç°å¾ˆå¤šç»†èŠ‚å…¶å®è‡ªå·±å¹¶æ²¡æœ‰æŒæ¡ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿåœ¨åšæŒè¾“å‡ºæŠ€æœ¯åšå®¢ã€‚åŒæ—¶æŠ€æœ¯åšå®¢ä¹Ÿæ˜¯å¾ˆå¥½çš„ç®€å†ï¼Œæ¯”èµ·ç®€å†ä¸Šçš„ä¸€å¥ â€ç²¾é€šXXXæŠ€æœ¯â€œï¼Œä¸€ç¯‡ç²¾å½©çš„ â€XXXæŠ€æœ¯è§£æâ€œ æ˜¯ä¸æ˜¯æ›´æœ‰è¯´æœåŠ›å‘¢ï¼Ÿ</p><p>æˆ‘ä»å¼€å§‹å·¥ä½œå°±å¼€å§‹å†™æŠ€æœ¯åšå®¢ï¼Œåˆšå¼€å§‹äº§é‡æ¯”è¾ƒä½ã€‚ç›´åˆ°ä¸€æœ¬ä¹¦æ”¹å˜äº†æˆ‘å¯¹å†™ä½œçš„çœ‹æ³•ï¼ŒSpenser å¤§ç¥çš„ã€Šå†™ä½œæ˜¯æœ€å¥½çš„è‡ªæˆ‘æŠ•èµ„ã€‹ï¼Œä»¥å‰ä¸€ç›´è®¤ä¸ºå†™æ–‡ç« å¾ˆéš¾ï¼Œè¦å†™çš„å®Œç¾æ‰æ•¢å‘å‡ºæ¥ï¼Œå¾ˆå¤šæ—¶å€™åˆ›ä½œæ¿€æƒ…æ¥äº†ï¼Œå†™ä¸¤ä¸ªå­—ï¼Œçœ‹äº†çœ‹å«Œå¼ƒè‡ªå·±å†™çš„å¤ªçƒ‚åˆé»˜é»˜çš„åˆ æ‰äº†ï¼Œæœ€åå•¥ä¹Ÿæ²¡æœ‰ç•™ä¸‹æ¥ã€‚çœ‹å®Œè¿™æœ¬ä¹¦æ‰æ˜ç™½ï¼Œä»¥å‰çš„æƒ³æ³•å°±æ˜¯ä½œèŒ§è‡ªç¼šï¼Œè¦å…ˆåŠ¨æ‰‹å†™ï¼Œå¤šå†™ï¼Œç§¯ç´¯å¤šäº†è‡ªç„¶å°±ä¼šå†™äº†ã€‚</p><p>äºæ˜¯ä¸‹å®šå†³å¿ƒï¼Œå…ˆå†™èµ·æ¥ï¼Œç”¨ Hexo æ­å»ºäº†æŠ€æœ¯åšå®¢ï¼ˆ<a href="http://crmo.github.io">ä¼ é€é—¨</a>ï¼‰ï¼Œåœ¨<a href="https://www.jianshu.com/u/714b759c0a3c" target="_blank" rel="noopener">ç®€ä¹¦</a>ä¸Šä¹ŸåŒæ­¥æ›´æ–°ã€‚æŠŠå¯¹è‡ªå·±çš„è¦æ±‚å’ŒæœŸæœ›æ”¾ä½ï¼Œä¸æ±‚å†™å‡ºåƒéœœç¥ã€å–µç¥ç­‰å¤§ç¥ä»¬æ•™ç§‘ä¹¦èˆ¬çš„ç»å…¸æ–‡ç« ï¼Œå°±åˆ†äº«ä¸€äº›å·¥ä½œå­¦ä¹ ä¸­é‡åˆ°çš„å° tipã€‚æ¸æ¸ä¹Ÿæ”¶è·åˆ°äº†å¤§å®¶çš„ä¸€äº›å–œæ¬¢å’Œè¯„è®ºï¼Œå‘ç°å¸®åŠ©äº†ä¸€äº›æœ‰éœ€è¦çš„æœ‹å‹ï¼Œå°±æ›´åŠ åšå®šè‡ªå·±çš„è·¯æ˜¯èµ°å¯¹äº†ã€‚</p><h2 id="å››ã€æŒ‘æˆ˜ç®—æ³•è¿™ç§å¤§å±±"><a href="#å››ã€æŒ‘æˆ˜ç®—æ³•è¿™ç§å¤§å±±" class="headerlink" title="å››ã€æŒ‘æˆ˜ç®—æ³•è¿™ç§å¤§å±±"></a>å››ã€æŒ‘æˆ˜ç®—æ³•è¿™ç§å¤§å±±</h2><p>ç®—æ³•æ˜¯ä¸€ä¸ªåˆæ ¼ç¨‹åºå‘˜å¿…å¤‡çš„å†…åŠŸå¿ƒæ³•ï¼Œæ˜¯è¿›å…¥å¤§å‚å¿…å¤‡çš„æŠ€èƒ½ï¼Œä¸è¿‡å¤§å®¶å¸¸å¸¸ä¼šäº§ç”Ÿä¸€äº›è¯¯è§£ï¼Œæœ‰ä¸¤ç§æç«¯ï¼š</p><p>1ã€è®¤ä¸ºç®—æ³•å¾ˆéš¾ï¼Œåƒæ´ªæ°´çŒ›å…½ä¸€èˆ¬éš¾ä»¥å…‹æœï¼Œä¸€å †æ•°æ®ç»“æ„ï¼Œå„ç§æŠ½è±¡çš„æ•°å­¦å…¬å¼ï¼Œäºæ˜¯å°±æ”¾å¼ƒäº†ã€‚<br>2ã€è®¤ä¸ºç®—æ³•æ²¡ç”¨ï¼Œä¹‹å‰é¢è¯•çš„æ—¶å€™å’Œå¾ˆå¤šiOSå¼€å‘èŠè¿‡ç®—æ³•çš„é—®é¢˜ï¼Œå‘ç°å¾ˆå¤šäººéƒ½è§‰å¾—ç®—æ³•åœ¨ç§»åŠ¨ç«¯å¼€å‘ä¹Ÿæ²¡å•¥ç”¨ï¼Œåšäº†å¥½å‡ å¹´å¼€å‘äº†éƒ½æ²¡ç”¨åˆ°è¿‡ï¼Œå”¯ä¸€æœ‰å…³ç³»çš„æ•°ç»„æ’åºï¼ŒæŸ¥è¯¢å•¥çš„ç³»ç»Ÿåº“éƒ½å°è£…å¥½äº†ï¼Œä¸éœ€è¦è‡ªå·±å»å®ç°ã€‚æ›¾ç»çš„æˆ‘ä¹Ÿè¿™ä¹ˆæƒ³è¿‡ï¼Œä¸è¿‡åœ¨ä½“ä¼šè¿‡ç®—æ³•çš„ç²¾å¦™ä¹‹åï¼Œæˆ‘æ‰é¢†æ‚Ÿåˆ°ç®—æ³•çš„é‡è¦æ€§ã€‚</p><p>æˆ‘è®¤ä¸ºé¦–å…ˆç®—æ³•å¾ˆæœ‰ç”¨ï¼Œå…¶æ¬¡ç®—æ³•å¹¶ä¸éš¾ï¼Œè€Œä¸”å¾ˆæœ‰è¶£ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å¼€å‘åŠŸèƒ½æ—¶ï¼Œä¸ºäº†æ»¡è¶³äº§å“å˜æ€çš„éœ€æ±‚ï¼Œéš¾å…æœ‰ç³»ç»Ÿç±»æä¾›çš„APIä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œè¿™æ—¶å€™ç§æœ‰å˜é‡å°±å¯ä»¥å‘æŒ¥å®ƒå…‰å’Œçƒ­äº†ã€‚æ€ä¹ˆé€šè¿‡ä¸€ä¸ªç±»ï¼Œä¸€å±‚ä¸€å±‚çš„æ‰¾åˆ°ç‰¹å®šç±»å‹çš„ç§æœ‰æˆå‘˜å˜é‡ï¼Ÿåœ¨å­¦ä¹ äº†å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰ç®—æ³•ä¹‹åï¼Œæˆ‘åˆ©ç”¨BFSå†™äº†ä¸€ä¸ªå·¥å…·ç±»æ¥å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œ</p><blockquote><p>è¯¦æƒ…è§<a href="http://crmo.github.io/2018/07/31/runtimeå®ç°ç§æœ‰å˜é‡æœç´¢/">runtimeå®ç°ç§æœ‰å˜é‡æœç´¢</a>ã€‚</p></blockquote><p>é™¤äº†è§£å†³å¼€å‘ä¸­çš„é—®é¢˜ï¼Œå½“ç„¶å­¦ä¹ ç®—æ³•è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ä½œç”¨ï¼Œåº”å¯¹å¤§å‚é¢è¯•ï¼Œç°åœ¨å¤§å‚å¯¹äºç®—æ³•è¿˜æ˜¯æ¯”è¾ƒé‡è§†çš„ï¼Œæˆ‘åœ¨é¢è¯•å­—èŠ‚è·³åŠ¨çš„æ—¶å€™ï¼Œæ¯ä¸€è½®æŠ€æœ¯é¢ç»“æŸéƒ½æœ‰ä¸€é“ç®—æ³•é¢˜ï¼Œéš¾åº¦ä¸å¤§ï¼Œä½†æ˜¯å¾ˆè€ƒéªŒå¹³æ—¶çš„ç§¯ç´¯ã€‚æˆ‘åˆ†äº«ä¸‹æˆ‘çš„å­¦ä¹ æ–¹æ³•å§ï¼š</p><ul><li>é¦–å…ˆæ˜¯ç³»ç»Ÿçš„å­¦ä¹ ç›¸å…³çŸ¥è¯†ï¼Œæ¨èä¸¤ä¸ªå­¦ä¹ ç®—æ³•çš„ä¸“æ <a href="https://xiaozhuanlan.com/LeetCodeGIF?rel=8008493458" target="_blank" rel="noopener">ã€Šåœ¨PPTåŠ¨ç”»ä¸­å­¦ç®—æ³•ã€‹</a>ã€<a href="https://xiaozhuanlan.com/daydaystudy?rel=8008493458" target="_blank" rel="noopener">ã€Šå›¾è§£æ•°æ®ç»“æ„ã€‹</a>ï¼Œæœ‰å¤šä½™çš„æ—¶é—´æœ€å¥½èƒ½çœ‹çœ‹è¿™ä¸¤æœ¬ä¹¦ã€Šç®—æ³•ã€‹ã€ã€Šå‰‘æŒ‡Offerã€‹ï¼ˆé¢è¯•å¿…å¤‡ï¼ï¼‰ã€‚</li><li>ç„¶åå°±æ˜¯ç»ƒé¢˜äº†ï¼Œä¸€å®šè¦å¤šç»ƒé¢˜ï¼ï¼<a href="https://leetcode.com" target="_blank" rel="noopener">Leetcode</a>æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å¹³å°ï¼ŒåšæŒæ¯å‘¨åˆ·ä¸¤é“é¢˜ï¼Œä¸€å¹´å°±èƒ½åšå¿«100é“é¢˜ï¼Œåº”å¯¹é¢è¯•ä¹Ÿå°±å·®ä¸å¤šäº†(æˆ‘åˆ·äº†97é“)ã€‚</li></ul><h2 id="äº”ã€å°è¯•ç‹¬ç«‹å¼€å‘"><a href="#äº”ã€å°è¯•ç‹¬ç«‹å¼€å‘" class="headerlink" title="äº”ã€å°è¯•ç‹¬ç«‹å¼€å‘"></a>äº”ã€å°è¯•ç‹¬ç«‹å¼€å‘</h2><p>æˆ‘ä¸€ç›´éƒ½æœ‰å¾ˆå¤šideaï¼Œä½†æ˜¯ä¸€ç›´éƒ½æ²¡ç‹ ä¸‹å¿ƒæ¥åšï¼Œåæ¥æœ‰å¹¸æ¥è§¦äº†å¼€æºå¤§ä½¬çš„ä¸“æ <a href="https://xiaozhuanlan.com/kyxuDev?rel=8008493458" target="_blank" rel="noopener">ã€ŠKyXu æ•™ä½ ç‹¬ç«‹å¼€å‘èµšé’±ã€‹</a>ï¼Œä»–ä»¥ç¨‹åºå‘˜çš„è§’åº¦ï¼Œå±•ç°äº†ä¸€ä¸ªäº§å“çš„ä»0åˆ°1çš„å…¨è²Œï¼Œè®©æˆ‘å¿ƒé©°ç¥å¾€ï¼Œäºæ˜¯å¿ƒä¸€æ¨ªï¼Œè´­ä¹°äº†ä¸€ä¸ªå¼€å‘è€…è´¦å·ã€‚åœ¨2018å¹´ä¸Šæ¶äº†ä¸¤æ¬¾ç‹¬ç«‹åº”ç”¨<a href="http://t.cn/EAs5ubq" target="_blank" rel="noopener">è¯†ä¹‹</a>å’Œ<a href="https://dwz.cn/HvVix2hH" target="_blank" rel="noopener">é¦™è•‰æ’­æ”¾å™¨</a>ï¼Œç§¯ç´¯äº†ä¸€äº›æŠ€æœ¯ä¹‹å¤–çš„ç»éªŒï¼Œæ¯”å¦‚äº§å“ã€è®¾è®¡ã€è¿è¥ä¹‹ç±»çš„ï¼Œæ„Ÿè§‰æ”¶è·è¿˜æ˜¯è›®å¤§çš„ã€‚</p><p>è¿™é‡Œæ¨èä¸¤æœ¬å…³äºè®¾è®¡çš„ç”µå­ä¹¦ï¼š<a href="https://xiaozhuanlan.com/Producter?rel=8008493458" target="_blank" rel="noopener">ã€ŠProducterï¼šè®©äº§å“ä» 0 åˆ° 1ã€‹</a>ã€<a href="https://xiaozhuanlan.com/larry?rel=8008493458" target="_blank" rel="noopener">ã€Šç¨‹åºå‘˜èŠè®¾è®¡ã€‹</a>ã€‚</p><hr><p><strong>æœ€åï¼Œç¥å„ä½æ‹¿åˆ°å¿ƒä»ªçš„Offerï¼ï¼ˆğŸ‘»ç‚¹èµå¹¶åˆ†äº«ç¥ç¦åŠ å€ï¼‰ã€‚</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ç¬”è€…å·¥ä½œç»éªŒ4å¹´ï¼Œç»è¿‡ä¸€å¹´çš„ç²¾å¿ƒå‡†å¤‡ï¼Œæ‹¿åˆ°äº†å­—èŠ‚è·³åŠ¨å’Œè…¾è®¯çš„ Offerï¼Œåœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘çš„ä¸€äº›å¿ƒå¾—ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°æœ‰éœ€è¦çš„åŒå­¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä¸€ã€æ‘†æ­£å¿ƒæ€&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ‘†æ­£å¿ƒæ€&quot; class=&quot;
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>GCD è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</title>
    <link href="https://crmo.github.io/2019/06/16/GCD%20%E8%A7%A3%E5%86%B3%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98/"/>
    <id>https://crmo.github.io/2019/06/16/GCD è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜/</id>
    <published>2019-06-15T16:00:00.000Z</published>
    <updated>2019-06-16T03:55:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¯´èµ·ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼ˆProducer-consumer problemï¼‰ï¼Œç›¸ä¿¡å¤§å®¶éƒ½å°è±¡æ·±åˆ»ï¼Œæœ‰é—å¿˜å¯ä»¥çœ‹çœ‹<a href="https://zh.wikipedia.org/wiki/ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜#ä½¿ç”¨ä¿¡å·ç¯çš„ç®—æ³•" target="_blank" rel="noopener">wiki</a>ä¸Šçš„è§£é‡Šï¼Œæˆ‘ä»¬ä»Šå¤©æ¥èŠèŠæ€ä¹ˆç”¨ GCD å®ç°ä¸€ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ã€‚</p><p>æˆ‘ä»¬å…ˆç†ä¸€ä¸‹æ€è·¯ï¼Œçœ‹çœ‹é—®é¢˜å…³é”®ç‚¹ï¼š</p><ol><li>ç”Ÿäº§è€…ç”Ÿæˆäº§å“æ”¾åˆ°ç¼“å†²åŒºä¸­ï¼Œç„¶åé‡å¤æ­¤è¿‡ç¨‹ï¼Œä½†æ˜¯ç”Ÿäº§çš„äº§å“æ•°é‡ä¸èƒ½è¶…è¿‡ç¼“å†²åŒºå¤§å°ï¼Œå¦‚æœç¼“å†²åŒºæ»¡äº†ï¼Œåœæ­¢ç”Ÿäº§æ–°çš„äº§å“ï¼Œç­‰å¾…ç¼“å†²åŒºæœ‰ç©ºä½ï¼›</li><li>æ¶ˆè´¹è€…ä¸åœä»ç¼“å†²åŒºå–å‡ºäº§å“ï¼Œå¦‚æœç¼“å†²åŒºç©ºäº†ï¼Œåˆ™åœæ­¢æ¶ˆè´¹ï¼Œç­‰å¾…æ–°çš„äº§å“æ”¾åˆ°ç¼“å†²åŒºä¸­ï¼›</li></ol><p>å¾ˆå®¹æ˜“å°±è”æƒ³åˆ°ä¿¡å·é‡ <code>dispatch_semaphore_t</code> ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸¤ä¸ªä¿¡å·é‡åˆ†åˆ«æ§åˆ¶<code>ç”Ÿäº§è€…</code>ä¸<code>æ¶ˆè´¹è€…</code>ï¼Œ<code>semaphoreProduce</code> æ§åˆ¶ç”Ÿäº§è€…å½“ç¼“å†²åŒºæ»¡æ—¶åœæ­¢ç”Ÿäº§ï¼Œ<code>semaphoreConsume</code> æ§åˆ¶æ¶ˆè´¹è€…å½“ç¼“å†²åŒºç©ºæ—¶åœæ­¢æ¶ˆè´¹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆé…å›¾çº¯æ‰‹å·¥åˆ¶ä½œï¼Œè½»å–·ğŸ˜‚ï¼‰ï¼š</p><p><img src="/images/IMG_0010.jpg" alt="çµé­‚ç”»æ‰‹é…å›¾âœŒï¸"></p><p>Show me the code.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// æ§åˆ¶ç”Ÿäº§è€…çš„ä¿¡å·é‡</span><br><span class="line">dispatch_semaphore_t semaphoreProduce;</span><br><span class="line">// æ§åˆ¶æ¶ˆè´¹è€…çš„ä¿¡å·é‡</span><br><span class="line">dispatch_semaphore_t semaphoreConsume;</span><br><span class="line">// å½“å‰äº§å“æ•°é‡</span><br><span class="line">int productCount = 0;</span><br><span class="line">// ç¼“å†²åŒºå¤§å°</span><br><span class="line">const int bufferSize = 5;</span><br><span class="line"></span><br><span class="line">// åˆå§‹åŒ–ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ä¿¡å·é‡</span><br><span class="line">- (void)initProducerAndConsume &#123;</span><br><span class="line">    // åˆå§‹åŒ–ç¼“å†²åŒºå¤§å°</span><br><span class="line">    semaphoreProduce = dispatch_semaphore_create(bufferSize);</span><br><span class="line">    semaphoreConsume = dispatch_semaphore_create(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç”Ÿäº§å•†å“</span><br><span class="line">- (void)produce &#123;</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">        dispatch_semaphore_wait(semaphoreProduce, DISPATCH_TIME_FOREVER);</span><br><span class="line">        [NSThread sleepForTimeInterval:1];</span><br><span class="line">        productCount++;</span><br><span class="line">        NSLog(@&quot;ç”Ÿäº§å•†å“ï¼Œå•†å“æ€»é‡ï¼š%d&quot;, productCount);</span><br><span class="line">        dispatch_semaphore_signal(semaphoreConsume);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ¶ˆè´¹å•†å“</span><br><span class="line">- (void)consume &#123;</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">        dispatch_semaphore_wait(semaphoreConsume, DISPATCH_TIME_FOREVER);</span><br><span class="line">        [NSThread sleepForTimeInterval:1];</span><br><span class="line">        productCount--;</span><br><span class="line">        NSLog(@&quot;æ¶ˆè´¹å•†å“ï¼Œå•†å“æ€»é‡ï¼š%d&quot;, productCount);</span><br><span class="line">        dispatch_semaphore_signal(semaphoreProduce);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¯´èµ·ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼ˆProducer-consumer problemï¼‰ï¼Œç›¸ä¿¡å¤§å®¶éƒ½å°è±¡æ·±åˆ»ï¼Œæœ‰é—å¿˜å¯ä»¥çœ‹çœ‹&lt;a href=&quot;https://zh.wikipedia.org/wiki/ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜#ä½¿ç”¨ä¿¡å·ç¯çš„ç®—æ³•&quot; target=&quot;_blank&quot; rel=&quot;noo
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>connectionProxyDictionary ç¬”è®°</title>
    <link href="https://crmo.github.io/2019/06/16/connectionProxyDictionary%E7%AC%94%E8%AE%B0/"/>
    <id>https://crmo.github.io/2019/06/16/connectionProxyDictionaryç¬”è®°/</id>
    <published>2019-06-15T16:00:00.000Z</published>
    <updated>2019-06-16T03:53:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ç ”ç©¶äº†ä¸‹ <code>connectionProxyDictionary</code>ï¼Œåšä¸€ä¸ªç®€å•çš„ç¬”è®°ã€‚<a href="https://developer.apple.com/documentation/foundation/nsurlsessionconfiguration/1411499-connectionproxydictionary" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>æ˜¯è¿™ä¹ˆæè¿°çš„ã€‚</p><blockquote><p>This property controls which proxy tasks within sessions based on this configuration use when connecting to remote hosts.<br>The default value is NULL, which means that tasks use the default system settings.</p></blockquote><p>è¿™ä¸ªå±æ€§å¯ä»¥è®¾ç½®ç½‘ç»œä»£ç†ï¼Œé»˜è®¤å€¼æ˜¯ NULLï¼Œä½¿ç”¨ç³»ç»Ÿçš„ä»£ç†è®¾ç½®ã€‚</p><blockquote><p>æœ‰ä¸€ä¸ªæ¯”è¾ƒå·§å¦™çš„ç”¨æ³•ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸ºç©ºå­—å…¸å¯ä»¥ç¦æ­¢ä»£ç†æŠ“åŒ…(charlesã€fiddlerç­‰)ã€‚</p></blockquote><p>ä¸Šä»£ç ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span>* proxyHost =  <span class="string">@"192.168.12.23"</span>;<span class="comment">//@"myProxyHost.com";</span></span><br><span class="line"><span class="built_in">NSNumber</span>* proxyPort = [<span class="built_in">NSNumber</span> numberWithInt: <span class="number">12345</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬HTTPæˆ–HTTPSä»£ç†ï¼Œå½“ç„¶è¿˜å¯ä»¥æ·»åŠ SOCKS,FTP,RTSPç­‰</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *proxyDict = @&#123;</span><br><span class="line">    (<span class="built_in">NSString</span> *)kCFNetworkProxiesHTTPEnable  : [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">1</span>],</span><br><span class="line">    (<span class="built_in">NSString</span> *)kCFNetworkProxiesHTTPProxy: proxyHost,</span><br><span class="line">    (<span class="built_in">NSString</span> *)kCFNetworkProxiesHTTPProxyPort: proxyPort,</span><br><span class="line"></span><br><span class="line">    (<span class="built_in">NSString</span> *)kCFNetworkProxiesHTTPSEnable : [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">1</span>],</span><br><span class="line">    (<span class="built_in">NSString</span> *)kCFNetworkProxiesHTTPSProxy: proxyHost,</span><br><span class="line">    (<span class="built_in">NSString</span> *)kCFNetworkProxiesHTTPSProxyPort: proxyPort,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> ephemeralSessionConfiguration];</span><br><span class="line"><span class="comment">// è®¾ç½®ä»£ç†</span></span><br><span class="line">configuration.connectionProxyDictionary = proxyDict;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¦æ­¢ä»£ç†</span></span><br><span class="line">configuration.connectionProxyDictionary = @&#123;&#125;;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1ã€<a href="https://developer.apple.com/documentation/foundation/nsurlsessionconfiguration/1411499-connectionproxydictionary" target="_blank" rel="noopener">Apple æ–‡æ¡£</a><br>2ã€<a href="https://stackoverflow.com/questions/28101582/how-to-programmatically-add-a-proxy-to-an-nsurlsession" target="_blank" rel="noopener">How to programmatically add a proxy to an NSURLSession</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘ç ”ç©¶äº†ä¸‹ &lt;code&gt;connectionProxyDictionary&lt;/code&gt;ï¼Œåšä¸€ä¸ªç®€å•çš„ç¬”è®°ã€‚&lt;a href=&quot;https://developer.apple.com/documentation/foundation/nsurlsessionconfigur
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>NSURLCache ç¼“å­˜æœºåˆ¶æµ…è°ˆ</title>
    <link href="https://crmo.github.io/2019/04/16/NSURLCache%20%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E6%B5%85%E8%B0%88/"/>
    <id>https://crmo.github.io/2019/04/16/NSURLCache ç¼“å­˜æœºåˆ¶æµ…è°ˆ/</id>
    <published>2019-04-15T16:00:00.000Z</published>
    <updated>2019-04-16T12:48:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>APP ä¸­æœ‰å¾ˆå¤šä»æœåŠ¡å™¨è·å–æ•°æ®ã€èµ„æºçš„éœ€æ±‚ï¼Œä¸ºäº†èŠ‚çœæµé‡ã€åŠ å¿«è®¿é—®é€Ÿåº¦ã€ç¦»çº¿ä½¿ç”¨ç­‰éœ€æ±‚ï¼Œå°±ä¼šä½¿ç”¨åˆ°ç½‘ç»œç¼“å­˜ã€‚<code>HTTPåè®®</code>å¯¹äºç¼“å­˜è®¾è®¡äº†å¾ˆå¤šæœºåˆ¶ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13" target="_blank" rel="noopener">ã€ŠRFC2616-section13-Caching in HTTPã€‹</a>ã€‚</p><h2 id="iOS-ä¸­å¸¸è§ç¼“å­˜æœºåˆ¶"><a href="#iOS-ä¸­å¸¸è§ç¼“å­˜æœºåˆ¶" class="headerlink" title="iOS ä¸­å¸¸è§ç¼“å­˜æœºåˆ¶"></a>iOS ä¸­å¸¸è§ç¼“å­˜æœºåˆ¶</h2><p>åœ¨iOSä¸­ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œä½¿ç”¨ç³»ç»Ÿçš„ç¼“å­˜æœºåˆ¶å°±å¯ä»¥æ»¡è¶³ã€‚å¦‚ï¼šmax-ageã€Last-Modifiedã€ETagã€Expiresç­‰æœºåˆ¶ç³»ç»Ÿéƒ½å®ç°äº†çš„ï¼Œä¸éœ€è¦è‡ªå·±å†å»æä¸€å¥—ã€‚åªéœ€è¦å°† <code>NSURLRequest</code> çš„ <code>cachePolicy</code> è®¾ç½®ä¸º <code>NSURLRequestUseProtocolCachePolicy</code> ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURLRequest</span> *request = [[<span class="built_in">NSURLRequest</span> alloc] init];</span><br><span class="line">request.cachePolicy = <span class="built_in">NSURLRequestUseProtocolCachePolicy</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç®€å•è¯´ä¸‹å¸¸è§çš„å‡ ç§æœºåˆ¶ï¼Œé¦–å…ˆæ¥çœ‹ä¸€ä¸ª<code>GETè¯·æ±‚</code>çš„å“åº”æŠ¥æ–‡ï¼Œé‡Œé¢åŒ…å«äº†å‡ ç§å¸¸è§çš„ç¼“å­˜æ ‡è¯†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 </span><br><span class="line">Cache-Controlmax-age=86400, private</span><br><span class="line">Last-ModifiedTue, 16 Apr 2019 06:07:39 GMT</span><br><span class="line">ETagW/&quot;28111-1554979928000&quot;</span><br><span class="line">ExpiresWed, 17 Apr 2019 06:07:39 GMT</span><br><span class="line">DateTue, 16 Apr 2019 06:07:39 GMT</span><br><span class="line">Transfer-Encodingchunked</span><br><span class="line">Connectionkeep-alive</span><br></pre></td></tr></table></figure><h3 id="max-age"><a href="#max-age" class="headerlink" title="max-age"></a>max-age</h3><p><code>max-age</code> æ˜¯ <code>cache-control</code> ä¸‹çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œè¡¨ç¤º <code>Response</code> çš„æœ€å¤§ Ageã€‚ä¾‹å¦‚ï¼š</p><blockquote><p>Cache-Control     max-age=86400, private</p></blockquote><p>å«ä¹‰ä¸ºï¼šè¯¥ <code>Response</code> çš„æœ‰æ•ˆæœŸä¸º1å¤©ï¼Œåœ¨ä¸€å¤©ä»¥å†…ï¼ŒåŒæ ·çš„ URL å°†ä¸ä¼šå†æ¬¡è¯·æ±‚ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚</p><h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p><code>Expires</code> å‘Šè¯‰å®¢æˆ·ç«¯ <code>Response</code> çš„è¿‡æœŸæ—¶é—´ã€‚ä¾‹å¦‚ï¼š</p><blockquote><p>Expires Wed, 17 Apr 2019 06:07:39 GMT</p></blockquote><p>å«ä¹‰ä¸ºï¼šè¯¥ <code>Response</code> åœ¨ <code>Wed, 17 Apr 2019 06:07:39 GMT</code> æ—¶è¿‡æœŸï¼Œåœ¨è¿™ä¹‹å‰ï¼ŒåŒæ ·çš„ URL å°†ä¸ä¼šå†æ¬¡è¯·æ±‚ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>max-age</code> çš„ä¼˜å…ˆçº§å¤§äº <code>expires</code>ã€‚</p><h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p><code>Last-Modified</code> æŒ‡æ˜èµ„æºçš„æœ€ç»ˆä¿®æ”¹æ—¶é—´ï¼Œå®¢æˆ·ç«¯åœ¨è¯·æ±‚çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªå€¼å¸¦åœ¨ <code>If-Modified-Since</code> ä¸­ã€‚ä¾‹å¦‚ï¼š</p><blockquote><p>If-Modified-Since    Thu, 11 Apr 2019 10:52:08 GMT</p></blockquote><p>æœåŠ¡å™¨ä¼šæ ¹æ®å®¢æˆ·ç«¯ä¼ é€’çš„æ—¶é—´åˆ¤æ–­èµ„æºæ˜¯å¦æœ‰æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨è¿”å›304ï¼Œå®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œå¦‚æœæœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨è¿”å›200å’Œæœ€æ–°çš„èµ„æºã€‚</p><h3 id="Etag"><a href="#Etag" class="headerlink" title="Etag"></a>Etag</h3><p><code>Etag</code> ç±»ä¼¼äºèµ„æºçš„å”¯ä¸€hashå€¼ï¼Œèµ„æºå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªå€¼å°±å‘ç”Ÿå˜æ›´ï¼Œå®¢æˆ·ç«¯åœ¨è¯·æ±‚èµ„æºæ—¶ï¼Œä¼šå°† <code>Etag</code> æ”¾åœ¨ <code>If-None-Match</code> ä¸­ï¼Œä¾‹å¦‚ï¼š</p><blockquote><p>If-None-Match     W/â€œ28111-1554979928000â€</p></blockquote><p>æœåŠ¡ç«¯æ ¹æ®å®¢æˆ·ç«¯ä¼ é€’çš„ <code>Etag</code> åˆ¤æ–­èµ„æºæ˜¯å¦æœ‰æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨è¿”å›304ï¼Œå®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œå¦‚æœæœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨è¿”å›200å’Œæœ€æ–°çš„èµ„æºã€‚</p><h2 id="å¯å‘å¼ç¼“å­˜ï¼ˆheuristic-expirationï¼‰"><a href="#å¯å‘å¼ç¼“å­˜ï¼ˆheuristic-expirationï¼‰" class="headerlink" title="å¯å‘å¼ç¼“å­˜ï¼ˆheuristic expirationï¼‰"></a>å¯å‘å¼ç¼“å­˜ï¼ˆheuristic expirationï¼‰</h2><p>åœ¨æµ‹è¯•ç¼“å­˜æœºåˆ¶æ—¶ï¼Œå‘ç°äº†ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œè¿”å›æŠ¥æ–‡é‡Œæ²¡æœ‰ <code>max-age</code> å’Œ <code>Expires</code>ï¼Œå†æ¬¡è¯·æ±‚ç›¸åŒURLæ—¶å´ç›´æ¥ä½¿ç”¨çš„ç¼“å­˜ï¼Œæ²¡æœ‰é‡æ–°å‘è¯·æ±‚ï¼Œè¯·æ±‚æŠ¥æ–‡å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 </span><br><span class="line">Accept-Rangesbytes</span><br><span class="line">ETagW/&quot;28111-1554979928000&quot;</span><br><span class="line">Last-ModifiedThu, 11 Apr 2019 10:52:08 GMT</span><br><span class="line">DateTue, 16 Apr 2019 07:23:21 GMT</span><br><span class="line">Content-Typeimage/jpeg</span><br><span class="line">Content-Length28111</span><br><span class="line">Connectionkeep-alive</span><br></pre></td></tr></table></figure><p>è®©äººæ‘¸ä¸ç€å¤´è„‘ï¼Œåœ¨æŸ¥è¯¢èµ„æ–™åå‘ç°ä¸€ç¯‡æ–‡ç« ï¼Œæåˆ°äº†è¿™ä¸ªç°è±¡ï¼Œ<a href="https://blackpixel.com/writing/2012/05/caching-and-nsurlconnection.html" target="_blank" rel="noopener">Caching and NSURLConnection</a>ã€‚</p><p>åœ¨æ–‡ç« çš„æŒ‡å¼•ä¸‹ï¼Œä»”ç»†ç ”ç©¶äº†ä¸‹<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13" target="_blank" rel="noopener">RFC2616-section13-Caching in HTTP</a>ï¼Œå‘ç°äº†ç­”æ¡ˆã€‚</p><p>RFCçš„åŸæ–‡å¦‚ä¸‹ï¼š</p><blockquote><p>If none of Expires, Cache-Control: max-age, or Cache-Control: s- maxage (see section 14.9.3) appears in the response, and the response does not include other restrictions on caching, the cache MAY compute a freshness lifetime using a heuristic. The cache MUST attach Warning 113 to any response whose age is more than 24 hours if such warning has not already been added.<br>Also, if the response does have a Last-Modified time, the heuristic expiration value SHOULD be no more than some fraction of the interval since that time. A typical setting of this fraction might be 10%.</p></blockquote><p>è¿™æ˜¯ä¸€ç§å«å¯å‘å¼ç¼“å­˜ï¼ˆheuristic expirationï¼‰çš„ç­–ç•¥ï¼Œåœ¨ response ä¸­å¦‚æœæ²¡æœ‰ Expiresã€max-ageã€s-maxageï¼Œæ¥æ˜ç¡®æŒ‡å®šèµ„æºçš„è¿‡æœŸæ—¶é—´ï¼ŒNSURLCache ä¼šæ ¹æ® Last-Modified æ¥è®¡ç®—ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚</p><blockquote><p>æ ¹æ®å®éªŒç»“æœï¼Œåœ¨iOSä¸­è®¡ç®—å…¬å¼æ˜¯è¿™æ ·çš„ï¼šlifetime = (Last-Modified - Now) * 10%</p></blockquote><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p>1ã€<a href="https://blackpixel.com/writing/2012/05/caching-and-nsurlconnection.html" target="_blank" rel="noopener">Caching and NSURLConnection</a><br>2ã€<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13" target="_blank" rel="noopener">RFC2616-section13-Caching in HTTP</a><br>3ã€<a href="https://nshipster.com/nsurlcache/" target="_blank" rel="noopener">NSURLCache-NSHipster</a><br>4ã€<a href="https://segmentfault.com/a/1190000004356632" target="_blank" rel="noopener">iOSç½‘ç»œç¼“å­˜æ‰«ç›²ç¯‡ - ä½¿ç”¨ä¸¤è¡Œä»£ç å°±èƒ½å®Œæˆ80%çš„ç¼“å­˜éœ€æ±‚</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;APP ä¸­æœ‰å¾ˆå¤šä»æœåŠ¡å™¨è·å–æ•°æ®ã€èµ„æºçš„éœ€æ±‚ï¼Œä¸ºäº†èŠ‚çœæµé‡ã€åŠ å¿«è®¿é—®é€Ÿåº¦ã€ç¦»çº¿ä½¿ç”¨ç­‰éœ€æ±‚ï¼Œå°±ä¼šä½¿ç”¨åˆ°ç½‘ç»œç¼“å­˜ã€‚&lt;code&gt;HTTPåè®®&lt;/code&gt;å¯¹äºç¼“å­˜è®¾è®¡äº†å¾ˆå¤šæœºåˆ¶ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹&lt;a href=&quot;https://www.w3.org/Protocols/rfc
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ä»FMDBçº¿ç¨‹å®‰å…¨é—®é¢˜è¯´èµ·</title>
    <link href="https://crmo.github.io/2019/01/28/%E4%BB%8EFMDB%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%E8%AF%B4%E8%B5%B7/"/>
    <id>https://crmo.github.io/2019/01/28/ä»FMDBçº¿ç¨‹å®‰å…¨é—®é¢˜è¯´èµ·/</id>
    <published>2019-01-27T16:00:00.000Z</published>
    <updated>2019-02-02T01:39:15.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è®¨è®ºçš„ FMDB ç‰ˆæœ¬ä¸º<code>2.7.5</code>ï¼Œæµ‹è¯•ç¯å¢ƒæ˜¯ <code>Xcode 10.1 &amp; iOS 12.1</code>ã€‚</p></blockquote><h2 id="ä¸€ã€é—®é¢˜è®°å½•"><a href="#ä¸€ã€é—®é¢˜è®°å½•" class="headerlink" title="ä¸€ã€é—®é¢˜è®°å½•"></a>ä¸€ã€é—®é¢˜è®°å½•</h2><p>æœ€è¿‘åœ¨åˆ†æå´©æºƒæ—¥å¿—çš„æ—¶å€™å‘ç°ä¸€ä¸ª FMDB çš„ crash é¢‘ç¹å‡ºç°ï¼Œcrash å †æ ˆå¦‚ä¸‹ï¼š</p><p><img src="/images/15486768292546.jpg" alt="15486768292546"></p><p>åœ¨æ§åˆ¶å°èƒ½çœ‹åˆ°æŠ¥é”™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[logging] BUG IN CLIENT OF sqlite3.dylib: illegal multi-threaded access to database connection</span><br><span class="line">Warning: there is at least one open result set around after performing [FMDatabaseQueue inDatabase:]</span><br></pre></td></tr></table></figure><p>ä»æ—¥å¿—ä¸­èƒ½å¤§æ¦‚çŒœåˆ°ï¼Œè¿™æ˜¯å¤šçº¿ç¨‹è®¿é—®æ•°æ®åº“å¯¼è‡´çš„ crashã€‚FMDB æä¾›äº† <code>FMDatabaseQueue</code> åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ“ä½œæ•°æ®åº“ï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚æˆ‘æ£€æŸ¥äº†æ‰€æœ‰æ“ä½œæ•°æ®åº“çš„ä»£ç ï¼Œéƒ½æ˜¯åœ¨ <code>FMDatabaseQueue</code> é˜Ÿåˆ—é‡Œæ‰§è¡Œçš„ï¼Œä¸ºå•¥è¿˜æ˜¯ä¼šæŠ¥å¤šçº¿ç¨‹é—®é¢˜ï¼ˆä¸€è„¸æ‡µé€¼ğŸ¤”ï¼‰ï¼Ÿ</p><p>åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€åœˆï¼Œå‘ç° github ä¸Šæœ‰äººé‡åˆ°äº†åŒæ ·çš„é—®é¢˜ï¼Œ <a href="https://github.com/ccgus/fmdb/issues/724" target="_blank" rel="noopener">Issue 724</a> å’Œ <a href="https://github.com/ccgus/fmdb/issues/711" target="_blank" rel="noopener">Issue 711</a>ï¼ŒStack Overflowä¸Šæœ‰ç›¸å…³çš„<a href="https://stackoverflow.com/questions/49198831/sqlite3-dylib-illegal-multi-threaded-access-to-database-connection/54397109#54397109" target="_blank" rel="noopener">è®¨è®º</a>ã€‚</p><p>é¡¹ç›®é‡Œä¸šåŠ¡å¤ªå¤æ‚ï¼Œå¾ˆéš¾æ’æŸ¥é—®é¢˜ï¼Œäºæ˜¯å†™äº†ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ Demo æ¥å¤ç°é—®é¢˜ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> *dbPath = [docPath stringByAppendingPathComponent:<span class="string">@"test.sqlite"</span>];</span><br><span class="line">    _queue = [FMDatabaseQueue databaseQueueWithPath:dbPath];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„å»ºæµ‹è¯•æ•°æ®ï¼Œæ–°å»ºä¸€ä¸ªè¡¨testï¼Œinertä¸€äº›æ•°æ®</span></span><br><span class="line">    [_queue inDatabase:^(FMDatabase * _Nonnull db) &#123;</span><br><span class="line">        [db executeUpdate:<span class="string">@"create table if not exists test (a text, b text, c text, d text, e text, f text, g text, h text, i text)"</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            [db executeUpdate:<span class="string">@"insert into test (a, b, c, d, e, f, g, h, i) values ('1', '1', '1','1', '1', '1','1', '1', '1')"</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤šçº¿ç¨‹æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">            [_queue inDatabase:^(FMDatabase * _Nonnull db) &#123;</span><br><span class="line">                FMResultSet *result = [db executeQuery:<span class="string">@"select * from test where a = '1'"</span>];</span><br><span class="line">                <span class="comment">// è¿™é‡Œè¦ç”¨ifï¼Œæ”¹æˆwhileå°±æ²¡é—®é¢˜äº†</span></span><br><span class="line">                <span class="keyword">if</span> ([result next]) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è¿™é‡Œä¸è°ƒç”¨close</span></span><br><span class="line"><span class="comment">//                [result close];</span></span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜å®Œç¾å¤ç°ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ’æŸ¥é—®é¢˜äº†ï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜äºŸå¾…è§£å†³ï¼š</p><ol><li>iOS ç³»ç»Ÿè‡ªå¸¦çš„ SQLite ç©¶ç«Ÿæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆä½¿ç”¨äº†çº¿ç¨‹å®‰å…¨é˜Ÿåˆ— <code>FMDatabaseQueue</code>ï¼Œ è¿˜æ˜¯å‡ºç°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ</li></ol><h2 id="äºŒã€SQLite-çº¿ç¨‹å®‰å…¨"><a href="#äºŒã€SQLite-çº¿ç¨‹å®‰å…¨" class="headerlink" title="äºŒã€SQLite çº¿ç¨‹å®‰å…¨"></a>äºŒã€SQLite çº¿ç¨‹å®‰å…¨</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒiOS ç³»ç»Ÿè‡ªå¸¦çš„ SQLite ç©¶ç«Ÿæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</p><p>Google äº†ä¸€ä¸‹ï¼Œå‘ç°äº†å…³äºSQLiteçš„<a href="https://www.sqlite.org/threadsafe.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£ - Using SQLite In Multi-Threaded Applications</a>ã€‚æ–‡æ¡£å†™çš„å¾ˆæ¸…æ™°ï¼Œæœ‰æ—¶é—´æœ€å¥½è®¤çœŸè¯»è¯»ï¼Œè¿™é‡Œç®€å•æ€»ç»“ä¸€ä¸‹ã€‚</p><p>SQLite æœ‰3ç§çº¿ç¨‹æ¨¡å¼ï¼š</p><ol><li>Single-threadï¼Œå•çº¿ç¨‹æ¨¡å¼ï¼Œç¼–è¯‘æ—¶æ‰€æœ‰äº’æ–¥é”ä»£ç ä¼šè¢«åˆ é™¤æ‰ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å®‰å…¨ã€‚</li><li>Multi-threadï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¤šçº¿ç¨‹ç¯å¢ƒå®‰å…¨ï¼Œæ¯”å¦‚åŒä¸€ä¸ªæ•°æ®åº“ï¼Œå¼€å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¼€ä¸€ä¸ªè¿æ¥åŒæ—¶è®¿é—®è¿™ä¸ªåº“ï¼Œè¿™ç§æƒ…å†µæ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸å®‰å…¨æƒ…å†µï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼ˆæˆ–ä»è¯¥è¿æ¥æ´¾ç”Ÿçš„ä»»ä½•é¢„å‡†å¤‡è¯­å¥ï¼‰</li><li>Serializedï¼Œå®Œå…¨çº¿ç¨‹å®‰å…¨ã€‚</li></ol><p>æœ‰3ä¸ªæ—¶é—´ç‚¹å¯ä»¥é…ç½® threading modeï¼Œç¼–è¯‘æ—¶ï¼ˆcompile-timeï¼‰ã€åˆå§‹åŒ–æ—¶ï¼ˆstart-timeï¼‰ã€è¿è¡Œæ—¶ï¼ˆrun-timeï¼‰ã€‚é…ç½®ç”Ÿæ•ˆè§„åˆ™æ˜¯ run-time è¦†ç›– start-time è¦†ç›– compile-timeï¼Œæœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼š</p><ol><li>ç¼–è¯‘æ—¶è®¾ç½® <code>Single-thread</code>ï¼Œç”¨æˆ·å°±ä¸èƒ½å†å¼€å¯å¤šçº¿ç¨‹æ¨¡å¼ï¼Œå› ä¸ºçº¿ç¨‹å®‰å…¨ä»£ç è¢«ä¼˜åŒ–äº†ã€‚</li><li>å¦‚æœç¼–è¯‘æ—¶è®¾ç½®çš„å¤šçº¿ç¨‹æ¨¡å¼ï¼Œåœ¨è¿è¡Œæ—¶ä¸èƒ½é™çº§ä¸ºå•çº¿ç¨‹æ¨¡å¼ï¼Œåªèƒ½åœ¨<code>Multi-thread</code>å’Œ<code>Serialized</code>é—´åˆ‡æ¢ã€‚</li></ol><h3 id="threading-mode-ç¼–è¯‘é€‰é¡¹"><a href="#threading-mode-ç¼–è¯‘é€‰é¡¹" class="headerlink" title="threading mode ç¼–è¯‘é€‰é¡¹"></a>threading mode ç¼–è¯‘é€‰é¡¹</h3><p>SQLite threading mode ç¼–è¯‘é€‰é¡¹çš„<a href="https://www.sqlite.org/compile.html#threadsafe" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p><p><img src="/images/15486559651186.jpg" alt="15486559651186"></p><p>ç¼–è¯‘æ—¶ï¼Œé€šè¿‡é…ç½®é¡¹<code>SQLITE_THREADSAFE</code>å¯ä»¥é…ç½® SQLite åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯å¦å®‰å…¨ã€‚æœ‰ä¸‰ä¸ªå¯é€‰é¡¹ï¼š</p><ol><li>0ï¼Œå¯¹åº” Single-thread ï¼Œç¼–è¯‘æ—¶æ‰€æœ‰äº’æ–¥é”ä»£ç ä¼šè¢«åˆ é™¤æ‰ï¼ŒSQLite åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å®‰å…¨ã€‚</li><li>1ï¼Œå¯¹åº” Serializedï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®‰å…¨ï¼Œå¦‚æœä¸æ‰‹åŠ¨æŒ‡å®šï¼Œè¿™æ˜¯é»˜è®¤é€‰é¡¹ã€‚</li><li>2ï¼Œå¯¹åº” Multi-thread ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¤šçº¿ç¨‹ç¯å¢ƒå®‰å…¨ï¼Œä¸å®‰å…¨æƒ…å†µï¼šæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å°è¯•ä½¿ç”¨ç›¸åŒæ•°æ®åº“è¿æ¥ï¼ˆæˆ–ä»è¯¥æ•°æ®åº“è¿æ¥æ´¾ç”Ÿçš„ä»»ä½•é¢„å¤„ç†è¯­å¥ Prepared Statementsï¼‰</li></ol><p>é™¤äº†ç¼–è¯‘æ—¶å¯ä»¥æŒ‡å®š threading mode ï¼Œè¿˜å¯ä»¥é€šè¿‡å‡½æ•° <code>sqlite3_config()</code> ï¼ˆstart-time ï¼‰æ”¹å˜å…¨å±€çš„ threading mode æˆ–è€…é€šè¿‡<code>sqlite3_open_v2()</code> ï¼ˆrun-timeï¼‰æ”¹å˜æŸä¸ªæ•°æ®åº“è¿æ¥çš„ threading modeã€‚</p><p>ä½†æ˜¯å¦‚æœç¼–è¯‘æ—¶é…ç½®äº†<code>SQLITE_THREADSAFE = 0</code>ï¼Œç¼–è¯‘æ—¶æ‰€æœ‰çº¿ç¨‹å®‰å…¨ä»£ç éƒ½è¢«ä¼˜åŒ–æ‰äº†ï¼Œå°±ä¸èƒ½å†åˆ‡æ¢åˆ°å¤šçº¿ç¨‹æ¨¡å¼äº†ã€‚</p><p>æœ‰äº†å‰é¢çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ†æé—®é¢˜ä¸€äº†ã€‚è°ƒç”¨å‡½æ•° <code>sqlite3_threadsafe()</code> å¯ä»¥è·å–ç¼–è¯‘æ—¶çš„é…ç½®é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå‡½æ•°è·å–ç³»ç»Ÿè‡ªå¸¦çš„ SQLite åœ¨ç¼–è¯‘æ—¶çš„é…ç½®ï¼Œç»“è®ºæ˜¯2ï¼ˆMulti-threadï¼‰ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿè‡ªå¸¦çš„ SQLite åœ¨ä¸åšä»»ä½•é…ç½®çš„æƒ…å†µä¸‹ä¸æ˜¯å®Œå…¨çº¿ç¨‹å®‰å…¨çš„ã€‚å½“ç„¶å¯ä»¥æ‰‹åŠ¨å°†æ¨¡å¼åˆ‡æ¢åˆ° <code>Serialized</code> å°±å¯ä»¥å®ç°å®Œå…¨çº¿ç¨‹å®‰å…¨äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// æ–¹æ¡ˆä¸€ï¼šå…¨å±€è®¾ç½®æ¨¡å¼</span><br><span class="line">sqlite3_config(SQLITE_CONFIG_SERIALIZED);</span><br><span class="line"></span><br><span class="line">// æ–¹æ¡ˆäºŒï¼šè®¾ç½® connecting æ¨¡å¼ï¼Œè°ƒç”¨ sqlite3_open_v2 æ—¶ flag åŠ ä¸Š SQLITE_OPEN_FULLMUTEX</span><br><span class="line">sqlite3_open_v2(path, &amp;db, SQLITE_OPEN_CREATE | SQLITE_OPEN_READWRITE | SQLITE_OPEN_FULLMUTEX, nil)</span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•ï¼Œé€šè¿‡ä¸Šé¢ä¸¤ç§æ–¹æ¡ˆæ”¹é€ ä¹‹åï¼ŒDemo ä¸­çš„ crash é—®é¢˜å®Œç¾è§£å†³ã€‚ä½†æ˜¯æˆ‘è®¤ä¸ºè¿™ä¸æ˜¯æœ€ä¼˜çš„è§£å†³æ–¹æ¡ˆï¼Œè‹¹æœä¸ºå•¥ä¸ç›´æ¥å°†ç¼–è¯‘é€‰é¡¹è®¾ç½®ä¸º <code>Serialized</code>ï¼Œè¿™ç¯‡æ–‡ç« å°±æ°¸è¿œä¸ä¼šå‡ºç°äº†ğŸ˜‚ï¼ŒåŠ³æ°‘ä¼¤è´¢è®©å¤§å®¶æŠ˜è…¾åŠå¤©ï¼Œå»æ‰‹åŠ¨è®¾ç½®æ¨¡å¼ã€‚æˆ‘è®¤ä¸ºæ€§èƒ½æ˜¯ä¸€ä¸ªé‡è¦å› ç´ ï¼Œ<code>Multi-thread</code> æ€§èƒ½ä¼˜äº <code>Serialized</code>, ç”¨æˆ·åªè¦ä¿è¯ä¸€ä¸ªè¿æ¥ä¸åœ¨å¤šçº¿ç¨‹åŒæ—¶è®¿é—®å°±æ²¡é—®é¢˜äº†ï¼Œå…¶å®èƒ½æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ã€‚</p><p>æ¯”å¦‚ FMDB çš„ <code>FMDatabaseQueue</code> å°±æ˜¯ä¸ºäº†è§£å†³è¯¥é—®é¢˜ã€‚</p><h2 id="ä¸‰ã€FMDatabaseQueue-å…¶å®å¹¶ä¸å®‰å…¨"><a href="#ä¸‰ã€FMDatabaseQueue-å…¶å®å¹¶ä¸å®‰å…¨" class="headerlink" title="ä¸‰ã€FMDatabaseQueue å…¶å®å¹¶ä¸å®‰å…¨"></a>ä¸‰ã€FMDatabaseQueue å…¶å®å¹¶ä¸å®‰å…¨</h2><p>FMDB çš„å®˜æ–¹æ–‡æ¡£å†™åˆ°ï¼š</p><blockquote><p>FMDatabaseQueue will run the blocks on a serialized queue (hence the name of the class). So if you call FMDatabaseQueueâ€™s methods from multiple threads at the same time, they will be executed in the order they are received. This way queries and updates wonâ€™t step on each otherâ€™s toes, and every one is happy.</p></blockquote><p>åœ¨å¤šçº¿ç¨‹ä½¿ç”¨ <code>FMDatabaseQueue</code> çš„ç¡®å¾ˆå®‰å…¨ï¼Œé€šè¿‡ GCD çš„ä¸²è¡Œé˜Ÿåˆ—æ¥ä¿è¯æ‰€æœ‰è¯»å†™æ“ä½œéƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ã€‚å®ƒçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">_queue = dispatch_queue_create([[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"fmdb.%@"</span>, <span class="keyword">self</span>] UTF8String], <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)inDatabase:(__attribute__((noescape)) <span class="keyword">void</span> (^)(FMDatabase *db))block &#123;</span><br><span class="line">    <span class="comment">// ...çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_sync</span>(_queue, ^() &#123;</span><br><span class="line">        FMDatabase *db = [<span class="keyword">self</span> database];</span><br><span class="line">        block(db);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åˆ†æç¬¬ä¸€èŠ‚ Demo çš„ crash å †æ ˆï¼Œå¯ä»¥çœ‹åˆ°å´©æºƒå‘ç”Ÿåœ¨çº¿ç¨‹3çš„å‡½æ•° <code>[FMResultSet reset]</code>ï¼Œå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)reset &#123;</span><br><span class="line">    <span class="keyword">if</span> (_statement) &#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾é¢„å¤„ç†è¯­å¥ï¼ˆReset A Prepared Statement Objectï¼‰</span></span><br><span class="line">        sqlite3_reset(_statement);</span><br><span class="line">    &#125;</span><br><span class="line">    _inUse = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æ ˆå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- [FMStatement reset]</span><br><span class="line">- [FMResultSet close]</span><br><span class="line">- [FMResultSet dealloc]</span><br></pre></td></tr></table></figure><p>é¡ºç€è°ƒç”¨å †æ ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ <code>FMResultSet</code> çš„ <code>dealloc</code> å’Œ <code>close</code> æ–¹æ³•ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    [<span class="keyword">self</span> close];</span><br><span class="line">    FMDBRelease(_query);</span><br><span class="line">    _query = <span class="literal">nil</span>;</span><br><span class="line">    FMDBRelease(_columnNameToIndexMap);</span><br><span class="line">    _columnNameToIndexMap = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)close &#123;</span><br><span class="line">    [_statement reset];</span><br><span class="line">    FMDBRelease(_statement);</span><br><span class="line">    _statement = <span class="literal">nil</span>;</span><br><span class="line">    [_parentDB resultSetDidClose:<span class="keyword">self</span>];</span><br><span class="line">    [<span class="keyword">self</span> setParentDB:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥å¾—å‡ºç»“è®ºï¼Œåœ¨ <code>FMResultSet</code> <code>dealloc</code> æ—¶ä¼šè°ƒç”¨ <code>close</code> æ–¹æ³•ï¼Œæ¥å…³é—­é¢„å¤„ç†è¯­å¥ã€‚å†å›åˆ°ç¬¬ä¸€èŠ‚çš„ crash å †æ ˆï¼Œä¸éš¾å‘ç°çº¿ç¨‹7åœ¨ç”¨åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥è¯»æ•°æ®åº“ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸€æ®µè¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºç»“è®ºäº†ã€‚</p><blockquote><p>When compiled with SQLITE_THREADSAFE=2, SQLite can be used in a multithreaded program so long as no two threads attempt to use the same database connection (or any prepared statements derived from that database connection) at the same time.</p></blockquote><p>ä½¿ç”¨ <code>FMDatabaseQueue</code> è¿˜æ˜¯å‘ç”Ÿäº†å¤šçº¿ç¨‹ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥ã€é¢„å¤„ç†è¯­å¥çš„æƒ…å†µï¼Œäºæ˜¯å°±å´©æºƒäº†ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>é—®é¢˜æ‰¾åˆ°äº†ï¼Œæ¥ä¸‹æ¥èŠèŠæ€ä¹ˆé¿å…é—®é¢˜ã€‚</p><h3 id="FMDBçš„æ­£ç¡®æ‰“å¼€æ–¹å¼"><a href="#FMDBçš„æ­£ç¡®æ‰“å¼€æ–¹å¼" class="headerlink" title="FMDBçš„æ­£ç¡®æ‰“å¼€æ–¹å¼"></a>FMDBçš„æ­£ç¡®æ‰“å¼€æ–¹å¼</h3><p>å¦‚æœç”¨ <code>while</code> å¾ªç¯éå† <code>FMResultSet</code> å°±ä¸å­˜åœ¨è¯¥é—®é¢˜ï¼Œå› ä¸º <code>[FMResultSet next]</code> éå†åˆ°æœ€åä¼šè°ƒç”¨ <code>[FMResultSet close]</code>ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[_queue inDatabase:^(FMDatabase * _Nonnull db) &#123;</span><br><span class="line">    FMResultSet *result = [db executeQuery:<span class="string">@"select * from test where a = '1'"</span>];</span><br><span class="line">    <span class="comment">// å®‰å…¨</span></span><br><span class="line">    <span class="keyword">while</span> ([result next]) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®‰å…¨</span></span><br><span class="line">    <span class="keyword">if</span> ([result next]) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    [result close];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€å®šè¦ç”¨ <code>if ([result next])</code> ï¼Œæ‰‹åŠ¨åŠ ä¸Š <code>[FMResultSet close]</code> ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>æˆ‘é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯è¢«å®˜æ–¹æ–‡æ¡£çš„ä¸€å¥è¯è¯¯å¯¼äº†ã€‚</p><blockquote><p>Typically, thereâ€™s no need to -close an FMResultSet yourself, since that happens when either the result set is deallocated, or the parent database is closed.</p></blockquote><p>äºæ˜¯æˆ‘æäº†ä¸€ä¸ª <a href="https://github.com/ccgus/fmdb/pull/728" target="_blank" rel="noopener">Pull requests</a> ï¼Œæˆ‘æå‡ºäº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ä¿®æ”¹æ–‡æ¡£ï¼Œåœ¨æ–‡æ¡£ä¸­å¼ºè°ƒï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨è°ƒç”¨ closeã€‚</li><li>åœ¨ <code>[FMDatabaseQueue inDatabase:]</code> å‡½æ•°çš„æœ€åï¼Œè°ƒç”¨ <code>[FMDatabase closeOpenResultSets]</code> å¸®åŠ©è°ƒç”¨è€…å…³é—­æ‰€æœ‰ FMResultSetã€‚</li></ol><p>FMDB çš„ä½œè€… <code>ccgus</code> é‡‡ç”¨äº†ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨æœ€æ–°çš„ä¸€æ¬¡ <a href="https://github.com/ccgus/fmdb/commit/7da3c812cdddd6f5da1df31e7751ef3e56dacd6b" target="_blank" rel="noopener">commit</a> ä¿®æ”¹äº†æ–‡æ¡£ï¼ŒåŠ ä¸Šäº†ç›¸å…³è¯´æ˜ã€‚</p><blockquote><p>Typically, thereâ€™s no need to -close an FMResultSet yourself, since that happens when either the result set is exhausted. However, if you only pull out a single request or any other number of requests which donâ€™t exhaust the result set, you will need to call the -close method on the FMResultSet.</p></blockquote><hr><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://www.sqlite.org/threadsafe.html" target="_blank" rel="noopener">Using SQLite In Multi-Threaded Applications</a></li><li><a href="https://stackoverflow.com/questions/49198831/sqlite3-dylib-illegal-multi-threaded-access-to-database-connection/54397109#54397109" target="_blank" rel="noopener">sqlite3.dylib: illegal multi-threaded access to database connection</a></li><li><a href="https://github.com/ccgus/fmdb" target="_blank" rel="noopener">FMDB</a></li><li><a href="https://www.sqlite.org/compile.html#threadsafe" target="_blank" rel="noopener">SQLiteç¼–è¯‘é€‰é¡¹å®˜æ–¹æ–‡æ¡£</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡è®¨è®ºçš„ FMDB ç‰ˆæœ¬ä¸º&lt;code&gt;2.7.5&lt;/code&gt;ï¼Œæµ‹è¯•ç¯å¢ƒæ˜¯ &lt;code&gt;Xcode 10.1 &amp;amp; iOS 12.1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä¸€ã€é—®é¢˜è®°å½•&quot;&gt;&lt;a href=&quot;#ä¸€
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>Core Animationå­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰- è§†è§‰æ•ˆæœ</title>
    <link href="https://crmo.github.io/2018/12/03/Core%20Animation%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <id>https://crmo.github.io/2018/12/03/Core Animationå­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰/</id>
    <published>2018-12-02T16:00:00.000Z</published>
    <updated>2018-12-04T13:48:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è®¨è®ºäº†<code>CALayer</code>çš„<code>backing images</code>ä¸å‡ ä½•å¸ƒå±€ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡å®ƒçš„ç‰¹æ€§æ¥å®ç°ä¸€äº›ç‚«é…·çš„æ•ˆæœã€‚</p><h2 id="åœ†è§’ä¸è¾¹æ¡†"><a href="#åœ†è§’ä¸è¾¹æ¡†" class="headerlink" title="åœ†è§’ä¸è¾¹æ¡†"></a>åœ†è§’ä¸è¾¹æ¡†</h2><p><code>CALayer</code>æœ‰ä¸€ä¸ªå«åš<code>conrnerRadius</code>çš„å±æ€§æ§åˆ¶ç€å›¾å±‚è§’çš„æ›²ç‡ã€‚å®ƒæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œé»˜è®¤ä¸º0ï¼ˆä¸º0çš„æ—¶å€™å°±æ˜¯ç›´è§’ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ›²ç‡å€¼åªå½±å“èƒŒæ™¯é¢œè‰²è€Œä¸å½±å“èƒŒæ™¯å›¾ç‰‡æˆ–æ˜¯å­å›¾å±‚ã€‚å¦‚æœæŠŠ<code>masksToBounds</code>è®¾ç½®æˆYESçš„è¯ï¼Œå›¾å±‚é‡Œé¢çš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šè¢«æˆªå–ã€‚<br><code>CALayer</code>å¦å¤–ä¸¤ä¸ªéå¸¸æœ‰ç”¨å±æ€§å°±æ˜¯<code>borderWidth</code>å’Œ<code>borderColor</code>ã€‚äºŒè€…å…±åŒå®šä¹‰äº†å›¾å±‚è¾¹çš„ç»˜åˆ¶æ ·å¼ã€‚è¿™æ¡çº¿ï¼ˆä¹Ÿè¢«ç§°ä½œstrokeï¼‰æ²¿ç€å›¾å±‚çš„boundsç»˜åˆ¶ï¼ŒåŒæ—¶ä¹ŸåŒ…å«å›¾å±‚çš„è§’ã€‚<br><code>borderWidth</code>æ˜¯ä»¥ç‚¹ä¸ºå•ä½çš„å®šä¹‰è¾¹æ¡†ç²—ç»†çš„æµ®ç‚¹æ•°ï¼Œé»˜è®¤ä¸º0ã€‚<code>borderColor</code>å®šä¹‰äº†è¾¹æ¡†çš„é¢œè‰²ï¼Œé»˜è®¤ä¸ºé»‘è‰²ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>conrnerRadius</code>ä¸<code>masksToBounds</code>åŒæ—¶ä½¿ç”¨æ˜¯ä¼šé€ æˆç¦»å±æ¸²æŸ“ï¼Œä½¿ç”¨éœ€è¦è°¨æ…ã€‚ä¾‹å¦‚åœ¨TableViewçš„cellå®ç°åœ†è§’å¤´åƒï¼Œä½¿ç”¨è¿™ç§æ–¹æ¡ˆå®ç°åœ†è§’å°±ä¸åˆé€‚äº†ã€‚æœ‰ä¸€ç§ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆï¼šåˆ©ç”¨ä¸€å¼ ä¸­é—´ä¸ºé€æ˜åœ†å½¢çš„å›¾ç‰‡æ¥è¿›è¡Œé®ç›–ï¼Œè™½ç„¶ä¼šå¼•èµ·blendingï¼Œä½†æ€§èƒ½ä»ç„¶é«˜äºç¦»å±æ¸²æŸ“ã€‚</p><h2 id="é˜´å½±"><a href="#é˜´å½±" class="headerlink" title="é˜´å½±"></a>é˜´å½±</h2><p>ä¸åœ†è§’å’Œè¾¹æ¡†ä¸åŒï¼Œé˜´å½±ä¼šæ ¹æ®<code>backing image</code>ä¸å­è§†å›¾æ¥ç»˜åˆ¶ï¼Œè€Œä¸æ˜¯layerçš„è¾¹ç•Œå’Œè§’åŠå¾„ã€‚<br>è‡ªå®šä¹‰é˜´å½±ä¸»è¦æœ‰ä¸‹é¢å±æ€§éœ€è¦å…³æ³¨ï¼ˆé…åˆä¸‹å›¾çš„ä¾‹å­çœ‹ç€æ¯”è¾ƒç›´è§‚ï¼‰ï¼š</p><ul><li>shadowOpacityï¼šé˜´å½±çš„é€æ˜åº¦ï¼Œå–å€¼èŒƒå›´åœ¨0.0ï¼ˆä¸å¯è§ï¼‰åˆ°1.0ï¼ˆä¸é€æ˜ï¼‰ä¹‹é—´</li><li>shadowColorï¼šé˜´å½±é¢œè‰²ï¼Œé»˜è®¤æ˜¯é»‘è‰²</li><li>shadowOffsetï¼šé˜´å½±çš„æ–¹å‘å’Œè·ç¦»ï¼Œä»–æ˜¯ä¸€ä¸ªCGSizeï¼Œå®½åº¦æ§åˆ¶é˜´å½±æ¨ªå‘ä½ç§»ï¼Œé«˜åº¦æ§åˆ¶é˜´å½±çºµå‘ä½ç§»ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯{0, -3}ï¼Œä¹Ÿå°±æ˜¯è¯´é˜´å½±å‘ä¸Šä¾¿å®œ3ä¸ªç‚¹ã€‚</li><li>shadowRadiusï¼šé˜´å½±çš„æ¨¡ç³Šåº¦ï¼Œé»˜è®¤å€¼æ˜¯3ã€‚</li></ul><p><img src="/images/15438192854146-1.jpg" alt="é˜´å½±å±æ€§ä¸¾ä¾‹"></p><h3 id="shadowPath"><a href="#shadowPath" class="headerlink" title="shadowPath"></a>shadowPath</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨<code>shadowOffse</code>è®¾ç½®é˜´å½±ä¼šå¯¼è‡´ç¦»å±æ¸²æŸ“ï¼Œå®æ—¶è®¡ç®—é˜´å½±æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—èµ„æºçš„æ“ä½œï¼Œå°¤å…¶æ˜¯å›¾å±‚æœ‰å¤šä¸ªå­å›¾å±‚ï¼Œä¸”æ¯ä¸ªå›¾å±‚è¿˜æœ‰ä¸€ä¸ªæœ‰é€æ˜æ•ˆæœçš„<code>backing images</code>çš„æ—¶å€™ã€‚<br>è¿™æ—¶å¯ä»¥é€šè¿‡è®¾ç½®<code>shadowPath</code>å±æ€§æ¥æé«˜æ€§èƒ½ï¼Œ<code>shadowPath</code>æ˜¯ä¸€ä¸ª<code>CGPathRef</code>ç±»å‹ï¼ˆä¸€ä¸ªæŒ‡å‘<code>CGPath</code>çš„æŒ‡é’ˆï¼‰ã€‚<code>CGPath</code>æ˜¯ä¸€ä¸ª<code>Core Graphics</code>å¯¹è±¡ï¼Œç”¨æ¥æŒ‡å®šä»»æ„çš„ä¸€ä¸ªçŸ¢é‡å›¾å½¢ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå±æ€§å•ç‹¬äºå›¾å±‚å½¢çŠ¶ä¹‹å¤–æŒ‡å®šé˜´å½±çš„å½¢çŠ¶ã€‚ä¸‹å›¾å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ä¸¤ç§æ–¹å¼åœ¨æ€§èƒ½ä¸Šçš„å·®è·ã€‚</p><p><img src="/images/15438427503914.png" alt="15438427503914"></p><p>ä¸‹é¢çš„ä»£ç å®ç°äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„çŸ©å½¢é˜´å½±ã€‚</p><p><img src="/images/15438159073216.jpg" alt="è‡ªå®šä¹‰çŸ©å½¢é˜´å½±"></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®é˜´å½±é¢œè‰²</span></span><br><span class="line">layer.shadowColor = [<span class="built_in">UIColor</span> blackColor].CGColor;</span><br><span class="line"><span class="comment">// è®¾ç½®é˜´å½±ä¸é€æ˜åº¦</span></span><br><span class="line">layer.shadowOpacity = <span class="number">0.5</span>;</span><br><span class="line"><span class="comment">// ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢</span></span><br><span class="line"><span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line"><span class="built_in">CGPathAddRect</span>(path, <span class="literal">NULL</span>, layer.bounds);</span><br><span class="line"><span class="built_in">CGPathRelease</span>(path);</span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰çŸ©å½¢é˜´å½±</span></span><br><span class="line">layer.shadowPath = path;</span><br></pre></td></tr></table></figure><h2 id="æ‹‰ä¼¸"><a href="#æ‹‰ä¼¸" class="headerlink" title="æ‹‰ä¼¸"></a>æ‹‰ä¼¸</h2><p>å½“å›¾ç‰‡å®é™…å¤§å°ä¸è¦å±•ç¤ºçš„å¤§å°ä¸åŒçš„æ—¶å€™ï¼Œå›¾åƒå°±éœ€è¦ç¼©æ”¾ã€‚æœ‰ä¸¤ä¸ªå±æ€§å¯ä»¥å®šä¹‰å±æ€§ç¼©æ”¾ä½¿ç”¨çš„ç®—æ³•ï¼š</p><ul><li>minificationFilterï¼šç¼©å°å›¾ç‰‡ä½¿ç”¨ç®—æ³•ï¼Œé»˜è®¤<code>kCAFilterLinear</code></li><li>magnificationFilterï¼šæ”¾å¤§å›¾ç‰‡ä½¿ç”¨ç®—æ³•ï¼Œé»˜è®¤<code>kCAFilterLinear</code></li></ul><p>CALayeræä¾›äº†ä¸‰ç§ç¼©æ”¾çš„æ–¹å¼ï¼š</p><ul><li>kCAFilterLinearï¼šåŒçº¿æ€§è¿‡æ»¤ç®—æ³•ï¼Œé»˜è®¤ç®—æ³•</li><li>kCAFilterTrilinearï¼šä¸‰çº¿æ€§è¿‡æ»¤ç®—æ³•</li><li>kCAFilterNearestï¼šä¸´è¿‘è¿‡æ»¤ç®—æ³•</li></ul><p>å…³äºä»€ä¹ˆæ˜¯çº¿æ€§è¿‡æ»¤ç®—æ³•ï¼Œå¯ä»¥çœ‹çœ‹ç»´åŸºç™¾ç§‘çš„ç›¸å…³è¯æ¡<a href="https://zh.wikipedia.org/wiki/åŒçº¿æ€§è¿‡æ»¤" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘-åŒçº¿æ€§è¿‡æ»¤</a>ã€‚è¿™é‡Œæ‘˜å½•ä¸€æ®µä¾›å‚è€ƒï¼š</p><blockquote><p>åŒçº¿æ€§è¿‡æ»¤ï¼ˆBilinear filteringï¼‰æ˜¯è¿›è¡Œç¼©æ”¾æ˜¾ç¤ºçš„æ—¶å€™è¿›è¡Œçº¹ç†å¹³æ»‘çš„ä¸€ç§çº¹ç†è¿‡æ»¤æ–¹æ³•ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œçº¹ç†åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„æ—¶å€™éƒ½ä¸ä¼šåŒä¿å­˜çš„çº¹ç†ä¸€æ¨¡ä¸€æ ·ï¼Œæ²¡æœ‰ä»»ä½•æŸå¤±ã€‚æ­£å› ä¸ºè¿™æ ·ï¼Œæ‰€ä»¥ä¸€äº›åƒç´ è¦ä½¿ç”¨çº¹ç´ ä¹‹é—´çš„ç‚¹è¿›è¡Œè¡¨ç¤ºï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å‡è®¾çº¹ç´ éƒ½æ˜¯ä½äºå„ä¸ªå•å…ƒä¸­å¿ƒæˆ–è€…å·¦ä¸Šæˆ–è€…å…¶å®ƒä½ç½®çš„ç‚¹ã€‚åŒçº¿æ€§è¿‡æ»¤å™¨åˆ©ç”¨åƒç´ æ‰€è¡¨ç¤ºç‚¹å‘¨å›´å››ä¸ªæœ€è¿‘çš„ç‚¹ï¼ˆçº¹ç´ ç‚¹ï¼‰ä¹‹é—´è¿›è¡ŒåŒçº¿æ€§æ’å€¼ã€‚<br>åœ¨çº¹ç†ç¼©å‡åˆ°ä¸€åŠæˆ–è€…æ”¾å¤§ä¸€å€çš„èŒƒå›´å†…ï¼ŒåŒçº¿æ€§è¿‡æ»¤éƒ½èƒ½å¤Ÿæœ‰éå¸¸å¥½çš„ç²¾åº¦ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœçº¹ç†åœ¨æ¯ä¸ªæ–¹å‘éƒ½æœ‰ 256 ä¸ªåƒç´ ï¼Œé‚£ä¹ˆå°†å®ƒç¼©å‡åˆ° 128 ä»¥ä¸‹æˆ–è€…æ”¾å¤§åˆ° 512 ä»¥ä¸Šçš„æ—¶å€™ï¼Œç”±äºä¼šä¸¢æ‰å¤ªå¤šçš„åƒç´ æˆ–è€…è¿›è¡Œäº†è¿‡å¤šçš„å¹³æ»‘å¤„ç†ï¼Œçº¹ç†çœ‹èµ·æ¥å°±ä¼šå¾ˆå·®ã€‚<br>ä¸‰çº¿æ€§è¿‡æ»¤å°½ç®¡æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯å¯ä»¥ä½¿å¾—è¿‡æ¸¡éå¸¸å¹³æ»‘ã€‚</p></blockquote><p>ä¸´è¿‘è¿‡æ»¤ç®—æ³•æ˜¯ä¸€ç§ç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œå®ƒåªå–æ ·æœ€è¿‘çš„å•åƒç´ ç‚¹ï¼Œä¸ç®¡å…¶å®ƒåƒç´ ç‚¹ã€‚è¿™æ ·åšéå¸¸å¿«ï¼Œä¹Ÿä¸ä¼šä½¿å›¾ç‰‡æ¨¡ç³Šã€‚ä½†æ˜¯ä¼šè®©å‹ç¼©çš„å›¾ç‰‡æ›´ç³Ÿï¼Œè®©æ”¾å¤§çš„å›¾ç‰‡æ˜¾å¾—å—çŠ¶æˆ–æ˜¯é©¬èµ›å…‹ä¸¥é‡ã€‚</p><p>å¯¹æ¯”çº¿æ€§è¿‡æ»¤å’Œä¸´è¿‘è¿‡æ»¤ç®—æ³•ï¼Œéå¸¸å°çš„å›¾åƒæˆ–å…·æœ‰é²œæ˜å¯¹æ¯”åº¦å’Œè¾ƒå°‘æ–œçº¿çš„è¾ƒå¤§å›¾åƒï¼ˆä¾‹å¦‚ï¼Œè®¡ç®—æœºç”Ÿæˆçš„å›¾åƒï¼‰â€‹â€‹ï¼Œä¸´è¿‘è¿‡æ»¤ç®—æ³•å°†ä¿æŒå¯¹æ¯”åº¦å¹¶ä¸”å¯ä»¥äº§ç”Ÿæ›´å¥½çš„æ•ˆæœã€‚ä½†æ˜¯å¯¹äºå¤§å¤šæ•°å›¾åƒï¼Œå°¤å…¶æ˜¯å…·æœ‰æ–œçº¿æˆ–æ›²çº¿çš„å›¾åƒï¼Œçº¿æ€§è¿‡æ»¤ç®—æ³•å¥½å¾—å¤šã€‚æ¢å¥è¯è¯´ï¼Œçº¿æ€§è¿‡æ»¤ä¿ç•™äº†å½¢çŠ¶ï¼Œä¸´è¿‘è¿‡æ»¤ä¿ç•™äº†åƒç´ å·®å¼‚ã€‚</p><p>ä¹¦ä¸­ä¸¾äº†ä¸¤ä¸ªå¾ˆç›´è§‚ä¾‹å­ï¼Œå¯¹äºå¤§å›¾æ¥è¯´ï¼ŒåŒçº¿æ€§è¿‡æ»¤ç®—æ³•å’Œä¸‰çº¿æ€§è¿‡æ»¤ç®—æ³•è¡¨ç°å¾—æ›´å‡ºè‰²ï¼š<br><img src="/images/15438313676615.png" alt="15438313676615"></p><p>å¯¹äºæ²¡æœ‰æ–œçº¿çš„å°å›¾æ¥è¯´ï¼Œæœ€è¿‘è¿‡æ»¤ç®—æ³•è¦å¥½å¾ˆå¤šï¼š<br><img src="/images/15438313825142.png" alt="15438313825142"></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><code>CALayer</code>æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥å®ç°å¸¸è§çš„è§†è§‰æ•ˆæœï¼Œä½†æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬è¦æ³¨æ„ç¦»å±æ¸²æŸ“é—®é¢˜ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­è®¨è®ºäº†&lt;code&gt;CALayer&lt;/code&gt;çš„&lt;code&gt;backing images&lt;/code&gt;ä¸å‡ ä½•å¸ƒå±€ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡å®ƒçš„ç‰¹æ€§æ¥å®ç°ä¸€äº›ç‚«é…·çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;h2 id=&quot;åœ†è§’ä¸è¾¹æ¡†&quot;&gt;&lt;a href=&quot;#åœ†è§’ä¸è¾¹æ¡†&quot; class=
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>Core Animationå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰- å›¾å±‚å‡ ä½•å¸ƒå±€</title>
    <link href="https://crmo.github.io/2018/12/02/Core%20Animation%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://crmo.github.io/2018/12/02/Core Animationå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰/</id>
    <published>2018-12-01T16:00:00.000Z</published>
    <updated>2019-06-18T08:59:55.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€Layout"><a href="#ä¸€ã€Layout" class="headerlink" title="ä¸€ã€Layout"></a>ä¸€ã€Layout</h2><p>UIViewæœ‰ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„å¸ƒå±€å±æ€§ï¼š<code>frame</code>ï¼Œ<code>bounds</code>å’Œ<code>center</code>ï¼Œ<code>CALayer</code>å¯¹åº”åœ°å«åš<code>frame</code>ï¼Œ<code>bounds</code>å’Œ<code>position</code>ã€‚<br><code>frame</code>æ˜¯å›¾å±‚åœ¨çˆ¶å›¾å±‚ä¸Šçš„åæ ‡ï¼Œ<code>bounds</code>æ˜¯å†…éƒ¨åæ ‡ï¼ˆ{0, 0}é€šå¸¸æ˜¯å·¦ä¸Šè§’ï¼‰ã€‚<br><code>center</code>å’Œ<code>position</code>è¦éš¾ç†è§£ä¸€äº›ï¼Œç®€å•æ¥è¯´ä»–ä»¬å®šä¹‰äº†<code>anchorPoint</code>åœ¨çˆ¶å›¾å±‚ä¸­çš„ä½ç½®ï¼ˆåé¢ä¼šè¯¦ç»†è¯´æ˜ï¼‰ã€‚</p><p><code>UIView</code> çš„ <code>frame</code>,<code>bounds</code>,<code>center</code> å±æ€§å…¶å®åªæ˜¯å­˜å–æ–¹æ³•ï¼Œæ”¹å˜è¿™ä¸‰ä¸ªå±æ€§å…¶å®å®è´¨ä¸Šæ˜¯æ”¹å˜ <code>CALayer</code> çš„å¯¹åº”å±æ€§ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><p><img src="/images/15437391858284.jpg" alt="15437391858284"></p><p><code>frame</code> æ˜¯ä¸€ä¸ªè™šæ‹Ÿå±æ€§ï¼Œæ˜¯æ ¹æ® <code>bounds</code>ï¼Œ<code>position</code> å’Œ <code>transform</code> è®¡ç®—è€Œæ¥ï¼Œæ‰€ä»¥å½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªå€¼å‘ç”Ÿæ”¹å˜ï¼Œ<code>frame</code> éƒ½ä¼šå˜åŒ–ã€‚ç›¸åï¼Œæ”¹å˜ <code>frame</code> çš„å€¼åŒæ ·ä¼šå½±å“åˆ°ä»–ä»¬å½“ä¸­çš„å€¼ã€‚</p><blockquote><p><code>frame</code> ä¸ <code>bounds</code> ä¸€ç›´ç›¸ç­‰å—ï¼Ÿè¿™æ˜¯ä¸€ä¸ªé¢è¯•å¸¸é—®åˆ°çš„é—®é¢˜ã€‚<br>æˆ‘ä»¬é€šå¸¸å¼€å‘çš„æ—¶å€™<code>frame</code>ä¸<code>bounds</code>çš„å®½é«˜éƒ½ç›¸ç­‰ã€‚ä½†æ˜¯å½“å¯¹å›¾å±‚åšå˜æ¢çš„æ—¶å€™ï¼ˆæ—‹è½¬æˆ–è€…ç¼©æ”¾ï¼‰ï¼Œ<code>frame</code> å®é™…ä¸Šä»£è¡¨äº†è¦†ç›–åœ¨å›¾å±‚æ—‹è½¬ä¹‹åçš„æ•´ä¸ªè½´å¯¹é½çš„çŸ©å½¢åŒºåŸŸï¼Œè¿™æ—¶å€™å®ƒä»¬å°†ä¸å†ç›¸ç­‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p></blockquote><p><img src="/images/15437396721415.jpg" alt="15437396721415"></p><h2 id="äºŒã€anchorPointã€positionã€centerä¸‰è€…ä¸å¾—ä¸è¯´çš„æ•…äº‹"><a href="#äºŒã€anchorPointã€positionã€centerä¸‰è€…ä¸å¾—ä¸è¯´çš„æ•…äº‹" class="headerlink" title="äºŒã€anchorPointã€positionã€centerä¸‰è€…ä¸å¾—ä¸è¯´çš„æ•…äº‹"></a>äºŒã€anchorPointã€positionã€centerä¸‰è€…ä¸å¾—ä¸è¯´çš„æ•…äº‹</h2><p>è¦å½»åº•ç†è§£ <code>position</code> ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œé¦–å…ˆæˆ‘ä»¬å¾—ææ‡‚ä»€ä¹ˆæ˜¯ <code>anchorPoint</code>ã€‚å®ƒå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå›ºå®šå›¾å±‚çš„å›¾é’‰ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä½œä¸ºå˜æ¢çš„æ”¯ç‚¹ï¼Œæ¯”å¦‚åœ¨æ—‹è½¬å›¾å±‚æ—¶ï¼Œå°±ä¼šä»¥ <code>anchorPoint</code> ä¸ºåœ†å¿ƒæ—‹è½¬ï¼ˆä¸€èµ·æ¥æƒ³è±¡ä¸€ä¸‹ï¼‰ã€‚</p><p><img src="/images/15437419896060.jpg" alt="15437419896060"></p><p><code>anchorPoint</code> ç”¨ç›¸å¯¹åæ ‡è¡¨ç¤ºï¼Œå®ƒè¡¨ç¤ºç›¸å¯¹äºå›¾å±‚çš„ä½ç½®ï¼Œä¸¾å‡ ä¸ªä¾‹å­ã€‚</p><ul><li>å·¦ä¸Šè§’ï¼š(0,0)</li><li>å³ä¸‹è§’ï¼š(1,1)</li><li>ä¸­å¿ƒï¼š(0.5,0.5)</li></ul><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>anchorPoint</code> å¯ä»¥æ”¾åˆ° layer å¤–é¢ï¼Œè®¾ç½®å¤§äº1æˆ–å°äº0çš„å€¼å°±è¡Œã€‚</p></blockquote><p>è€Œ <code>position</code> å°±è¡¨ç¤º <code>anchorPoint</code> åœ¨çˆ¶å›¾å±‚çš„åæ ‡ï¼Œä¸‹é¢è¿™å¼ å›¾éå¸¸çš„æ¸…æ™°æ˜äº†ã€‚</p><p><img src="/images/15437425063586.jpg" alt="15437425063586"></p><p>ç”±äº <code>anchorPoint</code> æ˜¯ <code>CALayer</code> çš„å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯(0.5,0.5)ï¼Œä¹Ÿå°±æ˜¯ä¸­å¿ƒã€‚è€Œ <code>UIView</code> æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå› æ­¤ <code>UIView</code> çš„ <code>center</code> å±æ€§å°±è¡¨ç¤ºviewçš„ä¸­å¿ƒç‚¹åœ¨çˆ¶viewçš„åæ ‡ï¼ˆå‘½åä¸ºcenterå¯ä»¥è¯´æ˜¯éå¸¸çš„ç›´è§‚ï¼‰ã€‚</p><h2 id="ä¸‰ã€Coordinate-Systems"><a href="#ä¸‰ã€Coordinate-Systems" class="headerlink" title="ä¸‰ã€Coordinate Systems"></a>ä¸‰ã€Coordinate Systems</h2><h3 id="3-1ã€åæ ‡ç³»è½¬æ¢"><a href="#3-1ã€åæ ‡ç³»è½¬æ¢" class="headerlink" title="3.1ã€åæ ‡ç³»è½¬æ¢"></a>3.1ã€åæ ‡ç³»è½¬æ¢</h3><p><code>CALayer</code> ç»™ä¸åŒåæ ‡ç³»ä¹‹é—´çš„å›¾å±‚è½¬æ¢æä¾›äº†ä¸€äº›å·¥å…·ç±»æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥æŠŠå®šä¹‰åœ¨ä¸€ä¸ªå›¾å±‚åæ ‡ç³»ä¸‹çš„ç‚¹æˆ–è€…çŸ©å½¢è½¬æ¢æˆå¦ä¸€ä¸ªå›¾å±‚åæ ‡ç³»ä¸‹çš„ç‚¹æˆ–è€…çŸ©å½¢ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">CGPoint</span>)convertPoint:(<span class="built_in">CGPoint</span>)point fromLayer:(<span class="built_in">CALayer</span> *)layer;</span><br><span class="line">- (<span class="built_in">CGPoint</span>)convertPoint:(<span class="built_in">CGPoint</span>)point toLayer:(<span class="built_in">CALayer</span> *)layer;</span><br><span class="line">- (<span class="built_in">CGRect</span>)convertRect:(<span class="built_in">CGRect</span>)rect fromLayer:(<span class="built_in">CALayer</span> *)layer;</span><br><span class="line">- (<span class="built_in">CGRect</span>)convertRect:(<span class="built_in">CGRect</span>)rect toLayer:(<span class="built_in">CALayer</span> *)layer;</span><br></pre></td></tr></table></figure><h3 id="3-2ã€ç¿»è½¬"><a href="#3-2ã€ç¿»è½¬" class="headerlink" title="3.2ã€ç¿»è½¬"></a>3.2ã€ç¿»è½¬</h3><p>å¸¸è§„è¯´æ¥ï¼Œåœ¨iOSä¸Šï¼Œä¸€ä¸ªå›¾å±‚çš„<code>position</code>ä½äºçˆ¶å›¾å±‚çš„å·¦ä¸Šè§’ï¼Œä½†æ˜¯åœ¨Mac OSä¸Šï¼Œé€šå¸¸æ˜¯ä½äºå·¦ä¸‹è§’ã€‚<code>Core Animation</code>å¯ä»¥é€šè¿‡<code>geometryFlipped</code>å±æ€§æ¥é€‚é…è¿™ä¸¤ç§æƒ…å†µï¼Œå®ƒå†³å®šäº†ä¸€ä¸ªå›¾å±‚çš„åæ ‡æ˜¯å¦ç›¸å¯¹äºçˆ¶å›¾å±‚å‚ç›´ç¿»è½¬ï¼Œæ˜¯ä¸€ä¸ªBOOLç±»å‹ã€‚åœ¨iOSä¸Šé€šè¿‡è®¾ç½®å®ƒä¸ºYESæ„å‘³ç€å®ƒçš„å­å›¾å±‚å°†ä¼šè¢«å‚ç›´ç¿»è½¬ï¼Œä¹Ÿå°±æ˜¯å°†ä¼šæ²¿ç€åº•éƒ¨æ’ç‰ˆè€Œä¸æ˜¯é€šå¸¸çš„é¡¶éƒ¨ï¼ˆå®ƒçš„æ‰€æœ‰å­å›¾å±‚ä¹ŸåŒç†ï¼Œé™¤éæŠŠå®ƒä»¬çš„<code>geometryFlipped</code>å±æ€§ä¹Ÿè®¾ä¸ºYESï¼‰ã€‚</p><h3 id="3-3ã€Z-è½´"><a href="#3-3ã€Z-è½´" class="headerlink" title="3.3ã€Z è½´"></a>3.3ã€Z è½´</h3><p>å’Œ <code>UIView</code> ä¸¥æ ¼çš„äºŒç»´åæ ‡ç³»ä¸åŒï¼Œ<code>CALayer</code> å­˜åœ¨äºä¸€ä¸ªä¸‰ç»´ç©ºé—´å½“ä¸­ã€‚é™¤äº†æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡çš„ <code>position</code> å’Œ <code>anchorPoint</code> å±æ€§ä¹‹å¤–ï¼Œ<code>CALayer</code> è¿˜æœ‰å¦å¤–ä¸¤ä¸ªå±æ€§ï¼Œ<code>zPosition</code> å’Œ <code>anchorPointZ</code>ï¼ŒäºŒè€…éƒ½æ˜¯åœ¨Zè½´ä¸Šæè¿°å›¾å±‚ä½ç½®çš„æµ®ç‚¹ç±»å‹ã€‚</p><h2 id="å››ã€Hit-testing"><a href="#å››ã€Hit-testing" class="headerlink" title="å››ã€Hit testing"></a>å››ã€Hit testing</h2><p><code>CALayer</code> å¹¶ä¸å…³å¿ƒäº‹ä»¶å“åº”é“¾ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å¤„ç†è§¦æ‘¸äº‹ä»¶æˆ–è€…æ‰‹åŠ¿ã€‚ä½†æ˜¯å®ƒæœ‰ä¸€ç³»åˆ—çš„æ–¹æ³•å¸®ä½ å¤„ç†äº‹ä»¶ï¼š<code>containsPoint:</code>å’Œ<code>hitTest:</code>ã€‚<br><code>containsPoint:</code> æ¥å—ä¸€ä¸ªåœ¨æœ¬å›¾å±‚åæ ‡ç³»ä¸‹çš„CGPointï¼Œå¦‚æœè¿™ä¸ªç‚¹åœ¨layerçš„frameèŒƒå›´å†…å°±è¿”å›YESã€‚<br><code>hitTest:</code> æ–¹æ³•æ¥å—ä¸€ä¸ªCGPointç±»å‹å‚æ•°ï¼Œå®ƒè¿”å›è¿™ä¸ªç‚¹æ‰€åœ¨layerï¼Œä¹Ÿå°±æ˜¯layeræœ¬èº«ï¼Œæˆ–è€…å¶å­èŠ‚ç‚¹ã€‚</p><h2 id="è‡ªåŠ¨å¸ƒå±€"><a href="#è‡ªåŠ¨å¸ƒå±€" class="headerlink" title="è‡ªåŠ¨å¸ƒå±€"></a>è‡ªåŠ¨å¸ƒå±€</h2><p><code>CALayer</code> ä¸æ”¯æŒè‡ªåŠ¨å¸ƒå±€ï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†å’Œè®¡ç®—ã€‚æœ€å¥½çš„ç®¡ç†æ—¶æœºæ˜¯ <code>CALayerDelegate</code> çš„æ–¹æ³• <code>layoutSublayersOfLayer:</code> ï¼Œè¿™ä¸ªæ–¹æ³•è‡ªåŠ¨è°ƒç”¨å½“ <code>bounds</code> å˜åŒ–æˆ–è€… <code>setNeedsLayout</code> è¢«è°ƒç”¨ã€‚</p><p>ç„¶åæ‰‹åŠ¨ç®¡ç†å¸ƒå±€éå¸¸çš„ä¸å‹å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code>CALayer</code>ï¼Œè€Œæ˜¯è¦ç”¨ <code>UIView</code> çš„é‡è¦åŸå› ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ol><li>ç†è§£<code>frame</code>ï¼Œ<code>bounds</code>ï¼Œ<code>center</code>ï¼Œ<code>position</code>ï¼Œ<code>anchorPoint</code> å¯¹äºç†è§£å›¾å±‚å¸ƒå±€å¾ˆé‡è¦ã€‚</li><li><code>CALayer</code> æ²¡æœ‰å¤„ç†äº‹ä»¶å“åº”é“¾ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚</li><li><code>CALayer</code> ä¸æ”¯æŒè‡ªåŠ¨å¸ƒå±€ã€‚</li></ol><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="http://kittenyang.com/anchorpoint/" target="_blank" rel="noopener">è¿™å°†æ˜¯ä½ æœ€åä¸€æ¬¡çº ç»“positionä¸anchorPointï¼</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸€ã€Layout&quot;&gt;&lt;a href=&quot;#ä¸€ã€Layout&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€Layout&quot;&gt;&lt;/a&gt;ä¸€ã€Layout&lt;/h2&gt;&lt;p&gt;UIViewæœ‰ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„å¸ƒå±€å±æ€§ï¼š&lt;code&gt;frame&lt;/code&gt;ï¼Œ&lt;code&gt;bo
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>Core Animationå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰- CALayer</title>
    <link href="https://crmo.github.io/2018/12/02/Core%20Animation%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://crmo.github.io/2018/12/02/Core Animationå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰/</id>
    <published>2018-12-01T16:00:00.000Z</published>
    <updated>2019-06-17T04:06:34.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ˜¯æˆ‘é˜…è¯»ä¹¦ç±ã€ŠiOS CORE ANIMATION ADVANCED TECHNIQUESã€‹çš„è¯»ä¹¦ç¬”è®°ï¼Œæ„Ÿè°¢åŸä¹¦ä½œè€…åŠè¯‘è€…çš„åˆ†äº«ï¼<br>æ¨èå¤§å®¶æœ‰æ—¶é—´å¯ä»¥è¯»è¯»åŸä¹¦ï¼Œå†™çš„å¾ˆç²¾å½©ã€‚<a href="https://zsisme.gitbooks.io/ios-/content/index.html" target="_blank" rel="noopener">ä¸­æ–‡ç‰ˆ</a></p></blockquote><h2 id="ä¸€ã€Core-Animationå®šä¹‰"><a href="#ä¸€ã€Core-Animationå®šä¹‰" class="headerlink" title="ä¸€ã€Core Animationå®šä¹‰"></a>ä¸€ã€Core Animationå®šä¹‰</h2><p>ä»€ä¹ˆæ˜¯<code>Core Animation</code>ï¼Œç›¸ä¿¡å¾ˆå¤šåŒå­¦å¯¹äºå®ƒæ—¢ç†Ÿæ‚‰åˆé™Œç”Ÿï¼Œä»åå­—ä¸Šæ¥çœ‹å®ƒåº”è¯¥æ˜¯ä¸€ä¸ªåšåŠ¨ç”»çš„æ¡†æ¶ï¼Œå…¶å®åŠ¨ç”»åªæ˜¯å®ƒçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ›¾ç»å«åš<code>Layer Kit</code>ã€‚</p><p>å¼•ç”¨ä¹¦ä¸­çš„å®šä¹‰ï¼š</p><blockquote><p>Core Animationæ˜¯ä¸€ä¸ªå¤åˆå¼•æ“ï¼Œå®ƒçš„èŒè´£å°±æ˜¯å°½å¯èƒ½å¿«åœ°ç»„åˆå±å¹•ä¸Šä¸åŒçš„å¯è§†å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹æ˜¯è¢«åˆ†è§£æˆç‹¬ç«‹çš„<code>Layer</code>ï¼Œå¹¶å­˜å‚¨åœ¨<code>Layer Tree</code>ä¸­ã€‚äºæ˜¯è¿™ä¸ªæ ‘å½¢æˆäº†UIKitä»¥åŠåœ¨iOSåº”ç”¨ç¨‹åºå½“ä¸­ä½ æ‰€èƒ½åœ¨å±å¹•ä¸Šçœ‹è§çš„ä¸€åˆ‡çš„åŸºç¡€ã€‚</p></blockquote><p>çœ‹å®Œè¿˜æ˜¯ä¸€è„¸æ‡µé€¼ï¼Ÿæ²¡å…³ç³»ï¼Œåœ¨è¿™ä¸€ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘å°†æŠ½ä¸å‰¥èŒ§ï¼Œå¸¦é¢†å¤§å®¶æ­å¼€<code>Core Animation</code>çš„ç¥ç§˜é¢çº±ã€‚</p><h2 id="äºŒã€UIView-ä¸-CALayer"><a href="#äºŒã€UIView-ä¸-CALayer" class="headerlink" title="äºŒã€UIView ä¸ CALayer"></a>äºŒã€UIView ä¸ CALayer</h2><p>æˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸­ï¼Œæ¥è§¦æœ€å¤šçš„å°±æ˜¯ <code>UIView</code>ï¼Œ<code>UIView</code> å¯ä»¥å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œå¯ä»¥æ”¯æŒåŸºäº <code>Core Graphics</code> ç»˜å›¾ï¼Œå¯ä»¥åšä»¿å°„å˜æ¢ï¼ˆä¾‹å¦‚æ—‹è½¬æˆ–è€…ç¼©æ”¾ï¼‰ï¼Œæˆ–è€…ç®€å•çš„ç±»ä¼¼äºæ»‘åŠ¨æˆ–è€…æ¸å˜çš„åŠ¨ç”»ã€‚</p><p><code>CALayer</code> åˆ™æ˜¯æ›´åº•å±‚çš„ä¸œè¥¿ï¼Œ<code>UIView</code> å…¶å®å°±æ˜¯å¯¹ <code>CALayer</code> çš„é«˜çº§å°è£…ã€‚æ¯ä¸ª<code>UIView</code>éƒ½åŒ…å«ä¸€ä¸ª<code>CALayer</code>å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<code>backing layer</code>ã€‚<code>CALayer</code> ä¸ <code>UIView</code> æœ€å¤§çš„åŒºåˆ«æ˜¯å®ƒä¸å¤„ç†ç”¨æˆ·çš„äº¤äº’ï¼Œå®ƒçš„èŒè´£æ˜¯è´Ÿè´£å±å¹•ä¸Šçš„æ˜¾ç¤ºå’ŒåŠ¨ç”»ã€‚<code>UIView</code>è´Ÿè´£å¤„ç†ç”¨æˆ·äº¤äº’ï¼Œå¹¶ç®¡ç†<code>CALayer</code>ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‚¹ï¼Œç›´æ¥ä½¿ç”¨ <code>CALayer</code> ä¸èƒ½ç”¨è‡ªåŠ¨å¸ƒå±€ï¼Œéœ€è¦è‡ªå·±è®¡ç®—å¸ƒå±€ã€‚æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šç›´æ¥ä½¿ç”¨ <code>CALayer</code>ã€‚é™¤éä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„éœ€æ±‚ï¼š</p><ul><li>å†™è·¨å¹³å°çš„ä»£ç ï¼ŒåŒæ—¶å…¼å®¹ iPhone å’Œ Mac</li><li>ç›´æ¥ä½¿ç”¨ <code>CALayer</code> çš„å­ç±»ï¼Œå®ç°ç‰¹æ®Šå›¾å±‚å›¾å±‚çš„å±•ç¤º</li><li>å¯¹äºæ€§èƒ½è¦æ±‚å¾ˆé«˜</li></ul><blockquote><p>ä¸ºä»€ä¹ˆè‹¹æœä¸ç›´æ¥ç”¨ä¸€ä¸ªç®€å•å±‚çº§æ¥å¤„ç†æ‰€æœ‰äº‹æƒ…ï¼Ÿ<br>åŸå› åœ¨äºè¦åšèŒè´£åˆ†ç¦»ï¼Œè¿™æ ·ä¹Ÿèƒ½é¿å…å¾ˆå¤šé‡å¤ä»£ç ã€‚åœ¨iOSå’ŒMac OSä¸¤ä¸ªå¹³å°ä¸Šï¼Œäº‹ä»¶å’Œç”¨æˆ·äº¤äº’æœ‰å¾ˆå¤šåœ°æ–¹çš„ä¸åŒï¼ŒåŸºäºå¤šç‚¹è§¦æ§çš„ç”¨æˆ·ç•Œé¢å’ŒåŸºäºé¼ æ ‡é”®ç›˜æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆiOSæœ‰<code>UIKit</code>å’Œ<code>UIView</code>ï¼Œä½†æ˜¯Mac OSæœ‰<code>AppKit</code>å’Œ<code>NSView</code>çš„åŸå› ã€‚ä»–ä»¬åŠŸèƒ½ä¸Šå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯åœ¨å®ç°ä¸Šæœ‰ç€æ˜¾è‘—çš„åŒºåˆ«ã€‚</p></blockquote><h3 id="CALayerç‹¬æœ‰åŠŸèƒ½"><a href="#CALayerç‹¬æœ‰åŠŸèƒ½" class="headerlink" title="CALayerç‹¬æœ‰åŠŸèƒ½"></a>CALayerç‹¬æœ‰åŠŸèƒ½</h3><p>è‹¹æœå®˜æ–¹ä¸ºæˆ‘ä»¬å°è£…å¥½äº† <code>UIView</code>ï¼Œç®€å•æ˜“ç”¨å´æŠ›å¼ƒäº†çµæ´»æ€§ï¼Œéš¾å…ä¼šæœ‰ <code>UIView</code> æ»¡è¶³ä¸äº†çš„éœ€æ±‚ï¼Œè¿™æ˜¯å°±éœ€è¦æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ <code>CALayer</code> äº†ã€‚æœ‰ä¸€äº›UIViewæ²¡æœ‰æš´éœ²å‡ºæ¥çš„CALayerçš„åŠŸèƒ½ï¼š</p><ul><li>é˜´å½±ï¼Œåœ†è§’ï¼Œå¸¦é¢œè‰²çš„è¾¹æ¡†</li><li>3Då˜æ¢</li><li>éçŸ©å½¢èŒƒå›´</li><li>é€æ˜é®ç½©</li><li>å¤šçº§éçº¿æ€§åŠ¨ç”»</li></ul><h2 id="ä¸‰ã€backing-image"><a href="#ä¸‰ã€backing-image" class="headerlink" title="ä¸‰ã€backing image"></a>ä¸‰ã€backing image</h2><p><code>backing image</code> æ˜¯ <code>CALayer</code> çš„é‡è¦éƒ¨åˆ†ï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°å„ç§å¤æ‚çš„UIã€‚æœ‰ä¸¤ç§è®¾ç½® <code>backing image</code> çš„æ–¹æ³•:</p><ol><li>è®¾ç½®CALayerçš„ <code>contents</code> å±æ€§</li><li>ç›´æ¥ç”¨ <code>Core Graphics</code> ç»˜åˆ¶</li></ol><h3 id="3-1ã€contents"><a href="#3-1ã€contents" class="headerlink" title="3.1ã€contents"></a>3.1ã€contents</h3><p>CALayeræœ‰ä¸€ä¸ªå±æ€§å«åš <code>contents</code> ï¼Œè¿™ä¸ªå±æ€§çš„ç±»å‹è¢«å®šä¹‰ä¸ºidï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ ç»™<code>contents</code>èµ‹çš„ä¸æ˜¯CGImageï¼Œé‚£ä¹ˆä½ å¾—åˆ°çš„å›¾å±‚å°†æ˜¯ç©ºç™½çš„ã€‚</p><blockquote><p><code>contents</code> è¿™ä¸ªå¥‡æ€ªçš„è¡¨ç°æ˜¯ç”± Mac OS çš„å†å²åŸå› é€ æˆçš„ã€‚å®ƒä¹‹æ‰€ä»¥è¢«å®šä¹‰ä¸º id ç±»å‹ï¼Œæ˜¯å› ä¸ºåœ¨ Mac OS ç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªå±æ€§å¯¹ CGImage å’Œ NSImage ç±»å‹çš„å€¼éƒ½èµ·ä½œç”¨ã€‚å¦‚æœä½ è¯•å›¾åœ¨iOSå¹³å°ä¸Šå°† UIImage çš„å€¼èµ‹ç»™å®ƒï¼Œåªèƒ½å¾—åˆ°ä¸€ä¸ªç©ºç™½çš„å›¾å±‚ã€‚</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ª Demoï¼Œå¦‚ä½•ç”¨ <code>UIView</code> è€Œä¸æ˜¯ <code>UIImageView</code> åŠ è½½äº†ä¸€å¼ å›¾ç‰‡ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> lightGrayColor];</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    view.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:view];</span><br><span class="line">    <span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    [view.layer addSublayer:layer];</span><br><span class="line">    layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// imageNamed: ä¼šæ ¹æ®ä¸åŒæœºå‹å–ä¸åŒå€å›¾</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"test"</span>];</span><br><span class="line">    <span class="comment">// UIImageè½¬CGImageRefæ—¶scaleå±æ€§ä¸¢å¤±</span></span><br><span class="line">    <span class="built_in">CGImageRef</span> imageRef = image.CGImage;</span><br><span class="line">    layer.contents = (__bridge <span class="keyword">id</span>)imageRef;</span><br><span class="line">    <span class="comment">// è®¾ç½®å›¾ç‰‡ç¼©æ”¾</span></span><br><span class="line">    <span class="comment">// å¦‚æœcontentsGravityè®¾ç½®ä¸ºè‡ªåŠ¨ç¼©æ”¾ï¼Œå¯ä»¥ä¸ç”¨è®¾ç½®è¿™ä¸ªå±æ€§</span></span><br><span class="line">    layer.contentsScale = image.scale;</span><br><span class="line">    <span class="comment">// è®¾ç½®å›¾ç‰‡å±…ä¸­ä¸ç¼©æ”¾</span></span><br><span class="line">    layer.contentsGravity = kCAGravityCenter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-1-1ã€contentsGravity"><a href="#3-1-1ã€contentsGravity" class="headerlink" title="3.1.1ã€contentsGravity"></a>3.1.1ã€contentsGravity</h4><p><code>UIImageView</code> ä¸­é€šè¿‡è®¾ç½® <code>contentMode</code> æ¥è®¾ç½®å›¾ç‰‡æ‹‰ä¼¸æ–¹å¼ï¼Œåœ¨ <code>CALayer</code> ä¸­æœ‰ä¸€ä¸ªå¯¹åº”å±æ€§ <code>contentsGravity</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªNSStringç±»å‹ï¼Œé»˜è®¤å€¼æ˜¯ <code>kCAGravityResize</code>ã€‚<br>å®ƒçš„å¯é€‰çš„å€¼æœ‰ï¼š</p><ul><li>kCAGravityCenter</li><li>kCAGravityTop</li><li>kCAGravityBottom</li><li>kCAGravityLeft</li><li>kCAGravityRight</li><li>kCAGravityTopLeft</li><li>kCAGravityTopRight</li><li>kCAGravityBottomLeft</li><li>kCAGravityBottomRight</li><li>kCAGravityResize</li><li>kCAGravityResizeAspect</li><li>kCAGravityResizeAspectFill</li></ul><h4 id="3-1-2ã€UIImageè½¬CGImageæ‹‰ä¼¸ä¸¢å¤±é—®é¢˜"><a href="#3-1-2ã€UIImageè½¬CGImageæ‹‰ä¼¸ä¸¢å¤±é—®é¢˜" class="headerlink" title="3.1.2ã€UIImageè½¬CGImageæ‹‰ä¼¸ä¸¢å¤±é—®é¢˜"></a>3.1.2ã€UIImageè½¬CGImageæ‹‰ä¼¸ä¸¢å¤±é—®é¢˜</h4><p>å’ŒUIImageä¸åŒï¼ŒCGImageæ²¡æœ‰æ‹‰ä¼¸çš„æ¦‚å¿µã€‚ä½¿ç”¨UIImageç±»å»è¯»å–å›¾ç‰‡çš„æ—¶å€™ï¼Œå®ƒä¼šè¯»å–äº†å±å¹•ï¼ˆ1xã€2xã€3xï¼‰å¯¹åº”å°ºå¯¸çš„å›¾ç‰‡ã€‚ä½†æ˜¯ç”¨CGImageæ¥è®¾ç½®<code>layer.contents</code>æ—¶ï¼Œæ‹‰ä¼¸è¿™ä¸ªå› ç´ åœ¨è½¬æ¢çš„æ—¶å€™å°±ä¸¢å¤±äº†ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨è®¾ç½®<code>contentsScale</code>æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="3-1-3ã€contentsScale"><a href="#3-1-3ã€contentsScale" class="headerlink" title="3.1.3ã€contentsScale"></a>3.1.3ã€contentsScale</h4><p><code>contentsScale</code> å®šä¹‰äº†åƒç´ ç‚¹ä¸ view çš„å°ºå¯¸çš„æ¯”ä¾‹ï¼Œå¦‚æœ <code>contentsScale</code> è®¾ç½®ä¸º1.0ï¼Œå°†ä¼šä»¥æ¯ä¸ªç‚¹1ä¸ªåƒç´ ç»˜åˆ¶å›¾ç‰‡ï¼Œå¦‚æœè®¾ç½®ä¸º2.0ï¼Œåˆ™ä¼šä»¥æ¯ä¸ªç‚¹2ä¸ªåƒç´ ç»˜åˆ¶å›¾ç‰‡ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯1.0ã€‚<code>UIView</code>ä¸­å¯¹åº”<code>contentScaleFactor</code>å±æ€§ã€‚</p><h4 id="3-1-4ã€masksToBounds"><a href="#3-1-4ã€masksToBounds" class="headerlink" title="3.1.4ã€masksToBounds"></a>3.1.4ã€masksToBounds</h4><p>å½“å›¾ç‰‡å†…å®¹è¶…å‡º <code>UIView</code> å°ºå¯¸æ—¶ï¼Œé€šè¿‡è®¾ç½® <code>clipsToBounds</code> å¯ä»¥å®šä¹‰æ˜¯å¦è£å‰ªå†…å®¹ï¼Œ<code>CALayer</code> å¯¹åº”çš„å±æ€§å°±æ˜¯ <code>masksToBounds</code>ã€‚</p><h4 id="3-1-5ã€contentsCenter"><a href="#3-1-5ã€contentsCenter" class="headerlink" title="3.1.5ã€contentsCenter"></a>3.1.5ã€contentsCenter</h4><p>contentsCenteræ˜¯ä¸€ä¸ªCGRectï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªå›ºå®šçš„è¾¹æ¡†å’Œä¸€ä¸ªåœ¨å›¾å±‚ä¸Šå¯æ‹‰ä¼¸çš„åŒºåŸŸã€‚ç±»ä¼¼äº<code>UIImage</code>é‡Œçš„<code>resizableImageWithCapInsets</code> æ–¹æ³•ï¼Œåªæ˜¯å®ƒå¯ä»¥è¿ç”¨åˆ°ä»»ä½•<code>backing image</code>ï¼Œç”šè‡³åŒ…æ‹¬<code>Core Graphics</code>ç»˜åˆ¶çš„å›¾å½¢ã€‚</p><p><img src="images/15436482245238.jpg" alt=""></p><h3 id="4-1ã€Custom-Drawing"><a href="#4-1ã€Custom-Drawing" class="headerlink" title="4.1ã€Custom Drawing"></a>4.1ã€Custom Drawing</h3><p>ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ç›´æ¥ç”¨ <code>Core Graphics</code> ç»˜åˆ¶  <code>backing image</code>ï¼Œå…·ä½“å®ç°æ–¹å¼æ˜¯é€šè¿‡ç»§æ‰¿ <code>UIView</code> å¹¶å®ç° <code>drawRect</code> æ¥è‡ªå®šä¹‰ç»˜åˆ¶ã€‚</p><h4 id="4-1-1ã€CALayerDelegate"><a href="#4-1-1ã€CALayerDelegate" class="headerlink" title="4.1.1ã€CALayerDelegate"></a>4.1.1ã€CALayerDelegate</h4><p>è¦ç†è§£ <code>drawRect</code> çš„å·¥ä½œåŸç†ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ <code>CALayerDelegate</code>ã€‚<br><code>CALayer</code> æœ‰ä¸€ä¸ªå¯é€‰çš„delegateï¼Œé€šè¿‡å®ç° <code>CALayerDelegate</code>ï¼Œå°±å¯ä»¥è‡ªå®šä¹‰ <code>CALayer</code> çš„ <code>backing image</code>ã€‚<br><code>CALayerDelegate</code> ä¸­æœ‰ä¸¤ä¸ªå€¼å¾—å…³æ³¨çš„æ–¹æ³•ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”±-displayæ–¹æ³•çš„é»˜è®¤å®ç°è°ƒç”¨ï¼Œä½ åº”è¯¥å®ç°æ•´ä¸ªæ˜¾ç¤ºè¿‡ç¨‹ï¼ˆé€šå¸¸é€šè¿‡è®¾ç½®'contents'å±æ€§ï¼‰</span></span><br><span class="line"><span class="comment">// å¦‚æœå®ç°äº†è¯¥æ–¹æ³•ï¼Œå°±ä¸ä¼šè°ƒç”¨drawLayer:inContext:äº†</span></span><br><span class="line">- (<span class="keyword">void</span>)displayLayer:(<span class="built_in">CALayer</span> *)layer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”±-drawInContextæ–¹æ³•çš„é»˜è®¤å®ç°è°ƒç”¨</span></span><br><span class="line"><span class="comment">// å¦‚æœæ²¡æœ‰å®ç°displayLayer:ï¼Œå°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx;</span><br></pre></td></tr></table></figure><p>ç»™ä¸ªç®€å•çš„Demoï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> lightGrayColor];</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    view.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:view];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    [view.layer addSublayer:layer];</span><br><span class="line">    layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®ä»£ç†</span></span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// displayæ–¹æ³•å¿…é¡»æ‰‹åŠ¨è°ƒç”¨ï¼Œä¸ç„¶ä¸ä¼šæ‰§è¡Œç»˜åˆ¶</span></span><br><span class="line">    [layer display]; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx &#123;</span><br><span class="line">    <span class="comment">// ç”»ä¸€ä¸ªåœ†ç¯</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> redColor].CGColor);</span><br><span class="line">    <span class="built_in">CGContextStrokeEllipseInRect</span>(ctx, layer.bounds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>[layer display]</code>éœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼Œ<code>CALayer</code>ä¸ä¼šè‡ªåŠ¨é‡ç»˜å®ƒçš„å†…å®¹ï¼Œè€Œæ˜¯æŠŠé‡ç»˜å†³å®šæƒäº¤ç»™äº†å¼€å‘è€…ã€‚</p></blockquote><h4 id="4-1-2ã€drawRect"><a href="#4-1-2ã€drawRect" class="headerlink" title="4.1.2ã€drawRect"></a>4.1.2ã€drawRect</h4><p>ç†è§£äº† <code>CALayerDelegate</code> å†æ¥çœ‹ <code>drawRect</code> å°±ç®€å•å¾ˆå¤šäº†ï¼Œ<code>UIView</code> æŠŠ <code>CALayerDelegate</code> è®¾ç½®ä¸ºè‡ªå·±ï¼Œå¹¶å®ç°äº† <code>displayLayer:</code>ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦å…³å¿ƒè¿™äº›ç»†èŠ‚ï¼Œåªéœ€è¦é‡å†™ <code>drawRect</code>ï¼Œåœ¨æ–¹æ³•å†…ç»˜åˆ¶ <code>backing image</code> å³å¯ã€‚</p><p><strong>drawRectè°ƒç”¨æ—¶æœº</strong></p><p>å½“ <code>UIView</code> åœ¨å±å¹•ä¸Šå‡ºç°çš„æ—¶å€™ï¼Œ<code>drawRect</code> æ–¹æ³•å°±ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ç„¶åå†…å®¹å°±ä¼šè¢«ç¼“å­˜èµ·æ¥ç›´åˆ°å®ƒéœ€è¦è¢«æ›´æ–°ï¼Œé€šå¸¸æ˜¯å› ä¸ºæ‰‹åŠ¨è°ƒç”¨äº†<code>setNeedsDisplay</code>ï¼Œæˆ–å½±å“åˆ°è¡¨ç°æ•ˆæœçš„å±æ€§å€¼è¢«æ›´æ”¹æ—¶ï¼Œå¦‚ bounds å±æ€§ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨ <code>setNeedsDisplay</code> åï¼Œä¸ä¼šé©¬ä¸Šè§¦å‘ <code>drawRect</code>ï¼Œè€Œæ˜¯è¦ç­‰åˆ°æ¥æ”¶åˆ°RunLoopçš„ <code>kCFRunLoopBeforeWaiting</code> é€šçŸ¥åè§¦å‘ <code>drawRect</code>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="images/15436511549803.jpg" alt="drawRectè°ƒç”¨æ ˆ"></p><p><strong>å¦‚éå¿…é¡»ï¼Œå‹¿é‡å†™drawRectï¼ï¼ï¼</strong></p><p><code>drawRect</code> æ–¹æ³•æ²¡æœ‰é»˜è®¤çš„å®ç°ï¼Œå› ä¸ºå¯¹UIViewæ¥è¯´ï¼Œ<code>backing image</code> å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚å¦‚æœ<code>UIView</code> æ£€æµ‹åˆ° <code>drawRect</code> æ–¹æ³•è¢«è°ƒç”¨äº†ï¼Œå®ƒå°±ä¼šä¸ºè§†å›¾åˆ†é…ä¸€ä¸ª <code>backing image</code>ï¼Œè¿™ä¸ª<code>backing image</code> çš„åƒç´ å°ºå¯¸ç­‰äº<code>è§†å›¾å¤§å° * contentsScale</code>ï¼›åä¹‹åˆ™ä¸ä¼šåˆ›å»º <code>backing image</code>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰ç»˜åˆ¶çš„ä»»åŠ¡å°±ä¸è¦åœ¨é‡å†™ä¸€ä¸ªç©ºçš„ <code>drawRect</code>ã€‚</p><blockquote><p>åœ¨åšå®éªŒçš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªæœ‰è¶£ç°è±¡ï¼Œåœ¨åŒä¸€ä¸ªRunLoopå¾ªç¯é‡Œï¼Œå…ˆè°ƒç”¨<code>setNeedsDisplay</code>ï¼Œå†è®¾ç½® <code>view.layer</code> çš„ <code>contents</code>ï¼Œç³»ç»Ÿå°±ä¸ä¼šè°ƒç”¨ <code>drawRect</code> æ–¹æ³•äº†(éš¾é“æ˜¯å› ä¸ºè®¾ç½®<code>contents</code>ä¼šæŠŠ<code>needsDisplay</code>è®¾ç½®ä¸ºNOï¼Ÿï¼Ÿ)ã€‚</p></blockquote><h2 id="å››ã€å°ç»“"><a href="#å››ã€å°ç»“" class="headerlink" title="å››ã€å°ç»“"></a>å››ã€å°ç»“</h2><p>å¦‚æœæˆ‘ä»¬åªæ˜¯å†™ä¸€äº›ç®€å•çš„ç•Œé¢ï¼Œç”¨ <code>UIView</code> è¿™ç§é«˜çº§æ¥å£å°±å¤Ÿäº†ã€‚ä½†æ˜¯ä¸ºäº†å®ç°å¤æ‚UIä¸ä¸æ»‘ä½“éªŒï¼Œä½¿ç”¨ <code>Core Animation</code> å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼ˆç¼ºç‚¹æ˜¯é—¨æ§›é«˜ç‚¹ï¼Œç¼–ç å¤æ‚åº¦è¦é«˜äº›ï¼‰ã€‚<br>æœ¬æ–‡è¦ç‚¹æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li><code>Core Animation</code>æ˜¯ä¸€ä¸ªè´Ÿè´£å¤„ç†å›¾å±‚ã€å±å¹•ç»˜åˆ¶ã€åŠ¨ç”»ç­‰çš„å¤åˆå¼•æ“</li><li><code>UIView</code> æ˜¯å¯¹ <code>CALayer</code> çš„é«˜çº§å°è£…ï¼Œæ¯ä¸ª <code>UIView</code> åŒ…å«ä¸€ä¸ª <code>CALayer</code> å®ä¾‹ã€‚</li><li>è®¾ç½® <code>CALayer</code> çš„ <code>backing image</code> æœ‰ä¸¤ç§æ–¹å¼ï¼š<ul><li>ç›´æ¥è®¾ç½® <code>contents</code> å±æ€§</li><li>å®ç° <code>drawRect</code> æ–¹æ³•ï¼Œç”¨ <code>Core Graphics</code> ç»˜åˆ¶</li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯æˆ‘é˜…è¯»ä¹¦ç±ã€ŠiOS CORE ANIMATION ADVANCED TECHNIQUESã€‹çš„è¯»ä¹¦ç¬”è®°ï¼Œæ„Ÿè°¢åŸä¹¦ä½œè€…åŠè¯‘è€…çš„åˆ†äº«ï¼&lt;br&gt;æ¨èå¤§å®¶æœ‰æ—¶é—´å¯ä»¥è¯»è¯»åŸä¹¦ï¼Œå†™çš„å¾ˆç²¾å½©ã€‚&lt;a href=&quot;https://zsisme.gitbooks.
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>App Storeä¸Šæ¶æ¼«è°ˆ</title>
    <link href="https://crmo.github.io/2018/11/15/App%20Store%E4%B8%8A%E6%9E%B6%E6%BC%AB%E8%B0%88/"/>
    <id>https://crmo.github.io/2018/11/15/App Storeä¸Šæ¶æ¼«è°ˆ/</id>
    <published>2018-11-14T16:00:00.000Z</published>
    <updated>2018-12-02T07:46:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘å¿™ç€å†™BugğŸ˜‚ï¼Œå¥½ä¹…æ²¡æœ‰å†™æ–‡ç« äº†ã€‚ä»Šå¤©å’Œå¤§å®¶åˆ†äº«ä¸‹æˆ‘æœ€è¿‘ä¸Šæ¶ç¬¬äºŒä¸ªç‹¬ç«‹å¼€å‘çš„APPâ€œè¯†ä¹‹â€çš„ä¸Šæ¶ç»éªŒï¼ˆå…¶å®å°±æ˜¯ä¸ºäº†åšä¸€æ³¢å¹¿å‘Šï¼‰ã€‚</p><blockquote><p>é‡ç‚¹æ¥äº†ï¼ï¼ï¼<br>è¯†ä¹‹ï¼Œäººå·¥æ™ºèƒ½AIè¯†åˆ«ï¼ŒåŠ¨ç‰©ã€æ¤ç‰©ã€Logoã€æ±½è½¦è½¦å‹ã€èœå“ã€é€šç”¨ï¼ˆè¯†åˆ«å„ç§ä¸œè¥¿ï¼‰ç»Ÿç»Ÿå¯ä»¥è¯†åˆ«ã€‚åªéœ€ç”¨ç›¸æœºæ‹ä¸€å¼ ç…§ç‰‡ï¼Œæˆ–è€…ä»ç›¸å†Œä¸­é€‰æ‹©è¦è¯†åˆ«çš„å›¾ç‰‡ï¼Œå³å¯å¾—åˆ°ç­”æ¡ˆã€‚ä½¿ç”¨å®Œå…¨å…è´¹ä½¿ç”¨ï¼Œè§£å†³æ‚¨çš„çŸ¥è¯†ç„¦è™‘ï¼<br>ä¸‹è½½é“¾æ¥ï¼š<a href="http://t.cn/EAs5ubq" target="_blank" rel="noopener">http://t.cn/EAs5ubq</a><br>äº”æ˜Ÿå¥½è¯„æˆªå›¾è¿”ç°ğŸ’•</p></blockquote><p>å¥½äº†ï¼Œé‡ç‚¹ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥èŠç‚¹é—²è¯ğŸ˜ã€‚</p><h2 id="èŠèŠå®¡æ ¸"><a href="#èŠèŠå®¡æ ¸" class="headerlink" title="èŠèŠå®¡æ ¸"></a>èŠèŠå®¡æ ¸</h2><p>â€œè¯†ä¹‹â€æ˜¯æˆ‘ä¸Šæ¶çš„ç¬¬äºŒä¸ªç‹¬ç«‹å¼€å‘APPï¼Œ2å¤©æå®šå®¡æ ¸æˆåŠŸä¸Šæ¶ï¼ˆç¬¬ä¸€ä¸ªAPPæ˜¯3å¤©ï¼‰ï¼Œæœ‰äº›å¿ƒå¾—å’Œå¤§å®¶åˆ†äº«ä¸‹ã€‚<br>ä¸å¾—ä¸è¯´è‹¹æœå®¡æ ¸å›¢é˜Ÿç°åœ¨çš„æ•ˆç‡å¾ˆé«˜ï¼Œä¸€èˆ¬ä¸€å¤©å°±å¯ä»¥å®¡æ ¸å®Œæˆï¼Œæˆ‘è®°å¾—æˆ‘åˆšå¼€å§‹åšiOSé‚£ä¼šï¼Œå®¡æ ¸ä¸€æ¬¡è¦ä¸€å‘¨ï¼ŒçœŸçš„å¤ªæ¼«é•¿äº†ã€‚<br>æ¯æ¬¡æäº¤æ–°ç‰ˆæœ¬ä¹‹åï¼Œç¬¬äºŒå¤©æ—©ä¸Šèµ·åºŠç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æ”¶é‚®ä»¶ã€‚ç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„æ ‡é¢˜çš„é‚®ä»¶ï¼Œå¿ƒæ€ç¬é—´è¹¦äº†ã€‚</p><p><img src="/images/WechatIMG82.jpeg" alt="WechatIMG82"></p><p>ä½†æ˜¯ä¸è¦æ…Œï¼Œè¿™åªæ˜¯è‹¹æœæ€€ç–‘ä½ å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå¹¶ä¸ä»£è¡¨çœŸçš„æœ‰é—®é¢˜ã€‚å…ˆé™ä¸‹å¿ƒæ¥ï¼Œè¯»è¯»è¿™ç¯‡<a href="https://developer.apple.com/cn/app-store/review/guidelines" target="_blank" rel="noopener">ä¸Šæ¶è¿‡å®¡ç§˜ç±</a>ã€‚</p><p>ç„¶å<code>ä»”ç»†é˜…è¯»</code>è‹¹æœçš„ç­”å¤ï¼Œä»”ç»†æ£æ‘©å®¡æ ¸å›¢é˜Ÿçš„ç”¨æ„ã€‚æŠŠå®¡æ ¸å›¢é˜Ÿå½“åšå°ç™½ç”¨æˆ·ï¼Œç«™åœ¨ä»–ä»¬çš„è§’åº¦æ¥æ€è€ƒä»–ä»¬æå‡ºçš„é—®é¢˜ï¼Œç„¶åå¯¹ç…§<a href="https://developer.apple.com/cn/app-store/review/guidelines" target="_blank" rel="noopener">è‹¹æœå®¡æ ¸æ¡ä¾‹</a>ä»”ç»†æ£€æŸ¥ã€‚å¦‚æœç¡®è®¤è‡ªå·±ä¸å­˜åœ¨é—®é¢˜ï¼Œå°±ç›´æ¥å›å¤é‚®ä»¶è¯´æ˜ï¼Œé’ˆå¯¹å®¡æ ¸å›¢é˜Ÿæå‡ºçš„é—®é¢˜è¯¦ç»†è§£é‡Šï¼ˆä¸éœ€è¦é‡æ–°æäº¤äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼Œä¸€èˆ¬éš”å¤©å°±èƒ½æ”¶åˆ°å®¡æ ¸å›¢é˜Ÿçš„ç­”å¤ã€‚</p><blockquote><p>è¿™é‡Œæœ‰ä¸ªæŠ€å·§æˆ‘å±¡è¯•ä¸çˆ½ï¼Œæäº¤å®¡æ ¸æ—¶ï¼Œå¯ä»¥é™„ä¸Šä¸€ä¸ªæ¼”ç¤ºè§†é¢‘ã€‚å› ä¸ºAPPçš„ä¸šåŠ¡é€»è¾‘ä¸€èˆ¬æ¯”è¾ƒå¤æ‚ï¼Œå•é æ–‡å­—æè¿°éš¾ä»¥è¡¨è¿°æ¸…æ¥šï¼ˆæƒ³æƒ³äº§å“ç»ç†å½“é¢äº¤ä»£çš„åŠŸèƒ½éƒ½ç»å¸¸è¢«åšåï¼Œåˆ«è¯´çŸ­çŸ­ä¸€å°é‚®ä»¶äº†ï¼‰ï¼Œè€Œä¸”é•¿æ–‡æœ¬ä¼šè®©äººçœ‹ç€å¾ˆæŠ“ç‹‚ï¼Œå®¡æ ¸å›¢é˜Ÿä¸€å¤©å¯†é›†çš„å®¡æ ¸ï¼Œçœ‹ç€é•¿ç¯‡å¤§è®ºå¿ƒæƒ…è‡ªç„¶ä¸å¥½ã€‚è¿™æ—¶å€™é™„ä¸Šä¸€ä¸ªç²¾å¿ƒå½•åˆ¶çš„æ¼”ç¤ºè§†é¢‘ï¼Œä¸€çœ¼å°±å¯ä»¥çœ‹æ‡‚ä½ çš„APPæ˜¯å¹²å˜›çš„ã€‚<br>è§†é¢‘æ¨èä¸Šä¼ åˆ°Youtubeæ–¹ä¾¿å›½å¤–è§‚çœ‹ã€‚</p></blockquote><p>å¦‚æœç¡®è®¤APPçœŸçš„å­˜åœ¨é—®é¢˜ï¼Œé‚£å°±ä¹–ä¹–çš„ä¿®æ”¹å§ï¼Œä¿®æ”¹ä¹‹åé‡æ–°æäº¤å®¡æ ¸ï¼ˆé¢ã€‚ã€‚ã€‚é©¬ç”²åŒ…ä»€ä¹ˆçš„ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ï¼‰ã€‚</p><blockquote><p>ä»Šå¹´10æœˆåä¸Šæ¶çš„APPéƒ½éœ€è¦æä¾›éšç§æ”¿ç­–ï¼Œ<a href="http://crmo.github.io/2018/10/13/åº”å¯¹è‹¹æœéšç§æ”¿ç­–çœ‹æˆ‘å°±å¤Ÿäº†/">è¿™ç¯‡æ–‡ç« </a>æ•™ä½ è½»æ¾åº”å¯¹ã€‚</p></blockquote><h2 id="å®é™…æ¡ˆä¾‹"><a href="#å®é™…æ¡ˆä¾‹" class="headerlink" title="å®é™…æ¡ˆä¾‹"></a>å®é™…æ¡ˆä¾‹</h2><p>è¿™é‡Œå’Œå¤§å®¶åˆ†äº«ä¸‹â€œè¯†ä¹‹â€çš„ä¸Šæ¶è¿‡ç¨‹ï¼Œâ€é¦™è•‰æ’­æ”¾å™¨â€œçš„ä¸Šæ¶è¿‡ç¨‹çœ‹<a href="http://crmo.github.io/2018/10/07/è®°â€œé¦™è•‰æ’­æ”¾å™¨â€ä¸Šæ¶çš„è¾›é…¸å†ç¨‹/">è¿™ç¯‡æ–‡ç« </a>ã€‚<br>æäº¤çš„ç¬¬äºŒå¤©å°±æ”¶åˆ°æ‹’ä¿¡ï¼Œæ¶‰åŠåˆ°çš„æ¡æ¬¾ï¼š<code>3.1.4</code>ã€<code>4.2</code>ï¼ˆè¿™æ¬¡ç»ˆäºæ²¡æœ‰åˆºæ¿€çš„2.1å¤§ç¤¼åŒ…äº†ï¼‰ã€‚ä¸‹é¢æ˜¯å®¡æ ¸å›¢é˜Ÿçš„å›å¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Guideline 3.1.4 - Business - Payments - Content Codes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Your app enables additional features or functionality when used with augmented reality markers or QR codes. However, those features are not available in the app to users without the necessary markers.</span><br><span class="line"></span><br><span class="line">Next Steps</span><br><span class="line"></span><br><span class="line">To resolve this issue, please provide a means to access these features from within the app, such as through achievements or in-app purchase. If they can be freely obtained, such as through a link to a website, please revise your app to include clear instructions for obtaining the necessary markers or codes.</span><br><span class="line"></span><br><span class="line">Please note that apps cannot require users to purchase unrelated products or engage in advertising or marketing activities to unlock app functionality.</span><br><span class="line"></span><br><span class="line">Guideline 4.2 - Design - Minimum Functionality</span><br><span class="line"></span><br><span class="line">We noticed that your app includes an AR or QR scanner but does not include any additional content or functionality unless the user has access to the AR marker or QR code. While we understand that your app displays additional content when an AR marker or QR code is scanned, to users who do not have access to the AR markers or QR codes, your app only appears to display a camera view.</span><br><span class="line"></span><br><span class="line">Next Steps</span><br><span class="line"></span><br><span class="line">We encourage you to provide your users with additional content in your app, including directions on how to use your app and information on how to obtain any necessary AR markers or QR codes.</span><br><span class="line"></span><br><span class="line">To ensure users have the best experience, apps should provide valuable utility or entertainment, draw people in by offering compelling capabilities or content, or enable people to do something they couldn&apos;t do before or in a way they couldn&apos;t do it before.</span><br></pre></td></tr></table></figure><p>é˜…è¯»ç†è§£æ—¶é—´å¼€å§‹äº†ï¼Œç¬¬ä¸€éçœ‹å®Œæˆ‘æ˜¯ä¸€è„¸æ‡µé€¼çš„ï¼Œå›å¤ä¸­æåˆ°äº†ä¸¤ä¸ªå…³é”®è¯<code>AR markers</code>å’Œ<code>QR codes</code>ï¼Œå¯æ˜¯æˆ‘æ ¹æœ¬æ²¡æœ‰ç”¨åˆ°è¿™äº›ä¸œè¥¿ã€‚äºæ˜¯æˆ‘å†·é™ä¸‹æ¥ï¼ŒæŸ¥äº†ä¸‹å®¡æ ¸æŒ‡å—ã€‚</p><p><img src="/images/15422845505208.jpg" alt="15422845505208"></p><p><img src="/images/15422846190717.jpg" alt="15422846190717"></p><p>ç»“åˆå®¡æ ¸æŒ‡å—å°±èƒ½ç†è§£å®¡æ ¸å›¢é˜Ÿçš„ç”¨æ„äº†ï¼Œä»–ä»¬æ²¡æœ‰ç†è§£æˆ‘çš„APPçš„åŠŸèƒ½ï¼Œæˆ‘çš„APPä¸»è¦é¡µé¢æ˜¯ä¸€ä¸ªç›¸æœºï¼Œæ‹ä¸€å¼ ç…§ç‰‡ï¼Œç„¶åè¯†åˆ«å›¾ç‰‡ä¸­çš„ç‰©ä½“æ˜¯å•¥ã€‚<br>å®¡æ ¸å›¢é˜Ÿçš„ç†è§£æ˜¯APPéœ€è¦é…åˆç‰¹æ®Šçš„å®ä½“ç‰©ä½“æˆ–è€…äºŒç»´ç æ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå¦åˆ™APPå°±æ²¡æœ‰ä»»ä½•ç”¨é€”ã€‚è¿™æ˜¾ç„¶æ˜¯è¯¯è§£æˆ‘äº†ï¼Œäºæ˜¯æˆ‘å½•åˆ¶äº†ä¸€ä¸ªè§†é¢‘ï¼Œè¯¦ç»†çš„æ¼”ç¤ºäº†APPçš„åŠŸèƒ½ï¼Œé…ä¸Šæ–‡å­—è¯´æ˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Dear Apple Review Team:</span><br><span class="line">    Thank you for your patience review, we have done a detailed check on the following questions.</span><br><span class="line">    Our app does not depend on specific markers or QR codes,users can use our app recognize anything,such as cars,plants,animals,dishes,logos.</span><br><span class="line">    We made this app to help users identify objects around them.For example, if the user sees a beautiful plant and wants to know what it is,he can open our appï¼Œthen take a photo use camera,our app will tell him what is this in the photo.</span><br><span class="line">    We recorded a detailed demo video to illustrate our features:https://youtu.be/1okyq-ZJGzU</span><br><span class="line">    Finally, thank you again for your hard review.</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå¤©ä¸Šæ¶æˆåŠŸã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘å¿™ç€å†™BugğŸ˜‚ï¼Œå¥½ä¹…æ²¡æœ‰å†™æ–‡ç« äº†ã€‚ä»Šå¤©å’Œå¤§å®¶åˆ†äº«ä¸‹æˆ‘æœ€è¿‘ä¸Šæ¶ç¬¬äºŒä¸ªç‹¬ç«‹å¼€å‘çš„APPâ€œè¯†ä¹‹â€çš„ä¸Šæ¶ç»éªŒï¼ˆå…¶å®å°±æ˜¯ä¸ºäº†åšä¸€æ³¢å¹¿å‘Šï¼‰ã€‚&lt;/p
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>èŠèŠiOSå¼€å‘ä¸­çš„JSBridge</title>
    <link href="https://crmo.github.io/2018/10/22/%E8%81%8A%E8%81%8AiOS%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84JSBridge/"/>
    <id>https://crmo.github.io/2018/10/22/èŠèŠiOSå¼€å‘ä¸­çš„JSBridge/</id>
    <published>2018-10-21T16:00:00.000Z</published>
    <updated>2018-10-22T13:40:18.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/tower-bridge-2324875_1280.jpg" alt="tower-bridge-2324875_1280"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Hybrid Appï¼ˆæ··åˆæ¨¡å¼ç§»åŠ¨åº”ç”¨ï¼‰æ˜¯æŒ‡ä»‹äºweb-appã€native-appè¿™ä¸¤è€…ä¹‹é—´çš„appï¼Œå…¼å…·â€œNative Appè‰¯å¥½ç”¨æˆ·äº¤äº’ä½“éªŒçš„ä¼˜åŠ¿â€å’Œâ€œWeb Appè·¨å¹³å°å¼€å‘çš„ä¼˜åŠ¿â€ã€‚è°ˆåˆ°Hybrid Appï¼ŒJSä¸Native codeçš„äº¤äº’å°±æ˜¯ä¸€ä¸ªç»•ä¸å¼€çš„è¯é¢˜ï¼Œè¿™æ—¶å°±éœ€è¦â€œä¸€åº§æ¡¥â€æ¥è¿æ¥ä¸¤ç«¯ã€‚<br><code>JSBridge</code>æ¶èµ·äº†ä¸€åº§è¿æ¥<code>JavaScript</code>ä¸<code>Native Code</code>çš„æ¡¥æ¢ï¼Œè®©ä¸¤ç«¯å¯ä»¥ç›¸äº’è°ƒç”¨ã€‚</p><p><img src="/images/JSBridge.png" alt="JSBridge"></p><p>æœ¬æ–‡åŸºäº<code>UIWebView</code>ï¼Œå°†ä¼šåˆ†åˆ«ä»‹ç»3ç§æ–¹æ¡ˆã€‚é€šè¿‡<code>Iframe</code>ã€<code>Ajax</code>ã€<code>JSCore</code>æ¥å®ç°JSBridgeï¼Œæ¶‰åŠåˆ°çš„<a href="https://github.com/crmo/CRJSBridgeDemo" target="_blank" rel="noopener">Demoåœ°å€</a>ï¼Œé¡ºæ‰‹ç»™ä¸ªStarå‘—ğŸ˜ã€‚</p><h2 id="å®ç°æ–¹æ¡ˆ"><a href="#å®ç°æ–¹æ¡ˆ" class="headerlink" title="å®ç°æ–¹æ¡ˆ"></a>å®ç°æ–¹æ¡ˆ</h2><h3 id="Iframe"><a href="#Iframe" class="headerlink" title="Iframe"></a>Iframe</h3><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´å…¥ä¸»é¢˜ï¼Œé¦–å…ˆè®²çš„è¿™ç§æ–¹æ¡ˆæ¯”è¾ƒå¸¸è§ã€‚<code>WebViewJavascriptBridge</code>ä¸<code>Cordava</code>éƒ½æ˜¯é‡‡ç”¨çš„è¯¥æ–¹æ¡ˆï¼ˆæ¨èçœ‹çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« <a href="http://crmo.github.io/2018/05/09/Cordovaæºç è§£æ/">Cordovaæºç è§£æ</a>ï¼‰ã€‚<br>æ ¸å¿ƒæ€è·¯å°±æ˜¯åœ¨UIWebViewæ‹¦æˆªIframeçš„srcï¼ŒåŒæ–¹æå‰çº¦å®šå¥½åè®®ï¼Œä¾‹å¦‚<code>https://__jsbridge__</code>å°±æ˜¯ä¸€æ¬¡è°ƒç”¨å¼€å§‹ã€‚<br>å¯ä»¥å­¦ä¹ <code>Cordova</code>çš„ç­–ç•¥ï¼Œå°†å¹¶å‘çš„å¤šæ¬¡è°ƒç”¨æ‰“åŒ…åˆå¹¶ä¸ºä¸€æ¬¡å¤„ç†ï¼Œå¯ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>1.JSæš´éœ²ä¸€ä¸ªæ–¹æ³•ç»™Nativeï¼Œæ¥æ”¶æ‰§è¡Œç»“æœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">responseFromObjC</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!callback) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    callback(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.Nativeå®ç°<code>UIWebView</code>çš„ä»£ç†ï¼Œåœ¨<code>webView:shouldStartLoadWithRequest:navigationType:</code>æ–¹æ³•æ‹¦æˆªè¯·æ±‚ï¼Œè¯†åˆ«åˆ°ç‰¹å®šURLï¼Œå¼€å§‹ä¸€æ¬¡è°ƒç”¨æµç¨‹ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‹¦æˆªJSè°ƒç”¨åŸç”Ÿæ ¸å¿ƒæ–¹æ³•</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)webView:(<span class="built_in">UIWebView</span> *)webView shouldStartLoadWithRequest:(<span class="built_in">NSURLRequest</span> *)request navigationType:(<span class="built_in">UIWebViewNavigationType</span>)navigationType &#123;</span><br><span class="line">    <span class="built_in">NSURL</span> *url = request.URL;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­urlæ˜¯å¦æ˜¯JSBridgeè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">if</span> ([url.host isEqualToString:<span class="string">@"__jsbridge__"</span>]) &#123;</span><br><span class="line">       <span class="comment">// å¤„ç†JSè°ƒç”¨Native</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.JSå¼€å¯ä¸€ä¸ªIframeï¼ŒåŠ è½½ä¸€ä¸ªç‰¹å®šçš„URLï¼Œå¼€å§‹ä¸€æ¬¡è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line">iframe.style.display = <span class="string">'none'</span>;</span><br><span class="line">iframe.src = <span class="string">'https://__jsbridge__?action='</span>+ action + <span class="string">'&amp;data='</span> + data;</span><br><span class="line"><span class="built_in">document</span>.documentElement.appendChild(iframe);</span><br></pre></td></tr></table></figure><p>4.Nativeæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œè°ƒç”¨JSæ–¹æ³•<code>responseFromObjC</code>å°†ç»“æœå›ä¼ ç»™JSã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// è·å–è°ƒç”¨å‚æ•°ï¼Œdemoçš„è°ƒç”¨æ–¹å¼æ˜¯ï¼š'https://__jsbridge__?action=action&amp;data='</span></span><br><span class="line"><span class="comment">// å‚æ•°ç›´æ¥æ”¾åœ¨queryé‡Œé¢çš„ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯jsæš´éœ²ä¸€ä¸ªæ–¹æ³•ç»™åŸç”Ÿï¼ŒåŸç”Ÿè°ƒç”¨æ–¹æ³•è·å–æ•°æ®</span></span><br><span class="line"><span class="built_in">NSURLComponents</span> *urlComponents = [<span class="built_in">NSURLComponents</span> componentsWithURL:url resolvingAgainstBaseURL:<span class="literal">YES</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *queryItems = urlComponents.queryItems;</span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *params = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSURLQueryItem</span> *queryItem <span class="keyword">in</span> queryItems) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *key = queryItem.name;</span><br><span class="line">    <span class="built_in">NSString</span> *value = queryItem.value;</span><br><span class="line">    [params setObject:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">NSString</span> *action = params[<span class="string">@"action"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *data = params[<span class="string">@"data"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ([action isEqualToString:<span class="string">@"alertMessage"</span>]) &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼Œè·å–æ•°æ®</span></span><br><span class="line">    <span class="comment">// jsæš´éœ²æ–¹æ³•`responseFromObjC`ç»™åŸç”Ÿï¼ŒåŸç”Ÿé€šè¿‡è¯¥æ–¹æ³•å›è°ƒ</span></span><br><span class="line">    <span class="comment">// åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸ºäº†å®ç°å®ç°jså¹¶å‘åŸç”Ÿæ–¹æ³•ï¼Œæœ€å¥½å¸¦ä¸€ä¸ªcallBackIDï¼Œæ¥åŒºåˆ†ä¸åŒçš„è°ƒç”¨</span></span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"responseFromObjC('%@')"</span>, data]];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"responseFromObjC('Unkown action'"</span>]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PS:demoä»£ç ä¸ºäº†ç®€åŒ–ï¼Œç›´æ¥å°†å‚æ•°æ”¾åœ¨URLçš„queryé‡Œï¼Œå¦‚æœåªä¼ è¾“ä¸€äº›ç®€å•æ•°æ®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯JSå…ˆå°†å‚æ•°å­˜æ”¾èµ·æ¥ï¼Œé€šè¿‡URLä¼ é€’ä¸€ä¸ªkeyç»™Nativeï¼Œå†æš´éœ²ä¸€ä¸ªé€šè¿‡keyå–æ•°æ®çš„æ–¹æ³•ï¼ŒNativeä¸»åŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•å–ã€‚</p><h3 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h3><p>ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯JSä½¿ç”¨<code>XMLHttpRequest</code>å‘èµ·è¯·æ±‚ï¼Œåœ¨Nativeæ‹¦æˆªè¾¾åˆ°è°ƒç”¨çš„ç›®çš„ã€‚é€šè¿‡è‡ªå®šä¹‰<code>NSURLProtocol</code>å¯ä»¥æ‹¦æˆªåˆ°Ajaxè¯·æ±‚ã€‚Demoé‡Œæœ‰è¯¦ç»†çš„ä»£ç å’Œæ³¨é‡Šï¼Œå»ºè®®ç»“åˆDemoä¸€èµ·çœ‹ã€‚</p><h4 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>1.æ–°å»ºç±»ç»§æ‰¿è‡ª<code>NSURLProtocol</code>ï¼Œå¹¶æ³¨å†Œã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">NSURLProtocol</span> registerClass:[CRURLProtocol <span class="keyword">class</span>]];</span><br></pre></td></tr></table></figure><p>2.å®ç°è‡ªå®šä¹‰<code>NSURLProtocol</code>ï¼Œåœ¨<code>startLoading</code>æ–¹æ³•æ‹¦æˆªAjaxè¯·æ±‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startLoading &#123;</span><br><span class="line">    <span class="built_in">NSURL</span> *url = [[<span class="keyword">self</span> request] URL];</span><br><span class="line">    <span class="comment">// æ‹¦æˆªâ€œhttp://__jsbridge__â€è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> ([url.host isEqualToString:<span class="string">@"__jsbridge__"</span>]) &#123;</span><br><span class="line">       <span class="comment">// å¤„ç†JSè°ƒç”¨Native</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.JSå‘èµ·Ajaxè¯·æ±‚ï¼ŒURLä¸ºæå‰çº¦å®šçš„ç‰¹æ®Šå€¼ï¼Œä¾‹å¦‚ï¼šhttp://<strong>jsbridge</strong>ã€‚è¯·æ±‚å‚æ•°æ”¾åœ¨<code>Request Body</code>é‡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è°ƒç”¨åŸç”Ÿ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callNative</span>(<span class="params">action, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="built_in">window</span>.XMLHttpRequest(),</span><br><span class="line">        url = <span class="string">'http://__jsbridge__'</span>;</span><br><span class="line">        xhr.open(<span class="string">'POST'</span>, url, <span class="literal">false</span>);</span><br><span class="line">        xhr.send(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">                    action: action,</span><br><span class="line">                    data: data</span><br><span class="line">                    &#125;));</span><br><span class="line">        <span class="keyword">return</span> xhr.responseText;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.Naiveæ‹¦æˆªåˆ°è¯·æ±‚ï¼Œè·å–å‚æ•°ï¼Œæ‰§è¡ŒNativeæ–¹æ³•ï¼Œæœ€åé€šè¿‡Ajaxçš„<code>Response</code>æŠŠç»“æœè¿”å›ç»™JSã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 2. ä»HTTPBodyä¸­å–å‡ºè°ƒç”¨å‚æ•°</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *dic = [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:<span class="keyword">self</span>.request.HTTPBody options:<span class="built_in">NSJSONReadingAllowFragments</span> error:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSString</span> *action = dic[<span class="string">@"action"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *data = dic[<span class="string">@"data"</span>];</span><br><span class="line"><span class="built_in">NSData</span> *responseData;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ ¹æ®actionè½¬å‘åˆ°ä¸åŒæ–¹æ³•å¤„ç†ï¼Œparamæºå¸¦å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> ([action isEqualToString:<span class="string">@"alertMessage"</span>]) &#123;</span><br><span class="line">    responseData = [data dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    responseData = [<span class="string">@"Unknown action"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å¤„ç†å®Œæˆï¼Œå°†ç»“æœè¿”å›ç»™js</span></span><br><span class="line">[<span class="keyword">self</span> sendResponseWithResponseCode:<span class="number">200</span> data:responseData mimeType:<span class="string">@"text/html"</span>];</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)sendResponseWithResponseCode:(<span class="built_in">NSInteger</span>)statusCode data:(<span class="built_in">NSData</span>*)data mimeType:(<span class="built_in">NSString</span>*)mimeType &#123;</span><br><span class="line">    <span class="built_in">NSHTTPURLResponse</span>* response = [[<span class="built_in">NSHTTPURLResponse</span> alloc] initWithURL:[[<span class="keyword">self</span> request] URL] statusCode:statusCode HTTPVersion:<span class="string">@"HTTP/1.1"</span> headerFields:@&#123;<span class="string">@"Content-Type"</span> : mimeType&#125;];</span><br><span class="line">    </span><br><span class="line">    [[<span class="keyword">self</span> client] URLProtocol:<span class="keyword">self</span> didReceiveResponse:response cacheStoragePolicy:<span class="built_in">NSURLCacheStorageNotAllowed</span>];</span><br><span class="line">    <span class="keyword">if</span> (data != <span class="literal">nil</span>) &#123;</span><br><span class="line">        [[<span class="keyword">self</span> client] URLProtocol:<span class="keyword">self</span> didLoadData:data];</span><br><span class="line">    &#125;</span><br><span class="line">    [[<span class="keyword">self</span> client] URLProtocolDidFinishLoading:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JSCore"><a href="#JSCore" class="headerlink" title="JSCore"></a>JSCore</h3><p>å‰ä¸¤ç§æ–¹æ¡ˆè™½ç„¶å®ç°æ–¹æ³•ä¸ä¸€è‡´ï¼Œä½†æ˜¯æ€è·¯éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œç”±äºJSä¸èƒ½ç›´æ¥è°ƒç”¨Nativeæ–¹æ³•ï¼Œé€šè¿‡æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼Œæ‰¾åˆ°ä¸€ä¸ªè½½ä½“æ¥ä¼ é€’ä¿¡æ¯ã€‚<br>ç¬¬ä¸‰ç§æ–¹æ¡ˆå°±æ¯”è¾ƒç›´æ¥äº†ï¼Œä½¿ç”¨iOS7æ¨å‡ºçš„é»‘ç§‘æŠ€<code>JavaScriptCore</code>ï¼Œå°†Nativeæ–¹æ³•ç›´æ¥æš´éœ²ç»™JSï¼Œæ‰“é€šä¸¤ç«¯çš„æ•°æ®é€šé“ã€‚è°ˆåˆ°<code>JavaScriptCore</code>ä¸å¾—ä¸è¯´çš„æ˜¯bang590çš„<code>JSPatch</code>ï¼Œè¿˜æœ‰ReactNativeã€Weexç­‰éƒ½æ˜¯åˆ©ç”¨<code>JavaScriptCore</code>æ¥å®ç°å„ç§ç‚«é…·çš„åŠŸèƒ½ã€‚(å¼ºåŠ›æ¨èä¸€æœ¬Lefe_xçš„ä¹¦<a href="https://github.com/awesome-tips/iOS-Tips/blob/master/resources/ä¸€ä»½èµ°å¿ƒçš„JS-Nativeäº¤äº’ç”µå­ä¹¦.pdf" target="_blank" rel="noopener">ã€Šä¸€ä»½èµ°å¿ƒçš„JS-Nativeäº¤äº’ç”µå­ä¹¦ã€‹</a>ï¼Œéå¸¸ç²¾å½©)ã€‚<br>ä¸è¿‡è¿™ç§æ–¹æ¡ˆæœ‰ä¸ªç¼ºé™·ï¼Œ<code>UIWebView</code>æ²¡æœ‰æš´éœ²<code>JSContext</code>ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡KVCæ‹¿åˆ°ï¼Œä½†æ˜¯æ¯•ç«Ÿä¸æ˜¯ä¸€ç§å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œä¸çŸ¥é“ä¸Šæ¶ä¼šä¸ä¼šæœ‰é£é™©ï¼ˆæ±‚çŸ¥é“çš„åŒå­¦æŒ‡æ•™ä¸€ä¸‹ï¼‰ã€‚</p><h4 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>å®ç°æµç¨‹å°±ä¸ç»†è¯´äº†ï¼Œæµç¨‹æ¯”è¾ƒç®€å•ï¼ŒDemoé‡Œé¢æœ‰ã€‚è¯´è¯´å…³é”®å®ç°ä»£ç </p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)injectJSBridge &#123;</span><br><span class="line">    <span class="comment">// è·å–JSContext</span></span><br><span class="line">    JSContext *context = [_webView valueForKeyPath:<span class="string">@"documentView.webView.mainFrame.javaScriptContext"</span>];</span><br><span class="line">    <span class="comment">// ç»™JSæ³¨å…¥æ–¹æ³•callNative</span></span><br><span class="line">    context[<span class="string">@"callNative"</span>] = ^(JSValue *action, JSValue *data) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *actionStr = [action toString];</span><br><span class="line">        <span class="built_in">NSString</span> *dataStr = [data toString];</span><br><span class="line">        <span class="keyword">if</span> ([actionStr isEqualToString:<span class="string">@"alertMessage"</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> dataStr;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">@"Unkown action"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JSè°ƒç”¨éå¸¸ç®€å•ï¼Œä¸€å¥è¯æå®šã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callNative(<span class="string">"alertMessage"</span>, <span class="string">"Hello world!"</span>)</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h2><p>ä¸ºäº†éªŒè¯ä¸‰ç§æ–¹æ¡ˆçš„æ€§èƒ½ï¼Œè®¾è®¡äº†ä¸ªç®€å•çš„å®éªŒï¼Œåˆ†åˆ«æ‰§è¡Œäº†100ã€1000ã€10000æ¬¡è°ƒç”¨ï¼Œæµ‹è¯•æ‰‹æœºiPhone Xï¼Œç³»ç»ŸiOS 12ï¼Œæ—¶é—´å¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br>å…ˆè¯´ç»“è®ºï¼ŒJSCoreçš„æ€§èƒ½æ˜¯æœ€ä¼˜çš„ï¼Œ<code>JSCore&gt;Ajax&gt;Iframe</code>ã€‚åœ¨ä½å¹¶å‘çš„æ—¶å€™ä¸‰ç§æ–¹æ¡ˆå·®è·ä¸å¤§ï¼Œæ‰§è¡Œæ¬¡æ•°10000æ¬¡æ—¶Iframeæ•ˆç‡å°±å¾ˆä½äº†ï¼ŒAjaxæ¬¡ä¹‹ï¼ŒJSCoreæ€§èƒ½å¾ˆç¨³å®šã€‚å½“ç„¶å®é™…ä½¿ç”¨çš„æ—¶å€™ä¸ä¼šå‡ºç°è°ƒç”¨10000æ¬¡è¿™ç§æé™æƒ…å†µã€‚<br><code>Cordova</code>å¯¹äºå¹¶å‘æœ‰ä¸ªä¼˜åŒ–ç­–ç•¥ï¼Œå¾ˆå€¼å¾—å‚è€ƒï¼Œå°†å¹¶å‘çš„å¤šæ¬¡è°ƒç”¨æ‰“åŒ…åˆå¹¶ä¸ºä¸€æ¬¡å¤„ç†ã€‚</p><p><img src="/images/15401284999756.jpg" alt="15401284999756"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/tower-bridge-2324875_1280.jpg&quot; alt=&quot;tower-bridge-2324875_1280&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>iOSå®šä¹‰é•¿å­—ç¬¦ä¸²çš„å®ç”¨å®</title>
    <link href="https://crmo.github.io/2018/10/16/iOS%E5%AE%9A%E4%B9%89%E9%95%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%AE%9E%E7%94%A8%E5%AE%8F/"/>
    <id>https://crmo.github.io/2018/10/16/iOSå®šä¹‰é•¿å­—ç¬¦ä¸²çš„å®ç”¨å®/</id>
    <published>2018-10-15T16:00:00.000Z</published>
    <updated>2018-10-17T00:58:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨çœ‹<code>WebViewJavascriptBridge</code>æºç çš„æ—¶å€™å‘ç°ä¸€ä¸ªç¥å¥‡çš„å®ï¼Œåœ¨å®šä¹‰è¾ƒé•¿å­—ç¬¦ä¸²æ—¶å¾ˆå®ç”¨ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œå°†ä¸€æ®µjsä»£ç å­˜åˆ°ä¸€ä¸ªå˜é‡ï¼Œä¸ºäº†ä¾¿äºé˜…è¯»éœ€è¦åŠ å…¥æ¢è¡Œï¼Œéœ€è¦åœ¨æ¯è¡Œç»“æŸåŠ ä¸Š<code>\</code>ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str = <span class="string">@"function() &#123; \</span></span><br><span class="line"><span class="string">if (window.WebViewJavascriptBridge) &#123; \</span></span><br><span class="line"><span class="string">return; \</span></span><br><span class="line"><span class="string">&#125; \</span></span><br><span class="line"><span class="string">&#125;)(); \</span></span><br><span class="line"><span class="string">"</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œå¯ä»¥ç”¨å®æ¥ä¼˜åŒ–ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define LONG_STRING_DEFINE(x) #x</span></span><br><span class="line"><span class="built_in">NSString</span> *str = @LONG_STRING_DEFINE(function() &#123;</span><br><span class="line"><span class="keyword">if</span> (window.WebViewJavascriptBridge) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)();</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å®å±•å¼€åä»£ç å¦‚ä¸‹</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str = <span class="string">@";(function() &#123; if (window.WebViewJavascriptBridge) &#123; return; &#125;)();"</span>;</span><br></pre></td></tr></table></figure><h2 id="ç”¨Xcodeçœ‹å®å±•å¼€"><a href="#ç”¨Xcodeçœ‹å®å±•å¼€" class="headerlink" title="ç”¨Xcodeçœ‹å®å±•å¼€"></a>ç”¨Xcodeçœ‹å®å±•å¼€</h2><p>æ‰“å¼€<code>Assistant Editor</code>ï¼Œé€‰æ‹©<code>Preproces</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°å±•å¼€çš„å®ã€‚</p><p><img src="/images/15396963641371.jpg" alt="15396963641371"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©åœ¨çœ‹&lt;code&gt;WebViewJavascriptBridge&lt;/code&gt;æºç çš„æ—¶å€™å‘ç°ä¸€ä¸ªç¥å¥‡çš„å®ï¼Œåœ¨å®šä¹‰è¾ƒé•¿å­—ç¬¦ä¸²æ—¶å¾ˆå®ç”¨ã€‚&lt;br&gt;ä¸¾ä¸ªä¾‹å­ï¼Œå°†ä¸€æ®µjsä»£ç å­˜åˆ°ä¸€ä¸ªå˜é‡ï¼Œä¸ºäº†ä¾¿äºé˜…è¯»éœ€è¦åŠ å…¥æ¢è¡Œï¼Œéœ€è¦åœ¨æ¯è¡Œç»“æŸåŠ ä¸Š&lt;code&gt;\&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;figu
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>åº”å¯¹iOSéšç§æ”¿ç­–ä¸‰æ­¥æ›²</title>
    <link href="https://crmo.github.io/2018/10/13/%E5%BA%94%E5%AF%B9%E8%8B%B9%E6%9E%9C%E9%9A%90%E7%A7%81%E6%94%BF%E7%AD%96%E7%9C%8B%E6%88%91%E5%B0%B1%E5%A4%9F%E4%BA%86/"/>
    <id>https://crmo.github.io/2018/10/13/åº”å¯¹è‹¹æœéšç§æ”¿ç­–çœ‹æˆ‘å°±å¤Ÿäº†/</id>
    <published>2018-10-12T16:00:00.000Z</published>
    <updated>2018-10-21T15:32:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>å›½åº†å‡æœŸå›æ¥å‡†å¤‡æäº¤æ–°ç‰ˆæœ¬åˆ°App Storeï¼Œé‡åˆ°è‹¹æœæ–°æ”¿ç­–ï¼Œå®æµ‹ä¸‹æ¥å½±å“ä¸å¤§ï¼Œåº”å¯¹è¿˜ç®—æ¯”è¾ƒç®€å•ï¼Œæ€»ç»“ä¸€ä¸‹åˆ†äº«ç»™å¤§å®¶ã€‚</p><h2 id="æ”¿ç­–è¯´æ˜"><a href="#æ”¿ç­–è¯´æ˜" class="headerlink" title="æ”¿ç­–è¯´æ˜"></a>æ”¿ç­–è¯´æ˜</h2><p><img src="/images/QQ20181012-090233.png" alt="QQ20181012-090233"></p><p>ä»2018å¹´10æœˆ3å·èµ·ï¼Œæ‰€æœ‰æ–°æäº¤çš„Appéƒ½å¿…é¡»æä¾›éšç§æ¡ä¾‹ï¼Œ<a href="https://developer.apple.com/news/?id=08312018a" target="_blank" rel="noopener">å®˜æ–¹è¿æ¥</a>ã€‚</p><p>å¯¹äºéšç§æ¡ä¾‹ï¼Œè‹¹æœå®¡æ ¸æ¡ä¾‹æ˜¯è¿™ä¹ˆè¯´æ˜çš„ã€‚</p><p><img src="/images/QQ20181012-085839.png" alt="QQ20181012-085839"></p><p>éœ€è¦åœ¨ä¸¤ä¸ªåœ°æ–¹æä¾›éšç§æ¡ä¾‹ï¼š</p><ol><li>å…ƒæ•°æ®</li><li>åº”ç”¨å†…æœ‰æ˜æ˜¾çš„å…¥å£</li></ol><h2 id="ç”Ÿæˆéšç§æ¡ä¾‹"><a href="#ç”Ÿæˆéšç§æ¡ä¾‹" class="headerlink" title="ç”Ÿæˆéšç§æ¡ä¾‹"></a>ç”Ÿæˆéšç§æ¡ä¾‹</h2><p>å…³äºéšç§æ¡ä¾‹ï¼Œç½‘ä¸Šæœ‰å„ç§æ¨¡æ¿ï¼Œå¼„ä¸€ä¸ªæ”¹æ”¹å°±è¡Œäº†ï¼Œè¿™é‡Œæ¨èä¸€ä¸ª<a href="https://www.freeprivacypolicy.com" target="_blank" rel="noopener">è‡ªåŠ¨ç”Ÿæˆçš„ç½‘ç«™</a>ã€‚<br>å…è´¹ç”Ÿæˆï¼Œè¿˜æä¾›ä¸€ä¸ªé“¾æ¥ï¼ŒæŒ‚åœ¨å®ƒä»¬ç½‘ç«™ï¼Œå°±ä¸ç”¨è‡ªå·±ææœåŠ¡å™¨äº†ã€‚ä¾‹å¦‚<a href="https://www.freeprivacypolicy.com/privacy/view/cb2289ee81ec0d2f61ec1790bccf861d" target="_blank" rel="noopener">æˆ‘ç»™Appç”Ÿæˆçš„éšç§æ¡ä¾‹</a></p><p><img src="/images/QQ20181012-090746.png" alt="QQ20181012-090746"></p><h2 id="é›†æˆéšç§æ¡ä¾‹"><a href="#é›†æˆéšç§æ¡ä¾‹" class="headerlink" title="é›†æˆéšç§æ¡ä¾‹"></a>é›†æˆéšç§æ¡ä¾‹</h2><p>ç¬¬ä¸€æ­¥ï¼šæŠŠåˆšåˆšç”Ÿæˆçš„URLå¡«åœ¨å…ƒæ•°æ®é‡Œ</p><p><img src="/images/QQ20181012-091050.png" alt="QQ20181012-091050"></p><p>ç¬¬äºŒæ­¥ï¼šåœ¨åº”ç”¨å†…åŠ ä¸€ä¸ªé¡µé¢ï¼Œå¼€ä¸€ä¸ªWebViewåŠ è½½åˆšåˆšç”Ÿæˆçš„URLï¼Œä¾‹å¦‚æˆ‘å°±æ”¾åœ¨äº†â€œå…³äº-éšç§æ¡ä¾‹â€</p><p>ç¬¬ä¸‰æ­¥ï¼šæäº¤å®¡æ ¸æ—¶ï¼Œåœ¨å¤‡æ³¨é‡Œé¢è¯´æ˜ï¼Œéšç§æ¡ä¾‹çš„å…¥å£åœ¨å“ªé‡Œã€‚ï¼ˆè¿™ä¸€æ­¥å¯èƒ½ä¸è¦ä¹Ÿè¡Œï¼Œä¸è¿‡ä¸ºäº†ç¨³å¦¥æˆ‘åŠ ä¸Šäº†ï¼Œç»™è‹¹æœå®¡æ ¸å›¢é˜Ÿè®²æ¸…æ¥šæ€»æ˜¯å¥½çš„ï¼‰</p><p>ç¬¬äºŒå¤©å°±ä¸Šæ¶æˆåŠŸäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å›½åº†å‡æœŸå›æ¥å‡†å¤‡æäº¤æ–°ç‰ˆæœ¬åˆ°App Storeï¼Œé‡åˆ°è‹¹æœæ–°æ”¿ç­–ï¼Œå®æµ‹ä¸‹æ¥å½±å“ä¸å¤§ï¼Œåº”å¯¹è¿˜ç®—æ¯”è¾ƒç®€å•ï¼Œæ€»ç»“ä¸€ä¸‹åˆ†äº«ç»™å¤§å®¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ”¿ç­–è¯´æ˜&quot;&gt;&lt;a href=&quot;#æ”¿ç­–è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;æ”¿ç­–è¯´æ˜&quot;&gt;&lt;/a&gt;æ”¿ç­–è¯´æ˜&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®°â€œé¦™è•‰æ’­æ”¾å™¨â€ä¸Šæ¶çš„è¾›é…¸å†ç¨‹</title>
    <link href="https://crmo.github.io/2018/10/07/%E8%AE%B0%E2%80%9C%E9%A6%99%E8%95%89%E6%92%AD%E6%94%BE%E5%99%A8%E2%80%9D%E4%B8%8A%E6%9E%B6%E7%9A%84%E8%BE%9B%E9%85%B8%E5%8E%86%E7%A8%8B/"/>
    <id>https://crmo.github.io/2018/10/07/è®°â€œé¦™è•‰æ’­æ”¾å™¨â€ä¸Šæ¶çš„è¾›é…¸å†ç¨‹/</id>
    <published>2018-10-06T16:00:00.000Z</published>
    <updated>2018-10-07T08:50:30.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>å…ˆè¯´ç‚¹åºŸè¯ï¼Œä»äº‹iOSå¼€å‘ä»¥æ¥ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„APPä¸Šæ¶App Storeï¼Œå¹¶ä¸”ç™»ä¸Šè‹¹æœæ¨èæ¦œå•ï¼Œè¿™å¯èƒ½æ˜¯å¤§å¤šæ•°iOSerçš„æ¢¦æƒ³ã€‚åœ¨è„‘å­é‡Œäº§ç”Ÿäº†å„ç§æƒ³æ³•ï¼Œä½†æ˜¯å‘ç°è‡ªå·±èƒ½æƒ³åˆ°çš„åˆ«äººéƒ½åšäº†ï¼Œå¹¶ä¸”åšçš„å¾ˆå¥½ï¼ŒåŠ ä¸Šå·¥ä½œç”Ÿæ´»ä¸Šçš„å¾ˆå¤šäº‹æƒ…ï¼ˆä¸»è¦æ˜¯æ‡’ğŸ˜ï¼‰ï¼Œä¸€æ‹–å°±æ˜¯3å¹´ã€‚<br>åæ¥å› ä¸ºè‡ªå·±çš„çœŸå®éœ€æ±‚ï¼ŒApp Storeæ‰¾ä¸åˆ°èƒ½æ»¡è¶³éœ€æ±‚çš„äº§å“ï¼Œå°±åšäº†ä¸€ä¸ªæ’­æ”¾å™¨è‡ªå·±ç”¨ï¼Œåœ¨ä¸­ç§‹å‡æœŸç‹ ä¸‹å¿ƒæ¥ï¼Œä¹°äº†å¼€å‘è€…è´¦å·ï¼ˆ688ï¼Œå¿ƒç—›ï¼ï¼å°±å½“ä¸ºäº†æ¢¦æƒ³å……å€¼å§ã€‚ï¼‰ï¼ŒæŠŠè¿™ä¸ªæ’­æ”¾å™¨ä¸Šæ¶äº†ã€‚</p><h2 id="è´­ä¹°å¼€å‘è€…è´¦å·"><a href="#è´­ä¹°å¼€å‘è€…è´¦å·" class="headerlink" title="è´­ä¹°å¼€å‘è€…è´¦å·"></a>è´­ä¹°å¼€å‘è€…è´¦å·</h2><p>å…³äºæ€ä¹ˆä¹°ä¸ªäººå¼€å‘è€…è´¦å·ï¼Œç½‘ä¸Šçš„æ•™ç¨‹ä¸€æŠ“ä¸€å¤§æŠŠï¼Œæ•´ä¸ªè´­ä¹°æµç¨‹ä¹Ÿæ²¡å•¥å¥½æ³¨æ„çš„ï¼Œæ ¹æ®æç¤ºä¸€æ­¥ä¸€æ­¥èµ°å°±OKäº†ã€‚ä½†æ˜¯åˆ°äº†æœ€åä»˜æ¬¾ç¯èŠ‚æŠŠæˆ‘å¡äº†ä¸€å‘¨ï¼ˆåŠäº†ä¸¤å¼ ä¿¡ç”¨å¡ã€‚ã€‚ã€‚ï¼‰ï¼Œå¿…é¡»è¦<code>visa+é“¶è”</code>åŒæ ‡çš„ä¿¡ç”¨å¡ï¼Œæ³¨æ„ä¸€å®šè¦åŒæ ‡ï¼Œåªæœ‰visaæˆ–è€…åªæœ‰é“¶è”éƒ½ä¸è¡Œã€‚<br>ä»˜äº†æ¬¾ä¸€å¤©å·¦å³è‹¹æœå°±ä¼šå‘æ¥é‚®ä»¶ï¼Œæä¾›èº«ä»½è¯æ­£åé¢ç…§ç‰‡å°±å¯ä»¥äº†ã€‚</p><h2 id="ä¸Šæ¶App-Store"><a href="#ä¸Šæ¶App-Store" class="headerlink" title="ä¸Šæ¶App Store"></a>ä¸Šæ¶App Store</h2><p>ä¸Šæ¶æµç¨‹å°±è½»è½¦ç†Ÿè·¯äº†ï¼Œæ‰“åŒ…ä¸Šä¼ ã€å¡«å†™å„ç§APPè¯´æ˜ã€ä¸Šä¼ å›¾æ ‡ã€å®£ä¼ å›¾ã€æäº¤å®¡æ ¸ã€‚æ¿€åŠ¨çš„æˆ‘ä¸€æ™šä¸Šæ²¡ç¡å¥½è§‰ï¼Œç¬¬äºŒå¤©æ—©ä¸Šæ‰“å¼€é‚®ç®±ï¼Œç­‰å¾…æˆ‘çš„å±…ç„¶æ˜¯<code>2.1å¤§ç¤¼åŒ…</code>ï¼ˆGuideline 2.1 - Information Neededï¼‰ã€‚</p><p><img src="/images/WechatIMG59.png" alt="WechatIMG59"></p><p>ä¸€çœ‹æˆ‘å°±æ‡µé€¼äº†ï¼Œä¸Šæ¶è¿™ä¹ˆå¤šæ¬¡ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¹ˆä¸¥å‰çš„å›å¤ï¼Œæ„Ÿè§‰åˆ†åˆ†é’Ÿè¦è¢«å°å·ã€‚ç»è¿‡å¤šæ–¹å’¨è¯¢ï¼Œå‘ç°è¿™æ˜¯è‹¹æœä»Šå¹´æ–°æ¨å‡ºçš„å¤§ç¤¼åŒ…ï¼Œå¾ˆå¤šäººéƒ½é‡åˆ°è¿‡ï¼Œä¸€èˆ¬æ˜¯æœºå™¨å®¡æ ¸å›å¤çš„ï¼Œé‡åˆ°è¿™ç§æƒ…å†µåˆ«æ…Œï¼ˆé™¤éä½ æ˜¯é©¬ç”²åŒ…ã€æˆ–è€…æŠ„è¢­çš„ä¹‹ç±»çš„APPï¼‰ï¼Œä»”ç»†æ£€æŸ¥æ¡ä¾‹ï¼Œç„¶åé€æ¡ç­”å¤ï¼ˆæœ€å¥½ç”¨è‹±æ–‡ï¼‰ã€‚<br>æœ€åæˆ‘è¿˜å½•åˆ¶äº†ä¸€ä¸ªè§†é¢‘ï¼Œæ¥æ¼”ç¤ºæˆ‘çš„APPçš„ä¸»è¦åŠŸèƒ½ï¼Œä¸Šä¼ åˆ°<code>youtube</code>ï¼Œé™„åœ¨äº†å¤‡æ³¨ã€‚<br>åˆ†äº«ä¸‹æˆ‘çš„ç­”å¤æ¨¡æ¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">å°Šæ•¬çš„è‹¹æœå®¡æ ¸å›¢é˜Ÿï¼š</span><br><span class="line">    æ„Ÿè°¢æ‚¨çš„è€å¿ƒå®¡æ ¸ï¼Œé’ˆå¯¹ä¸‹é¢é—®é¢˜ï¼Œæˆ‘ä»¬åšäº†è¯¦ç»†çš„æ£€æŸ¥</span><br><span class="line">    </span><br><span class="line">å…³äº Guideline 2.1</span><br><span class="line"></span><br><span class="line">1.1.6 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åŒ…å«ä»»ä½•çš„è™šå‡ä¸è¯¯å¯¼ä¿¡æ¯ï¼Œå…¨éƒ¨éƒ½æ˜¯çœŸå®æœ‰æ•ˆçš„</span><br><span class="line">2.3.0 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åœ¨é€šè¿‡å®¡æ ¸åä¿®æ”¹ä»»ä½•æ¦‚å¿µå’ŒåŠŸèƒ½</span><br><span class="line">2.3.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åŒ…å«ä»»ä½•éšè—åŠŸèƒ½ï¼Œæ²¡æœ‰åŒ…å«èµŒåšã€å½©ç¥¨ç½‘ç«™</span><br><span class="line">3.1.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€å†…æ²¡æœ‰ä»»ä½•å†…è´­ã€æ”¯ä»˜åŠŸèƒ½ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯å…è´¹æä¾›ç»™ç”¨æˆ·</span><br><span class="line">3.2.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€å†…éƒ¨åŒ…å«ä»»ä½•è´·æ¬¾ç­‰é‡‘èæœåŠ¡</span><br><span class="line">4.3.0 - â€œé¦™è•‰æ’­æ”¾å™¨â€åŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹å¼€å‘ï¼Œä¸å­˜åœ¨æŠ„è¢­æˆ–è€…å¤§é‡ç›¸ä¼¼</span><br><span class="line">5.2.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰æ³•äººå®ä½“å’Œç‰ˆæƒé£é™©</span><br><span class="line">5.2.3 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰æä¾›æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œæˆ–è€…å…¶å®ƒå­˜åœ¨ç‰ˆæƒé—®é¢˜çš„éŸ³è§†é¢‘</span><br><span class="line">5.3.4 - â€œé¦™è•‰æ’­æ”¾å™¨â€ä»…åœ¨ä¸­å›½åŒºä¸Šæ¶ï¼Œæ²¡æœ‰è¿è§„å†…å®¹</span><br><span class="line"></span><br><span class="line">å…³äº Guideline 2.3.7</span><br><span class="line"></span><br><span class="line">æˆ‘å·²ç»æŒ‰ç…§è¯´æ˜ï¼Œä¿®æ”¹äº†å…ƒæ•°æ®ï¼Œè¯·å®¡æ ¸å›¢é˜Ÿå†æ¬¡å®¡æ ¸ã€‚</span><br><span class="line"></span><br><span class="line">æœ€åå†æ¬¡æ„Ÿè°¢æ‚¨è¾›è‹¦çš„å®¡æ ¸ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dear Apple Review Team:</span><br><span class="line">    Thank you for your patience review, we have done a detailed check on the following questions.</span><br><span class="line">    </span><br><span class="line">About Guideline 2.1</span><br><span class="line"></span><br><span class="line">1.1.6 - &quot;Banana Player&quot; does not contain any false and misleading information, all of which are true and effective</span><br><span class="line">2.3.0 - &quot;Banana Player&quot; does not modify any concepts and features after passing the review</span><br><span class="line">2.3.1 - &quot;Banana Player&quot; does not contain any hidden features, does not contain gambling, lottery sites</span><br><span class="line">3.1.1 - There is no in-app purchase and payment function in the â€œBanana Playerâ€, all functions are provided to the user free of charge.</span><br><span class="line">3.2.1 - &quot;Banana Player&quot; contains any financial services such as loans</span><br><span class="line">4.3.0 - The &quot;Banana Player&quot; feature is developed independently, without plagiarism or a lot of similarity</span><br><span class="line">5.2.1 - &quot;Banana Player&quot; has no legal entity and copyright risk</span><br><span class="line">5.2.3 - &quot;Banana Player&quot; does not provide file sharing services, or other audio and video with copyright issues</span><br><span class="line">5.3.4 - &quot;Banana Player&quot; is only available in China, no illegal content</span><br><span class="line"></span><br><span class="line">About Guideline 2.3.7</span><br><span class="line"></span><br><span class="line">I have modified the metadata according to the instructions, please review the team again.</span><br><span class="line"></span><br><span class="line">Finally, thank you again for your hard review.</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå¤©å®¡æ ¸é€šè¿‡ï¼ŒæˆåŠŸä¸Šæ¶ï¼</p><h2 id="æ‰“ä¸ªå¹¿å‘Š"><a href="#æ‰“ä¸ªå¹¿å‘Š" class="headerlink" title="æ‰“ä¸ªå¹¿å‘Š"></a>æ‰“ä¸ªå¹¿å‘Š</h2><blockquote><p>ä¸‹è½½ğŸ”—ï¼š<a href="https://dwz.cn/HvVix2hH" target="_blank" rel="noopener">https://dwz.cn/HvVix2hH</a></p></blockquote><p>â€œé¦™è•‰æ’­æ”¾å™¨â€æ˜¯æˆ‘ç‹¬ç«‹å¼€å‘çš„ç¬¬ä¸€æ¬¾APPï¼Œå…è´¹æ— å¹¿å‘Šã€‚ä¸»è¦åŠŸèƒ½åœ¨æ‰‹æœºä¸Šæ’­æ”¾ä»ç½‘ç›˜ã€å…‰ç›˜ã€ç½‘ç«™ä¸‹è½½çš„éŸ³é¢‘èµ„æ–™ã€è¯¾ç¨‹ã€éŸ³ä¹ã€‚æ— éœ€æ•°æ®çº¿ï¼Œç”¨Wi-Fiå°±å¯ä»¥æ‹·è´æ–‡ä»¶åˆ°æ‰‹æœºï¼Œè‡ªåŠ¨è®°å½•æ’­æ”¾è¿›åº¦ã€‚<br>å¦‚æœæœ‰éœ€æ±‚å¯ä»¥æ”¯æŒä¸€æ³¢ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿è”ç³»æˆ‘ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;å…ˆè¯´ç‚¹åºŸè¯ï¼Œä»äº‹iOSå¼€å‘ä»¥æ¥ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„APPä¸Šæ¶App Storeï¼Œå¹¶ä¸”ç™»ä¸Šè‹¹æœæ¨èæ¦œå•ï¼Œè¿™å¯èƒ½æ˜¯å¤§
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€ä¸ªè¡Œç»“æŸç¬¦å¼•å‘çš„JSæŠ¥é”™</title>
    <link href="https://crmo.github.io/2018/09/05/%E8%AE%B0%E4%B8%80%E4%B8%AA%E8%A1%8C%E7%BB%93%E6%9D%9F%E7%AC%A6%E5%BC%95%E5%8F%91%E7%9A%84JS%E6%8A%A5%E9%94%99/"/>
    <id>https://crmo.github.io/2018/09/05/è®°ä¸€ä¸ªè¡Œç»“æŸç¬¦å¼•å‘çš„JSæŠ¥é”™/</id>
    <published>2018-09-04T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªç¥å¥‡çš„Bugï¼Œé€šè¿‡<code>UIWebView</code>çš„<code>stringByEvaluatingJavaScriptFromString:</code>æ–¹æ³•æ‰§è¡Œä¸€æ®µ<code>JavaScript</code>ä»£ç æ—¶ï¼Œ<code>JavaScript</code>æŠ¥é”™:</p><blockquote><p>SyntaxError: Unexpected EOF</p></blockquote><p>ç»è¿‡ä»”ç»†çš„æ’æŸ¥ï¼Œå‘ç°å¾…æ‰§è¡Œçš„<code>JavaScript</code>ä»£ç é‡Œé¢åŒ…å«<code>U+2028</code>å­—ç¬¦ã€‚è¿˜æ‰¾åˆ°äº†<a href="https://stackoverflow.com/questions/2965293/javascript-parse-error-on-u2028-unicode-character" target="_blank" rel="noopener">Stack Overflowç›¸å…³è®¨è®º</a>ã€‚<br><code>JavaScript</code>è§£æå™¨ä¼šæŠŠè¡Œåˆ†éš”ç¬¦<code>U+2028</code>å’Œæ®µè½åˆ†éš”ç¬¦<code>U+2029</code>è§£ææˆä¸€è¡Œçš„ç»“æŸï¼Œä»£ç é‡Œè¦æ˜¯åŒ…å«è¿™ä¸¤ä¸ªå­—ç¬¦ç›¸å½“äºæ¢è¡Œï¼Œä¾‹å¦‚ï¼š</p><blockquote><p>alert(â€œ\u2028â€)</p></blockquote><p>å°±ä¼šè¢«è§£æä¸º</p><blockquote><p>alert(â€œ<br>â€œ)</p></blockquote><p>äºæ˜¯å°±äº§ç”Ÿäº†è¯­æ³•é”™è¯¯ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æˆ‘ç”¨çš„æ–¹æ³•æ¯”è¾ƒç®€å•ã€ç²—æš´ï¼Œåœ¨æ‰§è¡Œ<code>JavaScript</code>ä»£ç å‰ï¼Œç›´æ¥è¿‡æ»¤æ‰è¿™ä¸¤ä¸ªå­—ç¬¦ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line">    javaScriptString = [javaScriptString stringByReplacingOccurrencesOfString:<span class="string">@"\u2028"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    javaScriptString = [javaScriptString stringByReplacingOccurrencesOfString:<span class="string">@"\u2029"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    <span class="built_in">NSString</span>* ret = [(<span class="built_in">UIWebView</span>*)_engineWebView stringByEvaluatingJavaScriptFromString:javaScriptString];</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;æœ€è¿‘é‡åˆ°ä¸€ä¸ªç¥å¥‡çš„Bugï¼Œé€šè¿‡&lt;code&gt;UIWebView&lt;/code&gt;çš„&lt;code&gt;stringByEvaluating
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ä»ä¸€ä¸ªAFNetworkingå¾ªç¯å¼•ç”¨è¯´èµ·</title>
    <link href="https://crmo.github.io/2018/08/28/%E4%BB%8E%E4%B8%80%E4%B8%AAAFNetworking%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E8%AF%B4%E8%B5%B7/"/>
    <id>https://crmo.github.io/2018/08/28/ä»ä¸€ä¸ªAFNetworkingå¾ªç¯å¼•ç”¨è¯´èµ·/</id>
    <published>2018-08-27T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡åˆ†æä½¿ç”¨ä»£ç æ˜¯<a href="https://github.com/AFNetworking/AFNetworking/releases" target="_blank" rel="noopener">AFNetworking 3.2.1</a></p></blockquote><p>æœ€è¿‘ä½¿ç”¨<code>Instruments</code>ä¸­çš„<code>Leaks</code>åˆ†æé¡¹ç›®å†…å­˜æ³„éœ²ï¼Œå‘ç°äº†ä¸€ä¸ªAFNetworkingçš„å¾ªç¯å¼•ç”¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/15354171666142.jpg" alt="15354171666142"></p><p>é€šè¿‡è°ƒç”¨æ ˆå‘ç°äº§ç”Ÿæ³„éœ²çš„ä»£ç åœ¨è¿™é‡Œï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AFURLSessionManager.m</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithSessionConfiguration:(<span class="built_in">NSURLSessionConfiguration</span> *)configuration &#123;</span><br><span class="line">    <span class="comment">// ... åˆå§‹åŒ–ä»£ç ï¼Œçœç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¼è‡´å¾ªç¯å¼•ç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">self</span>.session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:<span class="keyword">self</span>.sessionConfiguration delegate:<span class="keyword">self</span> delegateQueue:<span class="keyword">self</span>.operationQueue];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... å…¶å®ƒåˆå§‹åŒ–ä»£ç ï¼Œçœç•¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§è‡´åŸå› å°±æ˜¯AFURLSessionManagerå¼•ç”¨NSURLSessionï¼ŒåŒæ—¶è®¾ç½®NSURLSessionçš„delegateä¸ºè‡ªå·±ï¼ŒNSURLSessionä¼šå¼ºå¼•ç”¨delegateï¼Œäºæ˜¯äº§ç”Ÿäº†å¾ªç¯å¼•ç”¨ã€‚</p><blockquote><p>å…³äºNSURLSessionçš„delegateå®˜æ–¹è¯´æ˜ï¼š<br>This delegate object is responsible for handling authentication challenges, for making caching decisions, and for handling other session-related events. The session object keeps a strong reference to this delegate until your app exits or explicitly invalidates the session. If you do not invalidate the session, your app leaks memory until it exits.</p></blockquote><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨AFNetworkingå®˜æ–¹issuesæ‰¾åˆ°äº†ç›¸å…³çš„é—®é¢˜<a href="https://github.com/AFNetworking/AFNetworking/issues/1528" target="_blank" rel="noopener">Possible memory leak in AFURLSessionManager</a>ã€‚ä½œè€…çš„å›ç­”å¦‚ä¸‹ï¼š</p><p><img src="/images/15353328585634.jpg" alt="15353328585634"></p><p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ol><li>è¿™æ˜¯æœ€å¸¸è§ä¹Ÿæ˜¯ä½œè€…æ¨èçš„æ–¹æ³•ï¼Œåªåˆ›å»ºä¸€ä¸ªAFURLSessionManagerï¼Œæ•´ä¸ªAPPå…±äº«ï¼Œè™½ç„¶è¿˜æ˜¯æœ‰å¾ªç¯å¼•ç”¨ï¼Œä½†æ˜¯å°±æ²¡æœ‰å†…å­˜æ³„éœ²çš„é—®é¢˜äº†ã€‚</li><li>å¦‚æœè¦ä½¿ç”¨å¤šä¸ªAFURLSessionManagerï¼Œåœ¨ä½¿ç”¨å®Œæˆåæ‰‹åŠ¨è°ƒç”¨<code>invalidateSessionCancelingTasks:</code>æ¥æ–­å¼€å¾ªç¯å¼•ç”¨ã€‚ï¼ˆè¿™ç§æ–¹æ¡ˆä¸æ¨èï¼Œå…·ä½“åŸå› çœ‹ä¸‹ä¸€å°èŠ‚ï¼‰</li></ol><h2 id="AFURLSessionManagerå¤ç”¨"><a href="#AFURLSessionManagerå¤ç”¨" class="headerlink" title="AFURLSessionManagerå¤ç”¨"></a>AFURLSessionManagerå¤ç”¨</h2><p>å…³äºAFURLSessionManageræ˜¯å¦ä½¿ç”¨å•ä¾‹è¿™ä¸ªé—®é¢˜ï¼Œå®˜æ–¹demoä½¿ç”¨çš„æ˜¯å•ä¾‹ï¼Œåœ¨è‹¹æœå®˜æ–¹æ–‡æ¡£æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µè¯</p><blockquote><p>With the NSURLSession API, your app creates one or more sessions, each of which coordinates a group of related data transfer tasks. For example, if youâ€™re creating a web browser, your app might create one session per tab or window, or one session for interactive use and another for background downloads. Within each session, your app adds a series of tasks, each of which represents a request for a specific URL (following HTTP redirects, if necessary).</p></blockquote><p>æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œæ ¹æ®ä½¿ç”¨åœºæ™¯çš„ä¸åŒï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸åŒçš„ç­”æ¡ˆï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹APPéƒ½æ˜¯åœ¨å’ŒåŒä¸€æœåŠ¡å™¨æ‰“äº¤é“ï¼Œä¸€ä¸ª<code>session</code>å°±å¤Ÿäº†ï¼Œå¦‚æœæœ‰è¿æ¥å¤šä¸ªæœåŠ¡å™¨ã€æˆ–è€…åå°ä¸‹è½½ç­‰åŠŸèƒ½éœ€æ±‚ï¼Œå¯ä»¥ç»™æ¯ä¸ªæœåŠ¡å™¨ã€åå°ä¸‹è½½ä»»åŠ¡åˆ›å»ºå•ç‹¬çš„<code>session</code>ï¼ˆä½†æ˜¯ä¹Ÿä¸èƒ½æ¯ä¸ªè¯·æ±‚éƒ½å•ç‹¬åˆ›å»ºsessionï¼‰ã€‚</p><p>åœ¨æŸ¥æ‰¾èµ„æ–™çš„æ—¶å€™ï¼Œæˆ‘å‘ç°æœ‰åšå®¢æåˆ°å•ä¾‹seesionå¯ä»¥å‡å°‘TCPä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŠ¨æ‰‹éªŒè¯ä¸‹ï¼š</p><p>å¤šä¸ªç½‘ç»œè¯·æ±‚å¤ç”¨ä¸€ä¸ª<code>AFURLSessionManager</code>ï¼Œè¿ç»­å‘ä¸¤ä¸ªç½‘ç»œè¯·æ±‚ï¼Œç”¨<code>Wireshark</code>æŠ“åŒ…å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡ç½‘ç»œè¯·æ±‚å¤ç”¨äº†ç¬¬ä¸€æ¬¡çš„TCPè¿æ¥ï¼Œæ²¡æœ‰åšä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p><img src="/images/15354191775340.jpg" alt="15354191775340"></p><p>ä¸‹å›¾æ˜¯æ¯æ¬¡ç½‘ç»œè¯·æ±‚éƒ½æ–°å»ºä¸€ä¸ª<code>AFURLSessionManager</code>çš„æŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªç½‘ç»œè¯·æ±‚éƒ½è¿›è¡Œäº†TCPä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p><img src="/images/15354193039698.jpg" alt="15354193039698"></p><p>å®éªŒç»“æœçš„ç¡®å¦‚ç½‘ä¸Šæ‰€è¯´ï¼Œå¤ç”¨<code>AFURLSessionManager</code>å¯ä»¥å‡å°‘ä¸‰æ¬¡æ¡æ‰‹ï¼Œæå‡æ•ˆç‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡åˆ†æä½¿ç”¨ä»£ç æ˜¯&lt;a href=&quot;https://github.com/AFNetworking/AFNetworking/releases&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;AFNetworking 3.2.1&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>iOSæ¨¡æ‹Ÿå™¨å®‰è£…debugåŒ…</title>
    <link href="https://crmo.github.io/2018/08/21/iOS%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85debug%E5%8C%85/"/>
    <id>https://crmo.github.io/2018/08/21/iOSæ¨¡æ‹Ÿå™¨å®‰è£…debugåŒ…/</id>
    <published>2018-08-20T16:00:00.000Z</published>
    <updated>2019-03-07T01:03:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºé¡¹ç›®æ˜¯Hybridçš„å¹³å°ï¼Œæœ‰ç¬¬ä¸‰æ–¹äººå‘˜éœ€è¦åœ¨ä¸Šé¢å¼€å‘H5åº”ç”¨ï¼Œä½†æ˜¯releaseåŒ…ä¸èƒ½è°ƒè¯•H5ï¼Œåªæœ‰debugæŠ¥å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯é¡¹ç›®æºç ä¸èƒ½äº¤ç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨googleæœç´¢äº†ä¸‹ï¼Œå‘ç°ä¸€ç¯‡éœœç¥çš„<a href="https://juejin.im/post/57b01f298ac247005f0acb0a" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œè®²çš„æ˜¯debugåŒ…å¯ä»¥æ‹·è´åˆ°å…¶å®ƒæœºå™¨è¿è¡Œï¼Œäºæ˜¯å®è·µäº†ä¸€æ³¢ã€‚</p><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ul><li>Xcode</li><li>Command Line Tools</li><li>ios-sim</li></ul><blockquote><p>ios-simå®‰è£…å‘½ä»¤ï¼šnpm install ios-sim -g</p></blockquote><h2 id="æ‹·è´æœ¬åœ°çš„debugåŒ…"><a href="#æ‹·è´æœ¬åœ°çš„debugåŒ…" class="headerlink" title="æ‹·è´æœ¬åœ°çš„debugåŒ…"></a>æ‹·è´æœ¬åœ°çš„debugåŒ…</h2><ol><li>runä¸€æ¬¡éœ€è¦æ‹·è´çš„é¡¹ç›®ï¼Œå®‰è£…åˆ°æ¨¡æ‹Ÿå™¨ä¸Š</li></ol><ol><li>æ‰§è¡Œä¸‹é¢å‘½ä»¤è¡Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<code>ç›®æ ‡è·¯å¾„/xxx.zip</code>å°±æ˜¯æ‹·è´å‡ºæ¥çš„debugåº”ç”¨åŒ…ï¼Œéœ€è¦æ›¿æ¢ä¸ºè‡ªå·±çš„è·¯å¾„ï¼Œä¾‹å¦‚<code>/Users/crmo/Desktop/debug/debug.zip</code></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ditto -ck --sequesterRsrc --keepParent `ls -1 -d -t ~/Library/Developer/Xcode/DerivedData/*/Build/Products/*-iphonesimulator/*.app | head -n 1` ç›®æ ‡è·¯å¾„/xxx.zip</span><br></pre></td></tr></table></figure><h2 id="æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨"><a href="#æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨" class="headerlink" title="æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨"></a>æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨</h2><h3 id="1-è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨"><a href="#1-è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨" class="headerlink" title="1. è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨"></a>1. è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨</h3><blockquote><p>ios-sim showdevicetypes</p></blockquote><p>å¯ä»¥çœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºï¼Œå°±æ˜¯æœ¬æœºå¯ç”¨çš„æ¨¡æ‹Ÿå™¨ï¼Œé€‰æ‹©ä¸€ä¸ªéœ€è¦è¿è¡Œçš„æ¨¡æ‹Ÿå™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~ ios-sim showdevicetypes</span><br><span class="line">Apple-Watch-38mm, watchOS 4.3</span><br><span class="line">Apple-Watch-42mm, watchOS 4.3</span><br><span class="line">Apple-Watch-Series-2-38mm, watchOS 4.3</span><br><span class="line">Apple-Watch-Series-2-42mm, watchOS 4.3</span><br><span class="line">iPhone-7-Plus, 10.3</span><br><span class="line">iPhone-7-Plus, 11.4</span><br><span class="line">Apple-Watch-Series-3-38mm, watchOS 4.3</span><br><span class="line">Apple-Watch-Series-3-42mm, watchOS 4.3</span><br><span class="line">iPhone-5s, 11.4</span><br><span class="line">iPhone-6, 11.4</span><br><span class="line">iPhone-6-Plus, 11.4</span><br><span class="line">iPhone-6s, 11.4</span><br><span class="line">iPhone-6s-Plus, 11.4</span><br><span class="line">iPhone-7, 11.4</span><br><span class="line">iPhone-SE, 11.4</span><br><span class="line">iPad-Air, 11.4</span><br><span class="line">iPad-Air-2, 11.4</span><br><span class="line">iPhone-8, 11.4</span><br><span class="line">iPhone-8-Plus, 11.4</span><br><span class="line">iPhone-X, 11.4</span><br></pre></td></tr></table></figure><h3 id="2-åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…"><a href="#2-åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…" class="headerlink" title="2. åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…"></a>2. åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…</h3><blockquote><p>ios-sim launch åº”ç”¨åŒ…è·¯å¾„/xxx.app â€“devicetypeid æ¨¡æ‹Ÿå™¨</p></blockquote><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œdebug.zipè§£å‹åå°±å¯ä»¥å¾—åˆ°å¯¹åº”åº”ç”¨çš„.appæ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘çš„debugåŒ…æ”¾åœ¨<code>/Users/crmo/Desktop/debug/debug.app</code>ï¼Œæ¨¡æ‹Ÿå™¨é€‰æ‹©iPhone-8ï¼Œæœ€ç»ˆçš„å‘½ä»¤æ˜¯</p><blockquote><p>ios-sim launch /Users/crmo/Desktop/debug/debug.app â€“devicetypeid iPhone-8</p></blockquote><p>æˆ–è€…å°†åº”ç”¨ç›´æ¥å®‰è£…åˆ°æ¨¡æ‹Ÿå™¨ä¸Š</p><blockquote><p>ios-sim install /Users/crmo/Desktop/debug/debug.app â€“devicetypeid iPhone-8</p></blockquote><h2 id="simctl-was-not-foundé”™è¯¯è§£å†³"><a href="#simctl-was-not-foundé”™è¯¯è§£å†³" class="headerlink" title="simctl was not foundé”™è¯¯è§£å†³"></a>simctl was not foundé”™è¯¯è§£å†³</h2><p>åœ¨å®è·µæ—¶æµ‹è¯•æœºçš„<code>Command Line Tools</code>æ²¡æœ‰é…ç½®å¥½ï¼Œå‡ºç°æŠ¥é”™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">simctl was not found.</span><br><span class="line">Check that you have Xcode 8.x installed:</span><br><span class="line">xcodebuild --versionCheck that you have Xcode 8.x selected:</span><br><span class="line">xcode-select --print-path</span><br></pre></td></tr></table></figure><p><strong>è§£å†³åŠæ³•ï¼š</strong></p><p>1.é¦–å…ˆç¡®ä¿æ­£ç¡®å®‰è£…äº†Command Line Toolsï¼Œ</p><blockquote><p>å¸è½½Command Line Tools:rm -rf /Library/Developer/CommandLineTools<br>å®‰è£…Command Line Tools:xcode-select â€“install</p></blockquote><p>2.åœ¨xcodeé…ç½®ä¸€ä¸‹Command Line Toolsï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/images/15348328228775.jpg" alt="15348328228775"></p><hr><p>å‚è€ƒåšå®¢ï¼š</p><ul><li><a href="http://www.hudongdong.com/bug/772.html" target="_blank" rel="noopener">unable to find utility â€œsimctlâ€çš„è§£å†³æ–¹æ¡ˆ</a></li><li><a href="https://juejin.im/post/57b01f298ac247005f0acb0a" target="_blank" rel="noopener">ç»™ iOS æ¨¡æ‹Ÿå™¨ â€œå®‰è£…â€app æ–‡ä»¶</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç”±äºé¡¹ç›®æ˜¯Hybridçš„å¹³å°ï¼Œæœ‰ç¬¬ä¸‰æ–¹äººå‘˜éœ€è¦åœ¨ä¸Šé¢å¼€å‘H5åº”ç”¨ï¼Œä½†æ˜¯releaseåŒ…ä¸èƒ½è°ƒè¯•H5ï¼Œåªæœ‰debugæŠ¥å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯é¡¹ç›®æºç ä¸èƒ½äº¤ç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨googleæœç´¢äº†ä¸‹ï¼Œå‘ç°ä¸€ç¯‡éœœç¥çš„&lt;a href=&quot;https://juejin.im/post/57b01f298
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>dispatch_syncæ­»é”é—®é¢˜</title>
    <link href="https://crmo.github.io/2018/08/03/dispatch_sync%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98/"/>
    <id>https://crmo.github.io/2018/08/03/dispatch_syncæ­»é”é—®é¢˜/</id>
    <published>2018-08-02T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>ä½¿ç”¨<code>dispatch_sync</code>çš„æ—¶å€™è¦å°å¿ƒè°¨æ…ï¼Œç¨ä¸æ³¨æ„å°±ä¼šå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå…ˆçœ‹ä¸¤ä¸ªå…¸å‹çš„æ¡ˆä¾‹ï¼š</p><p>æ¡ˆä¾‹ä¸€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)deadlock1 &#123;</span><br><span class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_sync(queue, ^&#123;</span><br><span class="line">        dispatch_sync(queue, ^&#123;</span><br><span class="line">            NSLog(@&quot;&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¡ˆä¾‹äºŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (void)deadlock2 &#123;</span><br><span class="line">    dispatch_queue_t queue1 = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_queue_t queue2 = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_sync(queue1, ^&#123;</span><br><span class="line">        dispatch_sync(queue2, ^&#123;</span><br><span class="line">            dispatch_sync(queue1, ^&#123;</span><br><span class="line">                NSLog(@&quot;&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤ä¸ªæ¡ˆä¾‹æ­»é”çš„åŸå› éƒ½æ˜¯åŒä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—çš„ä»»åŠ¡ç›¸äº’ç­‰å¾…ã€‚ å½“ç„¶å®é™…å·¥ç¨‹ä¸­é‡åˆ°çš„æ­»é”é—®é¢˜ä¼šæ›´åŠ å¤æ‚ï¼Œéš¾ä»¥åˆ†æã€‚</p><h2 id="å…¸å‹è¯¯åŒº"><a href="#å…¸å‹è¯¯åŒº" class="headerlink" title="å…¸å‹è¯¯åŒº"></a>å…¸å‹è¯¯åŒº</h2><p>åœ¨é˜…è¯»ç›¸å…³ä¹¦ç±ã€åšå®¢éƒ½æåˆ°äº†ä¸€ä¸ªæ–¹æ³•<code>dispatch_get_current_queue()</code>ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°å½“å‰é˜Ÿåˆ—ï¼Œäºæ˜¯æœ‰äººå°±ç”¨å®ƒæ¥è§£å†³æ­»é”é—®é¢˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (void)safeSync:(void(^)())block &#123;</span><br><span class="line">    if (!block) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (dispatch_get_current_queue() == queue) &#123;</span><br><span class="line">        block();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        dispatch_sync(queue, ^&#123;</span><br><span class="line">            block();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€çœ¼çœ‹èµ·æ¥å¤©è¡£æ— ç¼ï¼Œå¯¹äºæ¡ˆä¾‹ä¸€çš„ç¡®å¯ä»¥å®Œç¾è§£å†³ï¼Œä½†æ˜¯å¯¹äºæ¡ˆä¾‹äºŒè¿™ç§å¯¹é˜Ÿåˆ—çš„æƒ…å†µå°±åˆ¤æ–­ä¸äº†ã€‚éš¾æ€ªè‹¹æœåœ¨iOS6å°±æ³¨é‡Šäº†è¿™ä¸ªæ–¹æ³•ã€‚</p><hr><p>æ¨èé˜…è¯»ï¼š</p><p><a href="https://www.objc.io/issues/2-concurrency/thread-safe-class-design/#pitfalls-of-gcd" target="_blank" rel="noopener">Thread-Safe Class Design</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜åˆ†æ&quot;&gt;&lt;a href=&quot;#é—®é¢˜åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜åˆ†æ&quot;&gt;&lt;/a&gt;é—®é¢˜åˆ†æ&lt;/h2&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;dispatch_sync&lt;/code&gt;çš„æ—¶å€™è¦å°å¿ƒè°¨æ…ï¼Œç¨ä¸æ³¨æ„å°±ä¼šå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå…ˆçœ‹ä¸¤ä¸ªå…¸å‹çš„æ¡ˆä¾‹ï¼š&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>UIWebViewè·å–è¯¦ç»†æµè§ˆè®°å½•</title>
    <link href="https://crmo.github.io/2018/08/01/UIWebView%E8%8E%B7%E5%8F%96history/"/>
    <id>https://crmo.github.io/2018/08/01/UIWebViewè·å–history/</id>
    <published>2018-07-31T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ‰€ç”¨æ–¹æ³•ä¼šä½¿ç”¨åˆ°è‹¹æœç§æœ‰APIï¼Œä¸Šæ¶APP Storeè¯·è°¨æ…ä½¿ç”¨ã€‚</p></blockquote><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>è·å–<code>UIWebView</code>çš„å‰è¿›åé€€çš„æµè§ˆè®°å½•ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä»A-&gt;B-&gt;C-&gt;Bï¼Œæ­¤æ—¶Bä¸Šä¸€é¡µæ˜¯Aï¼Œä¸‹ä¸€é¡µæ˜¯Cï¼Œéœ€è¦è·å–Aã€Cçš„URLä¿¡æ¯ã€‚</p><blockquote><p>WKWebViewæš´éœ²äº†è¿™ä¸ªå±æ€§ï¼Œ<code>WKBackForwardList *backForwardList</code>ã€‚å¯ä»¥å¾ˆå®¹æ˜“çš„å–åˆ°ï¼Œæ— å¥ˆé¡¹ç›®è¿˜æ˜¯ä½¿ç”¨çš„<code>UIWebView</code>ï¼Œäºæ˜¯æœ‰äº†åé¢çš„æ¢ç´¢ã€‚</p></blockquote><p>é¦–å…ˆåœ¨<code>UIWebView</code>æä¾›çš„APIé‡Œæ‰¾ï¼Œç›¸å…³çš„APIåªæœ‰<code>canGoBack</code>å’Œ<code>canGoForward</code>ï¼Œå‘½åå¾ˆç›´è§‚ï¼Œæ˜¯å¦å¯ä»¥åé€€å’Œå‰è¿›ï¼Œè¿™æ¡è·¯èµ°ä¸é€šã€‚<br>æƒ³åˆ°æ˜¯å¦å¯ä»¥é€šè¿‡JSçš„Window.historyè·å–åˆ°ï¼ŒæŸ¥äº†ä¸‹APIï¼Œå”¯ä¸€ä¸€ä¸ªæœ‰ç‚¹åƒçš„<code>length</code>å±æ€§ï¼Œæ™ºèƒ½å–åˆ°æµè§ˆè®°å½•ä¸­çš„æ‰€æœ‰URLçš„æ•°é‡ï¼Œä¸åŒºåˆ†å‰åï¼Œæ¯”å¦‚åœ¨ä¸Šé¢æåˆ°çš„ä¾‹å­ä¸­ï¼Œåœ¨Bé¡µé¢å–åˆ°çš„<code>length</code>æ˜¯3ï¼Œè€Œä¸”ä¸èƒ½å–å‡ºå…·ä½“çš„URLã€‚</p><p><img src="/images/15325235986699.jpg" alt="15325235986699"></p><p>æ— å¥ˆåªæœ‰ä¸Šæºç äº†ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯<a href="https://opensource.apple.com/release/ios-110.html" target="_blank" rel="noopener">â€œWebKit-7604.1.38.0.7â€å’Œâ€œWebCore-7604.1.38.0.7â€</a>ã€‚</p><h2 id="Window-History-lengthå®ç°æœ¬è´¨"><a href="#Window-History-lengthå®ç°æœ¬è´¨" class="headerlink" title="Window.History.lengthå®ç°æœ¬è´¨"></a>Window.History.lengthå®ç°æœ¬è´¨</h2><p>åœ¨WebCoreé‡Œé¢æ‰¾åˆ°äº†JSæ–¹æ³•<code>Window.History.length</code>å®ç°çš„æœ¬è´¨ï¼Œä¸Šä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebCore History.cpp</span></span><br><span class="line"><span class="keyword">unsigned</span> History::length() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!m_frame)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">auto</span>* page = m_frame-&gt;page();</span><br><span class="line">    <span class="keyword">if</span> (!page)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> page-&gt;backForward().count();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebCore BackForwardController.cpp</span></span><br><span class="line"><span class="keyword">int</span> BackForwardController::count() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// count = å½“å‰é¡µä¹‹å‰çš„é¡µé¢æ€»æ•° + å½“å‰é¡µä¹‹åçš„é¡µé¢æ€»æ•° + 1</span></span><br><span class="line">    <span class="keyword">return</span> m_client-&gt;backListCount() + <span class="number">1</span> + m_client-&gt;forwardListCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>WebCore</code>é‡Œé¢<code>backListCount()</code>ã€<code>forwardListCount()</code>å®šä¹‰æ˜¯è™šå‡½æ•°ï¼Œå…·ä½“å®ç°åœ¨<code>WebKit</code>å¯ä»¥æ‰¾åˆ°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebKit BackForwardList.mm</span></span><br><span class="line"><span class="keyword">int</span> BackForwardList::backListCount()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> m_current == NoCurrentItemIndex ? <span class="number">0</span> : m_current;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> BackForwardList::forwardListCount()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> m_current == NoCurrentItemIndex ? <span class="number">0</span> : (<span class="keyword">int</span>)m_entries.size() - (m_current + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸‹ï¼Œåé¢ä¼šç”¨åˆ°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebKit BackForwardList.mm</span></span><br><span class="line"><span class="comment">// è·å–ä¹‹å‰æœ€å¤šå‡ æ¡å†å²è®°å½•</span></span><br><span class="line"><span class="keyword">void</span> BackForwardList::backListWithLimit(<span class="keyword">int</span> limit, Vector&lt;Ref&lt;HistoryItem&gt;&gt;&amp; <span class="built_in">list</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">list</span>.clear();</span><br><span class="line">    <span class="keyword">if</span> (m_current != NoCurrentItemIndex) &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> first = <span class="built_in">std</span>::max(<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(m_current) - limit, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (; first &lt; m_current; ++first)</span><br><span class="line">            <span class="built_in">list</span>.append(m_entries[first].get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è·å–History"><a href="#è·å–History" class="headerlink" title="è·å–History"></a>è·å–History</h2><p>åœ¨<code>WebView</code>çš„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°<code>WebBackForwardList</code>çš„å®šä¹‰ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment">    @property backForwardList</span></span><br><span class="line"><span class="comment">    @abstract The backforward list for this WebView.</span></span><br><span class="line"><span class="comment">*/</span>    </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">strong</span>) WebBackForwardList *backForwardList;</span><br></pre></td></tr></table></figure><p><code>WebBackForwardList</code>æ˜¯å¯¹<code>BackForwardList</code>çš„ä¸€å±‚å°è£…ï¼Œé˜…è¯»ä¸€ä¸‹å®ƒçš„.hæ–‡ä»¶ï¼Œä¸éš¾æ‰¾åˆ°è·å–æµè§ˆè®°å½•çš„æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line">    @method backListWithLimit:</span><br><span class="line">    @abstract Returns a portion of the list before the current entry.</span><br><span class="line">    @param limit A cap on the size of the array returned.</span><br><span class="line">    @result An array of items before the current entry, or nil if there are none.  The entries are in the order that they were originally visited.</span><br><span class="line">*/</span><br><span class="line">- (NSArray *)backListWithLimit:(int)limit;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•å¯ä»¥è·å–åˆ°ä¸€ä¸ª<code>WebHistoryItem</code>æ•°ç»„ï¼Œ<code>WebHistoryItem</code>ä¿å­˜äº†æµè§ˆè®°å½•çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h2 id="è·å–WebBackForwardList"><a href="#è·å–WebBackForwardList" class="headerlink" title="è·å–WebBackForwardList"></a>è·å–WebBackForwardList</h2><p><code>UIWebView</code>æ²¡æœ‰æš´éœ²è·å–<code>WebView</code>æˆ–è€…<code>WebBackForwardList</code>çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨KVOæ›²çº¿æ•‘å›½ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°<code>WebView</code>çš„ç§æœ‰å˜é‡åã€‚ç”¨runtimeå¯ä»¥åšåˆ°ï¼Œä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘å†™äº†ä¸€ä¸ªå·¥å…·ç±»æ¥è¾…åŠ©æœç´¢ï¼Œå…·ä½“å¯ä»¥çœ‹<a href="https://crmo.github.io/2018/07/31/runtimeå®ç°ç§æœ‰å˜é‡æœç´¢/">è¿™ç¯‡æ–‡ç« -runtimeå®ç°ç§æœ‰å˜é‡æœç´¢</a>ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”¨runtimeè·å–ç±»æˆå‘˜å˜é‡åˆ—è¡¨ï¼Œç„¶åç”¨BFSæ¥æœç´¢æˆ‘ä»¬è¦æ‰¾çš„ç±»ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥UIWebViewä¸ºæ ¹èŠ‚ç‚¹ï¼ŒBFSæœç´¢WebView</span></span><br><span class="line">[BFSSearchClass searchClass:<span class="string">@"WebView"</span> inClass:<span class="string">@"UIWebView"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœç´¢ç»“æœå¦‚ä¸‹</span></span><br><span class="line"><span class="comment">// Class Nameï¼šç±»åï¼ŒIvar Nameï¼šå˜é‡åï¼ŒSuper Classï¼šçˆ¶ç±»</span></span><br><span class="line">Class Name:ã€WebViewã€‘,Ivar Name:ã€_webViewã€‘</span><br><span class="line">Class Name:ã€<span class="built_in">UIWebDocumentView</span>ã€‘,Ivar Name:ã€Super Classã€‘</span><br><span class="line">Class Name:ã€<span class="built_in">UIWebBrowserView</span>ã€‘,Ivar Name:ã€browserViewã€‘</span><br><span class="line">Class Name:ã€<span class="built_in">UIWebViewInternal</span>ã€‘,Ivar Name:ã€_internalã€‘</span><br><span class="line">Root Class:<span class="built_in">UIWebView</span></span><br></pre></td></tr></table></figure><p>æœ‰äº†ä¸Šé¢çš„ç»“è®ºï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨KVCæ¥è·å–åˆ°æµè§ˆè®°å½•äº†ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)printWebViewHistory:(<span class="built_in">UIWebView</span> *)aWebView &#123;</span><br><span class="line">    <span class="keyword">id</span> webviewInternal = [aWebView valueForKey:<span class="string">@"_internal"</span>];</span><br><span class="line">    <span class="keyword">id</span> browserView = [webviewInternal valueForKey:<span class="string">@"browserView"</span>];</span><br><span class="line">    <span class="keyword">id</span> webView = [browserView valueForKey:<span class="string">@"_webView"</span>];</span><br><span class="line">    <span class="keyword">id</span> backForwardList = [webView performSelector:<span class="keyword">@selector</span>(backForwardList)];</span><br><span class="line">    <span class="comment">// WebHistoryItemå­˜å‚¨çš„å…·ä½“æŸæ¡æµè§ˆè®°å½•ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">NSArray</span> *historyItems = [backForwardList performSelector:<span class="keyword">@selector</span>(backListWithLimit:) withObject:@<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">id</span> item <span class="keyword">in</span> historyItems) &#123;</span><br><span class="line">        <span class="comment">// è·å–æµè§ˆè®°å½•çš„url </span></span><br><span class="line">        <span class="built_in">NSString</span> *url = [item performSelector:<span class="keyword">@selector</span>(URLString)];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ‰€ç”¨æ–¹æ³•ä¼šä½¿ç”¨åˆ°è‹¹æœç§æœ‰APIï¼Œä¸Šæ¶APP Storeè¯·è°¨æ…ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;éœ€æ±‚&quot;&gt;&lt;a href=&quot;#éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;éœ€æ±‚&quot;&gt;&lt;/a&gt;éœ€æ±‚&lt;/h2&gt;&lt;p&gt;
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
</feed>
