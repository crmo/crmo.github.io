<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CR.MO`s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://crmo.github.io/"/>
  <updated>2018-10-15T00:58:35.183Z</updated>
  <id>https://crmo.github.io/</id>
  
  <author>
    <name>CR.MO</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åº”å¯¹è‹¹æœéšç§æ”¿ç­–çœ‹æˆ‘å°±å¤Ÿäº†</title>
    <link href="https://crmo.github.io/2018/10/13/%E5%BA%94%E5%AF%B9%E8%8B%B9%E6%9E%9C%E9%9A%90%E7%A7%81%E6%94%BF%E7%AD%96%E7%9C%8B%E6%88%91%E5%B0%B1%E5%A4%9F%E4%BA%86/"/>
    <id>https://crmo.github.io/2018/10/13/åº”å¯¹è‹¹æœéšç§æ”¿ç­–çœ‹æˆ‘å°±å¤Ÿäº†/</id>
    <published>2018-10-12T16:00:00.000Z</published>
    <updated>2018-10-15T00:58:35.183Z</updated>
    
    <content type="html"><![CDATA[<p>å›½åº†å‡æœŸå›æ¥å‡†å¤‡æäº¤æ–°ç‰ˆæœ¬åˆ°App Storeï¼Œé‡åˆ°è‹¹æœæ–°æ”¿ç­–ï¼Œå®æµ‹ä¸‹æ¥å½±å“ä¸å¤§ï¼Œåº”å¯¹è¿˜ç®—æ¯”è¾ƒç®€å•ï¼Œæ€»ç»“ä¸€ä¸‹åˆ†äº«ç»™å¤§å®¶ã€‚</p><h2 id="æ”¿ç­–è¯´æ˜"><a href="#æ”¿ç­–è¯´æ˜" class="headerlink" title="æ”¿ç­–è¯´æ˜"></a>æ”¿ç­–è¯´æ˜</h2><p><img src="/images/QQ20181012-090233.png" alt="QQ20181012-090233"></p><p>ä»2018å¹´10æœˆ3å·èµ·ï¼Œæ‰€æœ‰æ–°æäº¤çš„Appéƒ½å¿…é¡»æä¾›éšç§æ¡ä¾‹ï¼Œ<a href="https://developer.apple.com/news/?id=08312018a" target="_blank" rel="noopener">å®˜æ–¹è¿æ¥</a>ã€‚</p><p>å¯¹äºéšç§æ¡ä¾‹ï¼Œè‹¹æœå®¡æ ¸æ¡ä¾‹æ˜¯è¿™ä¹ˆè¯´æ˜çš„ã€‚</p><p><img src="/images/QQ20181012-085839.png" alt="QQ20181012-085839"></p><p>éœ€è¦åœ¨ä¸¤ä¸ªåœ°æ–¹æä¾›éšç§æ¡ä¾‹ï¼š</p><ol><li>å…ƒæ•°æ®</li><li>åº”ç”¨å†…æœ‰æ˜æ˜¾çš„å…¥å£</li></ol><h2 id="ç”Ÿæˆéšç§æ¡ä¾‹"><a href="#ç”Ÿæˆéšç§æ¡ä¾‹" class="headerlink" title="ç”Ÿæˆéšç§æ¡ä¾‹"></a>ç”Ÿæˆéšç§æ¡ä¾‹</h2><p>å…³äºéšç§æ¡ä¾‹ï¼Œç½‘ä¸Šæœ‰å„ç§æ¨¡æ¿ï¼Œå¼„ä¸€ä¸ªæ”¹æ”¹å°±è¡Œäº†ï¼Œè¿™é‡Œæ¨èä¸€ä¸ª<a href="https://www.freeprivacypolicy.com" target="_blank" rel="noopener">è‡ªåŠ¨ç”Ÿæˆçš„ç½‘ç«™</a>ã€‚<br>å…è´¹ç”Ÿæˆï¼Œè¿˜æä¾›ä¸€ä¸ªé“¾æ¥ï¼ŒæŒ‚åœ¨å®ƒä»¬ç½‘ç«™ï¼Œå°±ä¸ç”¨è‡ªå·±ææœåŠ¡å™¨äº†ã€‚ä¾‹å¦‚<a href="https://www.freeprivacypolicy.com/privacy/view/cb2289ee81ec0d2f61ec1790bccf861d" target="_blank" rel="noopener">æˆ‘ç»™Appç”Ÿæˆçš„éšç§æ¡ä¾‹</a></p><p><img src="/images/QQ20181012-090746.png" alt="QQ20181012-090746"></p><h2 id="é›†æˆéšç§æ¡ä¾‹"><a href="#é›†æˆéšç§æ¡ä¾‹" class="headerlink" title="é›†æˆéšç§æ¡ä¾‹"></a>é›†æˆéšç§æ¡ä¾‹</h2><p>ç¬¬ä¸€æ­¥ï¼šæŠŠåˆšåˆšç”Ÿæˆçš„URLå¡«åœ¨å…ƒæ•°æ®é‡Œ</p><p><img src="/images/QQ20181012-091050.png" alt="QQ20181012-091050"></p><p>ç¬¬äºŒæ­¥ï¼šåœ¨åº”ç”¨å†…åŠ ä¸€ä¸ªé¡µé¢ï¼Œå¼€ä¸€ä¸ªWebViewåŠ è½½åˆšåˆšç”Ÿæˆçš„URLï¼Œä¾‹å¦‚æˆ‘å°±æ”¾åœ¨äº†â€œå…³äº-éšç§æ¡ä¾‹â€</p><p>ç¬¬ä¸‰æ­¥ï¼šæäº¤å®¡æ ¸æ—¶ï¼Œåœ¨å¤‡æ³¨é‡Œé¢è¯´æ˜ï¼Œéšç§æ¡ä¾‹çš„å…¥å£åœ¨å“ªé‡Œã€‚ï¼ˆè¿™ä¸€æ­¥å¯èƒ½ä¸è¦ä¹Ÿè¡Œï¼Œä¸è¿‡ä¸ºäº†ç¨³å¦¥æˆ‘åŠ ä¸Šäº†ï¼Œç»™è‹¹æœå®¡æ ¸å›¢é˜Ÿè®²æ¸…æ¥šæ€»æ˜¯å¥½çš„ï¼‰</p><p>ç¬¬äºŒå¤©å°±ä¸Šæ¶æˆåŠŸäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å›½åº†å‡æœŸå›æ¥å‡†å¤‡æäº¤æ–°ç‰ˆæœ¬åˆ°App Storeï¼Œé‡åˆ°è‹¹æœæ–°æ”¿ç­–ï¼Œå®æµ‹ä¸‹æ¥å½±å“ä¸å¤§ï¼Œåº”å¯¹è¿˜ç®—æ¯”è¾ƒç®€å•ï¼Œæ€»ç»“ä¸€ä¸‹åˆ†äº«ç»™å¤§å®¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ”¿ç­–è¯´æ˜&quot;&gt;&lt;a href=&quot;#æ”¿ç­–è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;æ”¿ç­–è¯´æ˜&quot;&gt;&lt;/a&gt;æ”¿ç­–è¯´æ˜&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®°â€œé¦™è•‰æ’­æ”¾å™¨â€ä¸Šæ¶çš„è¾›é…¸å†ç¨‹</title>
    <link href="https://crmo.github.io/2018/10/07/%E8%AE%B0%E2%80%9C%E9%A6%99%E8%95%89%E6%92%AD%E6%94%BE%E5%99%A8%E2%80%9D%E4%B8%8A%E6%9E%B6%E7%9A%84%E8%BE%9B%E9%85%B8%E5%8E%86%E7%A8%8B/"/>
    <id>https://crmo.github.io/2018/10/07/è®°â€œé¦™è•‰æ’­æ”¾å™¨â€ä¸Šæ¶çš„è¾›é…¸å†ç¨‹/</id>
    <published>2018-10-06T16:00:00.000Z</published>
    <updated>2018-10-07T08:50:30.398Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>å…ˆè¯´ç‚¹åºŸè¯ï¼Œä»äº‹iOSå¼€å‘ä»¥æ¥ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„APPä¸Šæ¶App Storeï¼Œå¹¶ä¸”ç™»ä¸Šè‹¹æœæ¨èæ¦œå•ï¼Œè¿™å¯èƒ½æ˜¯å¤§å¤šæ•°iOSerçš„æ¢¦æƒ³ã€‚åœ¨è„‘å­é‡Œäº§ç”Ÿäº†å„ç§æƒ³æ³•ï¼Œä½†æ˜¯å‘ç°è‡ªå·±èƒ½æƒ³åˆ°çš„åˆ«äººéƒ½åšäº†ï¼Œå¹¶ä¸”åšçš„å¾ˆå¥½ï¼ŒåŠ ä¸Šå·¥ä½œç”Ÿæ´»ä¸Šçš„å¾ˆå¤šäº‹æƒ…ï¼ˆä¸»è¦æ˜¯æ‡’ğŸ˜ï¼‰ï¼Œä¸€æ‹–å°±æ˜¯3å¹´ã€‚<br>åæ¥å› ä¸ºè‡ªå·±çš„çœŸå®éœ€æ±‚ï¼ŒApp Storeæ‰¾ä¸åˆ°èƒ½æ»¡è¶³éœ€æ±‚çš„äº§å“ï¼Œå°±åšäº†ä¸€ä¸ªæ’­æ”¾å™¨è‡ªå·±ç”¨ï¼Œåœ¨ä¸­ç§‹å‡æœŸç‹ ä¸‹å¿ƒæ¥ï¼Œä¹°äº†å¼€å‘è€…è´¦å·ï¼ˆ688ï¼Œå¿ƒç—›ï¼ï¼å°±å½“ä¸ºäº†æ¢¦æƒ³å……å€¼å§ã€‚ï¼‰ï¼ŒæŠŠè¿™ä¸ªæ’­æ”¾å™¨ä¸Šæ¶äº†ã€‚</p><h2 id="è´­ä¹°å¼€å‘è€…è´¦å·"><a href="#è´­ä¹°å¼€å‘è€…è´¦å·" class="headerlink" title="è´­ä¹°å¼€å‘è€…è´¦å·"></a>è´­ä¹°å¼€å‘è€…è´¦å·</h2><p>å…³äºæ€ä¹ˆä¹°ä¸ªäººå¼€å‘è€…è´¦å·ï¼Œç½‘ä¸Šçš„æ•™ç¨‹ä¸€æŠ“ä¸€å¤§æŠŠï¼Œæ•´ä¸ªè´­ä¹°æµç¨‹ä¹Ÿæ²¡å•¥å¥½æ³¨æ„çš„ï¼Œæ ¹æ®æç¤ºä¸€æ­¥ä¸€æ­¥èµ°å°±OKäº†ã€‚ä½†æ˜¯åˆ°äº†æœ€åä»˜æ¬¾ç¯èŠ‚æŠŠæˆ‘å¡äº†ä¸€å‘¨ï¼ˆåŠäº†ä¸¤å¼ ä¿¡ç”¨å¡ã€‚ã€‚ã€‚ï¼‰ï¼Œå¿…é¡»è¦<code>visa+é“¶è”</code>åŒæ ‡çš„ä¿¡ç”¨å¡ï¼Œæ³¨æ„ä¸€å®šè¦åŒæ ‡ï¼Œåªæœ‰visaæˆ–è€…åªæœ‰é“¶è”éƒ½ä¸è¡Œã€‚<br>ä»˜äº†æ¬¾ä¸€å¤©å·¦å³è‹¹æœå°±ä¼šå‘æ¥é‚®ä»¶ï¼Œæä¾›èº«ä»½è¯æ­£åé¢ç…§ç‰‡å°±å¯ä»¥äº†ã€‚</p><h2 id="ä¸Šæ¶App-Store"><a href="#ä¸Šæ¶App-Store" class="headerlink" title="ä¸Šæ¶App Store"></a>ä¸Šæ¶App Store</h2><p>ä¸Šæ¶æµç¨‹å°±è½»è½¦ç†Ÿè·¯äº†ï¼Œæ‰“åŒ…ä¸Šä¼ ã€å¡«å†™å„ç§APPè¯´æ˜ã€ä¸Šä¼ å›¾æ ‡ã€å®£ä¼ å›¾ã€æäº¤å®¡æ ¸ã€‚æ¿€åŠ¨çš„æˆ‘ä¸€æ™šä¸Šæ²¡ç¡å¥½è§‰ï¼Œç¬¬äºŒå¤©æ—©ä¸Šæ‰“å¼€é‚®ç®±ï¼Œç­‰å¾…æˆ‘çš„å±…ç„¶æ˜¯<code>2.1å¤§ç¤¼åŒ…</code>ï¼ˆGuideline 2.1 - Information Neededï¼‰ã€‚</p><p><img src="/images/WechatIMG59.png" alt="WechatIMG59"></p><p>ä¸€çœ‹æˆ‘å°±æ‡µé€¼äº†ï¼Œä¸Šæ¶è¿™ä¹ˆå¤šæ¬¡ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¹ˆä¸¥å‰çš„å›å¤ï¼Œæ„Ÿè§‰åˆ†åˆ†é’Ÿè¦è¢«å°å·ã€‚ç»è¿‡å¤šæ–¹å’¨è¯¢ï¼Œå‘ç°è¿™æ˜¯è‹¹æœä»Šå¹´æ–°æ¨å‡ºçš„å¤§ç¤¼åŒ…ï¼Œå¾ˆå¤šäººéƒ½é‡åˆ°è¿‡ï¼Œä¸€èˆ¬æ˜¯æœºå™¨å®¡æ ¸å›å¤çš„ï¼Œé‡åˆ°è¿™ç§æƒ…å†µåˆ«æ…Œï¼ˆé™¤éä½ æ˜¯é©¬ç”²åŒ…ã€æˆ–è€…æŠ„è¢­çš„ä¹‹ç±»çš„APPï¼‰ï¼Œä»”ç»†æ£€æŸ¥æ¡ä¾‹ï¼Œç„¶åé€æ¡ç­”å¤ï¼ˆæœ€å¥½ç”¨è‹±æ–‡ï¼‰ã€‚<br>æœ€åæˆ‘è¿˜å½•åˆ¶äº†ä¸€ä¸ªè§†é¢‘ï¼Œæ¥æ¼”ç¤ºæˆ‘çš„APPçš„ä¸»è¦åŠŸèƒ½ï¼Œä¸Šä¼ åˆ°<code>youtube</code>ï¼Œé™„åœ¨äº†å¤‡æ³¨ã€‚<br>åˆ†äº«ä¸‹æˆ‘çš„ç­”å¤æ¨¡æ¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">å°Šæ•¬çš„è‹¹æœå®¡æ ¸å›¢é˜Ÿï¼š</span><br><span class="line">    æ„Ÿè°¢æ‚¨çš„è€å¿ƒå®¡æ ¸ï¼Œé’ˆå¯¹ä¸‹é¢é—®é¢˜ï¼Œæˆ‘ä»¬åšäº†è¯¦ç»†çš„æ£€æŸ¥</span><br><span class="line">    </span><br><span class="line">å…³äº Guideline 2.1</span><br><span class="line"></span><br><span class="line">1.1.6 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åŒ…å«ä»»ä½•çš„è™šå‡ä¸è¯¯å¯¼ä¿¡æ¯ï¼Œå…¨éƒ¨éƒ½æ˜¯çœŸå®æœ‰æ•ˆçš„</span><br><span class="line">2.3.0 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åœ¨é€šè¿‡å®¡æ ¸åä¿®æ”¹ä»»ä½•æ¦‚å¿µå’ŒåŠŸèƒ½</span><br><span class="line">2.3.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰åŒ…å«ä»»ä½•éšè—åŠŸèƒ½ï¼Œæ²¡æœ‰åŒ…å«èµŒåšã€å½©ç¥¨ç½‘ç«™</span><br><span class="line">3.1.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€å†…æ²¡æœ‰ä»»ä½•å†…è´­ã€æ”¯ä»˜åŠŸèƒ½ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯å…è´¹æä¾›ç»™ç”¨æˆ·</span><br><span class="line">3.2.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€å†…éƒ¨åŒ…å«ä»»ä½•è´·æ¬¾ç­‰é‡‘èæœåŠ¡</span><br><span class="line">4.3.0 - â€œé¦™è•‰æ’­æ”¾å™¨â€åŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹å¼€å‘ï¼Œä¸å­˜åœ¨æŠ„è¢­æˆ–è€…å¤§é‡ç›¸ä¼¼</span><br><span class="line">5.2.1 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰æ³•äººå®ä½“å’Œç‰ˆæƒé£é™©</span><br><span class="line">5.2.3 - â€œé¦™è•‰æ’­æ”¾å™¨â€æ²¡æœ‰æä¾›æ–‡ä»¶å…±äº«æœåŠ¡ï¼Œæˆ–è€…å…¶å®ƒå­˜åœ¨ç‰ˆæƒé—®é¢˜çš„éŸ³è§†é¢‘</span><br><span class="line">5.3.4 - â€œé¦™è•‰æ’­æ”¾å™¨â€ä»…åœ¨ä¸­å›½åŒºä¸Šæ¶ï¼Œæ²¡æœ‰è¿è§„å†…å®¹</span><br><span class="line"></span><br><span class="line">å…³äº Guideline 2.3.7</span><br><span class="line"></span><br><span class="line">æˆ‘å·²ç»æŒ‰ç…§è¯´æ˜ï¼Œä¿®æ”¹äº†å…ƒæ•°æ®ï¼Œè¯·å®¡æ ¸å›¢é˜Ÿå†æ¬¡å®¡æ ¸ã€‚</span><br><span class="line"></span><br><span class="line">æœ€åå†æ¬¡æ„Ÿè°¢æ‚¨è¾›è‹¦çš„å®¡æ ¸ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dear Apple Review Team:</span><br><span class="line">    Thank you for your patience review, we have done a detailed check on the following questions.</span><br><span class="line">    </span><br><span class="line">About Guideline 2.1</span><br><span class="line"></span><br><span class="line">1.1.6 - &quot;Banana Player&quot; does not contain any false and misleading information, all of which are true and effective</span><br><span class="line">2.3.0 - &quot;Banana Player&quot; does not modify any concepts and features after passing the review</span><br><span class="line">2.3.1 - &quot;Banana Player&quot; does not contain any hidden features, does not contain gambling, lottery sites</span><br><span class="line">3.1.1 - There is no in-app purchase and payment function in the â€œBanana Playerâ€, all functions are provided to the user free of charge.</span><br><span class="line">3.2.1 - &quot;Banana Player&quot; contains any financial services such as loans</span><br><span class="line">4.3.0 - The &quot;Banana Player&quot; feature is developed independently, without plagiarism or a lot of similarity</span><br><span class="line">5.2.1 - &quot;Banana Player&quot; has no legal entity and copyright risk</span><br><span class="line">5.2.3 - &quot;Banana Player&quot; does not provide file sharing services, or other audio and video with copyright issues</span><br><span class="line">5.3.4 - &quot;Banana Player&quot; is only available in China, no illegal content</span><br><span class="line"></span><br><span class="line">About Guideline 2.3.7</span><br><span class="line"></span><br><span class="line">I have modified the metadata according to the instructions, please review the team again.</span><br><span class="line"></span><br><span class="line">Finally, thank you again for your hard review.</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå¤©å®¡æ ¸é€šè¿‡ï¼ŒæˆåŠŸä¸Šæ¶ï¼</p><h2 id="æ‰“ä¸ªå¹¿å‘Š"><a href="#æ‰“ä¸ªå¹¿å‘Š" class="headerlink" title="æ‰“ä¸ªå¹¿å‘Š"></a>æ‰“ä¸ªå¹¿å‘Š</h2><blockquote><p>ä¸‹è½½ğŸ”—ï¼š<a href="https://dwz.cn/HvVix2hH" target="_blank" rel="noopener">https://dwz.cn/HvVix2hH</a></p></blockquote><p>â€œé¦™è•‰æ’­æ”¾å™¨â€æ˜¯æˆ‘ç‹¬ç«‹å¼€å‘çš„ç¬¬ä¸€æ¬¾APPï¼Œå…è´¹æ— å¹¿å‘Šã€‚ä¸»è¦åŠŸèƒ½åœ¨æ‰‹æœºä¸Šæ’­æ”¾ä»ç½‘ç›˜ã€å…‰ç›˜ã€ç½‘ç«™ä¸‹è½½çš„éŸ³é¢‘èµ„æ–™ã€è¯¾ç¨‹ã€éŸ³ä¹ã€‚æ— éœ€æ•°æ®çº¿ï¼Œç”¨Wi-Fiå°±å¯ä»¥æ‹·è´æ–‡ä»¶åˆ°æ‰‹æœºï¼Œè‡ªåŠ¨è®°å½•æ’­æ”¾è¿›åº¦ã€‚<br>å¦‚æœæœ‰éœ€æ±‚å¯ä»¥æ”¯æŒä¸€æ³¢ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿è”ç³»æˆ‘ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;å…ˆè¯´ç‚¹åºŸè¯ï¼Œä»äº‹iOSå¼€å‘ä»¥æ¥ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„APPä¸Šæ¶App Storeï¼Œå¹¶ä¸”ç™»ä¸Šè‹¹æœæ¨èæ¦œå•ï¼Œè¿™å¯èƒ½æ˜¯å¤§
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€ä¸ªè¡Œç»“æŸç¬¦å¼•å‘çš„JSæŠ¥é”™</title>
    <link href="https://crmo.github.io/2018/09/05/%E8%AE%B0%E4%B8%80%E4%B8%AA%E8%A1%8C%E7%BB%93%E6%9D%9F%E7%AC%A6%E5%BC%95%E5%8F%91%E7%9A%84JS%E6%8A%A5%E9%94%99/"/>
    <id>https://crmo.github.io/2018/09/05/è®°ä¸€ä¸ªè¡Œç»“æŸç¬¦å¼•å‘çš„JSæŠ¥é”™/</id>
    <published>2018-09-04T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.773Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªç¥å¥‡çš„Bugï¼Œé€šè¿‡<code>UIWebView</code>çš„<code>stringByEvaluatingJavaScriptFromString:</code>æ–¹æ³•æ‰§è¡Œä¸€æ®µ<code>JavaScript</code>ä»£ç æ—¶ï¼Œ<code>JavaScript</code>æŠ¥é”™:</p><blockquote><p>SyntaxError: Unexpected EOF</p></blockquote><p>ç»è¿‡ä»”ç»†çš„æ’æŸ¥ï¼Œå‘ç°å¾…æ‰§è¡Œçš„<code>JavaScript</code>ä»£ç é‡Œé¢åŒ…å«<code>U+2028</code>å­—ç¬¦ã€‚è¿˜æ‰¾åˆ°äº†<a href="https://stackoverflow.com/questions/2965293/javascript-parse-error-on-u2028-unicode-character" target="_blank" rel="noopener">Stack Overflowç›¸å…³è®¨è®º</a>ã€‚<br><code>JavaScript</code>è§£æå™¨ä¼šæŠŠè¡Œåˆ†éš”ç¬¦<code>U+2028</code>å’Œæ®µè½åˆ†éš”ç¬¦<code>U+2029</code>è§£ææˆä¸€è¡Œçš„ç»“æŸï¼Œä»£ç é‡Œè¦æ˜¯åŒ…å«è¿™ä¸¤ä¸ªå­—ç¬¦ç›¸å½“äºæ¢è¡Œï¼Œä¾‹å¦‚ï¼š</p><blockquote><p>alert(â€œ\u2028â€)</p></blockquote><p>å°±ä¼šè¢«è§£æä¸º</p><blockquote><p>alert(â€œ<br>â€œ)</p></blockquote><p>äºæ˜¯å°±äº§ç”Ÿäº†è¯­æ³•é”™è¯¯ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æˆ‘ç”¨çš„æ–¹æ³•æ¯”è¾ƒç®€å•ã€ç²—æš´ï¼Œåœ¨æ‰§è¡Œ<code>JavaScript</code>ä»£ç å‰ï¼Œç›´æ¥è¿‡æ»¤æ‰è¿™ä¸¤ä¸ªå­—ç¬¦ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line">    javaScriptString = [javaScriptString stringByReplacingOccurrencesOfString:<span class="string">@"\u2028"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    javaScriptString = [javaScriptString stringByReplacingOccurrencesOfString:<span class="string">@"\u2029"</span> withString:<span class="string">@""</span>];</span><br><span class="line">    <span class="built_in">NSString</span>* ret = [(<span class="built_in">UIWebView</span>*)_engineWebView stringByEvaluatingJavaScriptFromString:javaScriptString];</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;æœ€è¿‘é‡åˆ°ä¸€ä¸ªç¥å¥‡çš„Bugï¼Œé€šè¿‡&lt;code&gt;UIWebView&lt;/code&gt;çš„&lt;code&gt;stringByEvaluating
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ä»ä¸€ä¸ªAFNetworkingå¾ªç¯å¼•ç”¨è¯´èµ·</title>
    <link href="https://crmo.github.io/2018/08/28/%E4%BB%8E%E4%B8%80%E4%B8%AAAFNetworking%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E8%AF%B4%E8%B5%B7/"/>
    <id>https://crmo.github.io/2018/08/28/ä»ä¸€ä¸ªAFNetworkingå¾ªç¯å¼•ç”¨è¯´èµ·/</id>
    <published>2018-08-27T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.791Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡åˆ†æä½¿ç”¨ä»£ç æ˜¯<a href="https://github.com/AFNetworking/AFNetworking/releases" target="_blank" rel="noopener">AFNetworking 3.2.1</a></p></blockquote><p>æœ€è¿‘ä½¿ç”¨<code>Instruments</code>ä¸­çš„<code>Leaks</code>åˆ†æé¡¹ç›®å†…å­˜æ³„éœ²ï¼Œå‘ç°äº†ä¸€ä¸ªAFNetworkingçš„å¾ªç¯å¼•ç”¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/15354171666142.jpg" alt="15354171666142"></p><p>é€šè¿‡è°ƒç”¨æ ˆå‘ç°äº§ç”Ÿæ³„éœ²çš„ä»£ç åœ¨è¿™é‡Œï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AFURLSessionManager.m</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithSessionConfiguration:(<span class="built_in">NSURLSessionConfiguration</span> *)configuration &#123;</span><br><span class="line">    <span class="comment">// ... åˆå§‹åŒ–ä»£ç ï¼Œçœç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¼è‡´å¾ªç¯å¼•ç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">self</span>.session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:<span class="keyword">self</span>.sessionConfiguration delegate:<span class="keyword">self</span> delegateQueue:<span class="keyword">self</span>.operationQueue];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... å…¶å®ƒåˆå§‹åŒ–ä»£ç ï¼Œçœç•¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§è‡´åŸå› å°±æ˜¯AFURLSessionManagerå¼•ç”¨NSURLSessionï¼ŒåŒæ—¶è®¾ç½®NSURLSessionçš„delegateä¸ºè‡ªå·±ï¼ŒNSURLSessionä¼šå¼ºå¼•ç”¨delegateï¼Œäºæ˜¯äº§ç”Ÿäº†å¾ªç¯å¼•ç”¨ã€‚</p><blockquote><p>å…³äºNSURLSessionçš„delegateå®˜æ–¹è¯´æ˜ï¼š<br>This delegate object is responsible for handling authentication challenges, for making caching decisions, and for handling other session-related events. The session object keeps a strong reference to this delegate until your app exits or explicitly invalidates the session. If you do not invalidate the session, your app leaks memory until it exits.</p></blockquote><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨AFNetworkingå®˜æ–¹issuesæ‰¾åˆ°äº†ç›¸å…³çš„é—®é¢˜<a href="https://github.com/AFNetworking/AFNetworking/issues/1528" target="_blank" rel="noopener">Possible memory leak in AFURLSessionManager</a>ã€‚ä½œè€…çš„å›ç­”å¦‚ä¸‹ï¼š</p><p><img src="/images/15353328585634.jpg" alt="15353328585634"></p><p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ol><li>è¿™æ˜¯æœ€å¸¸è§ä¹Ÿæ˜¯ä½œè€…æ¨èçš„æ–¹æ³•ï¼Œåªåˆ›å»ºä¸€ä¸ªAFURLSessionManagerï¼Œæ•´ä¸ªAPPå…±äº«ï¼Œè™½ç„¶è¿˜æ˜¯æœ‰å¾ªç¯å¼•ç”¨ï¼Œä½†æ˜¯å°±æ²¡æœ‰å†…å­˜æ³„éœ²çš„é—®é¢˜äº†ã€‚</li><li>å¦‚æœè¦ä½¿ç”¨å¤šä¸ªAFURLSessionManagerï¼Œåœ¨ä½¿ç”¨å®Œæˆåæ‰‹åŠ¨è°ƒç”¨<code>invalidateSessionCancelingTasks:</code>æ¥æ–­å¼€å¾ªç¯å¼•ç”¨ã€‚ï¼ˆè¿™ç§æ–¹æ¡ˆä¸æ¨èï¼Œå…·ä½“åŸå› çœ‹ä¸‹ä¸€å°èŠ‚ï¼‰</li></ol><h2 id="AFURLSessionManagerå¤ç”¨"><a href="#AFURLSessionManagerå¤ç”¨" class="headerlink" title="AFURLSessionManagerå¤ç”¨"></a>AFURLSessionManagerå¤ç”¨</h2><p>å…³äºAFURLSessionManageræ˜¯å¦ä½¿ç”¨å•ä¾‹è¿™ä¸ªé—®é¢˜ï¼Œå®˜æ–¹demoä½¿ç”¨çš„æ˜¯å•ä¾‹ï¼Œåœ¨è‹¹æœå®˜æ–¹æ–‡æ¡£æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µè¯</p><blockquote><p>With the NSURLSession API, your app creates one or more sessions, each of which coordinates a group of related data transfer tasks. For example, if youâ€™re creating a web browser, your app might create one session per tab or window, or one session for interactive use and another for background downloads. Within each session, your app adds a series of tasks, each of which represents a request for a specific URL (following HTTP redirects, if necessary).</p></blockquote><p>æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼Œæ ¹æ®ä½¿ç”¨åœºæ™¯çš„ä¸åŒï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸åŒçš„ç­”æ¡ˆï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹APPéƒ½æ˜¯åœ¨å’ŒåŒä¸€æœåŠ¡å™¨æ‰“äº¤é“ï¼Œä¸€ä¸ª<code>session</code>å°±å¤Ÿäº†ï¼Œå¦‚æœæœ‰è¿æ¥å¤šä¸ªæœåŠ¡å™¨ã€æˆ–è€…åå°ä¸‹è½½ç­‰åŠŸèƒ½éœ€æ±‚ï¼Œå¯ä»¥ç»™æ¯ä¸ªæœåŠ¡å™¨ã€åå°ä¸‹è½½ä»»åŠ¡åˆ›å»ºå•ç‹¬çš„<code>session</code>ï¼ˆä½†æ˜¯ä¹Ÿä¸èƒ½æ¯ä¸ªè¯·æ±‚éƒ½å•ç‹¬åˆ›å»ºsessionï¼‰ã€‚</p><p>åœ¨æŸ¥æ‰¾èµ„æ–™çš„æ—¶å€™ï¼Œæˆ‘å‘ç°æœ‰åšå®¢æåˆ°å•ä¾‹seesionå¯ä»¥å‡å°‘TCPä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŠ¨æ‰‹éªŒè¯ä¸‹ï¼š</p><p>å¤šä¸ªç½‘ç»œè¯·æ±‚å¤ç”¨ä¸€ä¸ª<code>AFURLSessionManager</code>ï¼Œè¿ç»­å‘ä¸¤ä¸ªç½‘ç»œè¯·æ±‚ï¼Œç”¨<code>Wireshark</code>æŠ“åŒ…å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡ç½‘ç»œè¯·æ±‚å¤ç”¨äº†ç¬¬ä¸€æ¬¡çš„TCPè¿æ¥ï¼Œæ²¡æœ‰åšä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p><img src="/images/15354191775340.jpg" alt="15354191775340"></p><p>ä¸‹å›¾æ˜¯æ¯æ¬¡ç½‘ç»œè¯·æ±‚éƒ½æ–°å»ºä¸€ä¸ª<code>AFURLSessionManager</code>çš„æŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªç½‘ç»œè¯·æ±‚éƒ½è¿›è¡Œäº†TCPä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p><img src="/images/15354193039698.jpg" alt="15354193039698"></p><p>å®éªŒç»“æœçš„ç¡®å¦‚ç½‘ä¸Šæ‰€è¯´ï¼Œå¤ç”¨<code>AFURLSessionManager</code>å¯ä»¥å‡å°‘ä¸‰æ¬¡æ¡æ‰‹ï¼Œæå‡æ•ˆç‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡åˆ†æä½¿ç”¨ä»£ç æ˜¯&lt;a href=&quot;https://github.com/AFNetworking/AFNetworking/releases&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;AFNetworking 3.2.1&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>iOSæ¨¡æ‹Ÿå™¨å®‰è£…debugåŒ…</title>
    <link href="https://crmo.github.io/2018/08/21/iOS%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85debug%E5%8C%85/"/>
    <id>https://crmo.github.io/2018/08/21/iOSæ¨¡æ‹Ÿå™¨å®‰è£…debugåŒ…/</id>
    <published>2018-08-20T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.803Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºé¡¹ç›®æ˜¯Hybridçš„å¹³å°ï¼Œæœ‰ç¬¬ä¸‰æ–¹äººå‘˜éœ€è¦åœ¨ä¸Šé¢å¼€å‘H5åº”ç”¨ï¼Œä½†æ˜¯releaseåŒ…ä¸èƒ½è°ƒè¯•H5ï¼Œåªæœ‰debugæŠ¥å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯é¡¹ç›®æºç ä¸èƒ½äº¤ç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨googleæœç´¢äº†ä¸‹ï¼Œå‘ç°ä¸€ç¯‡éœœç¥çš„<a href="https://juejin.im/post/57b01f298ac247005f0acb0a" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œè®²çš„æ˜¯debugåŒ…å¯ä»¥æ‹·è´åˆ°å…¶å®ƒæœºå™¨è¿è¡Œï¼Œäºæ˜¯å®è·µäº†ä¸€æ³¢ã€‚</p><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ul><li>Xcode</li><li>Command Line Tools</li><li>ios-sim</li></ul><blockquote><p>ios-simå®‰è£…å‘½ä»¤ï¼šnpm install ios-sim -g</p></blockquote><h2 id="æ‹·è´æœ¬åœ°çš„debugåŒ…"><a href="#æ‹·è´æœ¬åœ°çš„debugåŒ…" class="headerlink" title="æ‹·è´æœ¬åœ°çš„debugåŒ…"></a>æ‹·è´æœ¬åœ°çš„debugåŒ…</h2><ol><li>runä¸€æ¬¡éœ€è¦æ‹·è´çš„é¡¹ç›®ï¼Œå®‰è£…åˆ°æ¨¡æ‹Ÿå™¨ä¸Š</li></ol><ol><li>æ‰§è¡Œä¸‹é¢å‘½ä»¤è¡Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<code>ç›®æ ‡è·¯å¾„/xxx.zip</code>å°±æ˜¯æ‹·è´å‡ºæ¥çš„debugåº”ç”¨åŒ…ï¼Œéœ€è¦æ›¿æ¢ä¸ºè‡ªå·±çš„è·¯å¾„ï¼Œä¾‹å¦‚<code>/Users/crmo/Desktop/debug/debug.zip</code></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ditto -ck --sequesterRsrc --keepParent `ls -1 -d -t ~/Library/Developer/Xcode/DerivedData/*/Build/Products/*-iphonesimulator/*.app | head -n 1` ç›®æ ‡è·¯å¾„/xxx.zip</span><br></pre></td></tr></table></figure><h2 id="æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨"><a href="#æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨" class="headerlink" title="æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨"></a>æ‹·è´debugåŒ…åˆ°å…¶å®ƒæ¨¡æ‹Ÿå™¨</h2><h3 id="1-è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨"><a href="#1-è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨" class="headerlink" title="1. è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨"></a>1. è·å–æ¨¡æ‹Ÿå™¨åˆ—è¡¨</h3><blockquote><p>ios-sim showdevicetypes</p></blockquote><p>å¯ä»¥çœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºï¼Œå°±æ˜¯æœ¬æœºå¯ç”¨çš„æ¨¡æ‹Ÿå™¨ï¼Œé€‰æ‹©ä¸€ä¸ªéœ€è¦è¿è¡Œçš„æ¨¡æ‹Ÿå™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~ ios-sim showdevicetypes</span><br><span class="line">Apple-Watch-38mm, watchOS 4.3</span><br><span class="line">Apple-Watch-42mm, watchOS 4.3</span><br><span class="line">Apple-Watch-Series-2-38mm, watchOS 4.3</span><br><span class="line">Apple-Watch-Series-2-42mm, watchOS 4.3</span><br><span class="line">iPhone-7-Plus, 10.3</span><br><span class="line">iPhone-7-Plus, 11.4</span><br><span class="line">Apple-Watch-Series-3-38mm, watchOS 4.3</span><br><span class="line">Apple-Watch-Series-3-42mm, watchOS 4.3</span><br><span class="line">iPhone-5s, 11.4</span><br><span class="line">iPhone-6, 11.4</span><br><span class="line">iPhone-6-Plus, 11.4</span><br><span class="line">iPhone-6s, 11.4</span><br><span class="line">iPhone-6s-Plus, 11.4</span><br><span class="line">iPhone-7, 11.4</span><br><span class="line">iPhone-SE, 11.4</span><br><span class="line">iPad-Air, 11.4</span><br><span class="line">iPad-Air-2, 11.4</span><br><span class="line">iPhone-8, 11.4</span><br><span class="line">iPhone-8-Plus, 11.4</span><br><span class="line">iPhone-X, 11.4</span><br></pre></td></tr></table></figure><h3 id="2-åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…"><a href="#2-åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…" class="headerlink" title="2. åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…"></a>2. åœ¨æ¨¡æ‹Ÿå™¨ä¸Šå¯åŠ¨debugåŒ…</h3><blockquote><p>ios-sim launch åº”ç”¨åŒ…è·¯å¾„/xxx.app â€“devicetypeid æ¨¡æ‹Ÿå™¨</p></blockquote><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œdebug.zipè§£å‹åå°±å¯ä»¥å¾—åˆ°å¯¹åº”åº”ç”¨çš„.appæ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘çš„debugåŒ…æ”¾åœ¨<code>/Users/crmo/Desktop/debug/debug.app</code>ï¼Œæ¨¡æ‹Ÿå™¨é€‰æ‹©iPhone-8ï¼Œæœ€ç»ˆçš„å‘½ä»¤æ˜¯</p><blockquote><p>ios-sim launch /Users/crmo/Desktop/debug/debug.app â€“devicetypeid iPhone-8</p></blockquote><h2 id="simctl-was-not-foundé”™è¯¯è§£å†³"><a href="#simctl-was-not-foundé”™è¯¯è§£å†³" class="headerlink" title="simctl was not foundé”™è¯¯è§£å†³"></a>simctl was not foundé”™è¯¯è§£å†³</h2><p>åœ¨å®è·µæ—¶æµ‹è¯•æœºçš„<code>Command Line Tools</code>æ²¡æœ‰é…ç½®å¥½ï¼Œå‡ºç°æŠ¥é”™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">simctl was not found.</span><br><span class="line">Check that you have Xcode 8.x installed:</span><br><span class="line">xcodebuild --versionCheck that you have Xcode 8.x selected:</span><br><span class="line">xcode-select --print-path</span><br></pre></td></tr></table></figure><p><strong>è§£å†³åŠæ³•ï¼š</strong></p><p>1.é¦–å…ˆç¡®ä¿æ­£ç¡®å®‰è£…äº†Command Line Toolsï¼Œ</p><blockquote><p>å¸è½½Command Line Tools:rm -rf /Library/Developer/CommandLineTools<br>å®‰è£…Command Line Tools:xcode-select â€“install</p></blockquote><p>2.åœ¨xcodeé…ç½®ä¸€ä¸‹Command Line Toolsï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/images/15348328228775.jpg" alt="15348328228775"></p><hr><p>å‚è€ƒåšå®¢ï¼š</p><ul><li><a href="http://www.hudongdong.com/bug/772.html" target="_blank" rel="noopener">unable to find utility â€œsimctlâ€çš„è§£å†³æ–¹æ¡ˆ</a></li><li><a href="https://juejin.im/post/57b01f298ac247005f0acb0a" target="_blank" rel="noopener">ç»™ iOS æ¨¡æ‹Ÿå™¨ â€œå®‰è£…â€app æ–‡ä»¶</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç”±äºé¡¹ç›®æ˜¯Hybridçš„å¹³å°ï¼Œæœ‰ç¬¬ä¸‰æ–¹äººå‘˜éœ€è¦åœ¨ä¸Šé¢å¼€å‘H5åº”ç”¨ï¼Œä½†æ˜¯releaseåŒ…ä¸èƒ½è°ƒè¯•H5ï¼Œåªæœ‰debugæŠ¥å¯ä»¥è°ƒè¯•ï¼Œä½†æ˜¯é¡¹ç›®æºç ä¸èƒ½äº¤ç»™ç¬¬ä¸‰æ–¹ï¼Œåœ¨googleæœç´¢äº†ä¸‹ï¼Œå‘ç°ä¸€ç¯‡éœœç¥çš„&lt;a href=&quot;https://juejin.im/post/57b01f298
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>dispatch_syncæ­»é”é—®é¢˜</title>
    <link href="https://crmo.github.io/2018/08/03/dispatch_sync%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98/"/>
    <id>https://crmo.github.io/2018/08/03/dispatch_syncæ­»é”é—®é¢˜/</id>
    <published>2018-08-02T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.816Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>ä½¿ç”¨<code>dispatch_sync</code>çš„æ—¶å€™è¦å°å¿ƒè°¨æ…ï¼Œç¨ä¸æ³¨æ„å°±ä¼šå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå…ˆçœ‹ä¸¤ä¸ªå…¸å‹çš„æ¡ˆä¾‹ï¼š</p><p>æ¡ˆä¾‹ä¸€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)deadlock1 &#123;</span><br><span class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_sync(queue, ^&#123;</span><br><span class="line">        dispatch_sync(queue, ^&#123;</span><br><span class="line">            NSLog(@&quot;&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¡ˆä¾‹äºŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (void)deadlock2 &#123;</span><br><span class="line">    dispatch_queue_t queue1 = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_queue_t queue2 = dispatch_queue_create(&quot;label&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_sync(queue1, ^&#123;</span><br><span class="line">        dispatch_sync(queue2, ^&#123;</span><br><span class="line">            dispatch_sync(queue1, ^&#123;</span><br><span class="line">                NSLog(@&quot;&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤ä¸ªæ¡ˆä¾‹æ­»é”çš„åŸå› éƒ½æ˜¯åŒä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—çš„ä»»åŠ¡ç›¸äº’ç­‰å¾…ã€‚ å½“ç„¶å®é™…å·¥ç¨‹ä¸­é‡åˆ°çš„æ­»é”é—®é¢˜ä¼šæ›´åŠ å¤æ‚ï¼Œéš¾ä»¥åˆ†æã€‚</p><h2 id="å…¸å‹è¯¯åŒº"><a href="#å…¸å‹è¯¯åŒº" class="headerlink" title="å…¸å‹è¯¯åŒº"></a>å…¸å‹è¯¯åŒº</h2><p>åœ¨é˜…è¯»ç›¸å…³ä¹¦ç±ã€åšå®¢éƒ½æåˆ°äº†ä¸€ä¸ªæ–¹æ³•<code>dispatch_get_current_queue()</code>ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥è·å–åˆ°å½“å‰é˜Ÿåˆ—ï¼Œäºæ˜¯æœ‰äººå°±ç”¨å®ƒæ¥è§£å†³æ­»é”é—®é¢˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (void)safeSync:(void(^)())block &#123;</span><br><span class="line">    if (!block) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (dispatch_get_current_queue() == queue) &#123;</span><br><span class="line">        block();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        dispatch_sync(queue, ^&#123;</span><br><span class="line">            block();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€çœ¼çœ‹èµ·æ¥å¤©è¡£æ— ç¼ï¼Œå¯¹äºæ¡ˆä¾‹ä¸€çš„ç¡®å¯ä»¥å®Œç¾è§£å†³ï¼Œä½†æ˜¯å¯¹äºæ¡ˆä¾‹äºŒè¿™ç§å¯¹é˜Ÿåˆ—çš„æƒ…å†µå°±åˆ¤æ–­ä¸äº†ã€‚éš¾æ€ªè‹¹æœåœ¨iOS6å°±æ³¨é‡Šäº†è¿™ä¸ªæ–¹æ³•ã€‚</p><hr><p>æ¨èé˜…è¯»ï¼š</p><p><a href="https://www.objc.io/issues/2-concurrency/thread-safe-class-design/#pitfalls-of-gcd" target="_blank" rel="noopener">Thread-Safe Class Design</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜åˆ†æ&quot;&gt;&lt;a href=&quot;#é—®é¢˜åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜åˆ†æ&quot;&gt;&lt;/a&gt;é—®é¢˜åˆ†æ&lt;/h2&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;dispatch_sync&lt;/code&gt;çš„æ—¶å€™è¦å°å¿ƒè°¨æ…ï¼Œç¨ä¸æ³¨æ„å°±ä¼šå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå…ˆçœ‹ä¸¤ä¸ªå…¸å‹çš„æ¡ˆä¾‹ï¼š&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>UIWebViewè·å–è¯¦ç»†æµè§ˆè®°å½•</title>
    <link href="https://crmo.github.io/2018/08/01/UIWebView%E8%8E%B7%E5%8F%96history/"/>
    <id>https://crmo.github.io/2018/08/01/UIWebViewè·å–history/</id>
    <published>2018-07-31T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.824Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ‰€ç”¨æ–¹æ³•ä¼šä½¿ç”¨åˆ°è‹¹æœç§æœ‰APIï¼Œä¸Šæ¶APP Storeè¯·è°¨æ…ä½¿ç”¨ã€‚</p></blockquote><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>è·å–<code>UIWebView</code>çš„å‰è¿›åé€€çš„æµè§ˆè®°å½•ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä»A-&gt;B-&gt;C-&gt;Bï¼Œæ­¤æ—¶Bä¸Šä¸€é¡µæ˜¯Aï¼Œä¸‹ä¸€é¡µæ˜¯Cï¼Œéœ€è¦è·å–Aã€Cçš„URLä¿¡æ¯ã€‚</p><blockquote><p>WKWebViewæš´éœ²äº†è¿™ä¸ªå±æ€§ï¼Œ<code>WKBackForwardList *backForwardList</code>ã€‚å¯ä»¥å¾ˆå®¹æ˜“çš„å–åˆ°ï¼Œæ— å¥ˆé¡¹ç›®è¿˜æ˜¯ä½¿ç”¨çš„<code>UIWebView</code>ï¼Œäºæ˜¯æœ‰äº†åé¢çš„æ¢ç´¢ã€‚</p></blockquote><p>é¦–å…ˆåœ¨<code>UIWebView</code>æä¾›çš„APIé‡Œæ‰¾ï¼Œç›¸å…³çš„APIåªæœ‰<code>canGoBack</code>å’Œ<code>canGoForward</code>ï¼Œå‘½åå¾ˆç›´è§‚ï¼Œæ˜¯å¦å¯ä»¥åé€€å’Œå‰è¿›ï¼Œè¿™æ¡è·¯èµ°ä¸é€šã€‚<br>æƒ³åˆ°æ˜¯å¦å¯ä»¥é€šè¿‡JSçš„Window.historyè·å–åˆ°ï¼ŒæŸ¥äº†ä¸‹APIï¼Œå”¯ä¸€ä¸€ä¸ªæœ‰ç‚¹åƒçš„<code>length</code>å±æ€§ï¼Œæ™ºèƒ½å–åˆ°æµè§ˆè®°å½•ä¸­çš„æ‰€æœ‰URLçš„æ•°é‡ï¼Œä¸åŒºåˆ†å‰åï¼Œæ¯”å¦‚åœ¨ä¸Šé¢æåˆ°çš„ä¾‹å­ä¸­ï¼Œåœ¨Bé¡µé¢å–åˆ°çš„<code>length</code>æ˜¯3ï¼Œè€Œä¸”ä¸èƒ½å–å‡ºå…·ä½“çš„URLã€‚</p><p><img src="/images/15325235986699.jpg" alt="15325235986699"></p><p>æ— å¥ˆåªæœ‰ä¸Šæºç äº†ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯<a href="https://opensource.apple.com/release/ios-110.html" target="_blank" rel="noopener">â€œWebKit-7604.1.38.0.7â€å’Œâ€œWebCore-7604.1.38.0.7â€</a>ã€‚</p><h2 id="Window-History-lengthå®ç°æœ¬è´¨"><a href="#Window-History-lengthå®ç°æœ¬è´¨" class="headerlink" title="Window.History.lengthå®ç°æœ¬è´¨"></a>Window.History.lengthå®ç°æœ¬è´¨</h2><p>åœ¨WebCoreé‡Œé¢æ‰¾åˆ°äº†JSæ–¹æ³•<code>Window.History.length</code>å®ç°çš„æœ¬è´¨ï¼Œä¸Šä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebCore History.cpp</span></span><br><span class="line"><span class="keyword">unsigned</span> History::length() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!m_frame)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">auto</span>* page = m_frame-&gt;page();</span><br><span class="line">    <span class="keyword">if</span> (!page)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> page-&gt;backForward().count();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebCore BackForwardController.cpp</span></span><br><span class="line"><span class="keyword">int</span> BackForwardController::count() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// count = å½“å‰é¡µä¹‹å‰çš„é¡µé¢æ€»æ•° + å½“å‰é¡µä¹‹åçš„é¡µé¢æ€»æ•° + 1</span></span><br><span class="line">    <span class="keyword">return</span> m_client-&gt;backListCount() + <span class="number">1</span> + m_client-&gt;forwardListCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>WebCore</code>é‡Œé¢<code>backListCount()</code>ã€<code>forwardListCount()</code>å®šä¹‰æ˜¯è™šå‡½æ•°ï¼Œå…·ä½“å®ç°åœ¨<code>WebKit</code>å¯ä»¥æ‰¾åˆ°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebKit BackForwardList.mm</span></span><br><span class="line"><span class="keyword">int</span> BackForwardList::backListCount()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> m_current == NoCurrentItemIndex ? <span class="number">0</span> : m_current;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> BackForwardList::forwardListCount()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> m_current == NoCurrentItemIndex ? <span class="number">0</span> : (<span class="keyword">int</span>)m_entries.size() - (m_current + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸‹ï¼Œåé¢ä¼šç”¨åˆ°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebKit BackForwardList.mm</span></span><br><span class="line"><span class="comment">// è·å–ä¹‹å‰æœ€å¤šå‡ æ¡å†å²è®°å½•</span></span><br><span class="line"><span class="keyword">void</span> BackForwardList::backListWithLimit(<span class="keyword">int</span> limit, Vector&lt;Ref&lt;HistoryItem&gt;&gt;&amp; <span class="built_in">list</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">list</span>.clear();</span><br><span class="line">    <span class="keyword">if</span> (m_current != NoCurrentItemIndex) &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> first = <span class="built_in">std</span>::max(<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(m_current) - limit, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (; first &lt; m_current; ++first)</span><br><span class="line">            <span class="built_in">list</span>.append(m_entries[first].get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è·å–History"><a href="#è·å–History" class="headerlink" title="è·å–History"></a>è·å–History</h2><p>åœ¨<code>WebView</code>çš„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°<code>WebBackForwardList</code>çš„å®šä¹‰ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment">    @property backForwardList</span></span><br><span class="line"><span class="comment">    @abstract The backforward list for this WebView.</span></span><br><span class="line"><span class="comment">*/</span>    </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">strong</span>) WebBackForwardList *backForwardList;</span><br></pre></td></tr></table></figure><p><code>WebBackForwardList</code>æ˜¯å¯¹<code>BackForwardList</code>çš„ä¸€å±‚å°è£…ï¼Œé˜…è¯»ä¸€ä¸‹å®ƒçš„.hæ–‡ä»¶ï¼Œä¸éš¾æ‰¾åˆ°è·å–æµè§ˆè®°å½•çš„æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line">    @method backListWithLimit:</span><br><span class="line">    @abstract Returns a portion of the list before the current entry.</span><br><span class="line">    @param limit A cap on the size of the array returned.</span><br><span class="line">    @result An array of items before the current entry, or nil if there are none.  The entries are in the order that they were originally visited.</span><br><span class="line">*/</span><br><span class="line">- (NSArray *)backListWithLimit:(int)limit;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•å¯ä»¥è·å–åˆ°ä¸€ä¸ª<code>WebHistoryItem</code>æ•°ç»„ï¼Œ<code>WebHistoryItem</code>ä¿å­˜äº†æµè§ˆè®°å½•çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h2 id="è·å–WebBackForwardList"><a href="#è·å–WebBackForwardList" class="headerlink" title="è·å–WebBackForwardList"></a>è·å–WebBackForwardList</h2><p><code>UIWebView</code>æ²¡æœ‰æš´éœ²è·å–<code>WebView</code>æˆ–è€…<code>WebBackForwardList</code>çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨KVOæ›²çº¿æ•‘å›½ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°<code>WebView</code>çš„ç§æœ‰å˜é‡åã€‚ç”¨runtimeå¯ä»¥åšåˆ°ï¼Œä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘å†™äº†ä¸€ä¸ªå·¥å…·ç±»æ¥è¾…åŠ©æœç´¢ï¼Œå…·ä½“å¯ä»¥çœ‹<a href="https://crmo.github.io/2018/07/31/runtimeå®ç°ç§æœ‰å˜é‡æœç´¢/">è¿™ç¯‡æ–‡ç« -runtimeå®ç°ç§æœ‰å˜é‡æœç´¢</a>ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”¨runtimeè·å–ç±»æˆå‘˜å˜é‡åˆ—è¡¨ï¼Œç„¶åç”¨BFSæ¥æœç´¢æˆ‘ä»¬è¦æ‰¾çš„ç±»ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥UIWebViewä¸ºæ ¹èŠ‚ç‚¹ï¼ŒBFSæœç´¢WebView</span></span><br><span class="line">[BFSSearchClass searchClass:<span class="string">@"WebView"</span> inClass:<span class="string">@"UIWebView"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœç´¢ç»“æœå¦‚ä¸‹</span></span><br><span class="line"><span class="comment">// Class Nameï¼šç±»åï¼ŒIvar Nameï¼šå˜é‡åï¼ŒSuper Classï¼šçˆ¶ç±»</span></span><br><span class="line">Class Name:ã€WebViewã€‘,Ivar Name:ã€_webViewã€‘</span><br><span class="line">Class Name:ã€<span class="built_in">UIWebDocumentView</span>ã€‘,Ivar Name:ã€Super Classã€‘</span><br><span class="line">Class Name:ã€<span class="built_in">UIWebBrowserView</span>ã€‘,Ivar Name:ã€browserViewã€‘</span><br><span class="line">Class Name:ã€<span class="built_in">UIWebViewInternal</span>ã€‘,Ivar Name:ã€_internalã€‘</span><br><span class="line">Root Class:<span class="built_in">UIWebView</span></span><br></pre></td></tr></table></figure><p>æœ‰äº†ä¸Šé¢çš„ç»“è®ºï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨KVCæ¥è·å–åˆ°æµè§ˆè®°å½•äº†ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)printWebViewHistory:(<span class="built_in">UIWebView</span> *)aWebView &#123;</span><br><span class="line">    <span class="keyword">id</span> webviewInternal = [aWebView valueForKey:<span class="string">@"_internal"</span>];</span><br><span class="line">    <span class="keyword">id</span> browserView = [webviewInternal valueForKey:<span class="string">@"browserView"</span>];</span><br><span class="line">    <span class="keyword">id</span> webView = [browserView valueForKey:<span class="string">@"_webView"</span>];</span><br><span class="line">    <span class="keyword">id</span> backForwardList = [webView performSelector:<span class="keyword">@selector</span>(backForwardList)];</span><br><span class="line">    <span class="comment">// WebHistoryItemå­˜å‚¨çš„å…·ä½“æŸæ¡æµè§ˆè®°å½•ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">NSArray</span> *historyItems = [backForwardList performSelector:<span class="keyword">@selector</span>(backListWithLimit:) withObject:@<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">id</span> item <span class="keyword">in</span> historyItems) &#123;</span><br><span class="line">        <span class="comment">// è·å–æµè§ˆè®°å½•çš„url </span></span><br><span class="line">        <span class="built_in">NSString</span> *url = [item performSelector:<span class="keyword">@selector</span>(URLString)];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ‰€ç”¨æ–¹æ³•ä¼šä½¿ç”¨åˆ°è‹¹æœç§æœ‰APIï¼Œä¸Šæ¶APP Storeè¯·è°¨æ…ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;éœ€æ±‚&quot;&gt;&lt;a href=&quot;#éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;éœ€æ±‚&quot;&gt;&lt;/a&gt;éœ€æ±‚&lt;/h2&gt;&lt;p&gt;
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>runtimeå®ç°ç§æœ‰å˜é‡æœç´¢</title>
    <link href="https://crmo.github.io/2018/07/31/runtime%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F%E6%90%9C%E7%B4%A2/"/>
    <id>https://crmo.github.io/2018/07/31/runtimeå®ç°ç§æœ‰å˜é‡æœç´¢/</id>
    <published>2018-07-30T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.834Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡Demo(<a href="https://github.com/crmo/BFSSearchClass)åœ°å€" target="_blank" rel="noopener">https://github.com/crmo/BFSSearchClass)åœ°å€</a></p></blockquote><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>åœ¨å¼€å‘åŠŸèƒ½æ—¶ï¼Œä¸ºäº†æ»¡è¶³äº§å“å˜æ€çš„éœ€æ±‚ï¼Œéš¾å…æœ‰ç³»ç»Ÿç±»æä¾›çš„APIä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œè¿™æ—¶å€™ç§æœ‰å˜é‡å°±å¯ä»¥å‘æŒ¥å®ƒå…‰å’Œçƒ­äº†ã€‚æ€ä¹ˆé€šè¿‡ä¸€ä¸ªç±»ï¼Œä¸€å±‚ä¸€å±‚çš„æ‰¾åˆ°ç‰¹å®šç±»å‹çš„ç§æœ‰æˆå‘˜å˜é‡ï¼Ÿ<br>å—ç›ŠäºObjective-Cçš„åŠ¨æ€è¯­è¨€ç‰¹æ€§ï¼Œå°±ç®—è‹¹æœ<code>UIKit</code>ä¸å¼€æºï¼Œä½†æ˜¯åœ¨runtimeé¢å‰ï¼Œç±»çš„ç»“æ„è¿˜æ˜¯æš´éœ²æ— é—ã€‚æˆ‘çš„æ€è·¯æ˜¯é€å±‚æ‰‹åŠ¨æ‰“å°æˆå‘˜å˜é‡ä¿¡æ¯ï¼Œå¦‚æœæ˜¯UIæ§ä»¶å¯ä»¥ç”¨Revealæ¥åŠ å¿«è¿›åº¦ï¼Œé…åˆKVCæœºåˆ¶ï¼Œè·å–ç§æœ‰å˜é‡å°±å¦‚åŒæ¢å›Šå–ç‰©ä¸€èˆ¬ã€‚<br>åœ¨å¤šæ¬¡é‡åˆ°è¿™ä¸ªé—®é¢˜åï¼Œæˆ‘å†³å®šå®ç°ä¸€ä¸ªå·¥å…·ç±»æ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæ¯•ç«Ÿèƒ½è‡ªåŠ¨åŒ–çš„å°±å°½é‡ä¸è¦æ‰‹åŠ¨ã€‚</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><blockquote><p>æœç´¢èŒƒå›´ï¼šæˆå‘˜å˜é‡ã€å±æ€§</p></blockquote><p>å…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>runtimeä¸­çš„æ–¹æ³•<code>class_copyIvarList()</code>ï¼Œå¯ä»¥å–å‡ºç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ç»“æ„ä½“<code>Ivar</code>ã€‚</li><li>ä»Ivarä¸­å¯ä»¥å–å‡ºæˆå‘˜å˜é‡ç±»å‹<code>Type Encodings</code></li><li>ç”¨<code>Type Encodings</code>è·å–åˆ°ç±»å</li><li>éå†ç±»çš„æ‰€æœ‰<code>Ivar</code>ï¼Œè·å–åˆ°ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡çš„ç±»ä¿¡æ¯</li></ol><p>ä½†æ˜¯é—®é¢˜æ²¡è¿™ä¹ˆç®€å•ï¼Œæ¯”å¦‚ClassAæ˜¯ClassBçš„æˆå‘˜å˜é‡ï¼ŒClassBæ˜¯ClassCçš„æˆå‘˜å˜é‡ï¼Œæƒ³é€šè¿‡ClassCæ‰¾åˆ°ClassAï¼Œéœ€è¦å‘ä¸‹æ‰¾ä¸¤å±‚æ‰èƒ½æ‰¾åˆ°ï¼Œè¿˜è¦è€ƒè™‘çˆ¶ç±»çš„æƒ…å†µã€‚<br>æ•´ä¸ªæœç´¢è¿‡ç¨‹å°±æ˜¯ä¸€é¢—ä»¥å¾…æœç´¢ç±»ä¸ºæ ¹çš„æ ‘ï¼Œå¯ä»¥ç”¨BFSæ¥æœç´¢ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼ˆå¦‚å›¾ï¼Œæ•°å­—æ˜¯æœç´¢é¡ºåºï¼‰ï¼š</p><ol><li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹æœç´¢</li><li>é¦–å…ˆéå†å½“å‰èŠ‚ç‚¹çš„çˆ¶ç±»ï¼ŒåŠ å…¥æœç´¢é˜Ÿåˆ—</li><li>å†å–å‡ºå½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼ŒåŠ å…¥æœç´¢é˜Ÿåˆ—</li></ol><p><img src="/images/QQ20180731-202956@2x.png" alt="QQ20180731-202956@2x"></p><h2 id="å¦‚ä½•ä»Ivarä¸­è·å–Class"><a href="#å¦‚ä½•ä»Ivarä¸­è·å–Class" class="headerlink" title="å¦‚ä½•ä»Ivarä¸­è·å–Class"></a>å¦‚ä½•ä»Ivarä¸­è·å–Class</h2><p>Ivarä¸­ä¸èƒ½ç›´æ¥å–å‡ºå¯¹åº”ç±»åï¼Œåªèƒ½å–å‡º<code>Type Encodings</code>ï¼Œé—´æ¥å¯ä»¥å¾—åˆ°ç±»åã€‚ä»<a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>æˆªäº†å¼ å›¾ï¼Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°Codeçš„å®šä¹‰ã€‚</p><p><img src="/images/15329163411347.jpg" alt="15329163411347"></p><p>åŸºæœ¬æ•°æ®ç±»å‹ã€idç±»å‹ã€é›†åˆç±»å‹ã€ç»“æ„ä½“ç­‰ç±»å‹å°±ä¸éœ€è¦æœç´¢äº†ï¼Œå¯ä»¥è¿‡æ»¤æ‰ã€‚æˆ‘ä»¬åªæœç´¢ä¸¤ç§ç±»å‹</p><ol><li>ç±»ï¼Œä¾‹å¦‚<code>@&quot;UIWebViewInternal&quot;</code></li><li>ä»£ç†ï¼Œä¾‹å¦‚<code>@&quot;&lt;UIViewControllerTransitioningDelegate&gt;&quot;</code></li></ol><h2 id="ä¼˜åŒ–åŠå­˜åœ¨é—®é¢˜"><a href="#ä¼˜åŒ–åŠå­˜åœ¨é—®é¢˜" class="headerlink" title="ä¼˜åŒ–åŠå­˜åœ¨é—®é¢˜"></a>ä¼˜åŒ–åŠå­˜åœ¨é—®é¢˜</h2><ol><li>å¯ä»¥ç”¨ä¸€ä¸ª<code>NSMutableSet</code>å­˜å‚¨å·²ç»æœç´¢è¿‡çš„ç±»ï¼Œæ¯æ¬¡æœç´¢å‰åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å·²ç»æœç´¢è¿‡</li><li>è®°å½•æœç´¢æ¬¡æ•°ï¼Œå¯ä»¥é™åˆ¶æœç´¢æ¬¡æ•°ã€‚</li><li>å¯¹äºå®šä¹‰ä¸ºidç±»å‹ã€é›†åˆç±»çš„æˆå‘˜å˜é‡æ²¡æœ‰åšå¤„ç†ï¼Œå¯ä»¥ç»§ç»­æ·±å…¥éå†</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡Demo(&lt;a href=&quot;https://github.com/crmo/BFSSearchClass)åœ°å€&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/crmo/BFSSearchC
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>iOSæ¨ªç«–å±æ€»ç»“</title>
    <link href="https://crmo.github.io/2018/07/23/iOS%E6%A8%AA%E7%AB%96%E5%B1%8F%E6%80%BB%E7%BB%93/"/>
    <id>https://crmo.github.io/2018/07/23/iOSæ¨ªç«–å±æ€»ç»“/</id>
    <published>2018-07-22T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.843Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨<code>Auto Layout</code>æ¥è¿›è¡Œå¸ƒå±€å°±ä¸ç”¨è‡ªå·±å»ç›‘å¬æ¨ªç«–å±äº‹ä»¶äº†ï¼Œåªéœ€è¦ç»˜åˆ¶å¤šå¥—å¸ƒå±€å³å¯ã€‚ä½†æ˜¯é¡¹ç›®æœ‰å¾ˆå¤šé¡µé¢æ˜¯è‡ªå·±æ‰‹åŠ¨è®¡ç®—çš„ï¼Œäºæ˜¯åªæœ‰æƒ³åŠæ³•å†æ—‹è½¬å±å¹•æ—¶é‡æ–°å¸ƒå±€ã€‚</p><h2 id="ç›¸å…³æšä¸¾"><a href="#ç›¸å…³æšä¸¾" class="headerlink" title="ç›¸å…³æšä¸¾"></a>ç›¸å…³æšä¸¾</h2><p>å±å¹•æ–¹å‘æœ‰3ä¸ªç›¸å…³æšä¸¾ï¼Œç•Œé¢æ–¹å‘<code>UIInterfaceOrientation</code>ï¼Œè®¾å¤‡æ–¹å‘<code>UIDeviceOrientation</code>ï¼Œæ”¯æŒæ—‹è½¬æ–¹å‘<code>UIInterfaceOrientationMask</code>ã€‚</p><blockquote><p>æ³¨æ„UIInterfaceOrientationä¸UIDeviceOrientationå·¦å³æ–¹å‘æ˜¯ç›¸åçš„</p></blockquote><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">UIInterfaceOrientation</span>) &#123;</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationUnknown</span>            = <span class="built_in">UIDeviceOrientationUnknown</span>,</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationPortrait</span>           = <span class="built_in">UIDeviceOrientationPortrait</span>,</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationPortraitUpsideDown</span> = <span class="built_in">UIDeviceOrientationPortraitUpsideDown</span>,</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationLandscapeLeft</span>      = <span class="built_in">UIDeviceOrientationLandscapeRight</span>,</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationLandscapeRight</span>     = <span class="built_in">UIDeviceOrientationLandscapeLeft</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, <span class="built_in">UIInterfaceOrientationMask</span>) &#123;</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskPortrait</span> = (<span class="number">1</span> &lt;&lt; <span class="built_in">UIInterfaceOrientationPortrait</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> = (<span class="number">1</span> &lt;&lt; <span class="built_in">UIInterfaceOrientationLandscapeLeft</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskLandscapeRight</span> = (<span class="number">1</span> &lt;&lt; <span class="built_in">UIInterfaceOrientationLandscapeRight</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskPortraitUpsideDown</span> = (<span class="number">1</span> &lt;&lt; <span class="built_in">UIInterfaceOrientationPortraitUpsideDown</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskLandscape</span> = (<span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeRight</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskAll</span> = (<span class="built_in">UIInterfaceOrientationMaskPortrait</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeRight</span> | <span class="built_in">UIInterfaceOrientationMaskPortraitUpsideDown</span>),</span><br><span class="line">    <span class="built_in">UIInterfaceOrientationMaskAllButUpsideDown</span> = (<span class="built_in">UIInterfaceOrientationMaskPortrait</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> | <span class="built_in">UIInterfaceOrientationMaskLandscapeRight</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ¨ªç«–å±æ§åˆ¶"><a href="#æ¨ªç«–å±æ§åˆ¶" class="headerlink" title="æ¨ªç«–å±æ§åˆ¶"></a>æ¨ªç«–å±æ§åˆ¶</h2><p>æ§åˆ¶ç•Œé¢æ¨ªç«–å±åˆ‡æ¢æœ‰3ä¸ªé‡è¦çš„ç‚¹ï¼Œæœ€ç»ˆç»“æœä»¥è¿™ä¸‰ä¸ªåœ°æ–¹çš„å€¼å–äº¤é›†ã€‚</p><p><strong>1.info.plistå…¨å±€æ§åˆ¶</strong></p><p>å¯ä»¥åœ¨<code>General-&gt;Deplyment Info</code>ç•Œé¢ä¸Šå‹¾é€‰</p><p><img src="/images/15320065885480.jpg" alt="15320065885480"></p><p> info.plistæ–‡ä»¶ä¸­é…ç½®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸¤è¾¹ä¼šåŒæ­¥å˜æ›´</p><p><img src="/images/15320512384395.jpg" alt="15320512384395"></p><p><strong>2.AppDelegateä¸­æ ¹æ®ä¸åŒWindowæ§åˆ¶</strong></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDelegate</span></span><br><span class="line">- (<span class="built_in">UIInterfaceOrientationMask</span>)application:(<span class="built_in">UIApplication</span> *)application supportedInterfaceOrientationsForWindow:(<span class="built_in">UIWindow</span> *)window &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UIInterfaceOrientationMaskLandscapeLeft</span> | <span class="built_in">UIInterfaceOrientationMaskPortrait</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.åœ¨ViewControllerä¸­æ§åˆ¶å½“å‰é¡µé¢</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// UIViewController</span><br><span class="line">- (BOOL)shouldAutorotate &#123;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIInterfaceOrientationMask)supportedInterfaceOrientations &#123;</span><br><span class="line">    return UIInterfaceOrientationMaskLandscapeLeft;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œäº¤é›†ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™ä¼šå¯¼è‡´crash</p></blockquote><p>*** Terminating app due to uncaught exception â€˜UIApplicationInvalidInterfaceOrientationâ€™, reason: â€˜Supported orientations has no common orientation with the application, and [ViewController<br>shouldAutorotate] is returning YESâ€™</p><p><img src="/images/15320548897266-1.jpg" alt="15320548897266"></p><h2 id="æ—‹è½¬äº‹ä»¶ç›‘å¬"><a href="#æ—‹è½¬äº‹ä»¶ç›‘å¬" class="headerlink" title="æ—‹è½¬äº‹ä»¶ç›‘å¬"></a>æ—‹è½¬äº‹ä»¶ç›‘å¬</h2><h3 id="æ—‹è½¬äº‹ä»¶ä¼ é€’è¿‡ç¨‹"><a href="#æ—‹è½¬äº‹ä»¶ä¼ é€’è¿‡ç¨‹" class="headerlink" title="æ—‹è½¬äº‹ä»¶ä¼ é€’è¿‡ç¨‹"></a>æ—‹è½¬äº‹ä»¶ä¼ é€’è¿‡ç¨‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">op0=&gt;operation: __CFRunLoopDoSources0</span><br><span class="line">op1=&gt;operation: UIDevice</span><br><span class="line">op2=&gt;operation: UIWindow</span><br><span class="line">op3=&gt;operation: UIViewController</span><br><span class="line">op4=&gt;operation: UIView</span><br><span class="line"></span><br><span class="line">op1-&gt;op2-&gt;op3-&gt;op4</span><br></pre></td></tr></table></figure><h3 id="å±å¹•æ—‹è½¬ç›¸å…³äº‹ä»¶"><a href="#å±å¹•æ—‹è½¬ç›¸å…³äº‹ä»¶" class="headerlink" title="å±å¹•æ—‹è½¬ç›¸å…³äº‹ä»¶"></a>å±å¹•æ—‹è½¬ç›¸å…³äº‹ä»¶</h3><p>viewWillTransitionToSize:withTransitionCoordinator:</p><ul><li>ViewControllerè¢«çˆ¶å®¹å™¨å˜æ›´sizeæ—¶è°ƒç”¨ï¼ˆä¾‹å¦‚windowæ—‹è½¬æ—¶è°ƒç”¨root view controllerçš„è¯¥æ–¹æ³•ï¼‰</li><li>å¦‚æœé‡è½½è¯¥æ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨superä¼ é€’äº‹ä»¶ç»™å­ViewController</li><li>è¿™ä¸ªæ–¹æ³•æ˜¯æœ€å…³é”®çš„ï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­å¯¹ç•Œé¢è¿›è¡Œé‡æ–°å¸ƒå±€</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewWillTransitionToSize:(CGSize)size withTransitionCoordinator:(id &lt;UIViewControllerTransitionCoordinator&gt;)coordinator</span><br><span class="line">&#123;</span><br><span class="line">    // coordinatorç”¨æ¥å¤„ç†è½¬æ¢åŠ¨ç”»</span><br><span class="line">    [coordinator animateAlongsideTransition:^(id&lt;UIViewControllerTransitionCoordinatorContext&gt; context)</span><br><span class="line">     &#123;</span><br><span class="line">         // å¼€å§‹æ—‹è½¬</span><br><span class="line">     &#125; completion:^(id&lt;UIViewControllerTransitionCoordinatorContext&gt; context)</span><br><span class="line">     &#123;</span><br><span class="line">         // æ—‹è½¬ç»“æŸ</span><br><span class="line">     &#125;];</span><br><span class="line">     // è®°å¾—è°ƒç”¨super</span><br><span class="line">    [super viewWillTransitionToSize:size withTransitionCoordinator:coordinator];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UIApplicationWillChangeStatusBarOrientationNotification </p><ul><li>çŠ¶æ€æ å°†è¦æ—‹è½¬ï¼Œè¿™ä¸ªæ—¶å€™å–viewçš„frameè¿˜æ˜¯æ—‹è½¬ä¹‹å‰çš„</li><li>NSNotificationä¸­ç”¨key <code>UIApplicationStatusBarOrientationUserInfoKey</code>å¯ä»¥å–åˆ°å°†è¦æ—‹è½¬åˆ°çš„æ–¹å‘ã€‚</li></ul><p>UIApplicationDidChangeStatusBarOrientationNotification </p><ul><li>çŠ¶æ€æ å·²ç»æ—‹è½¬ï¼Œè¿™ä¸ªæ—¶å€™å–viewçš„frameæ˜¯æ—‹è½¬ä¹‹åçš„</li><li>NSNotificationä¸­ç”¨key <code>UIApplicationStatusBarOrientationUserInfoKey</code>å¯ä»¥å–åˆ°æ—‹è½¬ä¹‹å‰çš„æ–¹å‘ã€‚</li></ul><p>UIDeviceOrientationDidChangeNotification </p><ul><li>è®¾å¤‡æ–¹å‘å˜æ›´ï¼Œåœ¨æ”¶åˆ°é€šçŸ¥æ—¶å–viewçš„frameæ˜¯æ—‹è½¬ä¹‹åçš„ã€‚</li><li>åœ¨æ‰‹æœºä¸Šå°†æ—‹è½¬å±å¹•é”å®šä¹‹åï¼Œè®¾å¤‡æ–¹å‘å˜æ›´ä¹‹åæ”¶ä¸åˆ°è¯¥é€šçŸ¥</li><li>åœ¨ä»£ç é‡Œé¢é™åˆ¶è®¾å¤‡æ—‹è½¬æ–¹å‘ï¼Œè®¾å¤‡æ–¹å‘å˜æ›´åä¾ç„¶èƒ½æ”¶åˆ°è¯¥é€šçŸ¥</li></ul><p>è°ƒç”¨é¡ºåºå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: æ—‹è½¬å±å¹•</span><br><span class="line">e=&gt;end: ç»“æŸ</span><br><span class="line">op1=&gt;operation: viewWillTransitionToSize:withTransitionCoordinator:</span><br><span class="line">op2=&gt;operation: UIApplicationWillChangeStatusBarOrientationNotification</span><br><span class="line">op3=&gt;operation: UIApplicationDidChangeStatusBarOrientationNotification</span><br><span class="line">op4=&gt;operation: viewWillLayoutSubviews</span><br><span class="line">op5=&gt;operation: viewDidLayoutSubviews</span><br><span class="line">op6=&gt;operation: UIDeviceOrientationDidChangeNotification</span><br><span class="line"></span><br><span class="line">st-&gt;op1-&gt;op2-&gt;op3-&gt;op4-&gt;op5-&gt;op6-&gt;e</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰Windowçš„æ—‹è½¬äº‹ä»¶"><a href="#è‡ªå®šä¹‰Windowçš„æ—‹è½¬äº‹ä»¶" class="headerlink" title="è‡ªå®šä¹‰Windowçš„æ—‹è½¬äº‹ä»¶"></a>è‡ªå®šä¹‰Windowçš„æ—‹è½¬äº‹ä»¶</h2><p>å¦‚æœæƒ³è¦åœ¨è‡ªå®šä¹‰Windowçš„å­Viewæ”¶åˆ°å±å¹•æ—‹è½¬é€šçŸ¥ï¼Œè¦è®¾ç½®UIWindowçš„rootViewControllerï¼Œç„¶åæŠŠæ‰€æœ‰å­viewéƒ½åŠ åˆ°rootViewControllerï¼Œç³»ç»Ÿä¼šå¤„ç†æ¨ªç«–å±äº‹ä»¶ã€‚è¿™é‡Œæˆ‘è¿˜é‡åˆ°ä¸€ä¸ªå‘<a href="https://crmo.github.io/2018/07/19/è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘/">è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘</a>ã€‚</p><hr><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><p><a href="https://satanwoo.github.io/2016/09/17/uiwindow-iOS/" target="_blank" rel="noopener">https://satanwoo.github.io/2016/09/17/uiwindow-iOS/</a><br><a href="https://tbd.ink/2017/07/05/iOS/17070501.iOSå±å¹•æ—‹è½¬çŸ¥è¯†ç‚¹ä»¥åŠå®ç°/index/" target="_blank" rel="noopener">iOSå±å¹•æ—‹è½¬çŸ¥è¯†ç‚¹ä»¥åŠå®ç°</a><br><a href="https://imtangqi.com/2017/03/08/handle-orientation-changes-one/" target="_blank" rel="noopener">iOS å±å¹•æ—‹è½¬çš„é‚£äº›äº‹ï¼ˆä¸€ï¼‰</a><br><a href="https://satanwoo.github.io/2016/09/17/uiwindow-iOS/" target="_blank" rel="noopener">æµ…è°ˆiOSçš„å¤šWindowå¤„ç†</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä½¿ç”¨&lt;code&gt;Auto Layout&lt;/code&gt;æ¥è¿›è¡Œå¸ƒå±€å°±ä¸ç”¨è‡ªå·±å»ç›‘å¬æ¨ªç«–å±äº‹ä»¶äº†ï¼Œåªéœ€è¦ç»˜åˆ¶å¤šå¥—å¸ƒå±€å³å¯ã€‚ä½†æ˜¯é¡¹ç›®æœ‰å¾ˆå¤šé¡µé¢æ˜¯è‡ªå·±æ‰‹åŠ¨è®¡ç®—çš„ï¼Œäºæ˜¯åªæœ‰æƒ³åŠæ³•å†æ—‹è½¬å±å¹•æ—¶é‡æ–°å¸ƒå±€ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç›¸å…³æšä¸¾&quot;&gt;&lt;a href=&quot;#ç›¸å…³æšä¸¾&quot; class=&quot;h
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘</title>
    <link href="https://crmo.github.io/2018/07/19/%E8%AE%B0%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0UIWindow%E5%AD%90%E7%B1%BB%E7%9A%84%E5%B0%8F%E5%9D%91/"/>
    <id>https://crmo.github.io/2018/07/19/è®°ä¸€ä¸ªå®ç°UIWindowå­ç±»çš„å°å‘/</id>
    <published>2018-07-18T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.852Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>é¡¹ç›®ä¸­ä¸ºäº†å®ç°ä¸€ä¸ªå…¨å±€é®ç½©ç•Œé¢ï¼Œä½¿ç”¨äº†ä¸€ä¸ªUIWindowçš„å­ç±»<code>MyWindow</code>ï¼Œ<code>MyWindow</code>ä¸ºäº†å®ç°å›è°ƒå®šä¹‰äº†ä»£ç†<code>MyWindowDelegate</code>ã€‚ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">MyWindowDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyWindow</span> : <span class="title">UIWindow</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>)<span class="keyword">id</span>&lt;MyWindowDelegate&gt; delegate;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyWindow</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.windowLevel = <span class="built_in">UIWindowLevelNormal</span>;</span><br><span class="line">        <span class="keyword">self</span>.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        <span class="built_in">UIViewController</span> *vc = [[ViewController2 alloc] init];</span><br><span class="line">        <span class="keyword">self</span>.rootViewController = vc;</span><br><span class="line">        <span class="keyword">self</span>.hidden = <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨å®ç°ç•Œé¢æ¨ªå±æ—¶ï¼Œå‘ç°æ•´ä¸ªUIWindowä¸å“åº”æ¨ªç«–å±äº‹ä»¶ã€‚åˆšå¼€å§‹ä»¥ä¸ºæ¨ªç«–å±è®¾ç½®è¢«å…³é—­äº†ï¼ŒæŸ¥äº†å„ç§èµ„æ–™ï¼Œå‘ç°è¿™ç§å†™æ³•æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è®¾ç½®UIWindowçš„rootViewControllerï¼Œç„¶åæŠŠæ‰€æœ‰å­viewéƒ½åŠ åˆ°rootViewControllerï¼Œç³»ç»Ÿä¼šå¤„ç†æ¨ªç«–å±é—®é¢˜ã€‚</p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>ç”¨RuntimeæŠŠUIWindowçš„ç§æœ‰å˜é‡æ‰“å‡ºæ¥ï¼Œå°±å‘ç°é—®é¢˜äº†ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)printUIWindowIvars &#123;</span><br><span class="line">    Ivar *ivars = class_copyIvarList([<span class="built_in">UIWindow</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        Ivar ivar = ivars[i];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, ivar_getName(ivar));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹è¾“å‡ºï¼Œå‘ç°æœ‰ä¸ªç§æœ‰å˜é‡<code>_delegate</code>ã€‚</p><p><img src="/images/15319834677166.jpg" alt="15319834677166"></p><p><code>MyWindow</code>çš„å±æ€§<code>delegate</code>è¦†ç›–äº†çˆ¶ç±»<code>UIWindow</code>çš„å˜é‡ï¼Œå¯¼è‡´æ¨ªç«–å±åˆ‡æ¢äº‹ä»¶å¤±æ•ˆã€‚åœ¨ä»£ç†å‘½åçš„æ—¶å€™ä¸€å®šè¦æ³¨æ„å•Šï¼Œ<code>delegate</code>çœ‹æ¥ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®è·µï¼Œåº”è¯¥åŠ å‰ç¼€åŒºåˆ†é¿å…è¦†ç›–çˆ¶ç±»çš„å®ç°ï¼Œç‰¹åˆ«æ˜¯è¿™ç§ç§æœ‰çš„å˜é‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;é¡¹ç›®ä¸­ä¸ºäº†å®ç°ä¸€ä¸ªå…¨å±€é®ç½©ç•Œé¢ï¼Œä½¿ç”¨äº†ä¸€ä¸ªUIWindowçš„å­ç±»&lt;code&gt;MyWindow&lt;/code&gt;ï¼Œ&lt;code&gt;My
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªautoreleasepoolçš„ä½¿ç”¨åœºæ™¯</title>
    <link href="https://crmo.github.io/2018/07/18/%E4%B8%80%E4%B8%AAautoreleasepool%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
    <id>https://crmo.github.io/2018/07/18/ä¸€ä¸ªautoreleasepoolçš„ä½¿ç”¨åœºæ™¯/</id>
    <published>2018-07-17T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.861Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨å­¦ä¹ å¤§ä½¬åšå®¢çš„æ—¶å€™çœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä¸‹é¢ä»£ç ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// largeNumberæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; largeNumber; i++) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"hello -%04d"</span>, i];</span><br><span class="line">    str = [str stringByAppendingString:<span class="string">@" - world"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆšå¼€å§‹æ²¡çœ‹å‡ºä»€ä¹ˆé—®é¢˜ï¼Œå°±æ˜¯æ™®é€šçš„å¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯åˆ›å»ºä¸€ä¸ªå±€éƒ¨å˜é‡<code>NSString</code>ã€‚äºæ˜¯å†™äº†ä¸ªDemoéªŒè¯äº†ä¸‹ï¼Œåœ¨è§‚å¯Ÿå†…å­˜çš„æ—¶å€™å‘ç°äº†ç«¯å€ªï¼Œåœ¨å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä¸æ–­é£™å‡ã€‚</p><p><img src="/images/15318782609811.jpg" alt="15318782609811"></p><p>é¡¿æ—¶æ˜ç™½äº†ï¼ŒåŸæ¥é—®é¢˜çš„å…³é”®å°±æ˜¯è¿™ä¸ª<code>largeNumber</code>ï¼Œå½“å¾ªç¯æ­¤æ—¶å¾ˆå¤§æ—¶ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡çš„å±€éƒ¨å˜é‡ï¼Œè€Œä¸”å¾—ä¸åˆ°é‡Šæ”¾ï¼Œäºæ˜¯å†…å­˜å°±çˆ†äº†ã€‚è¿™æ—¶å€™å°±è¯¥<code>@autoreleasepool</code>ä¸Šåœºäº†ï¼Œä¼˜åŒ–åä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; largeNumber; i++) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *str = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"hello -%04d"</span>, i];</span><br><span class="line">        str = [str stringByAppendingString:<span class="string">@" - world"</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿è¡Œå†…å­˜ï¼Œå¯ä»¥çœ‹åˆ°éå¸¸å¹³ç¨³ã€‚</p><p><img src="/images/15318784002251.jpg" alt="15318784002251"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©åœ¨å­¦ä¹ å¤§ä½¬åšå®¢çš„æ—¶å€™çœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä¸‹é¢ä»£ç ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>UITabbarè‡ªå®šä¹‰Badge</title>
    <link href="https://crmo.github.io/2018/07/10/UITabbar%E8%87%AA%E5%AE%9A%E4%B9%89Badge/"/>
    <id>https://crmo.github.io/2018/07/10/UITabbarè‡ªå®šä¹‰Badge/</id>
    <published>2018-07-09T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.882Z</updated>
    
    <content type="html"><![CDATA[<p>tabBarItemçš„Badgeé»˜è®¤æ ·å¼æ˜¯å¸¦æ•°å­—çš„ï¼Œä½†æ˜¯äº§å“è¦æ±‚åªè¦ä¸€ä¸ªå°çº¢ç‚¹ï¼Œä¸éœ€è¦æ•°å­—ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰Badgeäº†ã€‚</p><p>ç”¨Revealåˆ†æUITabBarï¼Œå‘ç°æ¯ä¸ªæŒ‰é’®æ˜¯ä¸€ä¸ª<code>UITabBarButton</code>ï¼Œå±‚çº§å¦‚ä¸‹ï¼š</p><blockquote><p>-UITabBarButton<br>â€“UITabBarSwappableImageView // å›¾æ ‡<br>â€“UITabBarButtonLabel // æ–‡å­—</p></blockquote><p>å¦‚ä½•ä»<code>UITabBar</code>ä¸­æ‰¾åˆ°å¯¹åº”indexçš„<code>UITabBarButton</code>å‘¢ï¼Ÿæˆ‘ä»¬æ–­ç‚¹è°ƒè¯•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å¯ä»¥ç›´æ¥ä»<code>UITabBar</code>ä¸­ç”¨KVCå–å‡ºã€‚</p><p><img src="/images/QQ20180711-174329.png" alt="QQ20180711-174329"></p><p>å®ç°æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li>ç”¨KVCæ‰¾åˆ°UITabBarSwappableImageViewï¼Œå…³é”®å‡½æ•°<code>__iconViewWithIndex</code></li><li>æ–°å»ºBadgeï¼ŒåŠ åˆ°UITabBarSwappableImageViewä¸Š</li><li>æ–°å»ºBadgeçš„æ—¶å€™è®¾ç½®Tagï¼Œé€šè¿‡Tagæ¥ç§»é™¤Badge</li></ul><p>ä¸Šä»£ç </p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSInteger</span> <span class="keyword">const</span> kBadgeViewTagBase = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UITabBar</span> (<span class="title">badge</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºBadge</span></span><br><span class="line">- (<span class="keyword">void</span>)showBadgeOnItemIndex:(<span class="keyword">int</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.items.count) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœä¹‹å‰æ·»åŠ è¿‡ï¼Œç›´æ¥è®¾ç½®hiddenä¸ºNO</span></span><br><span class="line">    <span class="built_in">UIView</span> *icon = [<span class="keyword">self</span> __iconViewWithIndex:index];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *subView <span class="keyword">in</span> icon.subviews) &#123;</span><br><span class="line">        <span class="keyword">if</span> (subView.tag == kBadgeViewTagBase) &#123;</span><br><span class="line">            subView.hidden = <span class="literal">NO</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIView</span> *badgeView = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line">    badgeView.tag = kBadgeViewTagBase;</span><br><span class="line">    badgeView.layer.cornerRadius = <span class="number">5</span>;</span><br><span class="line">    badgeView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    badgeView.frame = <span class="built_in">CGRectMake</span>(icon.frame.size.width - <span class="number">5</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">9</span>);</span><br><span class="line">    [icon addSubview:badgeView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšè—Badge</span></span><br><span class="line">- (<span class="keyword">void</span>)hideBadgeOnItemIndex:(<span class="keyword">int</span>)index &#123;</span><br><span class="line">    <span class="built_in">UIView</span> *icon = [<span class="keyword">self</span> __iconViewWithIndex:index];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *subView <span class="keyword">in</span> icon.subviews) &#123;</span><br><span class="line">        <span class="keyword">if</span> (subView.tag == kBadgeViewTagBase) &#123;</span><br><span class="line">            subView.hidden = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å›¾æ ‡æ‰€åœ¨View</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)__iconViewWithIndex:(<span class="keyword">int</span>)index &#123;</span><br><span class="line">    <span class="built_in">UITabBarItem</span> *item = <span class="keyword">self</span>.items[index];</span><br><span class="line">    <span class="built_in">UIView</span> *tabBarButton = [item valueForKey:<span class="string">@"_view"</span>];</span><br><span class="line">    <span class="built_in">UIView</span> *icon = [tabBarButton valueForKey:<span class="string">@"_info"</span>];</span><br><span class="line">    <span class="keyword">return</span> icon;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;tabBarItemçš„Badgeé»˜è®¤æ ·å¼æ˜¯å¸¦æ•°å­—çš„ï¼Œä½†æ˜¯äº§å“è¦æ±‚åªè¦ä¸€ä¸ªå°çº¢ç‚¹ï¼Œä¸éœ€è¦æ•°å­—ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰Badgeäº†ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨Revealåˆ†æUITabBarï¼Œå‘ç°æ¯ä¸ªæŒ‰é’®æ˜¯ä¸€ä¸ª&lt;code&gt;UITabBarButton&lt;/code&gt;ï¼Œå±‚çº§å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;b
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æ–‡å­—é•¿åº¦</title>
    <link href="https://crmo.github.io/2018/07/09/%E8%AE%A1%E7%AE%97%E6%96%87%E5%AD%97%E9%95%BF%E5%BA%A6/"/>
    <id>https://crmo.github.io/2018/07/09/è®¡ç®—æ–‡å­—é•¿åº¦/</id>
    <published>2018-07-08T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.871Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://developer.apple.com/documentation/foundation/nsstring/1524729-boundingrectwithsize?language=occ" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p></blockquote><h2 id="æ–¹æ³•å®šä¹‰"><a href="#æ–¹æ³•å®šä¹‰" class="headerlink" title="æ–¹æ³•å®šä¹‰"></a>æ–¹æ³•å®šä¹‰</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSRect</span>)boundingRectWithSize:(<span class="built_in">NSSize</span>)size </span><br><span class="line">                       options:(<span class="built_in">NSStringDrawingOptions</span>)options </span><br><span class="line">                    attributes:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSAttributedStringKey</span>, <span class="keyword">id</span>&gt; *)attributes </span><br><span class="line">                       context:(<span class="built_in">NSStringDrawingContext</span> *)context;</span><br></pre></td></tr></table></figure><h2 id="å‚æ•°å®šä¹‰"><a href="#å‚æ•°å®šä¹‰" class="headerlink" title="å‚æ•°å®šä¹‰"></a>å‚æ•°å®šä¹‰</h2><h3 id="size"><a href="#size" class="headerlink" title="size"></a>size</h3><p>ç»˜åˆ¶çš„é™åˆ¶sizeï¼Œè®¡ç®—å‡ºæ¥çš„å€¼ä¸ä¼šè¶…è¿‡è¿™ä¸ªå¤§å°ã€‚</p><h3 id="options"><a href="#options" class="headerlink" title="options"></a>options</h3><p>ä¸€äº›é…ç½®é¡¹ã€‚å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSInteger</span>, <span class="built_in">NSStringDrawingOptions</span>) &#123;</span><br><span class="line">    <span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span> = <span class="number">1</span> &lt;&lt; <span class="number">0</span>, <span class="comment">// The specified origin is the line fragment origin, not the base line origin</span></span><br><span class="line">    <span class="built_in">NSStringDrawingUsesFontLeading</span> = <span class="number">1</span> &lt;&lt; <span class="number">1</span>, <span class="comment">// Uses the font leading for calculating line heights</span></span><br><span class="line">    <span class="built_in">NSStringDrawingUsesDeviceMetrics</span> = <span class="number">1</span> &lt;&lt; <span class="number">3</span>, <span class="comment">// Uses image glyph bounds instead of typographic bounds</span></span><br><span class="line">    <span class="built_in">NSStringDrawingTruncatesLastVisibleLine</span> <span class="built_in">NS_ENUM_AVAILABLE</span>(<span class="number">10</span>_5, <span class="number">6</span>_0) = <span class="number">1</span> &lt;&lt; <span class="number">5</span>, <span class="comment">// Truncates and adds the ellipsis character to the last visible line if the text doesn't fit into the bounds specified. Ignored if NSStringDrawingUsesLineFragmentOrigin is not also set.</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="built_in">NS_ENUM_AVAILABLE</span>(<span class="number">10</span>_0, <span class="number">6</span>_0);</span><br></pre></td></tr></table></figure><p>å®é™…æµ‹è¯•ä½¿ç”¨<code>NSStringDrawingUsesLineFragmentOrigin|NSStringDrawingUsesFontLeading</code>å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œ<code>NSStringDrawingUsesLineFragmentOrigin</code>æ˜¯å¿…é¡»çš„ï¼Œ<code>NSStringDrawingUsesFontLeading</code>åŠ ä¸åŠ åœ¨æµ‹è¯•çš„æ—¶å€™æ²¡å‘ç°åŒºåˆ«ï¼Œä½†æ˜¯åœ¨<a href="https://stackoverflow.com/questions/13621084/boundingrectwithsize-for-nsattributedstring-returning-wrong-size/15399767#15399767" target="_blank" rel="noopener">stackoverflowç›¸å…³è®¨è®º</a>é‡ŒåŠ ä¸Šäº†ï¼Œç•™ä¸ªå‘ï¼Œåé¢çŸ¥é“ä¸ºä»€ä¹ˆäº†æ¥è¡¥å……å§ã€‚</p><h3 id="attributes"><a href="#attributes" class="headerlink" title="attributes"></a>attributes</h3><p>å­—ä½“</p><h3 id="context"><a href="#context" class="headerlink" title="context"></a>context</h3><p>ä¸Šä¸‹æ–‡</p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol><li>å¦‚æœæ˜¯å¤šè¡Œæ–‡å­—ï¼Œoptionsè¦åŠ ä¸Š<code>NSStringDrawingUsesLineFragmentOrigin</code></li><li>è¿”å›çš„å€¼æ˜¯å°æ•°ï¼Œéœ€è¦è°ƒç”¨<code>ceil</code>å‘ä¸Šå–æ•´</li><li>å¾—åˆ°çš„å®½åº¦å¯èƒ½æ¯”å®é™…å®½</li></ol><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">CGSize</span>)getTextLabelSize:(<span class="built_in">NSString</span> *)message &#123;</span><br><span class="line">    <span class="keyword">if</span> ([message length] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// æ–‡æœ¬æ¡†çš„æœ€å¤§å®½åº¦</span></span><br><span class="line">        <span class="keyword">float</span> maxWidth = <span class="number">200</span>;</span><br><span class="line">        <span class="built_in">CGRect</span> textRect = [message</span><br><span class="line">                           boundingRectWithSize:<span class="built_in">CGSizeMake</span>(maxWidth, <span class="built_in">CGFLOAT_MAX</span>)</span><br><span class="line">                           options:(<span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span> |</span><br><span class="line">                                    <span class="built_in">NSStringDrawingUsesFontLeading</span>)</span><br><span class="line">                           attributes:@&#123;</span><br><span class="line">                                        <span class="built_in">NSFontAttributeName</span> :</span><br><span class="line">                                            [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">16</span>]</span><br><span class="line">                                        &#125;</span><br><span class="line">                           context:<span class="literal">nil</span>];</span><br><span class="line">        textRect.size.height = ceilf(textRect.size.height);</span><br><span class="line">        textRect.size.width = ceilf(textRect.size.width);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">CGSizeMake</span>(textRect.size.width, textRect.size.height);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">CGSizeZero</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/documentation/foundation/nsstring/1524729-boundingrectwithsize?language=occ&quot; target=&quot;_b
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>UITextFieldæ§åˆ¶è¾“å…¥é•¿åº¦</title>
    <link href="https://crmo.github.io/2018/07/06/UITextField%E6%8E%A7%E5%88%B6%E8%BE%93%E5%85%A5%E9%95%BF%E5%BA%A6/"/>
    <id>https://crmo.github.io/2018/07/06/UITextFieldæ§åˆ¶è¾“å…¥é•¿åº¦/</id>
    <published>2018-07-05T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.894Z</updated>
    
    <content type="html"><![CDATA[<p>æœ‰äº›æ—¶å€™ä¼šæœ‰æ§åˆ¶è¾“å…¥æ¡†æ–‡å­—é•¿åº¦çš„éœ€æ±‚ï¼Œè®°å½•ä¸€ä¸ªç®€å•çš„æ€è·¯ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string &#123;</span><br><span class="line">    <span class="keyword">if</span> (string.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSInteger</span> limit = <span class="number">15</span>; <span class="comment">// æ–‡æœ¬çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line">    <span class="built_in">NSString</span> *newStr = [textField.text stringByAppendingString:string]; <span class="comment">// ä¿®æ”¹ä¹‹åçš„æ–°å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="built_in">NSInteger</span> newStrLength = newStr.length;</span><br><span class="line">    newStrLength -= [textField textInRange:[textField markedTextRange]].length; <span class="comment">// å»æ‰é«˜äº®å†…å®¹ï¼Œè¾“å…¥ä¸­æ–‡æ‹¼éŸ³çš„æƒ…å†µ</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (newStrLength &gt; limit) &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†composed character, æ¯”å¦‚emoji</span></span><br><span class="line">        <span class="built_in">NSString</span> *tempStr = [newStr substringWithRange:[newStr rangeOfComposedCharacterSequencesForRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, limit)]];</span><br><span class="line">        textField.text = tempStr;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ä¸ªå‘æ³¨æ„ä¸‹ï¼š</p><ol><li>emojiæ˜¯<code>composed character</code>ï¼Œå®ƒæ˜¯ç”±å¤šä¸ªå­—ç¬¦ç»„åˆï¼Œé•¿åº¦ä¸æ˜¯1ã€‚æœ€å¼€å§‹ç”¨çš„<code>substringToIndex</code>ä¼šå¯¼è‡´æœ€åä¸€ä¸ªemojiä¹±ç ã€‚</li><li>è®¡ç®—é•¿åº¦çš„æ—¶å€™è¦å»æ‰ä¸­æ–‡è¾“å…¥çš„æ—¶å€™é«˜äº®éƒ¨åˆ†</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ‰äº›æ—¶å€™ä¼šæœ‰æ§åˆ¶è¾“å…¥æ¡†æ–‡å­—é•¿åº¦çš„éœ€æ±‚ï¼Œè®°å½•ä¸€ä¸ªç®€å•çš„æ€è·¯ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>property or synthsize</title>
    <link href="https://crmo.github.io/2018/07/05/property%20or%20synthsize/"/>
    <id>https://crmo.github.io/2018/07/05/property or synthsize/</id>
    <published>2018-07-04T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.910Z</updated>
    
    <content type="html"><![CDATA[<p>@property (nonatomic, retain) NSObject *var;</p><ul><li>ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„æ–¹æ³•å£°æ˜</li><li>ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„å®ç°ï¼ˆ<strong>æ—©æœŸç‰ˆæœ¬ç¼–è¯‘å™¨ä¸ç”Ÿæˆ</strong>ï¼‰</li><li>ç”Ÿæˆæˆå‘˜å˜é‡_varï¼ˆ<strong>æ—©æœŸç‰ˆæœ¬ç¼–è¯‘å™¨ä¸ç”Ÿæˆ</strong>ï¼‰</li></ul><p>@synthsize var = _var</p><ul><li>ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„å®ç°</li><li>ç”Ÿæˆvarå¯¹åº”çš„æˆå‘˜å˜é‡_var</li></ul><blockquote><p>mrcå¹´ä»£çš„getã€setæ–¹æ³•çš„å†™æ³•</p></blockquote><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setVar:(<span class="built_in">NSObject</span> *)var &#123;</span><br><span class="line">    <span class="keyword">if</span> (_var != var) &#123; <span class="comment">// å¦‚æœå¤šæ¬¡setåŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœä¸åˆ¤æ–­ä¼šå¯¼è‡´å¯¹è±¡è¢«é‡Šæ”¾</span></span><br><span class="line">        <span class="comment">// é‡Šæ”¾ä¹‹å‰çš„var</span></span><br><span class="line">        [_var release];</span><br><span class="line">        _var = [var <span class="keyword">retain</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSObject</span> *)var &#123;</span><br><span class="line">    <span class="keyword">return</span> _var;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;@property (nonatomic, retain) NSObject *var;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„æ–¹æ³•å£°æ˜&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆvarçš„setã€getæ–¹æ³•çš„å®ç°ï¼ˆ&lt;strong&gt;æ—©æœŸç‰ˆæœ¬ç¼–è¯‘å™¨ä¸ç”Ÿæˆ&lt;/strong&gt;ï¼‰&lt;/
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>Tagged Pointerå°è®°</title>
    <link href="https://crmo.github.io/2018/07/04/Tagged%20Pointer%E5%B0%8F%E8%AE%B0/"/>
    <id>https://crmo.github.io/2018/07/04/Tagged Pointerå°è®°/</id>
    <published>2018-07-03T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.998Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä½¿ç”¨çš„æµ‹è¯•ç¯å¢ƒæ˜¯arm64æ¶æ„çœŸæœº</p></blockquote><p>ä¸ºäº†æ¢ç©¶Tagged Pointeræœ¬è´¨ï¼Œå¯ä»¥æŸ¥çœ‹runtimeæºç ï¼Œä¸»è¦çœ‹æ–‡ä»¶<code>objc-internal.h</code>ã€‚</p><h2 id="å®å®šä¹‰"><a href="#å®å®šä¹‰" class="headerlink" title="å®å®šä¹‰"></a>å®å®šä¹‰</h2><p>å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å®å®šä¹‰ï¼Œåªæœ‰åœ¨64ä½ç³»ç»Ÿæ‰æ”¯æŒ<code>Tagged Pointer</code>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __LP64__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OBJC_HAVE_TAGGED_POINTERS 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>64-bitçš„macï¼Œtagå­˜å‚¨åœ¨LSBï¼ˆLeast Significant Bit æœ€ä½ä½ï¼‰ã€‚å…¶å®ƒæƒ…å†µæ¯”å¦‚64ä½çš„çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ï¼Œtagå­˜å‚¨åœ¨MSBï¼ˆMost Significant Bit æœ€é«˜ä½ï¼‰ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#if TARGET_OS_OSX &amp;&amp; __x86_64__</span></span><br><span class="line">    <span class="comment">// 64-bit Mac - tag bit is LSB</span></span><br><span class="line"><span class="meta">#   define OBJC_MSB_TAGGED_POINTERS 0</span></span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">    <span class="comment">// Everything else - tag bit is MSB</span></span><br><span class="line"><span class="meta">#   define OBJC_MSB_TAGGED_POINTERS 1</span></span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#if OBJC_MSB_TAGGED_POINTERS</span></span><br><span class="line"><span class="meta">#   define _OBJC_TAG_MASK (1UL<span class="meta-string">&lt;&lt;63)</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_INDEX_SHIFT 60</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_SLOT_SHIFT 60</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_PAYLOAD_LSHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_PAYLOAD_RSHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_MASK (0xfUL&lt;&lt;60)</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_INDEX_SHIFT 52</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_SLOT_SHIFT 52</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_PAYLOAD_LSHIFT 12</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_PAYLOAD_RSHIFT 12</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#else</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_MASK 1UL</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_INDEX_SHIFT 1</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_SLOT_SHIFT 0</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_PAYLOAD_LSHIFT 0</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_PAYLOAD_RSHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_MASK 0xfUL</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_INDEX_SHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_SLOT_SHIFT 4</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_PAYLOAD_LSHIFT 0</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#   define _OBJC_TAG_EXT_PAYLOAD_RSHIFT 12</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">#endif</span></span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªæšä¸¾å®šä¹‰ï¼Œå®šä¹‰äº†é»˜è®¤çš„ä½¿ç”¨<code>Tagged Pointer</code>çš„ç±»ã€‚ä¾‹å¦‚NSStringã€NSNumberã€NSIndexPathã€NSDateï¼ˆOBJC_TAG_NSAtomã€OBJC_TAG_1ã€OBJC_TAG_NSManagedObjectIDä¸çŸ¥é“æ˜¯å•¥æ„æ€ï¼Œè¿˜è¯·çŸ¥é“çš„åŒå­¦å‘Šè¯‰æˆ‘ï¼‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="keyword">objc_tag_index_t</span> : <span class="keyword">uint16_t</span></span><br><span class="line"><span class="keyword">enum</span></span><br><span class="line">&#123;</span><br><span class="line">    OBJC_TAG_NSAtom            = <span class="number">0</span>, </span><br><span class="line">    OBJC_TAG_1                 = <span class="number">1</span>, </span><br><span class="line">    OBJC_TAG_NSString          = <span class="number">2</span>, </span><br><span class="line">    OBJC_TAG_NSNumber          = <span class="number">3</span>, </span><br><span class="line">    OBJC_TAG_NSIndexPath       = <span class="number">4</span>, </span><br><span class="line">    OBJC_TAG_NSManagedObjectID = <span class="number">5</span>, </span><br><span class="line">    OBJC_TAG_NSDate            = <span class="number">6</span>, </span><br><span class="line">    OBJC_TAG_RESERVED_7        = <span class="number">7</span>, </span><br><span class="line"></span><br><span class="line">    OBJC_TAG_First60BitPayload = <span class="number">0</span>, </span><br><span class="line">    OBJC_TAG_Last60BitPayload  = <span class="number">6</span>, </span><br><span class="line">    OBJC_TAG_First52BitPayload = <span class="number">8</span>, </span><br><span class="line">    OBJC_TAG_Last52BitPayload  = <span class="number">263</span>, </span><br><span class="line"></span><br><span class="line">    OBJC_TAG_RESERVED_264      = <span class="number">264</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•å®šä¹‰"><a href="#æ–¹æ³•å®šä¹‰" class="headerlink" title="æ–¹æ³•å®šä¹‰"></a>æ–¹æ³•å®šä¹‰</h2><p>åˆ¤æ–­æ˜¯ä¸æ˜¯<code>Tagged Pointer</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">bool</span></span><br><span class="line">_objc_isTaggedPointer(<span class="keyword">const</span> <span class="keyword">void</span> * _Nullable ptr) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> ((uintptr_t)ptr &amp; _OBJC_TAG_MASK) == _OBJC_TAG_MASK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆä¸€ä¸ª<code>Tagged Pointer</code>ï¼Œæœ€é«˜çš„4ä½æ˜¯taggedï¼Œå‰©ä¸‹çš„æ˜¯æ•°æ®</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> * _Nonnull</span><br><span class="line">_objc_makeTaggedPointer(objc_tag_index_t tag, uintptr_t value)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (tag &lt;= OBJC_TAG_Last60BitPayload) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">void</span> *)</span><br><span class="line">            (_OBJC_TAG_MASK | </span><br><span class="line">             ((uintptr_t)tag &lt;&lt; _OBJC_TAG_INDEX_SHIFT) | </span><br><span class="line">             ((value &lt;&lt; _OBJC_TAG_PAYLOAD_RSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_LSHIFT));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">void</span> *)</span><br><span class="line">            (_OBJC_TAG_EXT_MASK |</span><br><span class="line">             ((uintptr_t)(tag - OBJC_TAG_First52BitPayload) &lt;&lt; _OBJC_TAG_EXT_INDEX_SHIFT) |</span><br><span class="line">             ((value &lt;&lt; _OBJC_TAG_EXT_PAYLOAD_RSHIFT) &gt;&gt; _OBJC_TAG_EXT_PAYLOAD_LSHIFT));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»<code>Tagged Pointer</code>ä¸­å–å‡ºå€¼</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> uintptr_t</span><br><span class="line">_objc_getTaggedPointerValue(<span class="keyword">const</span> <span class="keyword">void</span> * _Nullable ptr) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// assert(_objc_isTaggedPointer(ptr));</span></span><br><span class="line">    uintptr_t basicTag = ((uintptr_t)ptr &gt;&gt; _OBJC_TAG_INDEX_SHIFT) &amp; _OBJC_TAG_INDEX_MASK;</span><br><span class="line">    <span class="keyword">if</span> (basicTag == _OBJC_TAG_INDEX_MASK) &#123;</span><br><span class="line">        <span class="keyword">return</span> ((uintptr_t)ptr &lt;&lt; _OBJC_TAG_EXT_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_EXT_PAYLOAD_RSHIFT;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((uintptr_t)ptr &lt;&lt; _OBJC_TAG_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_RSHIFT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="NSNumberåº”ç”¨ä¸¾ä¾‹"><a href="#NSNumberåº”ç”¨ä¸¾ä¾‹" class="headerlink" title="NSNumberåº”ç”¨ä¸¾ä¾‹"></a>NSNumberåº”ç”¨ä¸¾ä¾‹</h2><p>å¯ä»¥ä½¿ç”¨ä¸‹é¢ä»£ç æ¥éªŒè¯NSNumberå¦‚ä½•ä½¿ç”¨<code>Tagged Pointer</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSNumber</span> *charNumber = [<span class="built_in">NSNumber</span> numberWithChar:<span class="string">'1'</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *shortNumber = [<span class="built_in">NSNumber</span> numberWithShort:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *intNumber = [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *floatNumber = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">1.0</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *longNumber = [<span class="built_in">NSNumber</span> numberWithLong:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *doubleNumber = [<span class="built_in">NSNumber</span> numberWithDouble:<span class="number">1.0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºå˜é‡çš„æŒ‡é’ˆåœ°å€ï¼š</span></span><br><span class="line"><span class="comment">// charNumber 0xb000000000000310</span></span><br><span class="line"><span class="comment">// shortNumber 0xb000000000000011</span></span><br><span class="line"><span class="comment">// intNumber 0xb000000000000012</span></span><br><span class="line"><span class="comment">// floatNumber 0xb000000000000014</span></span><br><span class="line"><span class="comment">// longNumber 0xb000000000000013</span></span><br><span class="line"><span class="comment">// doubleNumber 0xb000000000000015</span></span><br></pre></td></tr></table></figure><p>ä¸éš¾å‘ç°è§„å¾‹ï¼Œéƒ½æ˜¯ä»¥b(1011)å¼€å¤´</p><ul><li>æœ€é«˜ä½æ˜¯1ï¼Œè¯´æ˜è¿™ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ª<code>Tagged Pointer</code></li><li>ç¬¬61-63ä½æ˜¯11ï¼ˆåè¿›åˆ¶æ˜¯3ï¼‰ï¼Œä¹Ÿå°±æ˜¯<code>OBJC_TAG_NSNumber</code>ï¼ˆæŸ¥ä¸Šé¢çš„æšä¸¾ï¼‰</li><li>ç¬¬1-4ä½æ˜¯NSNumberçš„ç±»å‹ï¼šæ¯”å¦‚ï¼Œcharæ˜¯0ã€shortæ˜¯1ã€intæ˜¯2ã€floatæ˜¯4</li><li>å‰©ä¸‹çš„56ä½å°±æ˜¯çœŸæ­£çš„å€¼äº†</li></ul><h2 id="NSStringåº”ç”¨ä¸¾ä¾‹"><a href="#NSStringåº”ç”¨ä¸¾ä¾‹" class="headerlink" title="NSStringåº”ç”¨ä¸¾ä¾‹"></a>NSStringåº”ç”¨ä¸¾ä¾‹</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str1 = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"a"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *str2 = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"ab"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºå˜é‡çš„æŒ‡é’ˆåœ°å€ï¼š</span></span><br><span class="line"><span class="comment">// str1: 0xa000000000000611</span></span><br><span class="line"><span class="comment">// str2: 0xa000000000062612</span></span><br></pre></td></tr></table></figure><p>ä¸NSNumberç±»ä¼¼</p><ul><li>æœ€é«˜ä½æ˜¯1ï¼Œè¯´æ˜è¿™ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ª<code>Tagged Pointer</code></li><li>ç¬¬61-63ä½æ˜¯11ï¼ˆåè¿›åˆ¶æ˜¯2ï¼‰ï¼Œä¹Ÿå°±æ˜¯<code>OBJC_TAG_NSString</code></li><li>ç¬¬1-4ä½æ˜¯å­—ç¬¦ä¸²é•¿åº¦</li><li>å‰©ä¸‹çš„56ä½å°±æ˜¯çœŸæ­£çš„å€¼äº†</li></ul><blockquote><p>æ›´å¤šç»†èŠ‚æ¨èè¿™ç¯‡æ–‡ç« <a href="http://www.cocoachina.com/ios/20150918/13449.html" target="_blank" rel="noopener">é‡‡ç”¨Tagged Pointerçš„å­—ç¬¦ä¸²</a></p></blockquote><hr><p>å‚è€ƒæ–‡ç« </p><ul><li><a href="https://www.jianshu.com/p/e354f9137ba8" target="_blank" rel="noopener">iOS Tagged Pointer</a></li><li><a href="https://en.wikipedia.org/wiki/Tagged_pointer" target="_blank" rel="noopener">wiki</a></li><li><a href="http://www.infoq.com/cn/articles/deep-understanding-of-tagged-pointer" target="_blank" rel="noopener">æ·±å…¥ç†è§£Tagged Pointer</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„æµ‹è¯•ç¯å¢ƒæ˜¯arm64æ¶æ„çœŸæœº&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸ºäº†æ¢ç©¶Tagged Pointeræœ¬è´¨ï¼Œå¯ä»¥æŸ¥çœ‹runtimeæºç ï¼Œä¸»è¦çœ‹æ–‡ä»¶&lt;code&gt;objc-internal.h&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>URLWithString return nil</title>
    <link href="https://crmo.github.io/2018/07/03/URLWithString%20return%20nil/"/>
    <id>https://crmo.github.io/2018/07/03/URLWithString return nil/</id>
    <published>2018-07-02T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:38.010Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨ä½¿ç”¨<code>URLWithString</code>ç”ŸæˆNSURLæ—¶ï¼Œå¦‚æœå‡ºç°ä¸­æ–‡ï¼Œä¼šå¯¼è‡´è¿”å›çš„NSURLä¸ºnilã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSURL *aUrl = [NSURL URLWithString:@&quot;http://ä¸­æ–‡åŸŸå&quot;];</span><br></pre></td></tr></table></figure><p><a href="https://stackoverflow.com/questions/1981390/urlwithstring-returns-nil" target="_blank" rel="noopener">stackoverflowç›¸å…³è®¨è®º</a></p><p>æŸ¥è¯¢äº†<a href="https://developer.apple.com/documentation/foundation/nsurl/1572047-urlwithstring?changes=_1&amp;language=objc" target="_blank" rel="noopener">URLWithStringçš„å®˜æ–¹æ–‡æ¡£</a>ï¼Œå…¶ä¸­æœ‰ä¸€æ®µè¯è§£å†³äº†æˆ‘çš„ç–‘æƒ‘ã€‚</p><blockquote><p>This method expects URLString to contain only characters that are allowed in a properly formed URL. All other characters must be properly percent escaped. Any percent-escaped characters are interpreted using UTF-8 encoding.</p></blockquote><p>æ„æ€å°±æ˜¯è¯¥æ–¹æ³•çš„è¾“å…¥å‚æ•°<code>URLString</code>åªèƒ½åŒ…å«URLçš„åˆæ³•å­—ç¬¦ï¼ŒåŒ…å«éæ³•å­—ç¬¦çš„URLéœ€è¦è¿›è¡Œç™¾åˆ†å·ç¼–ç (percent escaped)</p><h2 id="ç™¾åˆ†å·ç¼–ç ï¼ˆpercent-escapedï¼‰"><a href="#ç™¾åˆ†å·ç¼–ç ï¼ˆpercent-escapedï¼‰" class="headerlink" title="ç™¾åˆ†å·ç¼–ç ï¼ˆpercent escapedï¼‰"></a>ç™¾åˆ†å·ç¼–ç ï¼ˆpercent escapedï¼‰</h2><p><a href="https://zh.wikipedia.org/wiki/ç™¾åˆ†å·ç¼–ç " target="_blank" rel="noopener">wikiç›¸å…³è¯æ¡</a></p><p>æœ‰ä¸¤ç§æƒ…å†µå¿…é¡»ä½¿ç”¨ç™¾åˆ†å·ç¼–ç </p><ol><li>å‚æ•°ä¸­å‡ºç°ä¿ç•™å­—ç¬¦</li></ol><p>URLæ‰€å…è®¸çš„å­—ç¬¦åˆ†ä½œä¿ç•™ä¸æœªä¿ç•™ï¼Œä¿ç•™å­—ç¬¦æ˜¯é‚£äº›å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦</p><p><img src="/images/15305867541997.jpg" alt=""></p><ol><li>URLä¸­å‡ºç°éASCIIå­—ç¬¦</li></ol><p>å¯¹äºéASCIIå­—ç¬¦, éœ€è¦è½¬æ¢ä¸ºUTF-8å­—èŠ‚åºï¼Œå†è¿›è¡Œç™¾åˆ†å·ç¼–ç </p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ä½¿ç”¨æ–¹æ³•<code>stringByAddingPercentEscapesUsingEncoding</code>å¯¹URLå­—ç¬¦ä¸²ç™¾åˆ†å·ç¼–ç ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSString *encodeUrl = [url stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">    NSURL *aUrl = [NSURL URLWithString:encodeUrl];</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;åœ¨ä½¿ç”¨&lt;code&gt;URLWithString&lt;/code&gt;ç”ŸæˆNSURLæ—¶ï¼Œå¦‚æœå‡ºç°ä¸­æ–‡ï¼Œä¼šå¯¼è‡´è¿”å›çš„NSURLä¸ºnilã€‚ä»£
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>iOSæ¶ˆæ¯è½¬å‘å°è®°</title>
    <link href="https://crmo.github.io/2018/05/31/iOS%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91%E5%B0%8F%E8%AE%B0/"/>
    <id>https://crmo.github.io/2018/05/31/iOSæ¶ˆæ¯è½¬å‘å°è®°/</id>
    <published>2018-05-30T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:38.021Z</updated>
    
    <content type="html"><![CDATA[<p>æ¶ˆæ¯è½¬å‘æµç¨‹å›¾</p><p><img src="/images/15277558865032.jpg" alt=""></p><p>å¦‚æœç±»æ¥æ”¶åˆ°æ— æ³•å¤„ç†çš„æ¶ˆæ¯ï¼Œä¼šè§¦å‘æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼Œæ¥å—è€…åœ¨æ¯ä¸€æ­¥ä¸­å‡æœ‰æœºä¼šå¤„ç†æ¶ˆæ¯ã€‚æ­¥éª¤è¶Šå¾€åï¼Œå¤„ç†æ¶ˆæ¯çš„ä»£ä»·å°±è¶Šå¤§ï¼Œæ‰€ä»¥æœ€å¥½å†ç¬¬ä¸€æ­¥å°±å¤„ç†å®Œã€‚</p><h2 id="ç¬¬ä¸€é“é˜²çº¿"><a href="#ç¬¬ä¸€é“é˜²çº¿" class="headerlink" title="ç¬¬ä¸€é“é˜²çº¿"></a>ç¬¬ä¸€é“é˜²çº¿</h2><p>åœ¨ç±»é‡Œé¢å®ç°ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç†æœªçŸ¥æ¶ˆæ¯ã€‚æ‰§è¡ŒåŠ¨æ€æ–¹æ³•è§£æä¹‹å‰ï¼Œå…ˆä¼šåˆ¤æ–­æ˜¯å¦æ›¾ç»æœ‰åŠ¨æ€è§£æã€‚</p><ul><li><code>resolveInstanceMethod</code>ï¼šå¤„ç†å®ä¾‹æ–¹æ³•</li><li><code>resolveClassMethod</code>ï¼šå¤„ç†ç±»æ–¹æ³•</li></ul><p>æˆ‘ä»¬æ¥çœ‹ä¸ªDemoï¼Œå…ˆçœ‹è°ƒç”¨æ–¹ä»£ç </p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TestA *testA = [[TestA alloc] init];</span><br><span class="line">[testA instanceMethod];</span><br><span class="line">[TestA classMethod];</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹çœ‹TestAçš„å®šä¹‰ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TestA.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TestA</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)instanceMethod;</span><br><span class="line">+ (<span class="keyword">void</span>)classMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TestA.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TestA</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)newInstanceMethod &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"newInstanceMethod"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)newClassMethod &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"newClassMethod"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line">    <span class="keyword">if</span> (sel == <span class="keyword">@selector</span>(instanceMethod)) &#123;</span><br><span class="line">        <span class="comment">// åŠ¨æ€æ·»åŠ æ–¹æ³•newInstanceMethod</span></span><br><span class="line">        Method method = class_getInstanceMethod([<span class="keyword">self</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(newInstanceMethod));</span><br><span class="line">        IMP imp = method_getImplementation(method);</span><br><span class="line">        class_addMethod([<span class="keyword">self</span> <span class="keyword">class</span>], sel, imp, method_getTypeEncoding(method));</span><br><span class="line">        <span class="comment">// æˆåŠŸå¤„ç†ï¼Œæ¶ˆæ¯è½¬å‘æœºåˆ¶ç»“æŸï¼Œè°ƒç”¨newInstanceMethod</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸èƒ½å¤„ç†ï¼Œè¿›å…¥ç¬¬äºŒæ­¥</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">BOOL</span>)resolveClassMethod:(SEL)sel &#123;</span><br><span class="line">    <span class="keyword">if</span> (sel == <span class="keyword">@selector</span>(classMethod)) &#123;</span><br><span class="line">        <span class="comment">// åŠ¨æ€æ·»åŠ æ–¹æ³•newClassMethod</span></span><br><span class="line">        Method method = class_getInstanceMethod(object_getClass(<span class="keyword">self</span>), <span class="keyword">@selector</span>(newClassMethod));</span><br><span class="line">        IMP imp = method_getImplementation(method);</span><br><span class="line">        class_addMethod(object_getClass(<span class="keyword">self</span>), sel, imp, method_getTypeEncoding(method));</span><br><span class="line">        <span class="comment">// æˆåŠŸå¤„ç†ï¼Œæ¶ˆæ¯è½¬å‘æœºåˆ¶ç»“æŸï¼Œè°ƒç”¨newClassMethod</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸èƒ½å¤„ç†ï¼Œè¿›å…¥ç¬¬äºŒæ­¥</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveClassMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><p>TestAä¸­å¤´æ–‡ä»¶å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰å®ç°ï¼Œå¦‚æœä¸ç”¨æ¶ˆæ¯è½¬å‘æœºåˆ¶å¤„ç†å¼‚å¸¸ï¼Œä¼šå¯¼è‡´crashï¼Œlogæƒ³å¿…å¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰</p><blockquote><p>*** Terminating app due to uncaught exception â€˜NSInvalidArgumentExceptionâ€™, reason: â€˜-[TestA funcA]: unrecognized selector sent to instance 0x6040000125c0â€™</p></blockquote><p>å®ä¾‹æ–¹æ³•å­˜å‚¨åœ¨ç±»å¯¹è±¡ï¼Œç±»æ–¹æ³•å­˜å‚¨åœ¨å…ƒç±»å¯¹è±¡ï¼Œåœ¨è°ƒç”¨<code>class_addMethod</code>æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ³¨æ„ã€‚</p><h2 id="ç¬¬äºŒé“é˜²çº¿"><a href="#ç¬¬äºŒé“é˜²çº¿" class="headerlink" title="ç¬¬äºŒé“é˜²çº¿"></a>ç¬¬äºŒé“é˜²çº¿</h2><p>ç¬¬äºŒé“é˜²çº¿ä¾èµ–ä¸€ä¸ªå‡½æ•°<code>forwardingTargetForSelector</code>ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»æ–¹æ³•</span></span><br><span class="line"><span class="comment">//+ (id)forwardingTargetForSelector:(SEL)aSelector &#123;</span></span><br><span class="line"><span class="comment">//    </span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line">- (<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(instanceMethod)) &#123;</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯è½¬å‘ç»™TestBå®ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> [TestB new];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯è½¬å‘å¤±è´¥ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TestB.m</span></span><br><span class="line">- (<span class="keyword">void</span>)instanceMethod &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"instanceMethod"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰é“é˜²çº¿"><a href="#ç¬¬ä¸‰é“é˜²çº¿" class="headerlink" title="ç¬¬ä¸‰é“é˜²çº¿"></a>ç¬¬ä¸‰é“é˜²çº¿</h2><p>ç¬¬ä¸‰é“é˜²çº¿æœ‰ä¸¤æ­¥</p><ol><li>è°ƒç”¨<code>methodSignatureForSelector</code>ï¼Œè·å–æ–°çš„æ–¹æ³•ç­¾åï¼ˆè¿”å›å€¼ç±»å‹ï¼Œå‚æ•°ç±»å‹ï¼‰</li><li>è°ƒç”¨<code>forwardInvocation</code>ï¼Œè½¬å‘æ¶ˆæ¯ï¼Œ</li></ol><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•ç­¾åï¼ˆè¿”å›å€¼ç±»å‹ï¼Œå‚æ•°ç±»å‹ï¼‰</span></span><br><span class="line"><span class="comment">// ç±»æ–¹æ³•å‡å·æ”¹ä¸ºåŠ å·</span></span><br><span class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="built_in">NSMethodSignature</span> *signature = [TestB instanceMethodSignatureForSelector:aSelector];</span><br><span class="line">    <span class="keyword">return</span> signature;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSInvocationå°è£…äº†æ–¹æ³•è°ƒç”¨ï¼ŒåŒ…æ‹¬ï¼šæ–¹æ³•è°ƒç”¨è€…ã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°</span></span><br><span class="line"><span class="comment">// anInvocation.target æ¶ˆæ¯æ¥å—è€…</span></span><br><span class="line"><span class="comment">// anInvocation.selector å‡½æ•°å</span></span><br><span class="line"><span class="comment">// [anInvocation getArgument:NULL atIndex:0]; è·å–å‚æ•°</span></span><br><span class="line"><span class="comment">// ç±»æ–¹æ³•å‡å·æ”¹ä¸ºåŠ å·</span></span><br><span class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation &#123;</span><br><span class="line">    [anInvocation invokeWithTarget:[TestB new]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ¶ˆæ¯è½¬å‘æµç¨‹å›¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/15277558865032.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœç±»æ¥æ”¶åˆ°æ— æ³•å¤„ç†çš„æ¶ˆæ¯ï¼Œä¼šè§¦å‘æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼Œæ¥å—è€…åœ¨æ¯ä¸€æ­¥ä¸­å‡æœ‰æœºä¼šå¤„ç†æ¶ˆæ¯ã€‚æ­¥éª¤è¶Šå¾€åï¼Œå¤„ç†æ¶ˆæ¯çš„ä»£ä»·å°±è¶Šå¤§ï¼Œæ‰€ä»¥æœ€
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>æ¢å¯»Objective-Cå¼•ç”¨è®¡æ•°æœ¬è´¨</title>
    <link href="https://crmo.github.io/2018/05/26/%E6%8E%A2%E5%AF%BBObjective-C%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%9C%AC%E8%B4%A8/"/>
    <id>https://crmo.github.io/2018/05/26/æ¢å¯»Objective-Cå¼•ç”¨è®¡æ•°æœ¬è´¨/</id>
    <published>2018-05-25T16:00:00.000Z</published>
    <updated>2018-10-07T08:16:32.324Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ¶‰åŠåˆ°çš„CPUæ¶æ„ä¸ºarm64ï¼Œå…¶å®ƒæ¶æ„å¤§åŒå°å¼‚ã€‚<br>æºç æ¥è‡ª<a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="noopener">è‹¹æœå¼€æº-runtime</a>ã€‚</p></blockquote><p>Objective-Cä¸­é‡‡ç”¨å¼•ç”¨è®¡æ•°æœºåˆ¶æ¥ç®¡ç†å†…å­˜ï¼Œåœ¨MRCæ—¶ä»£ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨<code>retain</code>å’Œ<code>release</code>ï¼Œåœ¨è‹¹æœå¼•å…¥ARCåå¤§éƒ¨åˆ†æ—¶é—´æˆ‘ä»¬ä¸ç”¨å†å…³å¿ƒå¼•ç”¨è®¡æ•°é—®é¢˜ã€‚ä½†æ˜¯ä¸ºäº†æ·±å…¥Objective-Cæœ¬è´¨ï¼Œå¼•ç”¨è®¡æ•°ç©¶ç«Ÿæ˜¯æ€ä¹ˆå®ç°çš„è¿˜æ˜¯å€¼å¾—æˆ‘ä»¬å»æ¢å¯»çš„ã€‚</p><h2 id="ISA"><a href="#ISA" class="headerlink" title="ISA"></a>ISA</h2><p>OCä¸­çš„å¯¹è±¡çš„å®è´¨å…¶å®æ˜¯ç»“æ„ä½“ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æœ‰isaï¼ŒæŒ‡å‘ç±»å¯¹è±¡ï¼ˆæœ‰ä¸€ç§ç¥å¥‡çš„å­˜åœ¨å«åš<code>Tagged Pointer</code>ï¼‰ï¼Œæºç ä¸­å…³äºå¯¹è±¡ç»“æ„ä½“<code>objc_object</code>å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// objc-private.h</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">isa_t</span> isa;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">id <span class="title">retain</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">id <span class="title">autorelease</span><span class="params">()</span></span>;</span><br><span class="line">    ... <span class="comment">//çœç•¥äº†å…¶å®ƒæ–¹æ³•ï¼Œæ„Ÿå…´è¶£å¯ä»¥ç›´æ¥çœ‹æºç </span></span><br></pre></td></tr></table></figure><h3 id="Tagged-Pointer"><a href="#Tagged-Pointer" class="headerlink" title="Tagged Pointer"></a>Tagged Pointer</h3><p>é™¤äº†æœ‰ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡<code>Tagged Pointer</code>ï¼Œè¿™ç§ç±»å‹çš„å¯¹è±¡å€¼å°±å­˜åœ¨æŒ‡é’ˆå½“ä¸­ï¼Œå­˜å–æ€§èƒ½é«˜ã€‚å¯ä»¥ç”¨æ¥å­˜å‚¨å°‘é‡æ•°æ®çš„å¯¹è±¡ï¼Œä¾‹å¦‚NSNumberã€NSDateã€NSStringã€‚(æ›´å¤šTagged PointerçŸ¥è¯†ï¼Œå…·ä½“çœ‹è¿™ç¯‡<a href="https://crmo.github.io/2018/07/04/Tagged%20Pointerå°è®°/">Tagged Pointerå°è®°</a>)ã€‚ä¹Ÿå°±æ²¡æœ‰å¼•ç”¨è®¡æ•°ã€å†…å­˜é‡Šæ”¾çš„é—®é¢˜ã€‚</p><h3 id="NONPOINTER-ISA"><a href="#NONPOINTER-ISA" class="headerlink" title="NONPOINTER ISA"></a>NONPOINTER ISA</h3><p>arm64æ¶æ„isaå 64ä½ï¼Œè‹¹æœä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå­˜å‚¨ç±»å¯¹è±¡åœ°å€åªç”¨äº†33ä½ï¼Œå‰©ä¸‹çš„ä½ç”¨æ¥å­˜å‚¨ä¸€äº›å…¶å®ƒä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬æ–‡è®¨è®ºçš„å¼•ç”¨è®¡æ•°ã€‚</p><p>NONPOINTER ISAå­˜å‚¨çš„å­—æ®µå®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># if __arm64__</span><br><span class="line">#   define ISA_MASK        0x0000000ffffffff8ULL</span><br><span class="line">#   define ISA_MAGIC_MASK  0x000003f000000001ULL</span><br><span class="line">#   define ISA_MAGIC_VALUE 0x000001a000000001ULL</span><br><span class="line">    struct &#123;</span><br><span class="line">        uintptr_t nonpointer        : 1;</span><br><span class="line">        uintptr_t has_assoc         : 1;</span><br><span class="line">        uintptr_t has_cxx_dtor      : 1;</span><br><span class="line">        uintptr_t shiftcls          : 33; // MACH_VM_MAX_ADDRESS 0x1000000000</span><br><span class="line">        uintptr_t magic             : 6;</span><br><span class="line">        uintptr_t weakly_referenced : 1;</span><br><span class="line">        uintptr_t deallocating      : 1;</span><br><span class="line">        uintptr_t has_sidetable_rc  : 1;</span><br><span class="line">        uintptr_t extra_rc          : 19;</span><br><span class="line">#       define RC_ONE   (1ULL&lt;&lt;45)</span><br><span class="line">#       define RC_HALF  (1ULL&lt;&lt;18)</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><h2 id="extra-rc"><a href="#extra-rc" class="headerlink" title="extra_rc"></a>extra_rc</h2><p>é‚£å¼•ç”¨è®¡æ•°å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿç§˜å¯†å°±åœ¨<code>extra_rc</code>ä¸­ã€‚</p><blockquote><p>extra_rcåªæ˜¯å­˜å‚¨äº†é¢å¤–çš„å¼•ç”¨è®¡æ•°ï¼Œå®é™…çš„å¼•ç”¨è®¡æ•°è®¡ç®—å…¬å¼ï¼š<code>å¼•ç”¨è®¡æ•°=extra_rc+1</code>ã€‚</p></blockquote><p><code>extra_rc</code>å äº†19ä½ï¼Œå¯ä»¥å­˜å‚¨çš„æœ€å¤§å¼•ç”¨è®¡æ•°ï¼š$2^{19}-1+1=524288$ï¼Œè¶…è¿‡å®ƒå°±éœ€è¦è¿›ä½åˆ°<code>SideTables</code>ã€‚SideTablesæ˜¯ä¸€ä¸ªHashè¡¨ï¼Œæ ¹æ®å¯¹è±¡åœ°å€å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„<code>SideTable</code>ï¼Œ<code>SideTable</code>å†…åŒ…å«ä¸€ä¸ª<code>RefcountMap</code>ï¼Œæ ¹æ®å¯¹è±¡åœ°å€å–å‡ºå…¶å¼•ç”¨è®¡æ•°ï¼Œç±»å‹æ˜¯<code>size_t</code>ã€‚<br>å®ƒæ˜¯ä¸€ä¸ª<code>unsigned long</code>ï¼Œæœ€ä½ä¸¤ä½æ˜¯æ ‡å¿—ä½ï¼Œå‰©ä¸‹çš„62ä½ç”¨æ¥å­˜å‚¨å¼•ç”¨è®¡æ•°ã€‚æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºå¼•ç”¨è®¡æ•°çš„ç†è®ºæœ€å¤§å€¼ï¼š$2^{62+19}=2.417851639229258e24$ã€‚</p><blockquote><p>å…¶å®isaèƒ½å­˜å‚¨çš„524288åœ¨æ—¥å¸¸å¼€å‘å·²ç»å®Œå…¨å¤Ÿç”¨äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æä¸ªSide Tableï¼Ÿæˆ‘çŒœæµ‹æ˜¯å› ä¸ºå†å²é—®é¢˜ï¼Œä»¥å‰cpuæ˜¯32ä½çš„ï¼Œisaä¸­èƒ½å­˜å‚¨çš„å¼•ç”¨è®¡æ•°å°±åªæœ‰$2^{7}=128$ã€‚å› æ­¤åœ¨arm64ä¸‹ï¼Œå¼•ç”¨è®¡æ•°é€šå¸¸æ˜¯å­˜å‚¨åœ¨isaä¸­çš„ã€‚</p></blockquote><h2 id="retain"><a href="#retain" class="headerlink" title="retain"></a>retain</h2><p>æœ‰äº†å‰é¢çš„é“ºå«ï¼Œæˆ‘ä»¬çŸ¥é“å¼•ç”¨è®¡æ•°æ€ä¹ˆå­˜å‚¨çš„äº†ï¼Œé‚£å¼•ç”¨è®¡æ•°åˆæ˜¯æ€ä¹ˆæ”¹å˜çš„å‘¢ï¼Ÿé€šè¿‡å‰–æ<code>retain</code>æºç æˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºç»“è®ºäº†ã€‚<br>objc_objectçš„æ–¹æ³•å…¨éƒ¨å®šä¹‰åœ¨objc-object.hæ–‡ä»¶ä¸­ï¼Œå…¨æ˜¯å†…è”å‡½æ•°ï¼Œåº”è¯¥æ˜¯ä¸ºäº†æ€§èƒ½çš„è€ƒè™‘ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>retain</code>çš„å‡½æ•°å®šä¹‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> id </span><br><span class="line">objc_object::retain()</span><br><span class="line">&#123;</span><br><span class="line">    assert(!isTaggedPointer());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fastpath(!ISA()-&gt;hasCustomRR())) &#123;</span><br><span class="line">        <span class="keyword">return</span> rootRetain();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ((id(*)(objc_object *, SEL))objc_msgSend)(<span class="keyword">this</span>, SEL_retain);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å±‚æ¯”è¾ƒç®€å•ï¼Œåšäº†ä¸‰ä»¶äº‹æƒ…ï¼š</p><ol><li>åˆ¤æ–­æŒ‡é’ˆæ˜¯ä¸æ˜¯<code>Tagged Pointer</code></li><li>åˆ¤æ–­æ˜¯å¦æœ‰è‡ªå®šä¹‰<code>retain</code>ï¼Œå¦‚æœæœ‰è°ƒç”¨è‡ªå®šä¹‰çš„ã€‚</li><li>æœ€åè°ƒç”¨<code>rootRetain</code></li></ol><p>æˆ‘ä»¬æ¥çœ‹çœ‹å…³é”®å‡½æ•°<code>rootRetain</code>çš„å®ç°ï¼ˆä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œä»£ç æœ‰æ‰€åˆ å‡ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">ALWAYS_INLINE id </span><br><span class="line">objc_object::rootRetain(<span class="keyword">bool</span> tryRetain, <span class="keyword">bool</span> handleOverflow)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">isa_t</span> oldisa;</span><br><span class="line">    <span class="keyword">isa_t</span> newisa;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ é”ï¼Œç”¨æ±‡ç¼–æŒ‡ä»¤ldxræ¥ä¿è¯åŸå­æ€§</span></span><br><span class="line">    oldisa = LoadExclusive(&amp;isa.bits);</span><br><span class="line">    newisa = oldisa;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (newisa.nonpointer = <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// newisa.nonpointer = 0è¯´æ˜æ‰€æœ‰ä½æ•°éƒ½æ˜¯åœ°å€å€¼</span></span><br><span class="line">        <span class="comment">// é‡Šæ”¾é”ï¼Œä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤clrex</span></span><br><span class="line">        ClearExclusive(&amp;isa.bits);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç”±äºæ‰€æœ‰ä½æ•°éƒ½æ˜¯åœ°å€å€¼ï¼Œç›´æ¥ä½¿ç”¨sidetableæ¥å­˜å‚¨å¼•ç”¨è®¡æ•°</span></span><br><span class="line">        <span class="keyword">return</span> sidetable_retain();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å­˜å‚¨extra_rc++åçš„ç»“æœ</span></span><br><span class="line">    <span class="keyword">uintptr_t</span> carry;</span><br><span class="line">    <span class="comment">// extra_rc++</span></span><br><span class="line">    newisa.bits = addc(newisa.bits, RC_ONE, <span class="number">0</span>, &amp;carry);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (carry == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// extra_rc++åæº¢å‡ºï¼Œè¿›ä½åˆ°side table</span></span><br><span class="line">        newisa.extra_rc = RC_HALF;</span><br><span class="line">        newisa.has_sidetable_rc = <span class="literal">true</span>;</span><br><span class="line">        sidetable_addExtraRC_nolock(RC_HALF);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// å°†newisaå†™å…¥isa</span></span><br><span class="line">    StoreExclusive(&amp;isa.bits, oldisa.bits, newisa.bits)</span><br><span class="line">    <span class="keyword">return</span> (id)<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ªç»†èŠ‚å¯ä»¥äº†è§£ä¸‹ï¼Œå¦‚ä½•ç”¨æ±‡ç¼–æ¥å®ç°åŸå­æ€§æ“ä½œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> ALWAYS_INLINE</span><br><span class="line"><span class="keyword">uintptr_t</span> </span><br><span class="line">LoadExclusive(<span class="keyword">uintptr_t</span> *src)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">uintptr_t</span> result;</span><br><span class="line">    <span class="comment">// åœ¨å¤šæ ¸CPUä¸‹ï¼Œå¯¹ä¸€ä¸ªåœ°å€çš„è®¿é—®å¯èƒ½å¼•èµ·å†²çªï¼Œldxrè§£å†³äº†å†²çªï¼Œä¿è¯åŸå­æ€§ã€‚</span></span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">"ldxr %x0, [%x1]"</span> </span><br><span class="line">        : <span class="string">"=r"</span> (result) </span><br><span class="line">        : <span class="string">"r"</span> (src), <span class="string">"m"</span> (*src));</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="release"><a href="#release" class="headerlink" title="release"></a>release</h2><p><code>release</code>ä»£ç é€»è¾‘åŸºæœ¬ä¸Šå°±æ˜¯<code>retain</code>åè¿‡æ¥èµ°ä¸€éï¼Œæœ‰ç‚¹ä¸åŒçš„æ˜¯åœ¨å¼•ç”¨è®¡æ•°å‡åˆ°0æ—¶ï¼Œä¼šè°ƒç”¨å¯¹è±¡çš„deallocæ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">ALWAYS_INLINE bool</span><br><span class="line">objc_object::rootRelease(bool performDealloc, bool handleUnderflow)</span><br><span class="line">&#123;</span><br><span class="line">    isa_t oldisa;</span><br><span class="line">    isa_t newisa;</span><br><span class="line">    </span><br><span class="line">retry:</span><br><span class="line">    oldisa = LoadExclusive(&amp;isa.bits);</span><br><span class="line">    newisa = oldisa;</span><br><span class="line">    if (newisa.nonpointer == 0) &#123;</span><br><span class="line">        ClearExclusive(&amp;isa.bits);</span><br><span class="line">        if (sideTableLocked) sidetable_unlock();</span><br><span class="line">        return sidetable_release(performDealloc);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    uintptr_t carry;</span><br><span class="line">    // extra_rc--</span><br><span class="line">    newisa.bits = subc(newisa.bits, RC_ONE, 0, &amp;carry);</span><br><span class="line">    if (carry == 0) &#123;</span><br><span class="line">        // éœ€è¦ä»SideTableå€Ÿä½ï¼Œæˆ–è€…å¼•ç”¨è®¡æ•°ä¸º0</span><br><span class="line">        goto underflow;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å­˜å‚¨å¼•ç”¨è®¡æ•°åˆ°isa</span><br><span class="line">    StoreReleaseExclusive(&amp;isa.bits,</span><br><span class="line">                          oldisa.bits, newisa.bits)</span><br><span class="line">    return false;</span><br><span class="line">    </span><br><span class="line">underflow:</span><br><span class="line">    // ä»SideTableå€Ÿä½</span><br><span class="line">    // æˆ–å¼•ç”¨è®¡æ•°ä¸º0ï¼Œè°ƒç”¨delloc</span><br><span class="line">    </span><br><span class="line">    // æ­¤å¤„çœç•¥Nå¤šä»£ç </span><br><span class="line">    // æ€»ç»“ä¸€ä¸‹:ä¿®æ”¹Side Tableä¸extra_rcï¼Œ</span><br><span class="line">    </span><br><span class="line">    // å¼•ç”¨è®¡æ•°å‡ä¸º0æ—¶ï¼Œè°ƒç”¨dealloc</span><br><span class="line">    if (performDealloc) &#123;</span><br><span class="line">        ((void(*)(objc_object *, SEL))objc_msgSend)(this, SEL_dealloc);</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><blockquote><p>å¼•ç”¨è®¡æ•°å­˜åœ¨å“ªï¼Ÿ</p></blockquote><ol><li><code>Tagged Pointer</code>ä¸éœ€è¦å¼•ç”¨è®¡æ•°</li><li><code>NONPOINTER ISA</code>(isaçš„ç¬¬ä¸€ä½ä¸º1)çš„å¼•ç”¨è®¡æ•°ä¼˜å…ˆå­˜åœ¨isaä¸­ï¼Œå¤§äº524288äº†è¿›ä½åˆ°<code>Side Tables</code></li><li>é<code>NONPOINTER ISA</code>å¼•ç”¨è®¡æ•°å­˜åœ¨<code>Side Tables</code></li></ol><blockquote><p>retain/releaseçš„å®è´¨</p></blockquote><ul><li>æ‰¾åˆ°å¼•ç”¨è®¡æ•°å­˜å‚¨åŒºåŸŸï¼Œç„¶å+1/-1</li><li>å¦‚æœæ˜¯<code>NONPOINTER ISA</code>ï¼Œè¿˜è¦å¤„ç†è¿›ä½/å€Ÿä½çš„æƒ…å†µ</li><li>releaseåœ¨å¼•ç”¨è®¡æ•°å‡ä¸º0æ—¶ï¼Œè°ƒç”¨<code>dealloc</code></li></ul><hr><p>å‚è€ƒ</p><ul><li><a href="https://github.com/Draveness/analyze/blob/master/contents/objc/é»‘ç®±ä¸­çš„%20retain%20å’Œ%20release.md" target="_blank" rel="noopener">é»‘ç®±ä¸­çš„ retain å’Œ release</a></li><li><a href="http://www.infoq.com/cn/articles/deep-understanding-of-tagged-pointer" target="_blank" rel="noopener">æ·±å…¥ç†è§£Tagged Pointer</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ¶‰åŠåˆ°çš„CPUæ¶æ„ä¸ºarm64ï¼Œå…¶å®ƒæ¶æ„å¤§åŒå°å¼‚ã€‚&lt;br&gt;æºç æ¥è‡ª&lt;a href=&quot;https://opensource.apple.com/tarballs/objc4/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è‹¹æœå¼€
      
    
    </summary>
    
    
      <category term="iOSçŸ¥è¯†å°ç»“" scheme="https://crmo.github.io/tags/iOS%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>Cordovaæºç è§£æï¼ˆäºŒï¼‰- è‡ªå®šä¹‰UserAgent</title>
    <link href="https://crmo.github.io/2018/05/15/Cordova%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89-%20%E8%87%AA%E5%AE%9A%E4%B9%89UserAgent/"/>
    <id>https://crmo.github.io/2018/05/15/Cordovaæºç è§£æï¼ˆäºŒï¼‰- è‡ªå®šä¹‰UserAgent/</id>
    <published>2018-05-14T16:00:00.000Z</published>
    <updated>2018-10-07T08:13:37.929Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡åˆ†æçš„æºç æ˜¯åŸºäºCordova 4.2.1ç‰ˆæœ¬ï¼Œ<a href="https://cordova.apache.org" target="_blank" rel="noopener">Cordovaå®˜ç½‘</a>ã€‚</p><h1 id="Cordovaæºç è§£æï¼ˆäºŒï¼‰-è‡ªå®šä¹‰UserAgent"><a href="#Cordovaæºç è§£æï¼ˆäºŒï¼‰-è‡ªå®šä¹‰UserAgent" class="headerlink" title="Cordovaæºç è§£æï¼ˆäºŒï¼‰- è‡ªå®šä¹‰UserAgent"></a>Cordovaæºç è§£æï¼ˆäºŒï¼‰- è‡ªå®šä¹‰UserAgent</h1><p><code>UIWebView</code>æ²¡æœ‰æä¾›è®¾ç½®UserAgentçš„æ¥å£ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªåŠæ³•å¯ä»¥é—´æ¥çš„è®¾ç½®ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSDictionary* dict = [[NSDictionary alloc] initWithObjectsAndKeys:value, @&quot;UserAgent&quot;, nil];</span><br><span class="line">[[NSUserDefaults standardUserDefaults] registerDefaults:dict];</span><br></pre></td></tr></table></figure><p>é€šè¿‡è®¾ç½®<code>NSUserDefaults</code>ä¸­<code>UserAgent</code>çš„å€¼æ¥ä¿®æ”¹ï¼Œä½†æ˜¯è¿™ç§è®¾ç½®æ–¹æ³•æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œéœ€è¦åœ¨<code>UIWebView</code>çš„<code>loadRequest</code>ä¹‹å‰è°ƒç”¨æ‰èƒ½ç”Ÿæ•ˆ(åŠ è½½PDFæ¯”è¾ƒç‰¹æ®Š)ã€‚è¿™æ˜¯Cordovaæºç ä¸­å…³äºè¿™ä¸ªé—®é¢˜çš„æè¿°</p><blockquote><p>Setting the UserAgent must occur before a UIWebView is instantiated.<br>It is read per instantiation, so it does not affect previously created views.<br>Except! When a PDF is loaded, all currently active UIWebViews reload their<br>User-Agent from the NSUserDefaults some time after the DidFinishLoad of the PDF bah!</p></blockquote><h2 id="CDVUserAgentUtil"><a href="#CDVUserAgentUtil" class="headerlink" title="CDVUserAgentUtil"></a>CDVUserAgentUtil</h2><p>åœ¨å¤šWebViewçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ¯ä¸ªWebViewéƒ½æœ‰ä¸åŒçš„<code>UserAgent</code>ï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®ç«äº‰çš„é—®é¢˜ï¼Œå¤§å®¶éƒ½è¦ä¿®æ”¹<code>NSUserDefaults</code>ä¸­<code>UserAgent</code>çš„å€¼ï¼Œäºæ˜¯éœ€è¦å¯¹èµ„æºåŠ é”æ¥ä¿è¯æ¯ä¸ªWebViewéƒ½è®¾ç½®é¢„æœŸçš„<code>UserAgent</code>ã€‚åœ¨Cordovaä¸­ï¼Œä¸“é—¨æœ‰ä¸€ä¸ªç±»<code>CDVUserAgentUtil</code>æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p><code>CDVUserAgentUtil.h</code>æ–‡ä»¶ä¸­å®šä¹‰äº†å››ä¸ªæ–¹æ³•</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–UIWebViewé»˜è®¤çš„UserAgent</span></span><br><span class="line">+ (<span class="built_in">NSString</span>*)originalUserAgent;</span><br><span class="line"><span class="comment">// è·å–é”</span></span><br><span class="line">+ (<span class="keyword">void</span>)acquireLock:(<span class="keyword">void</span> (^)(<span class="built_in">NSInteger</span> lockToken))block;</span><br><span class="line"><span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">+ (<span class="keyword">void</span>)releaseLock:(<span class="built_in">NSInteger</span>*)lockToken;</span><br><span class="line"><span class="comment">// è®¾ç½®UIWebViewçš„UserAgent</span></span><br><span class="line">+ (<span class="keyword">void</span>)setUserAgent:(<span class="built_in">NSString</span>*)value lockToken:(<span class="built_in">NSInteger</span>)lockToken;</span><br></pre></td></tr></table></figure><h2 id="åŠ é”"><a href="#åŠ é”" class="headerlink" title="åŠ é”"></a>åŠ é”</h2><p>æ¯æ¬¡åŠ é”æˆåŠŸä¼šè¿”å›ä¸€ä¸ªNSIntegerç±»å‹çš„tokenï¼Œåœ¨é‡Šæ”¾é”çš„æ—¶å€™éœ€è¦æŠŠtokenä¼ å…¥ã€‚tokenä¼šä¸æ–­é€’å¢ï¼Œä¿è¯æ¯æ¬¡åŠ é”è¿”å›çš„tokenéƒ½ä¸å›é‡å¤ã€‚åŠ é”çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CDVUserAgentUtil.m</span></span><br><span class="line">+ (<span class="keyword">void</span>)acquireLock:(<span class="keyword">void</span> (^)(<span class="built_in">NSInteger</span> lockToken))block</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (gCurrentLockToken == <span class="number">0</span>) &#123;</span><br><span class="line">        gCurrentLockToken = ++gNextLockToken;</span><br><span class="line">        VerboseLog(<span class="string">@"Gave lock %d"</span>, gCurrentLockToken);</span><br><span class="line">        block(gCurrentLockToken);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (gPendingSetUserAgentBlocks == <span class="literal">nil</span>) &#123;</span><br><span class="line">            gPendingSetUserAgentBlocks = [[<span class="built_in">NSMutableArray</span> alloc] initWithCapacity:<span class="number">4</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        VerboseLog(<span class="string">@"Waiting for lock"</span>);</span><br><span class="line">        [gPendingSetUserAgentBlocks addObject:block];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨<code>acquireLock:</code>ï¼Œé¦–å…ˆä¼šåˆ¤æ–­<code>gCurrentLockToken</code>æ˜¯å¦ç­‰äº0</p><ul><li>å¦‚æœæ˜¯0è¯´æ˜æ²¡æœ‰æ¨¡å—æ­£åœ¨ä¿®æ”¹<code>UserAgent</code>ï¼Œèƒ½å¤ŸæˆåŠŸè·å–åˆ°é”ï¼Œ<code>gCurrentLockToken</code>é€’å¢ï¼Œæ ‡è‡´å½“å‰æœ‰æ¨¡å—æ­£åœ¨ä¿®æ”¹<code>UserAgent</code>ï¼Œå¹¶å›è°ƒ<code>block</code>ï¼Œè¿”å›<code>gCurrentLockToken</code></li><li>å¦‚æœä¸ä¸º0è¯´æ˜å½“å‰æœ‰æ¨¡å—æ­£åœ¨ä¿®æ”¹<code>UserAgent</code>ï¼Œå°†<code>block</code>å›è°ƒå­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—<code>gPendingSetUserAgentBlocks</code>ä¸­</li></ul><h2 id="é‡Šæ”¾é”"><a href="#é‡Šæ”¾é”" class="headerlink" title="é‡Šæ”¾é”"></a>é‡Šæ”¾é”</h2><p>é‡Šæ”¾é”éœ€è¦ä¼ å…¥tokenï¼Œé‡Šæ”¾é”ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)releaseLock:(<span class="built_in">NSInteger</span>*)lockToken</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (*lockToken == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSAssert</span>(gCurrentLockToken == *lockToken, <span class="string">@"Got token %ld, expected %ld"</span>, (<span class="keyword">long</span>)*lockToken, (<span class="keyword">long</span>)gCurrentLockToken);</span><br><span class="line"></span><br><span class="line">    VerboseLog(<span class="string">@"Released lock %d"</span>, *lockToken);</span><br><span class="line">    <span class="keyword">if</span> ([gPendingSetUserAgentBlocks count] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">void</span> (^block)() = [gPendingSetUserAgentBlocks objectAtIndex:<span class="number">0</span>];</span><br><span class="line">        [gPendingSetUserAgentBlocks removeObjectAtIndex:<span class="number">0</span>];</span><br><span class="line">        gCurrentLockToken = ++gNextLockToken;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Gave lock %ld"</span>, (<span class="keyword">long</span>)gCurrentLockToken);</span><br><span class="line">        block(gCurrentLockToken);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        gCurrentLockToken = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    *lockToken = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœè¦é‡Šæ”¾çš„<code>lockToken</code>ä¸º0ï¼Œè¯´æ˜è¿˜æ²¡åŠ è¿‡é”ï¼Œå°±è°ƒç”¨é‡Šæ”¾äº†ï¼Œç›´æ¥è¿”å›</li><li>ä»é˜Ÿåˆ—<code>gPendingSetUserAgentBlocks</code>ä¸­å–å‡ºæœ€æ—©åŠ å…¥çš„<code>block</code>ï¼Œä»é˜Ÿåˆ—ä¸­ç§»é™¤</li><li><code>gCurrentLockToken</code>é€’å¢ç”Ÿæˆæ–°tokenï¼Œå›è°ƒ<code>block</code></li><li>å¦‚æœé˜Ÿåˆ—<code>gPendingSetUserAgentBlocks</code>é‡Šæ”¾å®Œæˆï¼Œè¯´æ˜é‡Šæ”¾é”çš„è°ƒç”¨æ¬¡æ•°&gt;åŠ é”çš„æ¬¡æ•°ï¼Œä¸åšæ“ä½œï¼Œç„¶åæŠŠ<code>gCurrentLockToken</code>ç½®ä¸º0</li></ul><h2 id="è®¾ç½®UserAgent"><a href="#è®¾ç½®UserAgent" class="headerlink" title="è®¾ç½®UserAgent"></a>è®¾ç½®UserAgent</h2><p>åœ¨Cordovaå®é™…è¿ç”¨ä¸­ï¼Œæ“ä½œé”çš„æ—¶æœºï¼š<br>åŠ é”æ—¶æœºï¼š<code>CDVViewController</code>åŠ è½½å®Œæ¯•ï¼Œåœ¨<code>viewDidLoad</code>é‡Œè°ƒç”¨<br>é‡Šæ”¾é”æ—¶æœºï¼š</p><ul><li><code>UIWebView</code>çš„<code>webViewDidFinishLoad:</code>å›è°ƒ</li><li><code>UIWebView</code>çš„<code>webView:didFailLoadWithError:</code>å›è°ƒ</li><li><code>CDVViewController</code>çš„<code>dealloc</code></li><li><code>CDVViewController</code>çš„<code>viewDidUnload</code></li></ul><p>åŠ é”ä»£ç ï¼Œçœç•¥äº†ä¸ç›¸å…³ä»£ç </p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CDVViewController.m</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    [CDVUserAgentUtil acquireLock:^(<span class="built_in">NSInteger</span> lockToken) &#123;</span><br><span class="line">        _userAgentLockToken = lockToken;</span><br><span class="line">        [CDVUserAgentUtil setUserAgent:<span class="keyword">self</span>.userAgent lockToken:lockToken];</span><br><span class="line">        <span class="built_in">NSURLRequest</span>* appReq = [<span class="built_in">NSURLRequest</span> requestWithURL:appURL cachePolicy:<span class="built_in">NSURLRequestUseProtocolCachePolicy</span> timeoutInterval:<span class="number">20.0</span>];</span><br><span class="line">        [<span class="keyword">self</span>.webViewEngine loadRequest:appReq];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡Šæ”¾é”ä»£ç ï¼Œè¿™é‡Œåªçœ‹æ­£å¸¸é€»è¾‘ï¼Œåœ¨ç½‘é¡µåŠ è½½å®Œæˆå›è°ƒ<code>webViewDidFinishLoad:</code>ä¸­é‡Šæ”¾é€»è¾‘ã€‚ä¸è€ƒè™‘å¼‚å¸¸æƒ…å†µï¼Œçœç•¥äº†ä¸ç›¸å…³ä»£ç ã€‚</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CDVUIWebViewNavigationDelegate.m</span></span><br><span class="line">- (<span class="keyword">void</span>)webViewDidFinishLoad:(<span class="built_in">UIWebView</span>*)theWebView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Finished load of: %@"</span>, theWebView.request.URL);</span><br><span class="line">    CDVViewController* vc = (CDVViewController*)<span class="keyword">self</span>.enginePlugin.viewController;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// It's safe to release the lock even if this is just a sub-frame that's finished loading.</span></span><br><span class="line">    [CDVUserAgentUtil releaseLock:vc.userAgentLockToken];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>webViewDidFinishLoad:</code>å›è°ƒæ—¶ï¼ŒUserAgentå·²ç»è®¾ç½®æˆåŠŸï¼Œæ‰€ä»¥å¯ä»¥é‡Šæ”¾é”ï¼Œè®©å…¶å®ƒWebViewæ“ä½œUserDefaultäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡åˆ†æçš„æºç æ˜¯åŸºäºCordova 4.2.1ç‰ˆæœ¬ï¼Œ&lt;a href=&quot;https://cordova.apache.org&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Cordovaå®˜ç½‘&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h1 id=&quot;Cordovaæºç è§£æï¼ˆäºŒï¼‰-è‡ª
      
    
    </summary>
    
    
      <category term="æºç å­¦ä¹ " scheme="https://crmo.github.io/tags/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
</feed>
